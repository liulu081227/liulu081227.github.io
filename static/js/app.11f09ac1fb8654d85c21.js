(self.webpackChunkGaeaDecision=self.webpackChunkGaeaDecision||[]).push([[143],{40647:(e,t,s)=>{"use strict";var i=s(21931),a=s(35908),o=s(83851),n=s(88712),r=s.n(n);const l={assetsArr:[{type:"fact",name:"数据模型",icon:"iconfont iconshujumoxing",add:!0},{type:"constant",name:"枚举常量",icon:"iconfont iconxinzengchangliang",add:!0},{type:"guidedrule",name:"向导式决策集",icon:"iconfont iconweibiaoti-",add:!0},{type:"rulescript",name:"脚本式决策集",icon:"iconfont el-icon-edit",add:!0},{type:"ruletable",name:"决策表",icon:"iconfont iconjuecebiao",add:!0},{type:"crosstab",name:"交叉决策表",icon:"el-icon-document-copy",add:!1},{type:"ruletree",name:"决策树",icon:"iconfont iconjuxingkaobei",add:!0},{type:"scorecard",name:"评分卡",icon:"iconfont iconpingfenqia",add:!0},{type:"ruleflow",name:"决策流",icon:"iconfont icongongzuoliu",add:!0},{type:"testcase",name:"测试案例",icon:"el-icon-s-claim",add:!0},{type:"dir",name:"文件夹",icon:"el-icon-folder-add",add:!0},{type:"pkg",name:"知识包",icon:"el-icon-suitcase",add:!1},{type:"search",name:"搜索结果",icon:"el-icon-search",add:!1},{type:"recycle",name:"回收站",icon:"el-icon-delete",add:!1},{type:"func",name:"自定义函数",icon:"iconfont iconhanshu",add:!1}],isNumber:e=>"Integer"==e||"Long"==e||"Double"==e||"BigDecimal"==e||"Number"==e,isBoolean:e=>"Boolean"==e,isString:e=>"String"==e,isDate:e=>"Date"==e,isDateTime:e=>"DateTime"==e,isList:e=>!l.isBlank(e)&&(!("string"!=typeof e||!e.startsWith("List"))||"object"==typeof e&&"List"===e.type),isSet:e=>!l.isBlank(e)&&(!("string"!=typeof e||!e.startsWith("Set"))||"object"==typeof e&&"Set"===e.type),isDerive:e=>"Derive"==e,isCollection:e=>l.isList(e)||l.isSet(e),isObject:e=>e&&("Map"===e||"Object"===e||32==e.length),isTypeMatch:(e,t)=>!!(e&&t&&((e=e.trim())==(t=t.trim())||l.isCollection(e)&&l.isCollection(t)||l.isNumber(e)&&l.isNumber(t)||l.isObject(e)&&l.isObject(t)||"Collection"==e&&("List"==t||"Set"==t)||"Collection"==t&&("List"==e||"Set"==e))),isTypeNotMatch:(e,t)=>!l.isTypeMatch(e,t),getFieldType:e=>l.isList(e.type)||l.isSet(e.type)?{type:e.type,subType:e.subType}:e.type,getAssetsTypeText:function(e){return this.getAssetsByType(e).name},getAssetsTypeIcon:function(e){return this.getAssetsByType(e).icon},getAssetsByType:function(e){let t;return this.assetsArr.some((s=>{if(s.type==e)return t=s,!0})),t},isBlank:e=>null==e||"string"==typeof e&&""===e.trim(),isNotBlank:e=>!l.isBlank(e),isAnyBlank(){for(let e=0;e<arguments.length;e++)if(l.isBlank(arguments[e]))return!0;return!1},randomCode:e=>{let t="";for(let s=0;s<e;s++){const e=parseInt(62*Math.random(),10);t+="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".charAt(e)}return t},fieldTypeArr:["String","Integer","Double","Long","BigDecimal","Boolean","Date","DateTime","List","Map","Derive"],fieldBaseTypeArr:["String","Integer","Double","Long","BigDecimal","Boolean","Date","DateTime"],isBaseType:e=>-1!=l.fieldBaseTypeArr.indexOf(e)||l.isNumber(e),log:e=>{console.log(e)},equals:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.trim()===t.trim()||"object"==typeof e&&"object"==typeof t&&JSON.stringify(e)===JSON.stringify(t)||e===t,copy:e=>e?JSON.parse(JSON.stringify(e)):{},unique:e=>Array.from(new Set(e)),simpleClone:e=>{var t={};for(var s in e)t[s]=e[s];return t},clearTmpKey:e=>{e&&(Array.isArray(e)?e.forEach((e=>l.clearTmpKey(e))):Object.keys(e).forEach((t=>{t.startsWith("_")?delete e[t]:Array.isArray(e[t])?e[t].forEach((e=>{l.clearTmpKey(e)})):"object"==typeof e[t]&&l.clearTmpKey(e[t])})))},arrayFind:(e,t)=>{if("function"==typeof e.find)return e.find(t);const s=e.filter(t);return s.length>0?s[0]:null},arrayFindIndex:(e,t)=>{if("function"==typeof e.findIndex)return e.findIndex(t);let s=-1;return e.some(((e,i)=>{if(t(e))return s=i,!0})),s},arrayFlat:e=>{if("function"==typeof e.flat)return e.flat();const t=[];return e.forEach((e=>{Array.isArray(e)?l.arrayFlat(e).forEach((e=>{t.push(e)})):t.push(e)})),t},getCollectionSubType:e=>{const t=e.indexOf(".");return-1!=t?e.substring(t+1):null},checkUploadFile:(e,t)=>{if(e.size>31457280)return(0,n.Message)({type:"error",message:"上传文件大小不能超过30MB",showClose:!0}),!1;if(t){let s=!1;if(Array.isArray(t)?t.some((t=>{if(e.name.endsWith("."+t))return s=!0,!0})):s=e.name.endsWith("."+t),!s)return(0,n.Message)({type:"error",message:"不支持的文件类型",showClose:!0}),!1}return!0}},c={install:function(e,t={}){e.prototype.$utils=l},utils:l},d={setPkg(e,t){e.pkg=t},setPkgs(e,t){e.pkgs=t},setsAssetsLink(e,t){e.assetsLink=t},setAddTreeNode(e,t){e.addTreeNode=t},setRecyle(e,t){e.reloadRecyle=t},refreshBoms(e,t){"facts"in t&&(e.factMap={},e.fieldMap={},e.subFactIds=[],t.facts.forEach((t=>{e.factMap[t.uuid]=t,t.fields.forEach((s=>{e.fieldMap[t.uuid+"."+s.id]=s,c.utils.isObject(s.type)?-1==e.subFactIds.indexOf(s.subType)&&e.subFactIds.push(s.subType):c.utils.isCollection(s.type)&&c.utils.isObject(s.subType)&&-1==e.subFactIds.indexOf(s.subType)&&e.subFactIds.push(s.subType)}))})),e.facts=t.facts),"constants"in t&&(e.constants=t.constants),"functions"in t&&(e.functions=t.functions),"models"in t&&(e.models=t.models),"thirdapis"in t&&(e.thirdapis=t.thirdapis)},setUser(e,t){e.user=t},resetUser(e){e.user=null}};var u=s(90421),p=s.n(u);const h={getFactById:e=>(t,s)=>{let i=e.factMap[t];if(!i)return null;const a={id:i.uuid,name:i.name};return s?(a.fields=[],i.fields.some((e=>{if(e.id===s)return a.fields.push(e),!0}))):a.fields=i.fields,a},getAllFuncFact:e=>{let t={};return t.functions=e.functions,t.facts=e.facts,t},getFactText:e=>(t,s)=>{if(!t)return"";const i=e.factMap[t];if(!i)return"";let a=[i.name];if(s)if(-1==s.indexOf(",")){const i=e.fieldMap[t+"."+s];i&&a.push(i.label)}else{let i=t;s.split(",").some((t=>{const s=e.fieldMap[i+"."+t];return!s||(a.push(s.label),!c.utils.isObject(s.type)||void(i=s.subType))}))}return a.join(".")},getConstantText:e=>(t,s)=>{let i;return(t||s)&&e.constants.some((e=>{if(e.uuid==t)return s?e.fields.some((t=>{if(t.id==s)return i=e.name+"."+t.label,!0})):i=e.name,!0})),i},getModelName:e=>t=>{let s;return t&&e.models.some((e=>{if(e.uuid==t)return s=e.modelName,!0})),s},getFactField:e=>(t,s)=>{let i;if(t&&s)if(-1==s.indexOf(","))i=e.fieldMap[t+"."+s];else{let a=t;s.split(",").some((t=>(i=e.fieldMap[a+"."+t],!i||!c.utils.isObject(i.type)||void(a=i.subType))))}return i},getFieldText:e=>(t,s)=>{if(!t)return"";if(!e.factMap[t])return"";let i=[];if(s)if(-1==s.indexOf(",")){const a=e.fieldMap[t+"."+s];a&&i.push(a.label)}else{let a=t;s.split(",").some((t=>{const s=e.fieldMap[a+"."+t];return!s||(i.push(s.label),!c.utils.isObject(s.type)||void(a=s.subType))}))}return i.join(".")},getConstantField:e=>(t,s)=>{let i;return t&&s&&e.constants.some((e=>{if(e.uuid===t)return e.fields.some((e=>{if(e.id===s)return i=e,!0})),!0})),i},getFuncMethod:e=>(t,s)=>{let i;return t&&s&&e.functions.some((e=>{if(e.name==t)return e.methods.some((e=>{if(e.name==s)return i=JSON.parse(JSON.stringify(e)),!0})),!0})),i},getFactFields:e=>t=>{let s;return e.facts.some((e=>{if(e.uuid===t)return s=e.fields,!0})),s||[]},getThirdApiName:e=>t=>{let s;return e.thirdapis.some((e=>{if(e.uuid==t)return s=e.name,!0})),s},getExpressionType:(e,t)=>(s,i)=>{let a;if(!s||!s.type)return null;if("INPUT"==s.type)a="String";else if("FACT"==s.type&&s.fact){if(c.utils.isNotBlank(s.fact.fieldId)){const e=t.getFactField(s.fact.id,s.fact.fieldId);e&&(a=e.type,c.utils.isCollection(a)?a+="."+e.subType:"Derive"==a&&e.deriveData&&(a=t.getExpressionType(JSON.parse(e.deriveData))))}else if(e.factMap[s.fact.id])return"Map"}else if("CONSTANT"==s.type&&s.constant){const e=t.getConstantField(s.constant.id,s.constant.fieldId);e&&(a=e.type)}else if("FUNC"==s.type&&s.func){const e=t.getFuncMethod(s.func.name,s.func.method);e&&(a=e.returnType)}else if("MODEL"==s.type)a="String";else if("COLLECTION_CHILD"==s.type&&i){let e=t.getFactField(i.id,i.fieldId);e&&(c.utils.isBaseType(e.subType)?a=e.subType:s.collectionChild&&s.collectionChild.id&&(e=t.getFactField(s.collectionChild.id,s.collectionChild.fieldId),e&&(a=e.type)))}return a},getFactExpressionByText:(e,t)=>t=>{if(!t)return null;const s=t.split(".");if(s.length<=0)return null;let i;const a=s[0];if(e.facts.some((e=>{if(a==e.name)return i=e,!0})),!i)return null;const o=(e,t)=>{let s;return e.fields.some((e=>{if(e.label===t)return s=e,!0})),s};let n=i,r=[];for(let t=1;t<s.length;t++){const i=o(n,s[t]);if(!i)return null;if(r.push(i.id),c.utils.isObject(i.type)&&(n=e.factMap[i.subType],!n))return null}return{id:i.uuid,fieldId:r.join(",")}},getFactDefaultValueById:(e,t)=>s=>{const i=e.factMap[s];return i?t.getFactDefaultValue(i):{}},getFactDefaultValue:(e,t)=>e=>{const s={};return e.fields.forEach((e=>{s[e.name]=t.getFieldDefaultValue(e)})),s},getFieldDefaultValue:(e,t)=>s=>{if(c.utils.isString(s.type))return"";if(c.utils.isNumber(s.type))return 0;if(c.utils.isBoolean(s.type))return!1;if(c.utils.isDate(s.type))return p()(new Date).format("YYYY-MM-DD");if(c.utils.isDateTime(s.type))return p()(new Date).format("YYYY-MM-DD HH:mm:ss");if(c.utils.isCollection(s.type))return c.utils.isObject(s.subType)?[t.getFieldDefaultValue({type:"Map",subType:s.subType})]:[t.getFieldDefaultValue({type:s.subType})];if(c.utils.isObject(s.type)){const i=e.factMap[s.subType];return i?t.getFactDefaultValue(i):null}},userUuid:e=>{const t=e.user;return null!=t?t.uuid:null},userRealname:e=>{const t=e.user;return null==t?null:t.realname?t.realname:t.username}};var m=s(24559),f=s.n(m),g=s(90520),v=s.n(g);let b=window.location.protocol+"//"+window.location.host+"/gaea",w=window.location.protocol+"//"+window.location.host+"/openapi";window.baseUrl=b,window.openapiUrl=w;const y={install:function(e,t={}){f().defaults.baseURL=b,f().interceptors.request.use((e=>(e.crossDomain=!0,e.withCredentials=!0,e)),(e=>Promise.reject(e))),f().interceptors.response.use((e=>{if(401==e.data.code){localStorage.removeItem("hasLogin");let t=ho.currentRoute.fullPath;return t.startsWith("/login")||ho.push("/login?from="+t),e}return-2==e.data.code?ho.push("/nolicense"):2!=e.data.code&&3!=e.data.code||(localStorage.setItem("forceChangePwdCode",e.data.code),ho.push("/forcechangepwd")),e}),(e=>{e.response?console.log(e.response):"Network Error"==e.message&&(n.Message.closeAll(),(0,n.Message)({type:"error",message:"请求失败，请检查接口服务是否启用",showClose:!0}))})),e.prototype.$axios=f(),e.prototype.$qs=v()},axios:f(),qs:v()},_=(e,t)=>{y.axios.get("/function/modeling",{params:{projectUuid:t.projectUuid}}).then((t=>{0==t.data.code&&e("refreshBoms",{functions:t.data.data})}))},x={loadBoms({commit:e},t){((e,t)=>{y.axios.get("/bom",{params:{projectUuid:t.projectUuid}}).then((s=>{0==s.data.code&&(e("refreshBoms",s.data.data),t.callback&&t.callback())}))})(e,t),!t.ignoreFunc&&_(e,t),!t.ignoreModel&&(e=>{y.axios.get("/aimodel").then((t=>{0==t.data.code&&(t.data.data.forEach((e=>{e.text=e.modelName})),e("refreshBoms",{models:t.data.data}))}))})(e),!t.ignoreThirdApi&&(e=>{y.axios.get("/thirdapi").then((t=>{0==t.data.code&&e("refreshBoms",{thirdapis:t.data.data})}))})(e)},loadFunctions({commit:e},t){_(e,t)},getUserProfile:({commit:e})=>new Promise(((t,s)=>{y.axios.get("/user/profile").then((i=>{0==i.data.code?(e("setUser",i.data.data),t(i.data.data)):s(i)})).catch((e=>{s(e)}))}))};i.default.use(o.ZP);const k=new o.ZP.Store({state:{facts:[],factMap:{},fieldMap:{},constants:[],functions:[],models:[],thirdapis:[],pkg:{},pkgs:[],assetsLink:{},user:null,addTreeNode:{},reloadRecyle:!1},getters:h,mutations:d,actions:x});function $(e,t){const s=T(e),i=T(t);let a=0;for(let e=0,t=i.length;e<t;e++){const t=i[e];if(s.length-1<a)return!0;{const e=s[a];if(-1==e.indexOf("*")&&!D(e,t))return!1;a++}}for(;a<s.length;){if(-1==s[a].indexOf("*"))return!1;a++}return!0}function T(e){e=e.trim().toLocaleLowerCase();const t=[];return e.split(":").forEach((e=>{t.push(e.split(","))})),t}function D(e,t){for(let s=0,i=t.length;s<i;s++)if(-1==e.indexOf(t[s]))return!1;return!0}function S(e){const t=k.state.user;if(!t)return!1;if("superadmin"==t.username)return!0;if(!t.permissions)return!1;for(let s=0;s<t.permissions.length;s++)if($(t.permissions[s],e))return!0;return!1}var C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-header",{staticClass:"header"},[s("div",{staticClass:"headImg"},[s("router-link",{staticClass:"headWidth",attrs:{to:"/"}}),e._v(" "),s("div",{staticStyle:{display:"inline-block"}},[e.$hasPerm("menu:view:decision")?s("div",{staticClass:"menu_list",class:{active:1==e.menuIndex||e.isCurrentModule("/decision")},on:{mouseover:function(t){e.menuIndex=1},mouseout:function(t){e.menuIndex=-1}}},[s("div",{staticClass:"dropdown"},[s("router-link",{staticClass:"menu_manage dropdown-toggle",attrs:{to:"/decision"}},[e._v("\n              决策建模\n            ")])],1)]):e._e(),e._v(" "),e.$hasPerm("menu:view:microservice")?s("div",{staticClass:"menu_list",class:{active:2==e.menuIndex||e.isCurrentModule("/microservice")},on:{mouseover:function(t){e.menuIndex=2},mouseout:function(t){e.menuIndex=-1}}},[s("div",{staticClass:"dropdown"},[s("router-link",{staticClass:"menu_manage dropdown-toggle",attrs:{to:"/microservice"}},[e._v("\n              决策服务\n            ")])],1)]):e._e(),e._v(" "),e.$hasPerm("menu:view:systemadmin")?s("div",{staticClass:"menu_list",class:{active:5==e.menuIndex||e.isCurrentModule("/settings")},on:{mouseover:function(t){e.menuIndex=5},mouseout:function(t){e.menuIndex=-1}}},[s("div",{staticClass:"dropdown"},[s("router-link",{staticClass:"menu_manage dropdown-toggle",attrs:{to:"/settings"}},[e._v("\n              系统管理\n            ")]),e._v(" "),s("ul",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"header-system"}})],1)]):e._e()])],1),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("div",{staticClass:"menu_list",class:{active:6==e.menuIndex},on:{mouseover:function(t){e.menuIndex=6},mouseout:function(t){e.menuIndex=-1}}},[s("div",{staticClass:"dropdown"},[s("a",{staticClass:"username"},[s("i",{staticClass:"el-icon-user-solid"}),e._v("\n            "+e._s(e.realname)+"\n          ")]),e._v(" "),s("ul",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"userCenter"}},[s("li",[s("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.showChangePwd=!0}}},[s("i",{staticClass:"el-icon-key"}),e._v("修改密码\n              ")])])])])]),e._v(" "),s("div",{staticClass:"menu_list",class:{active:7==e.menuIndex},on:{mouseover:function(t){e.menuIndex=7},mouseout:function(t){e.menuIndex=-1}}},[s("div",{staticClass:"dropdown"},[s("a",{staticClass:"userquit",attrs:{href:"javascript:;"},on:{click:e.logout}},[s("i",{staticClass:"iconfont icontuichu2"}),e._v("\n            注销\n          ")])])])])]),e._v(" "),s("el-main",{staticStyle:{padding:"0",height:"100%"}},[s("change-pwd",{attrs:{show:e.showChangePwd},on:{"update:show":function(t){e.showChangePwd=t}}}),e._v(" "),s("router-view")],1)],1)};C._withStripped=!0;var N=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"修改密码",visible:e.show,width:"30%",modal:!e.force,"show-close":!e.force,"close-on-click-modal":!e.force,"close-on-press-escape":!e.force},on:{"update:visible":e.cancel,opened:function(t){return e.$refs.input.focus()},closed:function(t){return e.$refs.form.resetFields()}}},[e.force?s("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"warning",title:e.tips,"show-icon":"",closable:!1}}):e._e(),e._v(" "),s("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"100px"}},[s("el-form-item",{staticClass:"is-required",attrs:{label:"旧密码",prop:"oldPassword"}},[s("el-input",{ref:"input",attrs:{type:"password","show-password":"",placeholder:"请填写旧密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1),e._v(" "),s("el-form-item",{staticClass:"is-required",attrs:{label:"新密码",prop:"newPassword"}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:"请填写新密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}})],1),e._v(" "),s("el-form-item",{staticClass:"is-required",attrs:{label:"确认新密码",prop:"reNewPassword"}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:"请确认新密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.reNewPassword,callback:function(t){e.$set(e.form,"reNewPassword",t)},expression:"form.reNewPassword"}})],1)],1),e._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[e.force?s("el-button",{attrs:{icon:"iconfont icontuichu2"},on:{click:e.forceLogout}},[e._v("注 销")]):s("el-button",{attrs:{icon:"el-icon-error"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.loading},on:{click:e.submit}},[e._v("\n      "+e._s(e.loading?"提交中...":"确 认")+"\n    ")])],1)],1)};N._withStripped=!0;const L={name:"index",props:{show:Boolean,code:{type:Number,default:0}},data(){return{form:{oldPassword:"",newPassword:"",reNewPassword:""},rules:{oldPassword:[{validator:(e,t,s)=>{""===t?s(new Error("请填写旧密码")):s()},trigger:"blur"}],newPassword:[{validator:(e,t,s)=>{""===t?s(new Error("请填写新密码")):(""!==this.form.reNewPassword&&this.$refs.form.validateField("reNewPassword"),s())},trigger:"blur"},{min:6,message:"长度至少6位",trigger:"blur"}],reNewPassword:[{validator:(e,t,s)=>{""===t?s(new Error("请确认新密码")):t!==this.form.newPassword?s(new Error("两次填写新密码不一致!")):s()},trigger:"blur"},{min:6,message:"长度至少6位",trigger:"blur"}]},loading:!1,force:this.code>0,tips:2==this.code?"初次登录，请修改密码":"密码过期，请修改密码"}},mounted(){this.$refs.input&&this.$nextTick((()=>this.$refs.input.focus()))},methods:{cancel(){this.$emit("update:show",!1)},submit(){this.$refs.form.validate((e=>{e&&(this.loading=!0,this.$axios.post("/user/editmypwd",this.$qs.stringify({oldPassword:this.form.oldPassword,newPassword:this.form.newPassword})).then((e=>{this.loading=!1,0==e.data.code?(this.$message.success("修改成功"),this.force?(localStorage.removeItem("forceChangePwdCode"),this.$router.back()):this.forceLogout()):this.$message.error(e.data.msg?e.data.msg:"修改失败")})).catch((()=>{this.$message.error("修改失败"),this.loading=!1})))}))},forceLogout(){this.$axios.post("logout").then((e=>{this.$store.commit("resetUser"),localStorage.removeItem("hasLogin"),this.$router.push("/login")}))}}};var A=s(51900),E=(0,A.Z)(L,N,[],!1,null,"1a895abf",null);E.options.__file="src/view/changepwd/index.vue";const F=E.exports,O={components:{"change-pwd":F},computed:{realname:function(){const e=this.$store.getters.userRealname;return e?e.length>6?e.slice(0,6)+"...":e:""}},data:()=>({menuIndex:-1,showChangePwd:!1}),mounted(){if(document.querySelectorAll(".menu_list")[4]){let e=document.querySelectorAll(".menu_list")[4].querySelector("div");e&&(e.onmouseover=()=>{const t=e.querySelector(".dropdown-menu");t&&(t.style.display="block")},e.onmouseout=()=>{const t=e.querySelector(".dropdown-menu");t&&(t.style.display="none")})}},methods:{logout(){this.$confirm("确认注销?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.$loading({text:"正在注销..."});this.$axios.post("logout").then((t=>{if(this.$store.commit("resetUser"),localStorage.removeItem("hasLogin"),"LOCAL"==t.data.data.channel)e.close(),this.$router.push("/login");else{const e=encodeURIComponent(location.href);location.href=t.data.data.logoutUrl+"?service="+e}})).catch((()=>{e.close()}))}))},isCurrentModule(e){return this.$route.path.startsWith(e)}}};var I=(0,A.Z)(O,C,[],!1,null,"4f795181",null);I.options.__file="src/view/index.vue";const P=I.exports;var M=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-carousel",{staticStyle:{margin:"20px 0 0 0"},attrs:{interval:4e3,type:"card",height:"300px"}},e._l(e.banner,(function(e){return s("el-carousel-item",{key:e},[s("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:e}})])})),1),e._v(" "),s("div",{staticClass:"list-wrap",staticStyle:{"z-index":"2"}},e._l(e.list,(function(t,i){return s("div",[s("router-link",{attrs:{to:"/microservice/aimodel"}},[s("p",[e._v(e._s(t.title))]),e._v(" "),s("div",[e._v("\n          "+e._s(t.intro)+"\n        ")]),e._v(" "),s("img",{style:{width:t.w+"%",height:t.h+"%",transform:"translate("+(100-t.w)/2+"%,0)"},attrs:{src:t.icon,alt:""}})])],1)})),0)],1)};M._withStripped=!0;const R={name:"home",data:()=>({banner:[s(63848),s(42650),s(47210),s(26365),s(47875)],list:[{title:"流失预警",intro:"企业对流失预警中找到的流失可能性高、且对企业价值亦较高的客户，针对其可能发生流失的原因，开展有针对性的客户挽留活动。",icon:"https://www.qiniu.com/assets/icon-controllale@2x-47c22ae3192d5b1a26f8ccb4852d67ea8a1d10d5ab357bda51959edabdab1237.png",w:80,h:40},{title:"行为评分",intro:"用户行为数据最简单的存在形式就是日志，日志记录了用户的各项行为包括网页浏览、购买、点击、评分、评论等等。这些数据可以横向分析，比如某个页面的点击率；也可以纵向分析，比如某一个用户的操作流程。",icon:"https://www.qiniu.com/assets/icon-num@2x-1ce865341f8a2e0d2e31de027adc0fa680858e1bb889749b15533edc4340152d.png",w:90,h:50},{title:"循环授信",intro:"为客户核定的短期授信业务的存量管理指标，不论单笔贷款授信额度、借款企业额度和集团借款企业额度。只要授信余额不超过对应的业务品种指标，无论累计发放金额和发放次数为多少，商业银行业务部门均可快速向客户提供短期授信，即企业可便捷地循环使用银行的短期授信资金，从而满足客户对金融服务快捷性和便利性的要求。",icon:"https://www.qiniu.com/assets/icon-accelerate@2x-b363f024eb5a2d263d0909eab8ad231e735bd17e1da14cfd8fa6ff7f820973cb.png",w:80,h:40},{title:"故障分类",intro:"发生故障问题,除了影响生产效率、缩减经济效益以外,还存在严重的安全隐患。因此,当发生故障时,及时有效地确定故障类型、解决故障问题就显得尤为重要",icon:"https://www.qiniu.com/assets/icon-massstorage@2x-e76217a8daa1c84427de719c29b0d50aa693c380e32b085e73421715be9ab4e7.png",w:100,h:50}]}),mounted(){this.$axios.get("session")}};var j=(0,A.Z)(R,M,[],!1,null,"7e6062be",null);j.options.__file="src/view/home/home.vue";const B=j.exports;var U=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"error-box"},[s("div",{staticClass:"error-img not-found"}),e._v(" "),"nolicense"==e.$route.name?[s("div",{staticClass:"error-tip"},[e._v("License无效")]),e._v(" "),s("div",{staticClass:"error-tip"},[e._v("序列号："+e._s(e.sn))]),e._v(" "),s("div",{staticClass:"error-btn"},[s("el-upload",{staticStyle:{display:"inline-block"},attrs:{action:"","on-change":e.uploadLicense,"auto-upload":!1,"show-file-list":!1}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-upload"}},[e._v("\n          上传License\n        ")])],1)],1)]:"403"==e.$route.name?[s("div",{staticClass:"error-tip"},[e._v("403")]),e._v(" "),s("div",{staticClass:"error-tip"},[e._v("对不起，您没有权限访问")]),e._v(" "),s("div",{staticClass:"error-btn"},[s("dropdown",{staticStyle:{width:"175px"},attrs:{"split-button":"",type:"primary"},on:{click:function(){return e.$router.push("/")}}},[s("i",{staticClass:"el-icon-back"}),e._v("返回上一页\n        "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"iconfont icontuichu2"},nativeOn:{click:function(t){return e.logout(t)}}},[e._v("注销")])],1)],1)],1)]:"404"==e.$route.name?[s("div",{staticClass:"error-tip"},[e._v("404")]),e._v(" "),s("div",{staticClass:"error-tip"},[e._v("对不起，您访问的页面不存在")]),e._v(" "),s("div",{staticClass:"error-btn"},[s("el-button",{attrs:{type:"primary",icon:"el-icon-back"},on:{click:function(){return e.$router.back()}}},[e._v("返回上一页")])],1)]:"500"==e.$route.name?[s("div",{staticClass:"error-tip"},[e._v("500")]),e._v(" "),s("div",{staticClass:"error-tip"},[e._v("服务器繁忙，请稍候再试")])]:e._e()],2)};U._withStripped=!0;const V={data:()=>({sn:""}),mounted(){"nolicense"==this.$route.name&&this.getSn()},methods:{getSn(){this.$axios.get("/license/sn").then((e=>{0==e.data.code?this.sn=e.data.data:this.$message.error(e.data.msg?e.data.msg:"获取序列号失败")})).catch((()=>{this.$message.error("获取序列号失败")}))},uploadLicense(e){let t=new FormData;t.append("file",e.raw),this.$axios.post("/license/upload",t).then((e=>{0==e.data.code?(this.$message.success("上传成功"),this.$router.push({path:"/"})):this.$message.error(e.data.msg?e.data.msg:"上传失败")})).catch((()=>{this.$message.error("上传失败")}))},logout(){this.$confirm("确认注销?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const e=this.$loading({text:"正在注销..."});this.$axios.post("logout").then((t=>{if(this.$store.commit("resetUser"),localStorage.removeItem("hasLogin"),"LOCAL"==t.data.data.channel)e.close(),this.$router.push("/login");else{const e=encodeURIComponent(location.href);location.href=t.data.data.logoutUrl+"?service="+e}})).catch((()=>{e.close()}))}))}}};var H=(0,A.Z)(V,U,[],!1,null,"3851a1a0",null);H.options.__file="src/view/error/error.vue";const q=H.exports;var z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.code>0?s("change-pwd",{attrs:{show:e.showChangePwd,code:e.code},on:{"update:show":function(t){e.showChangePwd=t}}}):e._e()};z._withStripped=!0;const W={name:"force",components:{changePwd:F},data:()=>({showChangePwd:!1,code:0}),mounted(){const e=localStorage.getItem("forceChangePwdCode");e?(this.code=parseInt(e),this.showChangePwd=!0):this.$router.back()}};var G=(0,A.Z)(W,z,[],!1,null,"b481ef50",null);G.options.__file="src/view/changepwd/force.vue";const J=G.exports;var Z=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.localLogin?s("div",{staticClass:"content"},[e._m(0),e._v(" "),s("div",{staticClass:"login_centent"},[e._m(1),e._v(" "),s("div",{staticClass:"login_msg"},[s("h2",[e._v("Gaea Decision")]),e._v(" "),s("div",{staticStyle:{width:"50%",margin:"0 auto"}},[s("div",{staticStyle:{position:"relative"}},[e._m(2),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.username,expression:"username",modifiers:{trim:!0}}],ref:"input",staticClass:"layui-input",attrs:{placeholder:"请输入账户名",type:"text"},domProps:{value:e.username},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},e.input],input:function(t){t.target.composing||(e.username=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.usernameEmpty,expression:"usernameEmpty"}],staticClass:"errorMsg"},[e._v("账户名不能为空")])]),e._v(" "),s("div",{staticStyle:{position:"relative"}},[e._m(3),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.password,expression:"password",modifiers:{trim:!0}}],staticClass:"layui-input",attrs:{placeholder:"请输入密码",type:"password"},domProps:{value:e.password},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},e.input],input:function(t){t.target.composing||(e.password=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.passwordEmpty,expression:"passwordEmpty"}],staticClass:"errorMsg"},[e._v("密码不能为空")])]),e._v(" "),s("div",{staticClass:"verification",staticStyle:{position:"relative"}},[e._m(4),e._v(" "),s("div",{staticStyle:{display:"flex"}},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.captchaText,expression:"captchaText",modifiers:{trim:!0}}],staticClass:"layui-input verificationInput",attrs:{placeholder:"请输入验证码",type:"text"},domProps:{value:e.captchaText},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.login(t)},e.input],input:function(t){t.target.composing||(e.captchaText=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),s("el-tooltip",{attrs:{content:"点击刷新验证码",placement:"top",effect:"light"}},[s("img",{staticClass:"verificationImg",attrs:{src:e.captchaImg,alt:""},on:{click:e.loadCaptcha}})])],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.captchaEmpty,expression:"captchaEmpty"}],staticClass:"errorMsg"},[e._v("验证码不能为空")])]),e._v(" "),s("div",{staticClass:"checkdiv"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.rememberMe,expression:"rememberMe"}],attrs:{type:"checkbox",id:"rememberMe",checked:""},domProps:{checked:Array.isArray(e.rememberMe)?e._i(e.rememberMe,null)>-1:e.rememberMe},on:{change:function(t){var s=e.rememberMe,i=t.target,a=!!i.checked;if(Array.isArray(s)){var o=e._i(s,null);i.checked?o<0&&(e.rememberMe=s.concat([null])):o>-1&&(e.rememberMe=s.slice(0,o).concat(s.slice(o+1)))}else e.rememberMe=a}}}),e._v(" "),s("label",{staticStyle:{color:"#a7a2a4","font-size":"13px"},attrs:{for:"rememberMe"}},[e._v("7天内自动登录")])]),e._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:e.btnText,expression:"btnText"}],attrs:{type:"button"},domProps:{value:e.btnText},on:{click:e.login,input:function(t){t.target.composing||(e.btnText=t.target.value)}}}),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.loginFailed,expression:"loginFailed"}],staticClass:"loginTip"},[e._v(e._s(e.failedText))])])])]),e._v(" "),e._m(5)]):e._e()},Y=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login_head"},[i("div",{staticClass:"login_headinner"},[i("div",{staticClass:"logoImg"},[i("img",{attrs:{src:s(89597)}}),e._v(" "),i("h2",[e._v("Knowledge Is Everything")])])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"login_left"},[t("img",{attrs:{src:s(62124)}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("img",{staticClass:"faIcon",attrs:{src:s(81194)}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("img",{staticClass:"faIcon",attrs:{src:s(35959)}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("i",{staticClass:"el-icon-picture-outline faIcon"})])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"login_foot"},[s("p",[e._v("\n        天云融创数据科技（北京）有限公司\n        "),s("span",{staticStyle:{"margin-left":"5px"}},[e._v("V2.0")])]),e._v(" "),s("p",{staticStyle:{fontSize:"12px",marginTop:"2px"}},[e._v("beagledata technology (beijing) Co.，Ltd")])])}];Z._withStripped=!0;const K={name:"login",data(){return{username:"",password:"",rememberMe:!0,usernameEmpty:!1,passwordEmpty:!1,btnText:"登 录",logining:!1,loginFailed:!1,failedText:"账户名或密码错误",from:this.$route.query.from,captchaEmpty:!1,captchaImg:null,captchaText:"",localLogin:!1,authChannel:this.$route.query.authChannel}},mounted(){const e=this.$route.query.ticket;this.$utils.isNotBlank(e)?this.loginCas(e):this.assertLoginChannel()},methods:{async login(){if(this.usernameEmpty=""==this.username,this.passwordEmpty=""==this.password,this.captchaEmpty=""==this.captchaText,!(this.usernameEmpty||this.passwordEmpty||this.captchaEmpty||this.logining)){this.logining=!0,this.btnText="登录中...";const e=await this.encrypt(this.password);this.$axios.post("login",this.$qs.stringify({username:this.username,password:e,rememberMe:this.rememberMe,captcha:this.captchaText,authChannel:this.authChannel})).then((e=>{0==e.data.code?(this.loginFailed=!1,this.afterLoginSuccess(e.data.data)):1==e.data.code?this.doMultipleLogin():(this.failedText=e.data.msg,this.loginFailed=!0,this.loadCaptcha())})).catch((()=>{this.loginFailed=!0})).then((()=>{this.logining=!1,this.btnText="登 录"}))}},input(){this.usernameEmpty=""==this.username,this.passwordEmpty=""==this.password,this.captchaEmpty=""==this.captchaText},loadCaptcha(){this.$axios.get("/captcha").then((e=>{0==e.data.code&&(this.captchaImg=e.data.data)}))},assertLoginChannel(){if("local"==this.authChannel)return this.localLogin=!0,void this.$nextTick((()=>{this.$refs.input.focus(),this.loadCaptcha()}));this.$axios.get("/loginchannel").then((e=>{if(0==e.data.code)if("LOCAL"==e.data.data.channel)this.localLogin=!0,this.$nextTick((()=>{this.$refs.input.focus(),this.loadCaptcha()}));else{const t=encodeURIComponent(location.href);let s=e.data.data.serviceUrl+"/caslogin?casCallback="+t;s=encodeURIComponent(s),location.href=e.data.data.loginUrl+"?service="+s}else this.$router.push("/500")}))},loginCas(e){const t=this.$loading({text:"登录中..."});this.$axios.post("login",this.$qs.stringify({ticket:e})).then((s=>{t.close(),0==s.data.code?this.afterLoginSuccess(s.data.data):1==s.data.code?this.doMultipleLogin(e):this.$router.push("/500")})).catch((()=>{this.$router.push("/500")}))},doMultipleLogin(e){this.$confirm("用户正在其他地方登录，是否继续登录?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{const t=this.$loading({text:"登录中..."});this.$axios.post("forceLogin").then((s=>{t.close(),0==s.data.code?this.afterLoginSuccess(s.data.data):401==s.data.code?e?(this.$router.push("/login"),location.reload()):this.$message.error("已被其他用户抢占，请重新登录"):this.$router.push("/500")})).catch((()=>{this.$router.push("/500")}))})).catch((()=>{this.$axios.post("logout").then((e=>{if(this.$store.commit("resetUser"),localStorage.removeItem("hasLogin"),"LOCAL"!=e.data.data.channel){this.$router.push("/login");const t=encodeURIComponent(location.href);location.href=e.data.data.logoutUrl+"?service="+t}}))}))},afterLoginSuccess(e){this.$store.commit("setUser",e),localStorage.setItem("hasLogin","1"),this.from?this.from.startsWith("http")?location.href=this.from:this.$router.push(this.from):this.$router.push("/")},async encrypt(e){const t=new((await s.e(350).then(s.bind(s,66350))).default);return t.setPublicKey("MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKTgYIDx5MXfZqQVwUD7LCXf5tCXMGtxeJe9Ef+rrnpQ43JdNTr0xOImlkiTFdvWGVLykAwc4FDRroV5kPyn4wUCAwEAAQ=="),t.encrypt(e)}}};var X=(0,A.Z)(K,Z,Y,!1,null,"77c14c32",null);X.options.__file="src/view/login/login.vue";const Q=X.exports;var ee=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-aside",{staticClass:"menu",attrs:{width:"250px"}},[s("el-menu",{attrs:{"default-active":e.$route.path,router:!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},e._l(e.menus,(function(t,i){return e.$hasPerm(t.permission)?s("el-menu-item",{key:i,attrs:{index:t.path}},[s("i",{class:t.icon}),e._v(" "),s("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.label))])]):e._e()})),1)],1),e._v(" "),s("el-main",[s("router-view")],1)],1)};ee._withStripped=!0;const te={name:"decision",data:()=>({menus:[{path:"/decision/project",label:"项目列表",icon:"iconfont iconlist-2-copy",permission:"project:view"},{path:"/decision/func",label:"函数库",icon:"iconfont iconhanshu",permission:"function:view"},{path:"/decision/thirdapi",label:"外部接口",icon:"iconfont iconfuwuqi",permission:"thirdapi:view"},{path:"/decision/aimodel",label:"机器学习模型",icon:"iconfont iconAI",permission:"aimodel:view"}]}),watch:{$route:function(e){"decision"==e.name&&this.toFirstMenu()}},mounted(){"decision"==this.$route.name&&this.toFirstMenu()},methods:{toFirstMenu(){this.menus.some((e=>{if(this.$hasPerm(e.permission))return this.$router.push(e.path),!0}))}}};var se=(0,A.Z)(te,ee,[],!1,null,"07d2805e",null);se.options.__file="src/view/decision/decision.vue";const ie=se.exports;var ae=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"projectContent"},[s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("project:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.newAdd}},[e._v("\n        新建项目\n      ")]):e._e(),e._v(" "),s("el-upload",{staticClass:"upload",attrs:{action:"","on-change":e.importProject,"auto-upload":!1,disabled:e.fileLoading,"show-file-list":!1,accept:".project"}},[e.$hasPerm("project:import")?s("el-button",{attrs:{icon:"el-icon-upload",loading:e.fileLoading}},[e._v("\n          "+e._s(e.fileLoading?"正在导入...":"导入项目")+"\n        ")]):e._e()],1),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.projectSearchName,callback:function(t){e.projectSearchName="string"==typeof t?t.trim():t},expression:"projectSearchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.projects},on:{"sort-change":e.sortChange,"row-dblclick":function(t){return e.$router.push("/decision/project/"+t.uuid)}}},[s("el-table-column",{attrs:{label:"名称",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.$router.push("/decision/project/"+t.row.uuid)}}},[e._v("\n            "+e._s(t.row.name)+"\n          ")]),e._v(" "),t.row.auditCount>0&&e.$hasPerm("project.pkg.baseline:audit")?s("el-tooltip",{attrs:{content:"有"+t.row.auditCount+"个基线待审核",placement:"top"}},[s("el-tag",{attrs:{type:"danger",size:"mini",effect:"dark"}},[e._v("\n              "+e._s(t.row.auditCount)+"\n            ")])],1):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"更新时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"创建时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"创建人",width:"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("getRealname")(t.row.creator))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.$router.push("/decision/project/"+t.row.uuid+"/knowledgepackage")}}},[e._v("\n            知识包\n          ")]),e._v(" "),t.row.userEdit||e.$hasPerm("project:export")?s("dropdown",{staticClass:"moreOperation",on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n              更多"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t.row.userEdit?s("dropdown-item",{attrs:{command:{row:t.row,op:"edit"},icon:"el-icon-edit"}},[e._v("\n                编辑\n              ")]):e._e(),e._v(" "),s("dropdown-item",{attrs:{command:{row:t.row,op:"export"},icon:"el-icon-download"}},[e._v("\n                导出\n              ")]),e._v(" "),t.row.userEdit?s("dropdown-item",{attrs:{command:{row:t.row,op:"member"},icon:"el-icon-s-custom"}},[e._v("\n                成员\n              ")]):e._e(),e._v(" "),t.row.userEdit?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-delete",divided:""}},[e._v("\n                删除\n              ")]):e._e()],1)],1):e._e()]}}])})],1),e._v(" "),s("pagination",{ref:"pager",attrs:{load:e.loadData}})],1),e._v(" "),s("el-dialog",{staticClass:"editor-server",attrs:{title:e.form.uuid?"编辑项目":"新建项目",width:"30%",visible:e.showDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showDialog=t},opened:function(t){return e.$refs.input.focus()},closed:function(t){return e.$refs.form.resetFields()}}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[s("el-input",{ref:"input",attrs:{maxlength:20,"show-word-limit":!0,placeholder:"请填写项目名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"项目描述",prop:"description"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:6},maxlength:100,"show-word-limit":!0,placeholder:"还没有描述-这个项目是做什么的？"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.submit}},[e._v("\n        "+e._s(e.addLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"成员配置",top:e.$dialogTop,visible:e.showMemberDialog},on:{"update:visible":function(t){e.showMemberDialog=t},open:e.openMemberDialog}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.memberLoading,expression:"memberLoading"}],attrs:{"element-loading-text":"数据加载中..."}},[e.showMemberDialog?s("el-transfer",{attrs:{"filter-placeholder":"搜索",titles:["未选择用户","已选择用户"],data:e.users},on:{change:e.changeMember},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.option;return[i.org&&i.org.name?s("el-tooltip",{attrs:{content:i.org.name,placement:"left"}},[s("span",[e._v(e._s(i.label))])]):s("span",[e._v(e._s(i.label))])]}}],null,!1,3347071907),model:{value:e.memberUuids,callback:function(t){e.memberUuids=t},expression:"memberUuids"}},[s("el-input",{attrs:{slot:"left-footer",size:"small",placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.userSearch(t)}},slot:"left-footer",model:{value:e.userSearchName,callback:function(t){e.userSearchName=t},expression:"userSearchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.userSearch},slot:"suffix"})])],1):e._e(),e._v(" "),s("div",{staticClass:"pageContent"},[s("pagination",{attrs:{small:"",layout:"prev, pager, next",total:e.totalUser,"page-size":e.userPageNum,"pager-count":3,"current-page":e.userPage},on:{change:e.toPageUser}})],1)],1)])],1)};ae._withStripped=!0;const oe={name:"project",data:()=>({projects:[],tableLoading:!1,showDialog:!1,addLoading:!1,file:null,total:0,form:{uuid:"",name:"",description:""},rules:{name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"}],description:[{max:100,message:"长度不超过100个字符",trigger:"blur"}]},fileLoading:!1,currentProject:{},sortOption:{sortField:"",sortDirection:""},totalUser:0,userPage:1,projectSearchName:"",userSearchName:"",showMemberDialog:!1,memberLoading:!1,members:[],users:[],memberUuids:[],userPageNum:20}),methods:{submitMembers(){this.memberLoading=!0,this.$axios.post("/pu/auth",this.$qs.stringify({projectUuid:this.currentProject.uuid,uuids:this.memberUuids.join(",")})).then((e=>{this.memberLoading=!1,0==e.data.code?(this.$message.success("配置成功"),this.userSearch()):this.$message.error(e.data.msg?e.data.msg:"配置失败")})).catch((()=>{this.$message.error("配置失败"),this.memberLoading=!1}))},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.$refs.pager.refresh()},changeMember(e,t,s){const i=[];e.forEach((e=>{this.users.some((t=>{if(t.key==e)return i.push(t),!0}))})),this.members=i,this.submitMembers()},userSearch(){this.userPage=1,this.initUserList()},getMembers(){this.$axios.get(`/pu/users?uuid=${this.currentProject.uuid}`).then((e=>{0==e.data.code?(e.data.data.length>0&&e.data.data.forEach(((e,t)=>{this.memberUuids.push(e.uuid),this.members.push({key:e.uuid,label:e.realname,org:e.org})})),this.initUserList()):(this.$message.error(e.data.msg?e.data.msg:"获取项目成员失败"),this.memberLoading=!1,this.showMemberDialog=!1)})).catch((()=>{this.$message.error("获取项目成员失败"),this.memberLoading=!1,this.showMemberDialog=!1}))},initUserList(){this.memberLoading=!0,this.$axios.get("/user/searchnotprojectmember",{params:{projectUuid:this.currentProject.uuid,page:this.userPage,realname:this.userSearchName,pageNum:this.userPageNum}}).then((e=>{if(this.memberLoading=!1,0==e.data.code){this.totalUser=e.data.total;let t=[];e.data.data.forEach(((e,s)=>{t.push({key:e.uuid,label:e.realname,org:e.org})})),t=t.concat(this.members),this.users=t}else this.$message.error(e.data.msg?e.data.msg:"获取项目成员失败")})).catch((()=>{this.$message.error("获取项目成员失败"),this.memberLoading=!0}))},toPageUser(e){this.userPage=e,this.initUserList()},moreOperation({row:e,op:t}){"edit"==t?this.edit(e):"export"==t?this.exportProject(e):"member"==t?this.setMember(e):"del"==t&&this.del(e)},setMember(e){this.currentProject=e,this.showMemberDialog=!0},search(){this.$refs.pager.refresh(1)},setRowClick(e,t){if(""==this.permissions.userUuid)return this.$message.warning("请选择用户");let s=[],i=["r","w","d","x"];(e.permission[1]||e.permission[2]||e.permission[3])&&(e.permission[0]=!0);for(let t=0;t<e.permission.length;t++)e.permission[t]&&s.push(i[t]);this.$axios.post("/permission/authorization",this.$qs.stringify({accountUuid:this.permissions.userUuid,resourceId:e.uuid,type:t,permission:s.join(",")})).then((e=>{0==e.data.code?this.$message.success("操作成功"):this.$message.error(e.data.msg?e.data.msg:"操作失败")}))},loadData(e,t,s){this.tableLoading=!0,this.$axios.get("/project",{params:{page:e,pageNum:t,name:this.projectSearchName,sortField:this.sortOption.sortField,sortDirection:this.sortOption.sortDirection}}).then((e=>{0==e.data.code&&(e.data.data.forEach((e=>{e.creator&&!e.creator.realname&&(e.creator.realname=e.creator.username)})),this.projects=e.data.data,this.total=e.data.total,s(e.data.total)),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},submit(){this.$refs.form.validate((e=>{if(e){this.addLoading=!0;let e=this.form.uuid?"/project/edit":"/project/add",t={};this.form.uuid&&(t.uuid=this.form.uuid),t.name=this.form.name,t.description=this.form.description,this.$axios.post(e,this.$qs.stringify(t)).then((e=>{this.addLoading=!1,this.showDialog=!1,0==e.data.code?this.form.uuid?(this.$message.success("编辑成功"),this.$refs.pager.refresh(1)):this.$router.push("/decision/project/"+e.data.data.uuid):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.addLoading=!1,this.showDialog=!1}))}}))},edit(e){this.form.uuid=e.uuid,this.form.name=e.name,this.form.description=e.description,this.showDialog=!0},newAdd(){this.form={uuid:"",name:"",description:""},this.showDialog=!0},exportProject(e){const t=this;t.tableLoading=!0,this.$axios({method:"get",url:"/project/export?uuid="+e.uuid,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){const e=new FileReader;e.onload=function(){const s=JSON.parse(e.result);if(401==s.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(s.msg?s.msg:"导出失败")},e.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.name+".project"),document.body.appendChild(i),i.click()}t.tableLoading=!1})).catch((()=>{t.$message.error("导出失败"),t.tableLoading=!1}))},del(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.tableLoading=!0,this.$axios.post("/project/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.$refs.pager.refresh()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))}))},importProject(e){if(!this.$utils.checkUploadFile(e,"project"))return;let t=new FormData;t.append("file",e.raw),this.fileLoading=!0,this.$axios.post("/project/import",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{0==e.data.code?(this.$message.success("导入成功"),this.$router.push("/decision/project/"+e.data.data.uuid)):this.$message.error(e.data.msg?e.data.msg:"导入失败"),this.fileLoading=!1})).catch((()=>{this.$message.error("导入失败"),this.fileLoading=!1}))},openMemberDialog(){this.memberLoading=!0,this.members=[],this.users=[],this.memberUuids=[],this.getMembers()}}};var ne=(0,A.Z)(oe,ae,[],!1,null,"28784c11",null);ne.options.__file="src/view/decision/project/project.vue";const re=ne.exports;var le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"数据加载中..."}},[s("el-container",[s("el-aside",{attrs:{width:"250px"}},[s("el-input",{staticClass:"search",staticStyle:{"margin-bottom":"10px"},attrs:{size:"mini","suffix-icon":"el-icon-search",clearable:"",placeholder:"搜索"},on:{change:e.search},model:{value:e.searchWords,callback:function(t){e.searchWords="string"==typeof t?t.trim():t},expression:"searchWords"}}),e._v(" "),s("el-tree",{ref:"tree",attrs:{data:e.treeData,"highlight-current":"","node-key":"label"},on:{"node-click":e.clickTreeNode}})],1),e._v(" "),s("el-main",{staticStyle:{"padding-top":"0px"}},[s("div",{staticClass:"toolbar"},[e.$hasPerm("function:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n            添加函数\n          ")]):e._e(),e._v(" "),e.activeFunction.jarName?s("el-button",{attrs:{icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.downloadFunc}},[e._v("\n            "+e._s(e.downloadLoading?"加载中...":"下载函数")+"\n          ")]):e.$hasPerm("function:edit")?s("el-button",{attrs:{icon:"el-icon-edit",disabled:e.$utils.isBlank(e.activeFunction.uuid),loading:e.editLoading},on:{click:e.editFunc}},[e._v("\n            "+e._s(e.editLoading?"加载中...":"编辑函数")+"\n          ")]):e._e(),e._v(" "),e.$hasPerm("function:delete")?s("el-popconfirm",{attrs:{title:"确定删除当前函数？"},on:{confirm:function(t){return e.deleteFunc(e.activeFunction.uuid)}}},[s("el-button",{attrs:{slot:"reference",icon:"el-icon-delete",disabled:e.$utils.isBlank(e.activeFunction.uuid),loading:e.deleteLoading},slot:"reference"},[e._v("\n              "+e._s(e.deleteLoading?"加载中...":"删除函数")+"\n            ")])],1):e._e()],1),e._v(" "),e.activeFunction.uuid?s("el-row",{staticStyle:{margin:"20px 0px"}},[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建人：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeFunction.creator.realname))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建时间：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e._f("formatDateTime")(e.activeFunction.createTime)))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("更新时间：")]),e._v(" "),e.activeFunction.updateTime?s("span",{staticClass:"font-primary"},[e._v("\n              "+e._s(e._f("formatDateTime")(e.activeFunction.updateTime))+"\n            ")]):e._e()])],1):e._e(),e._v(" "),s("el-table",{ref:"table",attrs:{data:e.methods,border:""}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-table",{style:{width:e.expandTableWidth()},attrs:{data:t.row.params,border:""}},[s("el-table-column",{attrs:{type:"index"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数类型",prop:"type"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"函数中文名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"函数英文名称",prop:"declare"}}),e._v(" "),s("el-table-column",{attrs:{label:"函数返回类型",prop:"returnType"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.clickTest(t.row)}}},[e._v("测试")])]}}])})],1)],1)],1)],1),e._v(" "),s("el-dialog",{ref:"dialog",attrs:{title:"编写函数集",visible:e.showAddDialog,fullscreen:"","custom-class":"func-dialog","before-close":e.beforeCloseEditDialog},on:{"update:visible":function(t){e.showAddDialog=t},opened:e.openDialog,closed:e.closeAddDialog}},[s("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.editorLoading,expression:"editorLoading"}],attrs:{"element-loading-text":"初始化编辑框..."},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[s("el-tab-pane",{attrs:{label:"编写",name:"src"}},[s("el-form",{ref:"srcForm",attrs:{model:e.srcForm,rules:e.srcRules}},[s("el-form-item",{attrs:{prop:"src"}},[s("div",{ref:"editor",class:{"monaco-editor-loading":e.editorInLoading},style:{height:e.editorHeight},attrs:{name:"src"}})])],1)],1),e._v(" "),e.srcForm.uuid?e._e():s("el-tab-pane",{attrs:{label:"上传",name:"jar"}},[s("el-form",{ref:"jarForm",attrs:{model:e.jarForm,rules:e.jarRules}},[s("el-form-item",{attrs:{label:"函数包",prop:"file"}},[s("el-upload",{ref:"upload",attrs:{action:"",accept:".jar",limit:1,"on-change":e.changeFile,"on-remove":function(){return e.jarForm.file=null},"auto-upload":!1,"show-file-list":!0}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-files"}},[e._v("选择文件")])],1)],1)],1)],1)],1),e._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.addLoading?"提交中...":"确 定"))])],1)],1),e._v(" "),s("el-dialog",{ref:"testDialog",attrs:{title:"单元测试",top:e.$dialogTop,visible:e.showTestDialog},on:{"update:visible":function(t){e.showTestDialog=t},opened:e.openTestDialog,closed:e.closeTestDialog}},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-lightning",loading:e.testLoading},on:{click:e.submitTest}},[e._v("\n          "+e._s(e.testLoading?"加载中...":"测 试")+"\n        ")])],1),e._v(" "),s("el-col",{style:{maxHeight:e.testMaxHeight,overflow:"auto"},attrs:{span:20}},[s("h1",{staticStyle:{"margin-top":"0px"}},[e._v(e._s(e.testMethod.funcName)+"."+e._s(e.testMethod.name))]),e._v(" "),e.testMethod.params.length>0?[s("p",{staticClass:"font-primary test-title"},[e._v("输入参数")]),e._v(" "),s("el-table",{ref:"paramsTable",staticClass:"tb-edit",attrs:{data:e.testMethod.params,border:"","row-style":{cursor:"pointer"},"highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isNumber(t.row.type)?s("el-input-number",{ref:"param_value_"+t.$index,staticStyle:{width:"100%"},attrs:{"step-strictly":e.inputInteger(t.row),min:e.inputMin(t.row),max:e.inputMax(t.row),controls:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isBoolean(t.row.type)?s("el-select",{ref:"param_value_"+t.$index,attrs:{placeholder:"请选择"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)?s("date-picker",{ref:"param_value_"+t.$index,staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isCollection(t.row.type)?s("test-collection",{ref:"param_value_"+t.$index,attrs:{stringify:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isObject(t.row.type)?s("test-object",{ref:"param_value_"+t.$index,attrs:{stringify:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):s("el-input",{ref:"param_value_"+t.$index,model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n                  "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n                ")]):e.$utils.isCollection(t.row.type)||e.$utils.isObject(t.row.type)?e._e():s("span",[e._v("\n                  "+e._s(t.row.value)+"\n                ")])]}}],null,!1,1703483623)}),e._v(" "),s("el-table-column",{attrs:{label:"参数名称",prop:"name",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数类型",prop:"type",align:"center"}})],1)]:e._e(),e._v(" "),s("p",{staticClass:"font-primary test-title"},[e._v("返回结果")]),e._v(" "),s("el-table",{attrs:{data:e.testMethod.returnValue,border:""}},[s("el-table-column",{attrs:{label:"返回值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.value)+"\n            ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"返回类型",prop:"type",align:"center"}})],1)],2)],1)],1)],1)};le._withStripped=!0;const ce={name:"func",data:()=>({loading:!1,functions:[],methods:[],treeData:[],activeFunction:{},searchWords:"",showAddDialog:!1,activeTab:"src",srcForm:{uuid:"",src:""},addLoading:!1,jarForm:{file:null},srcRules:{src:[{required:!0,message:"请编写函数",trigger:"blur"}]},jarRules:{file:[{required:!0,message:"请上传函数包",trigger:"change"}]},editLoading:!1,downloadLoading:!1,editor:null,editorLoading:!1,editorHeight:"100%",showTestDialog:!1,testMethod:{funcName:"",name:"",params:[],returnValue:[]},testLoading:!1,deleteLoading:!1,testMaxHeight:"100%",editorInLoading:!1,initVersionId:-1,editVersionId:-1}),mounted(){window.addEventListener("resize",this.setEditorHeight),this.loadFunctions()},methods:{loadFunctions(e){this.loading=!0,this.$axios.get("/function/global").then((t=>{0==t.data.code&&(this.functions=t.data.data,this.setTreeData(),this.activeTreeNode(e)),this.loading=!1})).catch((()=>{this.loading=!1}))},search(){this.setTreeData(),this.activeTreeNode()},setTreeData(){this.treeData=[],this.functions.forEach((e=>{if(this.searchWords){const t=e.methods.filter((e=>-1!=e.name.indexOf(this.searchWords)||-1!=e.declare.indexOf(this.searchWords)));t.length>0&&this.treeData.push({label:e.name,func:{uuid:e.uuid,name:e.name,methods:t}})}else this.treeData.push({label:e.name,func:e})}))},activeTreeNode(e){this.treeData.length>0?this.$nextTick((()=>{const t=e?this.$utils.arrayFind(this.treeData,(t=>t.label==e)):this.treeData[0];t&&(this.$refs.tree.setCurrentKey(t.label),this.clickTreeNode(t))})):this.activeFunction={}},clickTreeNode(e){this.methods=e.func.methods,this.activeFunction=e.func},submit(e){"src"==this.activeTab?this.submitSrc(e):this.submitJar()},submitSrc(e){this.srcForm.src=this.editor.getValue().trim(),this.$refs.srcForm.validate((t=>{if(t){this.addLoading=!0;const t=this.srcForm.uuid?"/function/edit":"/function/add";this.$axios.post(t,this.$qs.stringify(this.srcForm)).then((t=>{if(0==t.data.code)this.$message.success("操作成功"),!0!==e&&(this.showAddDialog=!1),this.loadFunctions(t.data.data.name);else if(t.data.msg){const e=t.data.msg.replace(/\n/g,"<br>").replace(/ /g,"&ensp;");this.$message.error({message:e,duration:5e3,dangerouslyUseHTMLString:!0,showClose:!0})}else this.$message.error("操作失败");this.addLoading=!1})).catch((e=>{console.error(e),this.$message.error("操作失败"),this.addLoading=!1}))}}))},changeFile(e){this.jarForm.file=e,this.$refs.jarForm.validate()},submitJar(){this.$refs.jarForm.validate((e=>{if(e){const e=new FormData;e.append("file",this.jarForm.file.raw),this.addLoading=!0,this.$axios.post("/function/upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{0==e.data.code?(this.$message.success("上传成功"),this.showAddDialog=!1,this.loadFunctions()):this.$message.error(e.data.msg?e.data.msg:"上传失败"),this.addLoading=!1})).catch((()=>{this.$message.error("上传失败"),this.addLoading=!1}))}}))},closeAddDialog(){this.jarForm.file&&this.$refs.upload.clearFiles(),this.srcForm.uuid="",this.$refs.srcForm&&this.$refs.srcForm.resetFields(),this.$refs.jarForm&&this.$refs.jarForm.resetFields()},deleteFunc(e){this.deleteLoading=!0,this.$axios.post("/function/delete",this.$qs.stringify({uuid:e})).then((e=>{this.deleteLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.loadFunctions()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.deleteLoading=!1}))},editFunc(){this.editLoading=!0,this.$axios.get("/function/view",{params:{uuid:this.activeFunction.uuid}}).then((e=>{0==e.data.code?(this.showAddDialog=!0,this.$nextTick((()=>{this.srcForm.uuid=this.activeFunction.uuid,this.srcForm.src=e.data.data}))):this.$message.error(e.data.msg?e.data.msg:"操作失败"),this.editLoading=!1})).catch((()=>{this.$message.error("操作失败"),this.editLoading=!1}))},downloadFunc(){const e=this;this.downloadLoading=!0,this.$axios({method:"get",url:"/function/download?uuid="+this.activeFunction.uuid,responseType:"blob"}).then((t=>{if(this.downloadLoading=!1,"application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"下载失败")},s.readAsText(t.data)}else{let s=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.style.display="none",i.href=s,i.target="_blank",i.setAttribute("download",e.activeFunction.jarName),document.body.appendChild(i),i.click()}})).catch((()=>{this.$message.error("下载失败"),this.downloadLoading=!1}))},openDialog(){this.initEditor().then((()=>{this.editor.setValue(this.srcForm.src),this.editor.focus(),this.initVersionId=this.editVersionId})).catch((e=>{console.error(e),this.$message.error("初始化编辑框失败")}))},async initEditor(){if(this.setEditorHeight(),null==this.editor)try{this.editorLoading=!0;const e=await s.e(720).then(s.bind(s,59595)),t=e.editor.create(this.$refs.editor,{language:"java"});this.bindEditorCommand(t,e),this.bindEditorAction(t,e),this.bindEditorEvent(t),this.editorLoading=!1,this.editor=t}catch(e){throw this.editorLoading=!1,new Error(e)}else this.editor.layout()},bindEditorCommand(e,t){const s=this;e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KEY_S,(function(){s.submit(!0)}))},bindEditorAction(e,t){this.addEncryptAction(e,t),this.addTestAction(e,t)},bindEditorEvent(e){e.onDidChangeModelContent((e=>{this.editVersionId=e.versionId}))},addEncryptAction(e,t){const s=this;e.addAction({id:"encrypt",label:"加密",contextMenuGroupId:"navigation",run:function(t){const i=t.getSelection(),a=t.getModel().getValueInRange(i);return s.$utils.isBlank(a)?(s.$message.warning("没有选中内容"),null):(s.editorInLoading=!0,s.$axios.post("/function/encrypt",s.$qs.stringify({text:a})).then((t=>{s.editorInLoading=!1,0==t.data.code?e.executeEdits(null,[{range:i,text:t.data.data,forceMoveMarkers:!0}]):s.$message.error(t.data.msg?t.data.msg:"加密失败")})).catch((e=>{s.editorInLoading=!1,s.$message.error("加密失败")})),null)}})},addTestAction(e,t){const s=this;e.addAction({id:"test",label:"单元测试",contextMenuGroupId:"navigation",run:function(e){let t=e.getPosition().lineNumber,i=0;do{if(-1!=e.getModel().getLineContent(t).indexOf("@FunctionMethodProperty")){i=t;break}}while(--t>0);if(i<=0)return s.$message.warning("没有找到函数注解"),null;let a="";const o=e.getModel().getLineCount();do{const t=e.getModel().getLineContent(i);if(a+=t,t.trim().endsWith(")"))break}while(++i<=o);const n=a.match(/name[\s\S]*?=[\s\S]*?"(.+?)"/);if(null==n)return s.$message.warning("没有找到函数名称"),null;try{const t=n[1].trim();s.editorInLoading=!0,s.$axios.post("/function/method/params",s.$qs.stringify({src:e.getValue(),name:t})).then((e=>{if(s.editorInLoading=!1,0==e.data.code){const t=e.data.data;s.testMethod.funcName=t.funcName,s.testMethod.name=t.name,s.testMethod.params=t.params.map(((e,t)=>(e.index=t,e))),s.testMethod.returnValue=[{type:t.returnType}],s.showTestDialog=!0}else s.$message.error(e.data.msg?e.data.msg:"单元测试失败")})).catch((e=>{s.$message.error("单元测试失败"),s.editorInLoading=!1}))}catch(e){console.error(e)}return null}})},setEditorHeight(){if(!this.showAddDialog)return;const e=this.$refs.dialog.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=e.querySelector(".el-dialog__footer"),a=s.querySelector(".el-tabs__header"),o=window.getComputedStyle(a,null),n=window.getComputedStyle(i,null),r=parseInt(o.getPropertyValue("margin-bottom")),l=parseInt(n.getPropertyValue("padding-top")),c=parseInt(n.getPropertyValue("padding-bottom"));this.editorHeight=window.innerHeight-t.offsetHeight-a.offsetHeight-i.offsetHeight-r-l-c-1+"px",null!=this.editor&&this.$nextTick((()=>{this.editor.layout()}))},expandTableWidth(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?this.$refs.table.$el.offsetWidth-100+"px":"100%"},inputInteger:e=>-1!=["Integer","Long"].indexOf(e.type),inputMin:e=>"Integer"==e.type?-2147483648:"Long"==e.type?-0x8000000000000000:void 0,inputMax:e=>"Integer"==e.type?2147483647:"Long"==e.type?0x8000000000000000:void 0,cellClick(e,t){const s=this.$refs["param_value_"+e.index];"参数值"==t.label&&s&&this.$nextTick((function(){this.$utils.isBoolean(e.type)?s.toggleMenu():s.focus()}))},submitTest(){const e=this.$utils.arrayFind(this.testMethod.params,(e=>this.$utils.isBlank(e.value)));if(null!=e)return this.$refs.paramsTable.setCurrentRow(e),this.$nextTick((()=>{this.$utils.isBoolean(e.type)?this.$refs[`param_value_${e.index}`].toggleMenu():this.$refs[`param_value_${e.index}`].focus()})),void this.$message.warning("请填写输入参数");const t={name:this.testMethod.name},s=[];this.testMethod.params.forEach((e=>{s.push({type:e.type,value:e.value})})),t.params=JSON.stringify(s),this.showAddDialog?t.src=this.editor.getValue():t.funcName=this.testMethod.funcName,this.testLoading=!0,this.$axios.post("/function/method/test",this.$qs.stringify(t)).then((e=>{this.testLoading=!1,0==e.data.code?this.$set(this.testMethod.returnValue[0],"value",e.data.data):this.$message.error(e.data.msg?e.data.msg:"单元测试失败")})).catch((e=>{this.testLoading=!1,this.$message.error("单元测试失败")}))},clickTest(e){this.testMethod.funcName=this.activeFunction.name,this.testMethod.name=e.name,this.testMethod.params=e.params.map(((e,t)=>(e.index=t,e))),this.testMethod.returnValue=[{type:e.returnType}],this.showTestDialog=!0},openTestDialog(){const e=this.$refs.testDialog.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=window.getComputedStyle(e,null),a=window.getComputedStyle(s,null),o=parseInt(i.getPropertyValue("margin-top")),n=parseInt(a.getPropertyValue("padding-top")),r=parseInt(a.getPropertyValue("padding-bottom"));this.testMaxHeight=window.innerHeight-o-t.offsetHeight-n-r-20+"px"},closeTestDialog(){this.testMethod.params.forEach((e=>e.value=null))},closeEditDialog(){this.beforeCloseEditDialog((()=>this.showAddDialog=!1))},beforeCloseEditDialog(e){this.initVersionId==this.editVersionId?e():this.$confirm("内容未保存, 是否继续退出?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e()}))}},beforeDestroy(){null!=this.editor&&this.editor.dispose(),window.removeEventListener("resize",this.setEditorHeight)}};var de=(0,A.Z)(ce,le,[],!1,null,"c5d100c6",null);de.options.__file="src/view/decision/func/func.vue";const ue=de.exports;var pe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"数据加载中..."}},[s("el-container",[s("el-aside",{attrs:{width:"250px"}},[s("el-tree",{ref:"tree",attrs:{data:e.treeData,"highlight-current":"","node-key":"uuid"},on:{"node-click":e.clickTreeNode}})],1),e._v(" "),s("el-main",{staticStyle:{"padding-top":"0px"}},[s("div",{staticClass:"toolbar"},[e.$hasPerm("thirdapi:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n            添加接口\n          ")]):e._e(),e._v(" "),e.$hasPerm("thirdapi:edit")?s("el-button",{attrs:{icon:"el-icon-edit",disabled:!e.activeApi.uuid},on:{click:function(t){return e.editApi(e.activeApi.uuid)}}},[e._v("\n            编辑接口\n          ")]):e._e(),e._v(" "),e.$hasPerm("thirdapi:delete")?s("el-popconfirm",{attrs:{title:"确定删除当前接口？"},on:{confirm:function(t){return e.deleteApi(e.activeApi.uuid)}}},[s("el-button",{attrs:{slot:"reference",icon:"el-icon-delete",loading:e.deleteLoading,disabled:!e.activeApi.uuid},slot:"reference"},[e._v("\n              "+e._s(e.deleteLoading?"加载中...":"删除接口")+"\n            ")])],1):e._e()],1),e._v(" "),e.activeApi.uuid?[s("el-row",{staticStyle:{"margin-top":"20px"}},[s("el-col",[s("span",{staticClass:"font-common"},[e._v("请求地址：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeApi.url))])])],1),e._v(" "),s("el-row",{staticStyle:{"margin-top":"10px"}},[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("请求方法：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeApi.method))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("参数类型：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s("JSON"==e.activeApi.requestContextType?"JSON":"KEY-VALUE"))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("结果PATH：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeApi.responseJsonPath))])])],1),e._v(" "),s("el-row",{staticStyle:{"margin-top":"10px"}},[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建人：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeApi.creator.realname))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建时间：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e._f("formatDateTime")(e.activeApi.createTime)))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("更新时间：")]),e._v(" "),e.activeApi.updateTime?s("span",{staticClass:"font-primary"},[e._v("\n                "+e._s(e._f("formatDateTime")(e.activeApi.updateTime))+"\n              ")]):e._e()])],1),e._v(" "),s("el-row",{staticStyle:{"margin-top":"10px"}},[s("el-col",[s("span",{staticClass:"font-common"},[e._v("请求头部：")]),e._v(" "),s("el-table",{staticStyle:{"margin-top":"10px"},attrs:{data:e.activeApi.headers,border:""}},[s("el-table-column",{attrs:{prop:"name",label:"名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"value",label:"值",align:"center"}})],1)],1)],1)]:e._e()],2)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑外部接口":"添加外部接口",top:e.$dialogTop,visible:e.showAddDialog},on:{"update:visible":function(t){e.showAddDialog=t},opened:e.openAddDialog,closed:e.closeAddDialog}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"接口名称",prop:"name"}},[s("el-input",{ref:"name",attrs:{maxlength:30,"show-word-limit":"",clearable:"",placeholder:"请填写接口名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"请求地址",prop:"url"}},[s("el-input",{attrs:{maxlength:250,"show-word-limit":"",clearable:"",placeholder:"请填写请求地址"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.url,callback:function(t){e.$set(e.form,"url","string"==typeof t?t.trim():t)},expression:"form.url"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"请求方法",prop:"method"}},[s("el-select",{attrs:{placeholder:"请选择请求方法"},model:{value:e.form.method,callback:function(t){e.$set(e.form,"method",t)},expression:"form.method"}},[s("el-option",{attrs:{label:"GET",value:"GET"}}),e._v(" "),s("el-option",{attrs:{label:"POST",value:"POST"}})],1)],1),e._v(" "),"POST"==e.form.method?s("el-form-item",{attrs:{label:"参数类型",prop:"requestContentType"}},[s("el-select",{attrs:{placeholder:"请选择参数类型"},model:{value:e.form.requestContentType,callback:function(t){e.$set(e.form,"requestContentType",t)},expression:"form.requestContentType"}},[s("el-option",{attrs:{label:"KEY-VALUE",value:"X_WWW_FORM_URLENCODED"}}),e._v(" "),s("el-option",{attrs:{label:"JSON",value:"JSON"}})],1)],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"结果PATH",prop:"responseJsonPath"}},[s("el-input",{attrs:{maxlength:30,"show-word-limit":"",clearable:"",placeholder:"请填写结果PATH"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.responseJsonPath,callback:function(t){e.$set(e.form,"responseJsonPath","string"==typeof t?t.trim():t)},expression:"form.responseJsonPath"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"请求头部"}},[e._l(e.form.headers,(function(t,i){return s("el-row",{key:i},[s("el-col",{attrs:{span:1}},[e._v(e._s(i+1)+".")]),e._v(" "),s("el-col",{attrs:{span:9}},[s("el-input",{attrs:{clearable:"",placeholder:"请填写头部名称"},model:{value:t.name,callback:function(s){e.$set(t,"name","string"==typeof s?s.trim():s)},expression:"header.name"}})],1),e._v(" "),s("el-col",{attrs:{span:9,offset:1}},[s("el-input",{attrs:{clearable:"",placeholder:"请填写头部值"},model:{value:t.value,callback:function(s){e.$set(t,"value","string"==typeof s?s.trim():s)},expression:"header.value"}})],1),e._v(" "),s("el-col",{attrs:{span:4}},[s("i",{staticClass:"el-icon-plus icon-btn",on:{click:function(t){return e.addHeader(i)}}}),e._v(" "),s("i",{staticClass:"el-icon-delete icon-btn",on:{click:function(t){return e.delHeader(i)}}})])],1)})),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:e.addHeader}},[e._v("添加头部")])],2)],1),e._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.showAddDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.addLoading?"提交中...":"确 定"))])],1)],1)],1)};pe._withStripped=!0;const he={name:"thirdapi",data:()=>({loading:!1,showAddDialog:!1,addLoading:!1,form:{name:"",url:"",method:"POST",headers:[],requestContentType:"X_WWW_FORM_URLENCODED",responseJsonPath:"",headers:[{}]},rules:{name:[{required:!0,message:"请填写接口名称",trigger:"blur"},{max:30,message:"长度不能超过30个字符",trigger:"blur"}],url:[{required:!0,message:"请填写请求地址",trigger:"blur"},{max:250,message:"长度不能超过250个字符",trigger:"blur"}],method:[{required:!0,message:"请选择请求方法",trigger:"change"}],requestContentType:[{required:!0,message:"请选择参数类型",trigger:"change"}],responseJsonPath:[{max:30,message:"长度不能超过30个字符",trigger:"blur"}]},treeData:[],apis:[],activeApi:{},deleteLoading:!1}),mounted(){this.loadApis()},methods:{loadApis(e){this.loading=!0,this.$axios.get("/thirdapi/all").then((t=>{0==t.data.code&&(this.apis=t.data.data,this.setTreeData(),this.activeTreeNode(e)),this.loading=!1})).catch((()=>{this.loading=!1}))},setTreeData(){this.treeData=[],this.apis.forEach((e=>{this.treeData.push({uuid:e.uuid,label:e.name,api:e})}))},activeTreeNode(e){this.treeData.length>0?this.$nextTick((()=>{const t=e?this.$utils.arrayFind(this.treeData,(t=>t.uuid==e)):this.treeData[0];t&&(this.$refs.tree.setCurrentKey(t.uuid),this.clickTreeNode(t))})):this.activeApi={}},clickTreeNode(e){this.activeApi=e.api},openAddDialog(){this.$refs.name.focus()},closeAddDialog(){this.form={name:"",url:"",method:"POST",headers:[],requestContentType:"X_WWW_FORM_URLENCODED",responseJsonPath:"",headers:[{}]},this.$refs.form.resetFields()},addHeader(e){this.form.headers.splice(e+1,0,{})},delHeader(e){this.form.headers.splice(e,1),0==this.form.headers.length&&this.form.headers.push({})},submit(){this.$refs.form.validate((e=>{if(e){const e={name:this.form.name,url:this.form.url,method:this.form.method,requestContentType:this.form.requestContentType,responseJsonPath:this.form.responseJsonPath};this.form.uuid&&(e.uuid=this.form.uuid),this.form.headers.filter((e=>this.$utils.isNotBlank(e.name)&&this.$utils.isNotBlank(e.value))).forEach(((t,s)=>{e[`headers[${s}].name`]=t.name,e[`headers[${s}].value`]=t.value}));const t=e.uuid?"/thirdapi/edit":"/thirdapi/add";this.addLoading=!0,this.$axios.post(t,this.$qs.stringify(e)).then((t=>{0==t.data.code?(this.$message.success(e.uuid?"编辑成功":"添加成功"),this.showAddDialog=!1,this.loadApis(t.data.data.uuid)):this.$message.error(t.data.msg?t.data.msg:"操作失败"),this.addLoading=!1})).catch((()=>{this.addLoading=!1}))}}))},deleteApi(e){this.deleteLoading=!0,this.$axios.post("/thirdapi/delete",this.$qs.stringify({uuid:e})).then((e=>{this.deleteLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.loadApis()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.deleteLoading=!1}))},editApi(e){this.apis.some((t=>{if(t.uuid==e)return this.form=this.$utils.copy(t),this.showAddDialog=!0,!0}))}}};var me=(0,A.Z)(he,pe,[],!1,null,"00dd9cfd",null);me.options.__file="src/view/decision/thirdapi/thirdapi.vue";const fe=me.exports;var ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("aimodel:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addModel()}}},[e._v("\n        添加模型\n      ")]):e._e(),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"==typeof t?t.trim():t},expression:"searchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:function(t){return e.search()}},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...","row-class-name":e.tableRowClassName,data:e.models},on:{"sort-change":e.sortChange}},[s("el-table-column",{attrs:{label:"模型名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enable?s("span",[e._v(e._s(t.row.modelName))]):s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(t.row.modelName))])])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"jarName",label:"模型文件","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"更新时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"创建时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("aimodel:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.edit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),s("dropdown",{staticClass:"moreOperation",attrs:{trigger:"click"},on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n              更多\n              "),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$hasPerm("aimodel:download")?s("dropdown-item",{attrs:{command:{row:t.row,op:"download"},icon:"el-icon-download"}},[e._v("下载模型")]):e._e(),e._v(" "),e.$hasPerm("aimodel:download")?s("dropdown-item",{attrs:{command:{row:t.row,op:"downloadParam"},icon:"el-icon-download"}},[e._v("下载模型参数")]):e._e(),e._v(" "),e.$hasPerm("aimodel:del")?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-delete"}},[e._v("删除")]):e._e()],1)],1)]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}})],1),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑模型":"添加模型",width:"30%",visible:e.showModelDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showModelDialog=t},opened:function(t){return e.$refs.input.focus()},closed:e.resetForm}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"模型名称",prop:"modelName"}},[s("el-input",{ref:"input",attrs:{maxlength:100,"show-word-limit":!1},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.add(t)}},model:{value:e.form.modelName,callback:function(t){e.$set(e.form,"modelName","string"==typeof t?t.trim():t)},expression:"form.modelName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"模型文件",prop:"jarName"}},[s("el-upload",{ref:"upload1",attrs:{action:"",accept:".jar, .xml, .pmml",limit:1,"on-change":e.changeFile,"on-remove":function(){e.form.jarName=null},"auto-upload":!1,"show-file-list":!0},model:{value:e.form.jarName,callback:function(t){e.$set(e.form,"jarName",t)},expression:"form.jarName"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-files"}},[e._v("选择文件")]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("文件大小不超过30MB，支持PMML及MaximAI导出的JAR模型")])],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showModelDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.add}},[e._v(e._s(e.addLoading?"提交中...":"确 定"))])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"引用服务列表",visible:e.showMicroDialog},on:{"update:visible":function(t){e.showMicroDialog=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.microData}},[s("el-table-column",{attrs:{prop:"name",label:"服务名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"typeName",label:"服务类型"}}),e._v(" "),s("el-table-column",{attrs:{label:"是否可用",formatter:function(e){return e.enable?"是":"否"}}})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"AI模型权限配置",visible:e.showPermissionDialog},on:{"update:visible":function(t){e.showPermissionDialog=t}}},[s("div",{staticClass:"toolbar"},[s("el-cascader",{attrs:{options:e.accounts,placeholder:"选择要授权的用户",props:{value:"uuid",label:"username"}},on:{change:e.handleChange}})],1),e._v(" "),e._l(e.resourceData,(function(t,i){return s("div",{key:i,staticClass:"clearfix",staticStyle:{"line-height":"30px"}},[s("div",{staticStyle:{float:"left"}},[e._v(e._s(t.modelName))]),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("span",[e._v(e._s(t.permission[0]?"可见":"不可见"))]),e._v(" "),s("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(s){return e.setRowClick(t,7)}},model:{value:t.permission[0],callback:function(s){e.$set(t.permission,0,s)},expression:"item.permission[0]"}})],1)])}))],2)],1)};ge._withStripped=!0;const ve={name:"aimodel",data(){const e=this;return{showModelDialog:!1,showPermissionDialog:!1,tableLoading:!1,models:[],total:0,page:1,pageNum:10,searchName:"",addLoading:!1,innerVisible:!1,form:{uuid:"",modelName:"",jarName:"",params:""},rules:{modelName:[{required:!0,message:"请输入模型名称",trigger:"blur"},{max:100,message:"长度不超过100个字符",trigger:"blur"}],jarName:[{validator:function(t,s,i){e.form.uuid||e.file?i():i(new Error("请上传模型文件"))}}],paramName:[{validator:function(t,s,i){e.form.uuid,i()}}]},file:null,paramFile:null,microLoading:!1,showMicroDialog:!1,microData:[],accounts:[],resourceData:[],accountUuid:"",searchName:"",sortOption:{sortField:"",sortDirection:""}}},mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/aimodel/all",{params:{page:this.page,pageNum:this.pageNum,isAll:!1,modelName:this.searchName,sortField:this.sortOption.sortField,sortDirection:this.sortOption.sortDirection}}).then((e=>{0==e.data.code&&(e.data.data.forEach((e=>{e.permission=[!1,!1,!1,!1]})),this.total=e.data.total,this.models=e.data.data,this.resourceData=e.data.data),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},search(){this.initData()},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.initData()},addModel(){this.form.uuid="",this.form.modelName="",this.form.jarName="",this.form.params="",this.showModelDialog=!0},tableRowClassName:({row:e,rowIndex:t})=>!1===e.enable?"disabled":"",moreOperation({row:e,op:t}){"edit"==t?this.edit(e):"enable"==t?this.enable(e):"del"==t?this.del(e):"download"==t?this.download(e):"downloadParam"==t&&this.downloadParam(e)},add(){this.$refs.form.validate((e=>{if(e){this.addLoading=!0;let e=this.form.uuid?"/aimodel/edit":"/aimodel/add",t=new FormData;this.form.uuid&&t.append("uuid",this.form.uuid),this.file&&t.append("formFile",this.file.raw),t.append("modelName",this.form.modelName),this.$axios.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{this.addLoading=!1,this.showModelDialog=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.addLoading=!1,this.showModelDialog=!1}))}}))},changeFile(e){this.file=e},resetForm(){this.$refs.form.resetFields(),this.file&&this.$refs.upload1.clearFiles(),this.file=null},edit(e){this.form.uuid=e.uuid,this.form.modelName=e.modelName,this.form.params=e.params,this.showModelDialog=!0},enable(e){this.$confirm("确认"+(e.enable?"禁用":"启用"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let t=e.enable?"/aimodel/disable":"/aimodel/enable";this.tableLoading=!0,this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.tableLoading=!1}))}))},download(e){this.tableLoading=!0;const t=this;this.$axios({method:"get",url:"/aimodel/down?uuid="+e.uuid,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){var i=new FileReader;i.onload=function(){const e=JSON.parse(i.result);if(401==e.code){localStorage.removeItem("hasLogin");let e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(e.msg?e.msg:"下载失败")},i.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.jarName),document.body.appendChild(i),i.click()}t.tableLoading=!1})).catch((()=>{t.$message.error("下载失败"),t.tableLoading=!1}))},downloadParam(e){this.tableLoading=!0;const t=this;this.$axios({method:"get",url:"/aimodel/downmodelparams?uuid="+e.uuid,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){var i=new FileReader;i.onload=function(){const e=JSON.parse(i.result);t.$message.error(e.msg?e.msg:"下载失败")},i.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.className+".xlsx"),document.body.appendChild(i),i.click()}this.tableLoading=!1})).catch((()=>{t.$message.error("下载失败"),this.tableLoading=!1}))},del(e){this.tableLoading=!0,this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/aimodel/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))}))},microDoalogInfo(e){this.showMicroDialog=!0,this.microLoading=!0,this.$axios.get("/aimodel/micros",{params:{uuid:e.uuid}}).then((e=>{0==e.data.code&&(this.microData=e.data.data)})).catch((()=>{this.microLoading=!1})).then((()=>{this.microLoading=!1}))},handleChange(e){for(let e in this.resourceData)this.$set(this.resourceData,e,{...this.resourceData[e],permission:[!1,!1,!1,!1]});this.setResource(e[0],this.resourceData,3),this.accountUuid=e[0]},setResource(e,t,s){this.$axios.post("/permission/accounthas",this.$qs.stringify({accountUuid:e,dataType:s})).then((e=>{if(0==e.data.code){let s=e.data.data;for(let e=0;e<t.length;e++){for(let i=0;i<s.length;i++)t[e].uuid==s[i].resourceId&&this.$set(t,e,{...t[e],permission:this.infoPermission(s[i].permission)});0==s.length&&this.$set(t,e,{...t[e],permission:[!1,!1,!1,!1]})}}}))},infoPermission(e){let t=["r","w","d","x"],s=[!1,!1,!1,!1],i=e.split(",");for(let e=0;e<t.length;e++)for(let a=0;a<i.length;a++)t[e]==i[a]&&(s[e]=!0);return s},setRowClick(e,t){if(""==this.accountUuid)return this.$message.warning("请选择用户");let s=[],i=["r","w","d","x"];(e.permission[1]||e.permission[2]||e.permission[3])&&(e.permission[0]=!0);for(let t=0;t<e.permission.length;t++)e.permission[t]&&s.push(i[t]);this.$axios.post("/permission/authorization",this.$qs.stringify({accountUuid:this.accountUuid,resourceId:e.uuid,type:t,permission:s.join(",")})).then((e=>{0==e.data.code?this.$message.success("操作成功"):this.$message.error(e.data.msg?e.data.msg:"操作失败")}))}}};var be=(0,A.Z)(ve,ge,[],!1,null,"4b9d75e1",null);be.options.__file="src/view/decision/aimodel/aimodel.vue";const we=be.exports;var ye=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",{directives:[{name:"loading",rawName:"v-loading",value:null==e.project,expression:"project == null"}],attrs:{"element-loading-text":"数据加载中..."}},[s("el-aside",{directives:[{name:"show",rawName:"v-show",value:null!=e.project,expression:"project != null"}],ref:"aside",staticClass:"aside-wrap",attrs:{width:e.asideWidth}},[e.asideCollapse?e._e():s("div",{staticClass:"aside-toolbar"},[s("el-tooltip",{attrs:{content:"隐藏侧边栏",placement:"right"}},[s("i",{staticClass:"el-icon-s-fold",on:{click:function(){return e.asideCollapse=!e.asideCollapse}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"搜索",placement:"right"}},[s("i",{staticClass:"el-icon-search",on:{click:e.searchResources}})])],1),e._v(" "),e.asideCollapse?s("div",{staticClass:"aside-collapse",on:{click:function(){return e.asideCollapse=!e.asideCollapse}}},[s("el-tooltip",{attrs:{content:"展示侧边栏",placement:"right"}},[s("i",{staticClass:"el-icon-s-unfold"})])],1):e._e(),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.asideCollapse,expression:"!asideCollapse"}],staticClass:"tree-wrap"},[s("el-tree",{ref:"MenuTree",attrs:{props:e.treeProps,"node-key":"uuid",draggable:"","allow-drop":e.allowDrop,"allow-drag":e.allowDrag,"filter-node-method":e.filterNode,"default-expanded-keys":e.defaultExpend,"highlight-current":"",load:e.loadTreeNode,lazy:""},on:{"node-click":e.handleNodeClick,"node-drop":e.nodeDrop},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.node,a=t.data;return s("span",{staticClass:"custom-tree-node"},[s("treeMenu",{attrs:{menuNode:i,menuData:a},on:{handleCommand:e.handleCommand,importFact:e.importFact}})],1)}}])})],1)]),e._v(" "),s("el-main",{directives:[{name:"loading",rawName:"v-loading",value:e.assetsLoading,expression:"assetsLoading"},{name:"show",rawName:"v-show",value:null!=e.project,expression:"project != null"}],ref:"main",attrs:{id:"assets-main","element-loading-text":"数据加载中..."}},[s("div",{staticClass:"header-wrap",attrs:{id:"assets-header"}},[null!=e.project?s("el-page-header",{attrs:{content:e.project.name},on:{back:function(){return e.$router.push("/decision/project")}}}):e._e(),e._v(" "),e.$hasPerm("project.asset:add")?s("div",{staticStyle:{"margin-top":"-5px"}},[s("el-upload",{staticClass:"upload",staticStyle:{display:"inline-block"},attrs:{action:"","on-change":e.importAssets,"auto-upload":!1,disabled:e.importLoading,"show-file-list":!1,accept:".rule"}},[s("el-button",{attrs:{loading:e.importLoading,icon:"el-icon-upload"}},[e._v("\n            "+e._s(e.importLoading?"正在导入...":"导入资源")+"\n          ")])],1),e._v(" "),s("dropdown",{on:{command:e.add}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"}},[e._v("新建资源")]),e._v(" "),s("dropdown-menu",{staticStyle:{width:"170px"},attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.$utils.assetsArr,(function(t,i){return t.add?s("dropdown-item",{key:i,attrs:{command:t.type,icon:t.icon}},[e._v("\n              "+e._s(t.name)+"\n            ")]):e._e()})),1)],1)],1):e._e()],1),e._v(" "),s("el-tabs",{directives:[{name:"show",rawName:"v-show",value:e.assetsArr.length>0,expression:"assetsArr.length > 0"}],ref:"tabs",attrs:{id:"assets-tabs",type:"border-card",closable:""},on:{"tab-remove":e.removeTab},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.assetsArr,(function(t){return s("el-tab-pane",{key:t.uuid,attrs:{name:t.uuid}},[s("span",{attrs:{slot:"label"},slot:"label"},[t.locked?s("i",{staticClass:"el-icon-lock"}):e._e(),e._v(" "),s("i",{class:e.$utils.getAssetsTypeIcon(t.type)}),e._v("\n          "+e._s(t.name)+"\n        ")]),e._v(" "),"fact"==t.type?s("fact-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets}}):"constant"==t.type?s("constant-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets}}):"guidedrule"==t.type?s("guidedrule-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets,addTemplate:e.addTemplate}}):"rulescript"==t.type?s("rulescript-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets}}):"ruletable"==t.type?s("ruletable-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets,addTemplate:e.addTemplate}}):"ruletree"==t.type?s("ruletree-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets,addTemplate:e.addTemplate}}):"scorecard"==t.type?s("scorecard-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets,addTemplate:e.addTemplate}}):"ruleflow"==t.type?s("ruleflow-assets",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets}}):"testcase"==t.type?s("testcase",{attrs:{assets:t,readonly:e.isAssetsReadonly(t)},on:{refresh:e.refreshAssets,delete:e.deleteAssets}}):"pkg"==t.type?s("pkg"):"search"==t.type?s("searchResult",{attrs:{searchData:t.searchVal},on:{activateAssets:e.activateAssets}}):"recycle"==t.type?s("recycle",{ref:"recycledom",refInFor:!0,on:{reduction:e.reduction}}):"func"==t.type?s("func"):e._e()],1)})),1),e._v(" "),null!=e.project&&0==e.assetsArr.length?s("home",{attrs:{project:e.project},on:{"jump-activity":e.jumpActivity}}):e._e(),e._v(" "),s("el-dialog",{attrs:{title:"新建"+e.newFile.typeStr,visible:e.showAddFileDialog,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddFileDialog=t},opened:function(t){return e.$refs.newFileName.focus()},closed:function(t){e.$refs.newFileForm.resetFields(),e.clearDir()}}},[s("el-form",{ref:"newFileForm",attrs:{model:e.newFile,rules:e.newFileRules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{ref:"newFileName",attrs:{maxlength:20,"show-word-limit":"",placeholder:"请输入名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addSave(t)}},model:{value:e.newFile.name,callback:function(t){e.$set(e.newFile,"name","string"==typeof t?t.trim():t)},expression:"newFile.name"}})],1),e._v(" "),"dir"!=e.newFile.type?s("el-form-item",{attrs:{label:"描述",prop:"description"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请输入描述",autosize:{minRows:6},maxlength:100,"show-word-limit":""},model:{value:e.newFile.description,callback:function(t){e.$set(e.newFile,"description",t)},expression:"newFile.description"}})],1):e._e(),e._v(" "),s("el-form-item",{class:"dir"==e.newFile.type?"is-required":"",attrs:{label:"文件夹",prop:"dir"}},[s("el-input",{attrs:{readonly:"",placeholder:"请选择文件夹"},on:{focus:e.selectDir},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addSave(t)}},model:{value:e.newFile.dir,callback:function(t){e.$set(e.newFile,"dir","string"==typeof t?t.trim():t)},expression:"newFile.dir"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-delete"},on:{click:e.clearDir},slot:"append"})],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showAddFileDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.addSave}},[e._v("\n          "+e._s(e.addLoading?"提交中...":"确 定")+"\n        ")])],1),e._v(" "),s("el-dialog",{attrs:{title:"选择文件夹",width:"30%",visible:e.showDirDialog,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDirDialog=t}}},[e.showDirDialog?s("el-tree",{ref:"dirTree",attrs:{props:e.defaultProps,load:e.loadSelectTreeNode,lazy:"","node-key":"uuid"},on:{"node-click":e.handleNodeSelectClick}}):e._e(),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showDirDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.confirmSelectDir}},[e._v("确 定")])],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"选择要移动文件夹",width:"30%",visible:e.showDirMoveDialog,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.showDirMoveDialog=t}}},[s("el-tree",{ref:"dirMoveTree",attrs:{data:e.dirsMove,"default-expand-all":!0,"node-key":"id"}}),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showDirMoveDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.confirmSelectDirMove}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"编辑文件夹",visible:e.showEditFolderDialog,width:"30%"},on:{"update:visible":function(t){e.showEditFolderDialog=t},opened:function(t){return e.$refs.newFolderName.focus()}}},[s("el-form",{ref:"editFolderForm",attrs:{model:e.folder,rules:e.newFileRules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{ref:"newFolderName",attrs:{maxlength:20,"show-word-limit":!0,placeholder:"请输入名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitEditFolder(t)}},model:{value:e.folder.name,callback:function(t){e.$set(e.folder,"name",t)},expression:"folder.name"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showEditFolderDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.editLoading},on:{click:e.submitEditFolder}},[e._v("\n          "+e._s(e.editLoading?"提交中...":"确 定")+"\n        ")])],1)],1),e._v(" "),s("ul",{ref:"contextMenu",staticClass:"el-dropdown-menu el-popper",staticStyle:{top:"-100px","transform-origin":"center bottom 0px"}},[s("li",{staticClass:"el-dropdown-menu__item",on:{click:e.closeAll}},[e._v("关闭所有标签页")]),e._v(" "),s("li",{ref:"contextMenu-closeOther",staticClass:"el-dropdown-menu__item",on:{click:e.closeOther}},[e._v("关闭其它标签页")])]),e._v(" "),s("el-backtop",{attrs:{target:"#assets-main"}})],1)],1)};ye._withStripped=!0;var _e=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets,"new-version":!1},on:{callback:e.saveCallback}}),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.addField}},[e._v("\n          添加字段\n        ")]):e._e(),e._v(" "),s("dropdown",{attrs:{"split-button":""},on:{click:e.exportExcel}},[s("i",{staticClass:"el-icon-download"}),e._v("\n          "+e._s(e.exportLoading?"导出中...":"导出文件")+"\n          "),e.$hasPerm("project.asset:edit")?s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",[s("el-upload",{attrs:{action:"","on-change":e.importExcel,"auto-upload":!1,"show-file-list":!1,accept:".xlsx"}},[s("i",{staticClass:"iconfont iconVersionupdaterule-copy"}),e._v(" 导入文件\n              ")])],1)],1):e._e()],1),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:function(t){e.$emit("refresh",t)}}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-form",{attrs:{inline:""}},[s("el-form-item",[s("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n        模型英文名称\n        "),s("el-tooltip",{attrs:{content:"调用规则的时候，标识当前数据模型"}},[s("i",{staticClass:"el-icon-question"})])],1),e._v(" "),s("el-input",{ref:"enNameInput",attrs:{placeholder:"请输入模型英文名称",size:"small",maxlength:e.maxLength,disabled:e.readonly},model:{value:e.enName,callback:function(t){e.enName="string"==typeof t?t.trim():t},expression:"enName"}})],1),e._v(" "),s("el-form-item",[s("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n        传递方向\n        "),s("el-tooltip",{attrs:{content:"调用服务的时候，数据模型在报文体中的传递方向"}},[s("i",{staticClass:"el-icon-question"})])],1),e._v(" "),s("el-select",{attrs:{size:"small",disabled:e.readonly,placeholder:"请选择"},model:{value:e.direction,callback:function(t){e.direction=t},expression:"direction"}},[s("el-option",{attrs:{value:"IN_OUT",label:"传入传出"}}),e._v(" "),s("el-option",{attrs:{value:"IN",label:"仅传入"}}),e._v(" "),s("el-option",{attrs:{value:"OUT",label:"仅传出"}}),e._v(" "),s("el-option",{attrs:{value:"NONE",label:"不传入不传出"}})],1)],1),e._v(" "),s("el-form-item",[s("span",{attrs:{slot:"label"},slot:"label"},[e._v("\n        审批字段\n        "),s("el-tooltip",{attrs:{content:"统计报表时，审批字段标识本次调用审批是否通过，支持Boolean类型字段"}},[s("i",{staticClass:"el-icon-question"})])],1),e._v(" "),s("el-select",{attrs:{size:"small",clearable:"",disabled:e.readonly,placeholder:"请选择"},model:{value:e.approvalField,callback:function(t){e.approvalField=t},expression:"approvalField"}},e._l(e.approvalOptions,(function(e){return s("el-option",{key:e.name,attrs:{value:e.name,label:e.label}})})),1)],1)],1),e._v(" "),s("el-row",[s("el-col",[s("el-table",{ref:"table",staticClass:"tb-edit",attrs:{data:e.fields,border:"","highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"英文名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly||t.row.id!=e.clickRowId?e._e():s("el-input",{ref:"input_name_"+t.row.id,attrs:{placeholder:"请输入",maxlength:e.maxLength},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addField(t)}},model:{value:t.row.name,callback:function(s){e.$set(t.row,"name","string"==typeof s?s.trim():s)},expression:"scope.row.name"}}),e._v(" "),s("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"中文名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly||t.row.id!=e.clickRowId?e._e():s("el-input",{ref:"input_label_"+t.row.id,attrs:{placeholder:"请输入",maxlength:e.maxLength},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.addField(t)}},model:{value:t.row.label,callback:function(s){e.$set(t.row,"label","string"==typeof s?s.trim():s)},expression:"scope.row.label"}}),e._v(" "),s("span",[e._v(e._s(t.row.label))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"数据类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly||t.row.id!=e.clickRowId?e._e():s("el-select",{ref:"input_type_"+t.row.id,attrs:{placeholder:"请选择"},on:{change:function(s){return e.changeType(t.row)}},model:{value:t.row.type,callback:function(s){e.$set(t.row,"type",s)},expression:"scope.row.type"}},e._l(e.$utils.fieldTypeArr,(function(e){return s("el-option",{key:e,attrs:{label:"Derive"!=e?e:"衍生字段",value:e}})})),1),e._v(" "),s("span",[e._v(e._s("Derive"!=t.row.type?t.row.type:"衍生字段"))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"子类型/衍生字段",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?["Derive"==t.row.type?s("expression",{attrs:{readonly:""},model:{value:t.row.deriveData,callback:function(s){e.$set(t.row,"deriveData",s)},expression:"scope.row.deriveData"}}):s("span",[e._v(e._s(e.getSubTypeName(t.row.subType)))])]:[t.row.id==e.clickRowId?[e.$utils.isCollection(t.row.type)?s("el-select",{ref:"input_subType_"+t.row.id,attrs:{placeholder:"请选择",filterable:""},model:{value:t.row.subType,callback:function(s){e.$set(t.row,"subType",s)},expression:"scope.row.subType"}},e._l(e.subTypes,(function(t){return s("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,(function(e){return s("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1)})),1):e.$utils.isObject(t.row.type)?s("el-select",{ref:"input_subType_"+t.row.id,attrs:{placeholder:"请选择",filterable:""},model:{value:t.row.subType,callback:function(s){e.$set(t.row,"subType",s)},expression:"scope.row.subType"}},e._l(e.subTypes[0].options,(function(e){return s("el-option",{key:e.value,attrs:{value:e.value,label:e.label}})})),1):e._e()]:e._e(),e._v(" "),"Derive"==t.row.type?s("expression",{model:{value:t.row.deriveData,callback:function(s){e.$set(t.row,"deriveData",s)},expression:"scope.row.deriveData"}}):e._e(),e._v(" "),s("span",[e._v(e._s(e.getSubTypeName(t.row.subType)))])]]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"传递方向",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly||t.row.id!=e.clickRowId?e._e():s("el-select",{ref:"input_direction_"+t.row.id,attrs:{placeholder:"请选择"},model:{value:t.row.direction,callback:function(s){e.$set(t.row,"direction",s)},expression:"scope.row.direction"}},[s("el-option",{attrs:{value:"IN_OUT",label:"传入传出"}}),e._v(" "),s("el-option",{attrs:{value:"IN",label:"仅传入"}}),e._v(" "),s("el-option",{attrs:{value:"OUT",label:"仅传出"}}),e._v(" "),s("el-option",{attrs:{value:"NONE",label:"不传入不传出"}})],1),e._v(" "),"IN"==t.row.direction?s("span",[e._v("仅传入")]):"OUT"==t.row.direction?s("span",[e._v("仅传出")]):"NONE"==t.row.direction?s("span",[e._v("不传入不传出")]):s("span",[e._v("传入传出")])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"是否必输",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return"IN"==t.row.direction||"IN_OUT"==t.row.direction?[e.readonly||t.row.id!=e.clickRowId?e._e():s("el-select",{ref:"input_required_"+t.row.id,attrs:{placeholder:"请选择"},model:{value:t.row.required,callback:function(s){e.$set(t.row,"required",s)},expression:"scope.row.required"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1),e._v(" "),s("span",[e._v(e._s("true"==t.row.required?"是":"否"))])]:void 0}}],null,!0)}),e._v(" "),e.readonly?e._e():s("el-table-column",{attrs:{label:"操作",width:"120",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-delete icon-btn",on:{click:function(s){return s.stopPropagation(),e.delField(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-top icon-btn",on:{click:function(s){return s.stopPropagation(),e.moveUp(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-bottom icon-btn",on:{click:function(s){return s.stopPropagation(),e.moveDown(t)}}})]}}],null,!1,1387499192)})],1),e._v(" "),s("pagination",{attrs:{"page-size":e.pageSize,"current-page":e.page,total:e.totalFields.length},on:{"update:pageSize":function(t){e.pageSize=t},"update:page-size":function(t){e.pageSize=t},"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},change:e.refreshPage}})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"错误信息",top:e.$dialogTop,visible:e.showImportErrorDialog},on:{"update:visible":function(t){e.showImportErrorDialog=t}}},[s("el-alert",{attrs:{type:"error","show-icon":"",title:"导入文件失败，错误信息如下："}}),e._v(" "),s("el-table",{attrs:{data:e.importErrors}},[s("el-table-column",{attrs:{label:"文件中的行号",prop:"rowNumber"}}),e._v(" "),s("el-table-column",{attrs:{label:"错误描述",prop:"msgs","show-overflow-tooltip":""}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showImportErrorDialog=!1}}},[e._v("取 消")])],1)],1)],1)};_e._withStripped=!0;var xe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$hasPerm("project.asset:del")?s("el-popconfirm",{attrs:{title:"确定删除？"},on:{confirm:e.del}},[s("el-button",{attrs:{slot:"reference",icon:"el-icon-delete",loading:e.loading},slot:"reference"},[e._v("\n    "+e._s(e.loading?"提交中...":"删除")+"\n  ")])],1):e._e()};xe._withStripped=!0;const ke={name:"delete-btn",props:{assets:Object},data:()=>({loading:!1}),methods:{del(){this.loading=!0,this.$axios.post("/assets/delete",this.$qs.stringify({uuid:this.assets.uuid})).then((e=>{0==e.data.code?(this.$message.success("删除成功"),this.$emit("delete",this.assets.uuid),this.$store.commit("setRecyle",!0),"fact"!=this.assets.type&&"constant"!=this.assets.type||this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,ignoreFunc:!0,ignoreModel:!0,ignoreThidApi:!0})):this.$message.error(e.data.msg?e.data.msg:"删除失败"),this.loading=!1})).catch((()=>{this.$message.error("删除失败"),this.loading=!1}))}}};var $e=(0,A.Z)(ke,xe,[],!1,null,"2fe25884",null);$e.options.__file="src/view/decision/project/assets/delete-btn.vue";const Te=$e.exports;var De=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"referContent"},[e.isButtonModel?s("el-button",{attrs:{icon:"el-icon-search",loading:e.loading},on:{click:e.initData}},[e._v("\n    "+e._s(e.loading?"查询中...":"查询引用")+"\n  ")]):e._e(),e._v(" "),e.show?s("el-dialog",{staticClass:"referContent",attrs:{title:"引用结果",visible:e.show,"append-to-body":"",width:"80%"},on:{"update:visible":function(t){e.show=t},closed:e.closeRefer}},[e.assetsGroup.length?s("el-tabs",{attrs:{type:"border-card"}},e._l(e.assetsGroup,(function(t){return s("el-tab-pane",{key:t.type,attrs:{label:e.$utils.getAssetsTypeText(t.type)}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"referTable tb-edit",attrs:{"element-loading-text":"数据加载中...",data:t.list,"highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"文件名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){return["pkg"!==t.type&&"fact"!==t.type&&"constant"!==t.type?s("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.viewAssets(i.row)}}},[e._v("\n                "+e._s(i.row.name)+"\n              ")]):s("span",[e._v(e._s(i.row.name))])]}}],null,!0)}),e._v(" "),"fact"==e.assets.type||"constant"==e.assets.type?s("el-table-column",{attrs:{prop:"type",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.template?"模板":"规则"))])]}}],null,!0)}):e._e(),e._v(" "),s("el-table-column",{staticStyle:{width:"60%"},attrs:{label:"pkg"==t.type?"基线版本":"版本",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.select||0==t.row.select?[t.row.assetsVersions.length?s("el-select",{ref:"input_original_"+t.row.uuid,refInFor:!0,staticClass:"scopSelect",attrs:{placeholder:"请选择"},on:{change:function(s){return e.selectVerion(t.row)}},model:{value:t.row.select,callback:function(s){e.$set(t.row,"select",s)},expression:"scope.row.select"}},e._l(t.row.assetsVersions,(function(e,t){return s("el-option",{key:t,attrs:{value:e.versionNo,label:0==e.versionNo?"正在编辑":"V"+e.versionNo}})})),1):e._e(),e._v(" "),t.row.assetsVersions.length?s("span",{staticClass:"originSelect"},[e._v("\n                "+e._s(0==t.row.select?"正在编辑":"V"+t.row.select)+"\n              ")]):e._e()]:void 0}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"描述","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.recycle?"被删除":"正常"))])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n            ")]}}],null,!0)})],1)],1)})),1):e._e()],1):e._e(),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show,template:e.viewingAssets.template},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};De._withStripped=!0;const Se={name:"refer-btn",props:{assets:Object,isButtonModel:{type:Boolean,default:!0}},data:()=>({loading:!1,show:!1,tableLoading:!1,searchList:[],assetsGroup:[],tablePage:1,total:0,viewingAssets:{uuid:"",version:0,show:!1,template:!1}}),mounted(){this.isButtonModel||(this.show=!0,this.initData())},methods:{initData(){this.loading=!0,this.$axios.get("/assets/reference",{params:{assetsUuid:this.assets.uuid,type:this.assets.type,versionNo:this.assets.versionNo?this.assets.versionNo:""}}).then((e=>{this.loading=!1,0==e.data.code?(this.assetsGroup=[],e.data.data.forEach((e=>{e.list.forEach((e=>{e.assetsVersions?(e.select=e.assetsVersions[0].versionNo,e.versionNo=e.assetsVersions[0].versionNo,e.versionDes=e.assetsVersions[0].versionDes,e.createTime=e.assetsVersions[0].createTime):(e.select="",e.versionDes=e.description?e.description:"",e.createTime=e.createTime?e.createTime:"",e.assetsVersions=[])})),this.assetsGroup.push(e)})),this.show=!0):this.$message.error("查询失败")})).catch((()=>{this.$message.error("查询失败"),this.loading=!1}))},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.uuid][0];"版本号"==t.label&&a&&this.$nextTick((function(){a.toggleMenu()}))},selectVerion(e){e.assetsVersions.forEach((t=>{e.select==t.versionNo&&(e.versionNo=t.versionNo,e.versionDes=t.versionDes,e.createTime=t.createTime)}))},handleClose(){this.searchList=[]},toPage(e){this.tablePage=e,this.initData()},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.versionNo,this.viewingAssets.template=e.template,this.viewingAssets.show=!0},closeRefer(){this.isButtonModel||this.$emit("close"),this.show=!1}}};var Ce=(0,A.Z)(Se,De,[],!1,null,"27d6906e",null);Ce.options.__file="src/view/decision/project/assets/assets-refer-btn.vue";const Ne=Ce.exports;var Le=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block","font-size":"0px","-webkit-text-size-adjust":"none"}},[e.readonly?e._e():s("dropdown",{ref:"input",on:{command:e.changeType}},[e.value.type?s("span",{staticClass:"el-dropdown-link dashed-wrapper"},[s("i",{staticClass:"el-icon-caret-bottom"})]):s("span",{staticClass:"dashed-wrapper",staticStyle:{cursor:"pointer"}},[e._v("请选择")]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._l(Object.keys(e.types),(function(t,i){return s("dropdown-item",{key:i,attrs:{command:t}},[e._v(e._s(e.types[t]))])})),e._v(" "),!e.value.parentheses&&this.value.type?s("dropdown-item",{attrs:{command:"PARENTHESES"}},[e._v("添加括号")]):e._e(),e._v(" "),e.value.parentheses?s("dropdown-item",{attrs:{command:"PARENTHESES"}},[e._v("删除括号")]):e._e()],2)],1),e._v(" "),e.value.parentheses?s("span",{staticStyle:{"font-size":"14px"}},[e._v("(")]):e._e(),e._v(" "),"INPUT"==e.value.type?s("value-input",{attrs:{"input-type":e.inputType,immediate:e.childImmediate,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.input,callback:function(t){e.$set(e.value,"input",t)},expression:"value.input"}}):"FACT"==e.value.type?s("fact",{attrs:{"input-type":e.inputType,immediate:e.childImmediate,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.fact,callback:function(t){e.$set(e.value,"fact",t)},expression:"value.fact"}}):"CONSTANT"==e.value.type?s("constant",{attrs:{"input-type":e.inputType,immediate:e.childImmediate,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.constant,callback:function(t){e.$set(e.value,"constant",t)},expression:"value.constant"}}):"FUNC"==e.value.type?s("func",{attrs:{"input-type":e.inputType,immediate:e.childImmediate,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.func,callback:function(t){e.$set(e.value,"func",t)},expression:"value.func"}}):"COLLECTION_CHILD"==e.value.type?s("collection-child",{attrs:{"input-type":e.inputType,"loop-target":e.loopTarget,immediate:e.childImmediate,readonly:e.readonly},model:{value:e.value.collectionChild,callback:function(t){e.$set(e.value,"collectionChild",t)},expression:"value.collectionChild"}}):e._e(),e._v(" "),e.showArith?s("arith",{attrs:{"input-type":e.realInputType,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.arith,callback:function(t){e.$set(e.value,"arith",t)},expression:"value.arith"}}):e._e(),e._v(" "),e.value.parentheses?s("span",{staticStyle:{"font-size":"14px"}},[e._v(")")]):e._e(),e._v(" "),e.showArith&&e.value.parentheses?s("arith",{attrs:{"input-type":e.realInputType,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.parenArith,callback:function(t){e.$set(e.value,"parenArith",t)},expression:"value.parenArith"}}):e._e()],1)};Le._withStripped=!0;const Ae={name:"expression",props:{value:{type:Object,default:function(){return{}}},inputType:{type:[String,Object],required:!1},immediate:Boolean,loopTarget:Object,readonly:{type:Boolean,default:!1}},data:()=>({childImmediate:!1}),computed:{types:function(){const e={},t=this.inputType;return this.$utils.isBlank(t)||this.$utils.isBaseType(t)?(e.INPUT="输入值",e.FACT="数据模型",e.CONSTANT="枚举常量",e.FUNC="执行函数"):(e.FACT="数据模型",e.FUNC="执行函数"),this.loopTarget&&(e.COLLECTION_CHILD="集合对象"),e},showArith:function(){const e=this.inputType||this.$store.getters.getExpressionType(this.value);return!(!this.$utils.isString(e)&&!this.$utils.isNumber(e)&&(this.$delete(this.value,"arith"),1))},realInputType:function(){return this.$utils.isNotBlank(this.inputType)?this.inputType:this.$store.getters.getExpressionType(this.value,this.loopTarget)}},mounted(){this.immediate&&this.show()},methods:{show(){this.$refs.input.show()},changeType(e){"PARENTHESES"==e?(this.value.parentheses?(this.$set(this.value,"parentheses",!1),this.$delete(this.value,"parenArith")):this.$set(this.value,"parentheses",!0),this.$emit("input",this.value)):e!=this.value.type&&(this.$delete(this.value,"input"),this.$delete(this.value,"fact"),this.$delete(this.value,"constant"),this.$delete(this.value,"func"),this.$delete(this.value,"model"),this.$delete(this.value,"arith"),this.$set(this.value,"type",e),this.$emit("input",this.value),this.$emit("draw"),this.childImmediate=!0)}}};var Ee=(0,A.Z)(Ae,Le,[],!1,null,"484437ae",null);Ee.options.__file="src/view/decision/project/components/expression.vue";const Fe=Ee.exports;var Oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"assets-toolbar"},[s("el-tooltip",{attrs:{content:e.assetsFullscreen?"退出全屏":"进入全屏",placement:"bottom"}},[s("i",{staticClass:"el-icon-full-screen",on:{click:e.setFullscreen}})])],1)};Oe._withStripped=!0;const Ie={name:"assets-toolbar",props:{fullscreen:Boolean},data(){return{assetsFullscreen:this.fullscreen}},methods:{setFullscreen(){this.assetsFullscreen=!this.assetsFullscreen,this.$emit("update:fullscreen",this.assetsFullscreen),this.$emit("fullscreen",this.assetsFullscreen),this.assetsFullscreen?this.$parent.$el.addEventListener("scroll",this.pin):this.$parent.$el.removeEventListener("scroll",this.pin)},pin(){const e=this.$parent.$el.querySelectorAll(".pin");(this.$parent.$el.pageYOffset||this.$parent.$el.scrollTop)>40?e.forEach((e=>{-1==e.className.indexOf("pin-wrap")&&(e.offsetHeight>0&&(e.parentNode.style.height=e.offsetHeight+"px"),e.className="pin pin-wrap el-card is-always-shadow el-card__body",e.style.width=window.innerWidth-47+"px",e.style.left="15px")})):e.forEach((e=>{e.className="pin",e.style.width="100%",e.style.left="0px"}))}}};var Pe=(0,A.Z)(Ie,Oe,[],!1,null,"56c1ae35",null);Pe.options.__file="src/view/decision/project/assets/assets-toolbar.vue";const Me=Pe.exports,Re=["abstract","assert","boolean","break","byte","case","catch","char","class","const","continue","default","do","double","else","enum","extends","final","finally","float","for","goto","if","implements","import","instanceof","int","interface","long","native","new","package","private","protected","public","return","strictfp","short","static","super","switch","synchronized","this","throw","throws","transient","try","void","volatile","while","Boolean","Character","Double","Float","Integer","Long","Short","BigDecimal","String","Object","List","Set","Map","Date"],je={name:"index",props:{assets:Object,readonly:{type:Boolean,default:!1}},components:{deleteBtn:Te,referBtn:Ne,expression:Fe,assetsToolbar:Me},data:()=>({fields:[],showImportErrorDialog:!1,importErrors:[],maxLength:50,enName:"",historyEnName:"",clickRowId:"",direction:"IN_OUT",approvalField:"",exportLoading:!1,totalFields:[],page:1,pageSize:50,fullscreen:!1}),computed:{subTypes:function(){const e=[{label:"对象类型",options:[]},{label:"基本类型",options:[]}];return this.$store.state.facts.forEach((t=>{t.uuid!=this.assets.uuid&&e[0].options.push({value:t.uuid,label:t.name})})),this.$utils.fieldBaseTypeArr.forEach((t=>{e[1].options.push({value:t,label:t})})),e},approvalOptions(){return this.totalFields.filter((e=>this.$utils.isBoolean(e.type)))}},mounted(){this.initData()},methods:{initData(){if(this.assets.content){let e=JSON.parse(this.assets.content);const t=e.fields;t.forEach((e=>{e.id||(e.id=this.genFieldId()),this.$utils.isDerive(e.type)&&(e.deriveData?e.deriveData=JSON.parse(e.deriveData):e.deriveData={}),e.required||this.$set(e,"required","false")})),this.totalFields=t,this.filterPage(),e.enName&&(this.enName=e.enName,this.historyEnName=e.enName),e.direction&&(this.direction=e.direction),e.approvalField&&(this.approvalField=e.approvalField)}else this.fields=[],this.totalFields=[]},addField(){const e=this.genFieldId();let t={id:e,name:"",label:"",type:"String",subType:"",direction:"IN_OUT",deriveData:{},required:"false"};this.totalFields.push(t),this.jumpLastPage(),this.clickRowId=e,this.$nextTick((()=>{this.$refs.table.setCurrentRow(t),this.$nextTick((()=>{this.$refs["input_name_"+t.id].focus()}))}))},delField(e){this.totalFields=this.totalFields.filter((t=>t.id!=e.row.id)),this.refreshPage()},validate(){if(!this.enName)return this.$message.warning("请填写模型英文名称"),this.$refs.enNameInput.focus(),!1;if(!/^[A-Za-z]\w*$/.test(this.enName))return this.$message.warning("模型英文名称格式不正确，支持字母、数字、下划线，并且以字母开头"),this.$refs.enNameInput.focus(),!1;if(-1!=Re.indexOf(this.enName))return this.$message.warning("模型英文名称不能使用JAVA关键字"),this.$refs.enNameInput.focus(),!1;if(this.totalFields.length<1)return this.$message.warning("请添加字段"),!1;let e=!0;if(this.totalFields.some(((t,s)=>t.name?/^[A-Za-z]\w*$/.test(t.name)?-1!=Re.indexOf(t.name)?(this.showWarningMsg(s,"字段英文名称不能使用JAVA关键字","name"),e=!1,!0):t.label?-1!=t.label.indexOf(".")?(this.showWarningMsg(s,"字段中文名称不能包含字符[.]","label"),e=!1,!0):(this.$utils.isList(t.type)||this.$utils.isObject(t.type))&&this.$utils.isBlank(t.subType)?(this.showWarningMsg(s,"请选择字段子类型"),e=!1,!0):void 0:(this.showWarningMsg(s,"请填写字段中文名称","label"),e=!1,!0):(this.showWarningMsg(s,"字段英文名称格式不正确，支持字母、数字、下划线，并且以字母开头","name"),e=!1,!0):(this.showWarningMsg(s,"请填写英文名称","name"),e=!1,!0))),!e)return!1;let t=[],s=[];this.totalFields.forEach((e=>{t.push(e.name),s.push(e.label)})),t.sort(),s.sort();for(let e=0;e<t.length-1;e++)if(t[e]==t[e+1]||s[e]==s[e+1])return this.$message.warning("请去除重复字段"),!1;return!0},showWarningMsg(e,t,s){const i=Math.ceil((e+1)/this.pageSize);i!=this.page&&this.jumpPage(i),this.$message.warning(t);const a=this.totalFields[e];this.clickRowId=a.id,this.$refs.table.setCurrentRow(a),s&&this.$nextTick((()=>{this.$refs[`input_${s}_${a.id}`].focus()}))},cellClick(e,t,s,i){this.readonly||(this.clickRowId=e.id,this.$nextTick((function(){"英文名称"==t.label?this.$refs["input_name_"+e.id].focus():"中文名称"==t.label?this.$refs["input_label_"+e.id].focus():"数据类型"==t.label||"数据类型"==t.label?this.$refs["input_type_"+e.id].toggleMenu():"子类型/衍生字段"==t.label?this.$refs["input_subType_"+e.id]&&this.$refs["input_subType_"+e.id].toggleMenu():"传递方向"==t.label?this.$refs["input_direction_"+e.id].toggleMenu():"是否必输"==t.label&&this.$refs["input_required_"+e.id]&&this.$refs["input_required_"+e.id].toggleMenu()})))},importExcel(e){if(!this.$utils.checkUploadFile(e,["xlsx","xls"]))return;const t=new FormData;t.append("file",e.raw),this.$axios.post("/assets/readexcel",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(0==e.data.code){if(!e.data.data.csv||e.data.data.csv.length<=0)return void this.$message.error("导入文件失败，请检查文件是否正确");const t=e.data.data.csv[0].lines,s=this.getHeaderIndex(t[0]);if("string"==typeof s)return void this.$message.error(`导入文件失败，缺少列：[${s}]`);const[i,a,o,n,r,l]=s,c=[],d=[];t.forEach(((e,t)=>{if(t>0){let s=this.cleanText(e[i]),u=this.cleanText(e[a]),p=this.cleanText(e[o]),h=this.cleanText(e[n]),m=this.cleanText(e[r]),f=this.cleanText(e[l]),g=[];s?/^[A-Za-z]\w*$/.test(s)?s.length>this.maxLength?g.push(`英文名称不能超过${this.maxLength}个字符`):-1!=Re.indexOf(s)&&g.push("英文名称不能使用JAVA关键字"):g.push("英文名称格式不正确，支持字母、数字、下划线，并且以字母开头"):g.push("英文名称不能为空"),u?u.length>this.maxLength?g.push(`中文名称不能超过${this.maxLength}个字符`):-1!=u.indexOf(".")&&g.push("中文名称不能包含字符[.]"):g.push("中文名称不能为空"),p?"衍生字段"===p?p="Derive":-1==this.$utils.fieldTypeArr.indexOf(p)&&g.push("不支持的数据类型"):g.push("数据类型不能为空"),h&&-1==this.$utils.fieldTypeArr.indexOf(h)&&g.push("不支持的子类型"),m?(m=this.selectDirection(m),m||g.push("不支持的传递方向")):m="IN_OUT",f?"是"!=f&&"否"!=f?g.push("是否必输只能选择是否"):f="是"==f?"true":"false":f="false",0==g.length?c.push({id:this.genFieldId(),name:s,label:u,type:p,subType:h,direction:m,deriveData:{},required:f}):d.push({rowNumber:t+1,msgs:g.join("；")})}})),0==d.length?(this.$message.success("导入成功"),this.totalFields=c,this.page=1,this.refreshPage()):(this.showImportErrorDialog=!0,this.importErrors=d)}else this.$message.error(e.data.msg?e.data.msg:"导入失败")})).catch((e=>{this.$message.error("导入失败"),console.error(e)}))},getHeaderIndex(e){let t=["英文名称","中文名称","数据类型","子类型","传递方向","是否必输"];e.forEach(((e,s)=>{const i=this.cleanText(e),a=t.indexOf(i);-1!=a&&(t[a]=s)}));let s=t.filter((e=>"string"==typeof e));return s.length>0?s.join(","):t},cleanText:e=>e?e.trim():"",selectDirection:e=>"仅传入"==e?"IN":"仅传出"==e?"OUT":"不传入不传出"==e?"NONE":"传入传出"==e?"IN_OUT":void 0,exportExcel(){if(this.exportLoading)return;let e=!1,t=["List","Map","Derive"];this.totalFields.some((s=>{if(-1!=t.indexOf(s.type))return e=!0,!0})),e?this.$confirm("子类型是复杂类型或衍生变量将不会导出","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then((()=>{this.doExport()})):this.doExport()},doExport(){const e=this.formatJson(["name","label","type","subType","direction","required"],this.totalFields);e.unshift(["英文名称","中文名称","数据类型","子类型","传递方向","是否必输"]);const t=this;t.exportLoading=!0,this.$axios({method:"post",url:"/assets/writeexcel",data:e,responseType:"blob"}).then((e=>{if(t.exportLoading=!1,"application/json"==e.data.type){const s=new FileReader;s.onload=function(){const e=JSON.parse(s.result);if(401==e.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(e.msg?e.msg:"导出失败")},s.readAsText(e.data)}else{let t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.style.display="none",s.href=t,s.target="_blank",s.setAttribute("download",this.assets.name+".xlsx"),document.body.appendChild(s),s.click()}})).catch((()=>{t.exportLoading=!1,t.$message.error("导出失败")}))},formatJson(e,t){return t.map((t=>e.map((e=>"direction"==e?"IN"==t[e]?"仅传入":"OUT"==t[e]?"仅传出":"NONE"==t[e]?"不传入不传出":"传入传出":"subType"==e?-1!=this.$utils.fieldBaseTypeArr.indexOf(t[e])?t[e]:"":"required"==e?"true"==t[e]?"是":"否":"type"==e&&"Derive"==t[e]?"衍生字段":t[e]))))},moveUp(e){const t=this.$utils.arrayFindIndex(this.totalFields,(t=>t.id==e.row.id));t>0&&this.swapField(t,t-1)},moveDown(e){const t=this.$utils.arrayFindIndex(this.totalFields,(t=>t.id==e.row.id));t<this.totalFields.length-1&&this.swapField(t,t+1)},swapField(e,t){const s=this.totalFields[e];this.totalFields[e]=this.totalFields[t],this.totalFields[t]=s,this.refreshPage()},getSubTypeName(e){let t;return this.subTypes.some((s=>{if(s.options.some((s=>{if(e==s.value)return t=s.label,!0})),t)return!0})),t},changeType(e){e.subType="",this.$utils.isDerive(e.type)?e.deriveData={}:e.deriveData=""},saveCallback(e){this.$refs.table.setCurrentRow(),this.validate()&&(this.historyEnName&&this.historyEnName!=this.enName?this.$confirm("模型英文名称被修改，将会导致决策服务生效后报文字段变更，是否继续？","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then((()=>{this.doSaveCallback(e),this.historyEnName=this.enName})):this.doSaveCallback(e))},doSaveCallback(e){const t=this.$utils.copy(this.totalFields);t.forEach((e=>{this.$utils.isDerive(e.type)?e.deriveData=JSON.stringify(e.deriveData):e.deriveData=""}));let s=JSON.stringify({fields:t,enName:this.enName,direction:this.direction,approvalField:this.approvalField});s=s.replace(/\\r/g,"").replace(/\\n/g,""),e(s,(()=>{this.$store.dispatch("loadBoms",{projectUuid:this.assets.projectUuid,ignoreFunc:!0,ignoreModel:!0,ignoreThirdApi:!0})}))},genFieldId(){return this.$utils.randomCode(16)},refreshPage(){const e=parseInt((this.totalFields.length+this.pageSize-1)/this.pageSize);e<this.page&&(this.page=e),this.filterPage()},jumpLastPage(){const e=parseInt((this.totalFields.length+this.pageSize-1)/this.pageSize);this.jumpPage(e)},jumpPage(e){this.page=e,this.filterPage()},filterPage(){this.fields=this.totalFields.slice((this.page-1)*this.pageSize,this.page*this.pageSize)}}};var Be=(0,A.Z)(je,_e,[],!1,null,"3e5e90b2",null);Be.options.__file="src/view/decision/project/fact/index.vue";const Ue=Be.exports;var Ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets,"new-version":!1},on:{callback:e.saveCallback}}),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.addField}},[e._v("\n          添加字段\n        ")]):e._e(),e._v(" "),s("dropdown",{attrs:{"split-button":""},on:{click:e.exportExcel}},[s("i",{staticClass:"el-icon-download"}),e._v("\n            "+e._s(e.exportLoading?"导出中...":"导出文件")+"\n          "),e.$hasPerm("project.asset:edit")?s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",[s("el-upload",{attrs:{action:"","on-change":e.importExcel,"auto-upload":!1,"show-file-list":!1,accept:".xlsx"}},[s("i",{staticClass:"iconfont iconVersionupdaterule-copy"}),e._v(" 导入文件\n              ")])],1)],1):e._e()],1),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:function(t){e.$emit("refresh",t)}}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",[s("el-col",[s("el-table",{ref:"table",staticClass:"tb-edit",attrs:{data:e.fields,border:"","highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"中文名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?e._e():s("el-input",{ref:"input_label_"+t.row.id,attrs:{placeholder:"请输入标题",maxlength:e.maxLength},model:{value:t.row.label,callback:function(s){e.$set(t.row,"label","string"==typeof s?s.trim():s)},expression:"scope.row.label"}}),e._v(" "),s("span",[e._v(e._s(t.row.label))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"数据类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?e._e():s("el-select",{ref:"input_type_"+t.row.id,attrs:{placeholder:"请选择数据类型"},on:{change:function(s){return e.changeType(t.row)}},model:{value:t.row.type,callback:function(s){e.$set(t.row,"type",s)},expression:"scope.row.type"}},[s("el-option",{attrs:{value:"String"}}),e._v(" "),s("el-option",{attrs:{value:"Integer"}}),e._v(" "),s("el-option",{attrs:{value:"Double"}}),e._v(" "),s("el-option",{attrs:{value:"Long"}}),e._v(" "),s("el-option",{attrs:{value:"BigDecimal"}}),e._v(" "),s("el-option",{attrs:{value:"Boolean"}}),e._v(" "),s("el-option",{attrs:{value:"Date"}}),e._v(" "),s("el-option",{attrs:{value:"DateTime"}})],1),e._v(" "),s("span",[e._v(e._s(t.row.type))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?["Boolean"==t.row.type?s("span",[e._v("\n                "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n              ")]):s("span",[e._v(e._s(t.row.value))])]:[e.$utils.isNumber(t.row.type)?s("el-input-number",{ref:"input_value_"+t.row.id,attrs:{controls:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value","string"==typeof s?s.trim():s)},expression:"scope.row.value"}}):e.$utils.isBoolean(t.row.type)?s("el-select",{ref:"input_value_"+t.row.id,attrs:{placeholder:"请选择"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)?s("date-picker",{ref:"input_value_"+t.row.id,attrs:{"value-format":"yyyy-MM-dd"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isDateTime(t.row.type)?s("date-picker",{ref:"input_value_"+t.row.id,attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):s("el-input",{ref:"input_value_"+t.row.id,model:{value:t.row.value,callback:function(s){e.$set(t.row,"value","string"==typeof s?s.trim():s)},expression:"scope.row.value"}}),e._v(" "),"Boolean"==t.row.type?s("span",[e._v("\n                "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n              ")]):s("span",[e._v(e._s(t.row.value))])]]}}])}),e._v(" "),e.readonly?e._e():s("el-table-column",{attrs:{label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("i",{staticClass:"el-icon-delete icon-btn",on:{click:function(s){return s.stopPropagation(),e.delField(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-top icon-btn",on:{click:function(s){return s.stopPropagation(),e.moveUp(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-bottom icon-btn",on:{click:function(s){return s.stopPropagation(),e.moveDown(t)}}})]}}],null,!1,1387499192)})],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"错误信息",top:e.$dialogTop,visible:e.showImportErrorDialog},on:{"update:visible":function(t){e.showImportErrorDialog=t}}},[s("el-alert",{attrs:{type:"error","show-icon":"",title:"导入文件失败，错误信息如下："}}),e._v(" "),s("el-table",{attrs:{data:e.importErrors}},[s("el-table-column",{attrs:{label:"文件中的行号",prop:"rowNumber"}}),e._v(" "),s("el-table-column",{attrs:{label:"错误描述",prop:"msgs","show-overflow-tooltip":""}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showImportErrorDialog=!1}}},[e._v("取 消")])],1)],1)],1)};Ve._withStripped=!0;const He={name:"index",props:{assets:Object,readonly:{type:Boolean,default:!1}},components:{deleteBtn:Te,referBtn:Ne,assetsToolbar:Me},data:()=>({fields:[],showImportErrorDialog:!1,importErrors:[],maxLength:50,exportLoading:!1,fullscreen:!1}),mounted(){this.initData()},methods:{initData(){if(this.assets.content){let e=JSON.parse(this.assets.content);this.fields=e.fields,this.fields.forEach((e=>{e.id||(e.id=this.genFieldId())}))}else this.fields=[]},addField(){let e={id:this.genFieldId(),label:"",value:"",type:"String"};this.fields.push(e),this.$nextTick((()=>{this.$refs.table.setCurrentRow(e),this.$nextTick((()=>{this.$refs["input_label_"+e.id].focus()}))}))},delField(e){this.fields.splice(e.$index,1)},validate(){if(this.fields.length<1)return this.$message.warning("请添加字段"),!1;let e=!0;if(this.fields.some((t=>t.label?-1!=t.label.indexOf(".")?(this.$message.warning("中文名称不能包含字符[.]"),this.$refs.table.setCurrentRow(t),this.$nextTick((()=>{this.$refs["input_label_"+t.id].focus()})),e=!1,!0):null==t.value||""===t.value?(this.$message.warning("请输入值"),this.$refs.table.setCurrentRow(t),this.$nextTick((()=>{this.$utils.isBoolean(t.type)?this.$refs["input_value_"+t.id].toggleMenu():this.$refs["input_value_"+t.id].focus()})),e=!1,!0):void 0:(this.$message.warning("请输入中文名称"),this.$refs.table.setCurrentRow(t),this.$nextTick((()=>{this.$refs["input_label_"+t.id].focus()})),e=!1,!0))),!e)return!1;let t=[];this.fields.forEach((e=>{t.push(e.label)})),t.sort();for(let e=0;e<t.length-1;e++)if(t[e]==t[e+1])return this.$message.warning("请去除重复字段"),!1;return!0},importExcel(e){if(!this.$utils.checkUploadFile(e,["xlsx","xls"]))return;const t=new FormData;t.append("file",e.raw),this.$axios.post("/assets/readexcel",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(0==e.data.code){if(!e.data.data.csv||e.data.data.csv.length<=0)return void this.$message.error("导入文件失败，请检查文件是否正确");const t=e.data.data.csv[0].lines,s=this.getHeaderIndex(t[0]);if("string"==typeof s)return void this.$message.error(`导入文件失败，缺少列：[${s}]`);const[i,a,o]=s,n=[],r=[];t.forEach(((e,t)=>{if(t>0){let s=this.cleanText(e[i]),l=this.cleanText(e[a]),c=this.cleanText(e[o]),d=[];if(s?s.length>this.maxLength?d.push(`中文名称不能超过${this.maxLength}个字符`):-1!=s.indexOf(".")&&d.push("中文名称不能包含字符[.]"):d.push("中文名称不能为空"),l){if(this.$utils.isNumber(c)&&isNaN(Number(l)))d.push("值必须是数字");else if(this.$utils.isBoolean(c))"是"!=l&&"否"!=l?d.push("值只能选择是否"):l="是"==l?"true":"false";else if(this.$utils.isDate(c))try{const e=new Date(l);"Invalid Date"===e.toString()?d.push("值的日期格式不正确"):l=this.$moment(e).format("YYYY-MM-DD",!1)}catch(e){d.push("值的日期格式不正确")}else if(this.$utils.isDateTime(c))try{const e=new Date(l);"Invalid Date"===e.toString()?d.push("值的日期格式不正确"):l=this.$moment(e).format("YYYY-MM-DD HH:mm:ss",!1)}catch(e){d.push("值的日期格式不正确")}}else d.push("值不能为空");c?-1==this.$utils.fieldTypeArr.indexOf(c)&&d.push("不支持的数据类型"):d.push("数据类型不能为空"),0==d.length?n.push({id:this.genFieldId(),label:s,value:l,type:c}):r.push({rowNumber:t+1,msgs:d.join("；")})}})),0==r.length?(this.$message.success("导入成功"),this.fields=n):(this.showImportErrorDialog=!0,this.importErrors=r)}else this.$message.error(e.data.msg?e.data.msg:"导入失败")})).catch((e=>{this.$message.error("导入失败"),console.error(e)}))},getHeaderIndex(e){let t=["中文名称","值","数据类型"];e.forEach(((e,s)=>{const i=this.cleanText(e),a=t.indexOf(i);-1!=a&&(t[a]=s)}));let s=t.filter((e=>"string"==typeof e));return s.length>0?s.join(","):t},cleanText:e=>e?e.trim():"",exportExcel(){if(this.exportLoading)return;const e=this.formatJson(["label","value","type"],this.fields);e.unshift(["中文名称","值","数据类型"]);const t=this;t.exportLoading=!0,this.$axios({method:"post",url:"/assets/writeexcel",data:e,responseType:"blob"}).then((e=>{if(t.exportLoading=!1,"application/json"==e.data.type){const s=new FileReader;s.onload=function(){const e=JSON.parse(s.result);if(401==e.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(e.msg?e.msg:"导出失败")},s.readAsText(e.data)}else{let t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.style.display="none",s.href=t,s.target="_blank",s.setAttribute("download",this.assets.name+".xlsx"),document.body.appendChild(s),s.click()}})).catch((()=>{t.exportLoading=!1,t.$message.error("导出失败")}))},formatJson(e,t){return t.map((t=>e.map((e=>"value"==e&&this.$utils.isBoolean(t.type)?"true"===t[e]?"是":"否":t[e]))))},cellClick(e,t,s,i){this.readonly||this.$nextTick((()=>{"中文名称"==t.label?this.$refs["input_label_"+e.id].focus():"数据类型"==t.label?this.$refs["input_type_"+e.id].toggleMenu():"值"==t.label&&this.$refs["input_value_"+e.id]&&(this.$utils.isBoolean(e.type)?this.$refs["input_value_"+e.id].toggleMenu():this.$refs["input_value_"+e.id].focus())}))},moveUp(e){e.$index>0&&this.swapField(e.$index,e.$index-1)},moveDown(e){e.$index<this.fields.length-1&&this.swapField(e.$index,e.$index+1)},swapField(e,t){let s=[];this.fields.forEach((e=>{s.push(e)}));const i=s[e];s[e]=s[t],s[t]=i,this.fields=s},saveCallback(e){this.$refs.table.setCurrentRow(),this.validate()&&e(JSON.stringify({fields:this.fields}),(()=>{this.$store.dispatch("loadBoms",{projectUuid:this.assets.projectUuid,ignoreFunc:!0,ignoreModel:!0,ignoreThirdApi:!0})}))},genFieldId(){return this.$utils.randomCode(16)},changeType(e){e.value=""}}};var qe=(0,A.Z)(He,Ve,[],!1,null,"31360edf",null);qe.options.__file="src/view/decision/project/constant/index.vue";const ze=qe.exports;var We=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[e.readonly?e._e():s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets},on:{callback:e.saveCallback,refresh:e.refresh,template:e.guidedTemplate}}),e._v(" "),e.assets.isTemplate?e._e():s("test-btn",{attrs:{assets:e.assets}}),e._v(" "),e.$hasPerm("project.asset:edit")?s("dropdown",{attrs:{"split-button":""},on:{click:e.addRule}},[s("i",{staticClass:"el-icon-plus"}),e._v(" 添加规则\n          "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-refresh"},nativeOn:{click:function(t){return e.addRule(!0)}}},[e._v("添加循环规则")])],1)],1):e._e(),e._v(" "),s("import-btn",{attrs:{assets:e.assets},on:{importTpl:e.importTpl}}),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-validation",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",[s("el-col",{staticClass:"rule-container"},[e.fireRules.length>0?s("el-switch",{staticStyle:{"margin-bottom":"10px"},attrs:{"active-text":"仅显示触发规则"},on:{change:e.filterRules},model:{value:e.showFireRules,callback:function(t){e.showFireRules=t},expression:"showFireRules"}}):e._e(),e._v(" "),e._l(e.rules,(function(t,i){return s("el-card",{key:t._id?t._id:t._id=e.$utils.randomCode(6),class:t.cssStyle,staticStyle:{"overflow-x":"auto"},attrs:{shadow:"hover"}},[s("div",{staticClass:"headerContent",attrs:{slot:"header"},slot:"header"},[s("div",{staticClass:"editValue"},[e.readonly?s("span",[e._v(e._s(t.name))]):s("el-popover",{on:{"after-enter":function(t){return e.openNameInput(i)}}},[s("el-input",{ref:"name_"+i,refInFor:!0,on:{change:function(t){return e.editName(i,t)}},model:{value:t.name,callback:function(s){e.$set(t,"name","string"==typeof s?s.trim():s)},expression:"rule.name"}}),e._v(" "),s("el-link",{staticClass:"rule-name",attrs:{slot:"reference",underline:!1},slot:"reference"},[e._v(e._s(t.name))])],1),e._v(" "),s("div",{staticClass:"tagList"},e._l(t.attrs,(function(i,a){return s("el-tag",{key:i.name,staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"warning",closable:!e.readonly},on:{close:function(e){return t.attrs.splice(a,1)}}},[e._v("\n                "+e._s(e.$attr.getLabel(i.name))+"： "+e._s(i.value)+"\n              ")])})),1)],1),e._v(" "),e.$hasPerm("project.asset:edit")&&!e.readonly?s("div",[s("el-tooltip",{attrs:{content:"属性",placement:"top"}},[s("i",{staticClass:"el-icon-set-up icon-btn rule-btn",on:{click:function(t){return e.setAttr(i)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"删除",placement:"top"}},[s("div",{staticStyle:{float:"right"}},[s("el-popconfirm",{attrs:{title:"确定删除当前规则？"},on:{confirm:function(t){return e.rules.splice(i,1)}}},[s("i",{staticClass:"el-icon-delete icon-btn rule-btn",attrs:{slot:"reference"},slot:"reference"})])],1)]),e._v(" "),s("el-tooltip",{attrs:{content:"上移",placement:"top"}},[s("i",{staticClass:"el-icon-top icon-btn rule-btn",on:{click:function(t){return e.moveUp(i)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"下移",placement:"top"}},[s("i",{staticClass:"el-icon-bottom icon-btn rule-btn",on:{click:function(t){return e.moveDown(i)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"复制",placement:"top"}},[s("i",{staticClass:"el-icon-document-copy icon-btn rule-btn",on:{click:function(t){return e.copyRule(i)}}})])],1):e._e()]),e._v(" "),s("div",{staticClass:"rule-body"},[t.loop?s("p",[e._v("\n            循环对象:\n            "),s("fact",{attrs:{"input-type":"Collection",readonly:e.readonly},model:{value:t.loopTarget,callback:function(s){e.$set(t,"loopTarget",s)},expression:"rule.loopTarget"}})],1):e._e(),e._v(" "),s("p",[e._v("如果")]),e._v(" "),s("lhs",{attrs:{"loop-target":t.loopTarget,readonly:e.readonly},model:{value:t.lhs,callback:function(s){e.$set(t,"lhs",s)},expression:"rule.lhs"}}),e._v(" "),s("p",[e._v("那么")]),e._v(" "),s("rhs",{attrs:{"loop-target":t.loopTarget,readonly:e.readonly},model:{value:t.rhs,callback:function(s){e.$set(t,"rhs",s)},expression:"rule.rhs"}}),e._v(" "),!e.readonly||t.other&&t.other.actions.length>0?[s("p",{staticStyle:{"margin-top":"5px"}},[e._v("否则")]),e._v(" "),s("rhs",{attrs:{"loop-target":t.loopTarget,readonly:e.readonly},model:{value:t.other,callback:function(s){e.$set(t,"other",s)},expression:"rule.other"}})]:e._e()],2)])}))],2)],1),e._v(" "),e.rules.length>0?s("attr",{attrs:{show:e.showAttrDialog},on:{"update:show":function(t){e.showAttrDialog=t}},model:{value:e.rules[e.editRuleIndex].attrs,callback:function(t){e.$set(e.rules[e.editRuleIndex],"attrs",t)},expression:"rules[editRuleIndex].attrs"}}):e._e()],1)};We._withStripped=!0;var Ge=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"container",staticClass:"lhs-container",style:{height:e.height+"px"}},[e._l(e.constraints,(function(t,i){return[t.conjunction?s("div",{key:t._id,ref:t._id,refInFor:!0,staticClass:"lhs-node lhs-conjunction",style:{left:80*t._location[0]+"px",top:30*t._location[1]+"px"}},[e.readonly?s("span",[e._v(e._s(e.$conjunction[t.conjunction]))]):s("dropdown",{on:{command:function(s){return e.selectCondition(s,t)}}},[s("span",[e._v(e._s(e.$conjunction[t.conjunction])),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{command:"AND"}},[e._v("并且")]),e._v(" "),s("dropdown-item",{attrs:{command:"OR"}},[e._v("或者")]),e._v(" "),s("dropdown-item",{attrs:{command:"add-condition"}},[e._v("添加条件")]),e._v(" "),e.leftType?e._e():s("dropdown-item",{attrs:{command:"add-join-condition"}},[e._v("添加联合条件")]),e._v(" "),e.leftType?e._e():s("dropdown-item",{attrs:{command:"del",divided:""}},[e._v("删除")])],1)],1)],1):s("div",{key:t._id,ref:t._id,refInFor:!0,staticClass:"lhs-node lhs-constraint",style:{left:80*t._location[0]+"px",top:30*t._location[1]+"px"}},[s("constraint",{attrs:{"left-type":e.leftType,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:e.draw},model:{value:e.constraints[i],callback:function(t){e.$set(e.constraints,i,t)},expression:"constraints[index]"}}),e._v(" "),e.readonly?e._e():[s("el-tooltip",{attrs:{content:"删除条件"}},[s("i",{staticClass:"el-icon-delete icon-btn-mini",on:{click:function(s){return e.selectCondition("del",t)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"复制条件"}},[s("i",{staticClass:"el-icon-document-copy icon-btn-mini",on:{click:function(s){return e.copyConstraint(t)}}})])]],2)]})),e._v(" "),e.lines.length>0?s("svg",{attrs:{width:e.width,height:"100%",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}},e._l(e.lines,(function(e){return s("path",{attrs:{d:e,fill:"none",stroke:"#777777","stroke-width":"1"}})})),0):e._e()],2)};Ge._withStripped=!0;var Je=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.leftType?e._e():s("expression",{attrs:{"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.left,callback:function(t){e.$set(e.value,"left",t)},expression:"value.left"}}),e._v(" "),e.opInputType?s("op",{attrs:{"input-type":e.opInputType,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.op,callback:function(t){e.$set(e.value,"op",t)},expression:"value.op"}}):e._e(),e._v(" "),e.rightInputType?s("expression",{attrs:{"input-type":e.rightInputType,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.right,callback:function(t){e.$set(e.value,"right",t)},expression:"value.right"}}):e._e()],1)};Je._withStripped=!0;const Ze={name:"constraint",props:{value:{type:Object,default:function(){return{}}},leftType:[String,Object],loopTarget:Object,readonly:{type:Boolean,default:!1}},computed:{opInputType:function(){return this.leftType||this.$store.getters.getExpressionType(this.value.left,this.loopTarget)},rightInputType:function(){const e=this.value.op;if("STR_LENGTH"===e||"STR_NOT_LENGTH"===e)return"Integer";const t=this.leftType||this.$store.getters.getExpressionType(this.value.left,this.loopTarget);if(this.$utils.isCollection(t)){const e=this.$utils.getCollectionSubType(t);if(this.$utils.isNotBlank(e))return e}return t}}};var Ye=(0,A.Z)(Ze,Je,[],!1,null,"b0478624",null);Ye.options.__file="src/view/decision/project/components/constraint.vue";const Ke={name:"lhs",components:{constraint:Ye.exports},props:{value:{type:Object,default:function(){const e={constraint:{conjunction:"AND",constraints:[],_location:[0,0]}};return this.$emit("input",e),e}},leftType:[String,Object],loopTarget:Object,readonly:{type:Boolean,default:!1}},data(){return this.value.constraint||(this.$set(this.value,"constraint",{conjunction:"AND",constraints:[],_location:[0,0]}),this.$emit("input",this.value)),{width:0,height:30,constraints:[this.value.constraint],lines:[]}},created(){this.traverse()},mounted(){this.draw()},methods:{selectCondition(e,t){"AND"==e||"OR"==e?t.conjunction=e:"add-condition"==e?(t.constraints.push({}),this.traverse(),this.draw()):"add-join-condition"==e?(t.constraints.push({conjunction:"AND",constraints:[]}),this.traverse(),this.draw()):"del"==e&&(this.delNode(t._id),this.traverse(),this.draw())},traverse(){const e=this.value.constraint;this.getNodeDeep(e);let t=[],s=0,i=0,a=[e],o=[];for(;a.length>0;)i=0,a.forEach((e=>{e._id||(e._id=this.$utils.randomCode(6));const a=e._parentY?e._parentY:0;i<a&&(i=a),e._location=[s,i],i+=e._deep,t.push(e),e.constraints&&e.constraints.length>0&&e.constraints.forEach((t=>{t._parentY=e._location[1],t._parentId=e._id,o.push(t)}))})),s++,a=o,o=[];this.height=30*e._deep,this.constraints=t},draw(){setTimeout((()=>{let e=[this.value.constraint],t=[],s=[];for(;e.length>0;)e.forEach((e=>{e.constraints&&e.constraints.length>0&&e.constraints.forEach((i=>{const a=this.$refs[e._id][0],o=this.$refs[i._id][0];if(a&&o){const e=parseInt(a.style.left)+a.offsetWidth-5,n=parseInt(a.style.top)+a.offsetHeight/2,r=parseInt(o.style.left),l=parseInt(o.style.top)+o.offsetHeight/2,c="M"+e+" "+n+"C"+e+" "+l+" "+e+" "+l+" "+r+" "+l;s.push(c),t.push(i)}}))})),e=t,t=[];this.lines=s,this.setSvgWidth()}),0)},traverseNode(e,t,s){e.location=[t,s],e.constraints.length>0&&(t++,s=e.location[1],e.constraints.forEach((e=>{this.traverseNode(e,t,s++)})))},getNodeDeep(e){if(!e.constraints||0==e.constraints.length)return e._deep=1,1;let t=0;return e.constraints.forEach((e=>{t+=this.getNodeDeep(e)})),e._deep=t,t},delNode(e){if(this.value.constraint._id==e)this.value.constraint.constraints=[];else{let t=[this.value.constraint];for(;t.length>0;){const s=t.pop();s.constraints&&s.constraints.length>0&&s.constraints.forEach(((i,a)=>{if(i._id==e)return s.constraints.splice(a,1),!1;t.push(i)}))}}},setSvgWidth(){let e=0;this.constraints.forEach((t=>{const s=this.$refs[t._id][0],i=parseInt(s.style.left)+s.offsetWidth;i>e&&(e=i)})),this.width=e},copyConstraint(e){let t,s;if(this.constraints.some((i=>{if(i._id==e._parentId)return t=i,t.constraints.some(((t,i)=>{if(t._id==e._id)return s=i,!0})),!0})),!t)return;let i=this.$utils.copy(e);this.$utils.clearTmpKey(i),t.constraints.splice(s+1,0,i),this.traverse(),this.draw()}}};var Xe=(0,A.Z)(Ke,Ge,[],!1,null,"1e3de694",null);Xe.options.__file="src/view/decision/project/components/lhs.vue";const Qe=Xe.exports;var et=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{"overflow-x":"auto"},on:{drop:e.drop,dragover:function(e){e.preventDefault()}}},[e._l(e.value.actions,(function(t,i){return s("div",{key:e.getKey(i),ref:t._id,refInFor:!0,staticStyle:{"white-space":"nowrap"},attrs:{draggable:!e.readonly},on:{dragstart:function(s){return e.dragstart(t,s)},dragend:e.dragend}},[s("action",{attrs:{"loop-target":e.loopTarget,readonly:e.readonly,immediate:e.newId==e.value.actions[i]._id},model:{value:e.value.actions[i],callback:function(t){e.$set(e.value.actions,i,t)},expression:"value.actions[i]"}}),e._v(" "),e.readonly?e._e():[s("el-tooltip",{attrs:{content:"删除动作"}},[s("i",{staticClass:"el-icon-delete icon-btn-mini",on:{click:function(t){return e.delAction(i)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"复制动作"}},[s("i",{staticClass:"el-icon-document-copy icon-btn-mini",on:{click:function(t){return e.copyAction(i)}}})]),e._v(" "),s("el-tooltip",{attrs:{content:"添加动作"}},[s("dropdown",{on:{command:function(t){return e.addAction(t,i)}}},[s("i",{staticClass:"el-icon-plus",staticStyle:{cursor:"pointer"}}),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{command:"ASSIGN"}},[e._v("赋值")]),e._v(" "),s("dropdown-item",{attrs:{command:"FUNC"}},[e._v("执行函数")]),e._v(" "),s("dropdown-item",{attrs:{command:"THIRDAPI"}},[e._v("调用接口")]),e._v(" "),s("dropdown-item",{attrs:{command:"MODEL"}},[e._v("调用模型")])],1)],1)],1)]],2)})),e._v(" "),e.readonly?e._e():s("el-tooltip",{attrs:{content:"添加动作"}},[s("dropdown",{on:{command:e.addAction}},[s("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{cursor:"pointer"}}),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{command:"ASSIGN"}},[e._v("赋值")]),e._v(" "),s("dropdown-item",{attrs:{command:"FUNC"}},[e._v("执行函数")]),e._v(" "),s("dropdown-item",{attrs:{command:"THIRDAPI"}},[e._v("调用接口")]),e._v(" "),s("dropdown-item",{attrs:{command:"MODEL"}},[e._v("调用模型")])],1)],1)],1)],2)};et._withStripped=!0;const tt={name:"rhs",props:{value:{type:Object,default:function(){const e={actions:[]};return this.$emit("input",e),e}},readonly:{type:Boolean,default:!1},loopTarget:Object},data:()=>({newId:""}),methods:{addAction(e,t){const s=this.genId();void 0!==t?this.value.actions.splice(t+1,0,{_id:s,type:e}):this.value.actions.push({_id:s,type:e}),this.newId=s},delAction(e){this.value.actions.splice(e,1)},copyAction(e){const t=this.$utils.copy(this.value.actions[e]);t._id=this.genId(),this.value.actions.splice(e,0,t)},getKey(e){let t=this.value.actions[e];return t._id||(t._id=this.genId()),t._id},genId(){return this.$utils.randomCode(16)},dragstart(e,t){t.dataTransfer.setData("id",e._id),t.dataTransfer.setData("action",JSON.stringify(e))},dragend(e){e.dataTransfer.clearData()},drop(e){const t=e.dataTransfer.getData("id");if(!t)return;if(0==this.value.actions.length){const t=JSON.parse(e.dataTransfer.getData("action"));return t._id=this.genId(),void this.value.actions.push(t)}const s=this.$utils.arrayFindIndex(this.value.actions,(e=>e._id==t));-1==s?this.value.actions.some(((t,s)=>{if(this.$refs[t._id][0].contains(e.target)){const t=JSON.parse(e.dataTransfer.getData("action"));return t._id=this.genId(),this.value.actions.splice(s+1,0,t),!0}})):this.value.actions.some(((i,a)=>{if(t!=i._id&&this.$refs[i._id][0].contains(e.target)){const t=JSON.parse(e.dataTransfer.getData("action"));return this.value.actions.splice(s,1),this.value.actions.splice(a,0,t),!0}}))}}};var st=(0,A.Z)(tt,et,[],!1,null,"2e46703c",null);st.options.__file="src/view/decision/project/components/rhs.vue";const it=st.exports;var at=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"referContent"},[e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{icon:"iconfont iconVersionupdaterule-copy",loading:e.loading},on:{click:e.initData}},[e._v("\n    "+e._s(e.loading?"加载中...":"导入模板")+"\n  ")]):e._e(),e._v(" "),e.show?s("el-dialog",{staticClass:"referContent",attrs:{title:"模板列表",top:e.$dialogTop,visible:e.show,"append-to-body":""},on:{"update:visible":function(t){e.show=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"referTable tb-edit",attrs:{"element-loading-text":"数据加载中...",data:e.searchList,"highlight-current-row":""}},[s("el-table-column",{attrs:{prop:"label",label:"文件名称","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"文件类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.$utils.getAssetsTypeText(t.row.type)))])]}}],null,!1,139773554)}),e._v(" "),s("el-table-column",{attrs:{label:"添加时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}],null,!1,1087190999)}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.viewAssets(t.row)}}},[e._v("查看")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.importTpl(t.row)}}},[e._v("导入")])]}}],null,!1,197819324)})],1)],1):e._e(),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show,template:""},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};at._withStripped=!0;const ot={name:"refer-btn",props:{assets:Object},data:()=>({loading:!1,show:!1,tableLoading:!1,searchList:[],tablePage:1,total:0,viewingAssets:{uuid:"",version:0,show:!1}}),mounted(){},methods:{initData(){this.loading=!0;const e=`tpl_${this.assets.type}`;this.$axios.get("/assets/tree",{params:{projectUuid:this.$route.params.uuid,type:e}}).then((e=>{0==e.data.code?(e.data.data.forEach((e=>{e.type=e.type.replace("tpl_","")})),this.searchList=e.data.data,this.show=!0):this.$message.error("查询失败")})).catch((()=>{this.$message.error("查询失败")})).then((()=>{this.loading=!1}))},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.uuid][0];"版本号"==t.label&&a&&this.$nextTick((function(){a.toggleMenu()}))},handleClose(){this.searchList=[]},toPage(e){this.tablePage=e,this.initData()},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.select,this.viewingAssets.show=!0},importTpl(e){this.$axios.get("/template/"+e.uuid).then((e=>{0==e.data.code?(this.$emit("importTpl",e.data.data.content),this.show=!1,this.$message.success("导入成功")):this.$message.error(e.data.msg?e.data.msg:"导入失败")})).catch((()=>{this.$message.error("导入失败")}))}}};var nt=(0,A.Z)(ot,at,[],!1,null,"f1ffca48",null);nt.options.__file="src/view/decision/project/assets/assets-import-template.vue";const rt=nt.exports;var lt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$hasPerm("project.pkg:run")?s("div",[s("el-button",{attrs:{icon:"el-icon-lightning",loading:e.loading},on:{click:e.test}},[e._v("\n    测试\n  ")]),e._v(" "),s("test-dialog",{attrs:{active:e.showTestDialog},on:{"update:active":function(t){e.showTestDialog=t}}})],1):e._e()};lt._withStripped=!0;var ct=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"仿真测试",top:e.$dialogTop,visible:e.show,width:"70%","append-to-body":""},on:{"update:visible":function(t){e.show=t},open:e.open,closed:e.closed}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.testDataLoading,expression:"testDataLoading"}],staticClass:"toolbar"},[s("dropdown",{attrs:{"split-button":"",type:"primary",loading:e.testLoading},on:{command:e.moreTest,click:function(){return!e.testLoading&&e.submitTest()}}},[s("i",{class:e.testLoading?"el-icon-loading":"el-icon-lightning"}),e._v("\n      "+e._s(e.testLoading?"提交中...":"测 试")+"\n      "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-lightning",command:"agenda"}},[e._v("\n          测试生效组\n        ")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-lightning",disabled:null==e.lastSubmitFacts,command:"repeat"}},[e._v("\n          重复上次测试\n        ")])],1)],1),e._v(" "),s("dropdown",{directives:[{name:"loading",rawName:"v-loading",value:e.batchLoading,expression:"batchLoading"}],attrs:{"split-button":""},on:{click:e.downloadExcel}},[s("i",{staticClass:"el-icon-download"}),e._v("\n      下载批量测试模版\n      "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",[s("el-upload",{attrs:{action:"","on-change":e.uploadExcel,"auto-upload":!1,"show-file-list":!1,accept:".xlsx"}},[s("i",{staticClass:"iconfont iconVersionupdaterule-copy"}),e._v(" 上传批量测试数据\n          ")])],1)],1)],1)],1),e._v(" "),s("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.showTestResult&&e.testData.result,expression:"showTestResult && testData.result"}],staticClass:"toolbar",attrs:{title:"测试成功",closable:!1,type:"success","show-icon":""}},[s("p",[e._v("触发了"),s("b",[e._v(e._s(e.testResult.fireNum))]),e._v("条规则，耗时"),s("b",[e._v(e._s(e.testResult.fireTime))]),e._v("毫秒")]),e._v(" "),e.testResult.fireNodes&&e.testResult.fireNodes.length>0?[s("p",[e._v("决策流轨迹：")]),e._v(" "),e._l(e.testResult.fireNodes,(function(t,i){return s("p",{key:t.processId,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"success",icon:"el-icon-view"},on:{click:function(t){return e.showFlow(i)}}},[e._v("\n          "+e._s(t.flowName)+"\n        ")])],1)}))]:e._e(),e._v(" "),e.testResult.fireNum>0?[s("p",[e._v("规则列表：")]),e._v(" "),e._l(e.testResult.fireRules,(function(t,i){return s("p",{key:t.name,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"success",icon:"el-icon-view"},on:{click:function(t){return e.showAssets(i)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)}))]:e._e()],2),e._v(" "),e.showBatchResult?s("el-alert",{staticClass:"toolbar",attrs:{title:"批量测试成功",closable:!1,type:"success","show-icon":""}},[s("el-link",{attrs:{type:"success",icon:"el-icon-download"},on:{click:e.downloadBatchResult}},[e._v("\n      下载结果文件\n    ")])],1):e._e(),e._v(" "),e.showAgendaGroups?s("el-input",{ref:"agendaGroupsInput",staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"生效组，多个使用英文逗号分隔"},model:{value:e.agendaGroups,callback:function(t){e.agendaGroups="string"==typeof t?t.trim():t},expression:"agendaGroups"}},[s("el-button",{attrs:{slot:"append"},on:{click:e.cancelAgendaGroups},slot:"append"},[e._v("取 消")])],1):e._e(),e._v(" "),e.testData.facts.length>0?s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:6}},[s("el-table",{ref:"modelTable",attrs:{data:e.testData.facts,"row-style":{cursor:"pointer"},"row-class-name":e.setRowIndex,"highlight-current-row":"","current-row-key":e.testData.facts[e.testData.activeIndex].id,"row-key":"id",border:""},on:{"row-click":e.clickTestFact}},[s("el-table-column",{attrs:{prop:"name",label:"数据模型",align:"center"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:18}},e._l(e.testData.facts,(function(t,i){return s("el-table",{directives:[{name:"show",rawName:"v-show",value:i==e.testData.activeIndex,expression:"index == testData.activeIndex"}],key:t.id,staticClass:"tb-edit",attrs:{data:t.fields,"row-style":{cursor:"pointer"},"highlight-current-row":"",border:""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isNumber(t.row.type)?s("el-input-number",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{"step-strictly":e.inputInteger(t.row),min:e.inputMin(t.row),max:e.inputMax(t.row),controls:!1},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isBoolean(t.row.type)?s("el-select",{ref:"input_original_"+t.row.id,refInFor:!0,attrs:{placeholder:"请选择"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)?s("date-picker",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isDateTime(t.row.type)?s("date-picker",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isCollection(t.row.type)?s("test-collection",{ref:"input_original_"+t.row.id,refInFor:!0,attrs:{type:t.row.subType},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isObject(t.row.type)?s("test-object",{ref:"input_original_"+t.row.id,refInFor:!0,attrs:{id:t.row.subType},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):s("el-input",{ref:"input_original_"+t.row.id,refInFor:!0,model:{value:t.row.original,callback:function(s){e.$set(t.row,"original","string"==typeof s?s.trim():s)},expression:"scope.row.original"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n              "+e._s(t.row.original?"true"===t.row.original?"是":"否":"")+"\n            ")]):e.$utils.isCollection(t.row.type)||e.$utils.isObject(t.row.type)?e._e():s("span",[e._v("\n              "+e._s(t.row.original)+"\n            ")])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"结果",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n              "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n            ")]):(e.$utils.isObject(t.row.type)||e.$utils.isCollection(t.row.type))&&t.row.value?s("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[s("el-input",{attrs:{type:"textarea",rows:10,value:JSON.stringify(JSON.parse(t.row.value),null,2),readonly:""}}),e._v(" "),s("el-link",{attrs:{slot:"reference",icon:"el-icon-view"},slot:"reference"})],1):s("span",[e._v(e._s(t.row.value))])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{prop:"label",label:"中文名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"数据类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isCollection(t.row.type)?s("span",[e._v("\n              "+e._s(t.row.type+"<"+e.getSubTypeName(t.row.subType)+">")+"\n            ")]):e.$utils.isObject(t.row.type)?s("span",[e._v("\n              "+e._s(e.getObjectTypeName(t.row.subType))+"\n            ")]):s("span",[e._v(e._s(t.row.type))])]}}],null,!0)})],1)})),1)],1):e._e(),e._v(" "),s("ruleflow-trace",{attrs:{"flow-uuid":e.ruleflowTrace.uuid,"flow-version":e.ruleflowTrace.version,nodes:e.ruleflowTrace.nodes,show:e.ruleflowTrace.show},on:{"update:show":function(t){return e.$set(e.ruleflowTrace,"show",t)}}}),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,"fire-rules":e.viewingAssets.fireRules,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};ct._withStripped=!0;const dt={name:"test-dialog",props:{active:Boolean},watch:{active:function(e){this.show=e}},computed:{pkg(){return this.$store.state.pkg}},data(){return{show:this.active,testLoading:!1,testDataLoading:!1,testData:{activeIndex:0,facts:[]},showBatchDialog:!1,batchLoading:!1,batchData:{activeIndex:0,facts:null},batchTest:[],lastSubmitFacts:null,testResult:{},showTestResult:!1,showBatchResult:!1,downloadBatchResultLink:null,ruleflowTrace:{uuid:"",version:0,nodes:[],show:!1},viewingAssets:{uuid:"",version:0,show:!1,fireRules:[]},showAgendaGroups:!1,agendaGroups:null}},methods:{open(){this.testDataLoading=!0,this.testData.result=null,this.showBatchResult=!1,this.$axios.get("/knowledgepackage/testdata",{params:{uuid:this.pkg.packageUuid?this.pkg.packageUuid:this.pkg.uuid,baselineVersion:this.pkg.baselineVersion}}).then((e=>{this.testDataLoading=!1,0==e.data.code?(this.testData.facts=e.data.data,this.testData.facts.forEach((e=>{e.fields=e.fields.filter((e=>!this.$utils.isDerive(e.type)))})),this.$refs.modelTable.setCurrentRow(this.testData.facts[0]),this.clickTestFact({index:0})):this.$message.error(e.data.msg?e.data.msg:"加载失败")})).catch((()=>{this.testDataLoading=!1}))},closed(){this.$emit("update:active",!1),this.testData.activeIndex=0,this.testData.facts=[]},submitTest(){this.testData.facts.forEach((e=>{e.fields.forEach((e=>{this.$utils.isCollection(e.type)&&Array.isArray(e.original)&&(e.original=JSON.stringify(e.original))}))})),this.testLoading=!0,this.testData.result=null,this.lastSubmitFacts=this.testData.facts,this.showBatchResult=!1,this.$axios.post("/knowledgepackage/test",this.$qs.stringify({uuid:this.pkg.packageUuid?this.pkg.packageUuid:this.pkg.uuid,baselineVersion:this.pkg.baselineVersion,facts:JSON.stringify(this.testData.facts),agendaGroups:this.agendaGroups})).then((e=>{if(this.testLoading=!1,0==e.data.code){const t=e.data.data;void 0===t.result.fireNum&&(t.result.fireNum=0),this.testData.result=t.result,this.testData.facts=t.facts,this.testResult=t.result,this.showTestResult=!0}else if(e.data.msg){const t=e.data.msg.replace(/\n/g,"<br>").replace(/ /g,"&ensp;");this.$message.error({message:t,duration:5e3,dangerouslyUseHTMLString:!0,showClose:!0})}else this.$message.error("测试失败")})).catch((()=>{this.$message.error("测试失败"),this.testLoading=!1}))},moreTest(e){"agenda"==e?this.testAgendaGroups():"repeat"==e&&this.repeatSubmitTest()},testAgendaGroups(){this.showAgendaGroups=!0,this.$nextTick((()=>{this.$refs.agendaGroupsInput.focus()}))},cancelAgendaGroups(){this.showAgendaGroups=!1,this.agendaGroups=null},repeatSubmitTest(){null!=this.lastSubmitFacts&&(this.testData.facts=this.lastSubmitFacts,this.submitTest())},downloadExcel(){const e=this.pkg.packageUuid?this.pkg.packageUuid:this.pkg.uuid,t=this.pkg.baselineVersion?this.pkg.baselineVersion:0,s=this;this.$axios({method:"get",url:"/knowledgepackage/batchmodel?uuid="+e+"&baselineVersion="+t,responseType:"blob"}).then((e=>{if("application/json"==e.data.type){var t=new FileReader;t.onload=function(){const e=JSON.parse(t.result);if(401==e.code){localStorage.removeItem("hasLogin");const e=s.$router.currentRoute.fullPath;s.$router.push("/login?from="+e)}else s.$message.error(e.msg?e.msg:"下载失败")},t.readAsText(e.data)}else{let t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.style.display="none",s.href=t,s.target="_blank",s.setAttribute("download","批量测试模板.xlsx"),document.body.appendChild(s),s.click()}})).catch((()=>{s.$message.error("下载失败")}))},setRowIndex({row:e,rowIndex:t}){e.index=t},clickTestFact(e){this.testData.activeIndex=e.index},changeNumberInput(e){0==e.value&&(e.value=void 0)},getSubTypeName(e){if(this.$utils.isObject(e)){const t=this.$store.getters.getFactById(e);return t?t.name:""}return e},getObjectTypeName(e){const t=this.$store.getters.getFactById(e);return t?t.name:""},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.id][0];"值"==t.label&&a&&this.$nextTick((function(){this.$utils.isBoolean(e.type)?a.toggleMenu():a.focus()}))},chooseHistory(e){if(this.testData.facts.length>0){let t={};e.forEach((e=>{e.fields.forEach((s=>{t[e.id+"_"+s.id]=s.original}))})),this.testData.facts.forEach((e=>{e.fields.forEach((s=>{s.original=t[e.id+"_"+s.id]}))}))}},showFlow(e){const t=this.testResult.fireNodes[e];this.ruleflowTrace.uuid=t.flowUuid,this.ruleflowTrace.version=t.versionNo,this.ruleflowTrace.nodes=t.nodes,this.ruleflowTrace.show=!0},showAssets(e){const t=this.testResult.fireRules[e];this.viewingAssets.uuid=t.uuid,this.viewingAssets.version=t.version,this.viewingAssets.fireRules=[t.name],this.viewingAssets.show=!0},uploadExcel(e){if(!this.$utils.checkUploadFile(e,["xlsx","xls"]))return;const t=this.pkg.packageUuid?this.pkg.packageUuid:this.pkg.uuid,s=this.pkg.baselineVersion?this.pkg.baselineVersion:0,i=new FormData;i.append("file",e.raw),i.append("uuid",t),i.append("baselineVersion",s);const a=this;a.batchLoading=!0,a.showTestResult=!1,a.showBatchResult=!1,this.$axios({method:"post",url:"/knowledgepackage/batchtest",data:i,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){var s=new FileReader;s.onload=function(){const e=JSON.parse(s.result);if(401==e.code){localStorage.removeItem("hasLogin");const e=a.$router.currentRoute.fullPath;a.$router.push("/login?from="+e)}else a.$message.error(e.msg?e.msg:"批量测试失败")},s.readAsText(t.data)}else{let s=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.style.display="none",i.href=s,i.target="_blank";const o=e.name.lastIndexOf(".");-1!=o?i.setAttribute("download","批量测试结果"+e.name.substring(o)):i.setAttribute("download","批量测试结果.xlsx"),document.body.appendChild(i),a.showBatchResult=!0,a.downloadBatchResultLink=i}a.batchLoading=!1})).catch((()=>{a.$message.error("批量测试失败"),a.batchLoading=!1}))},downloadBatchResult(){this.downloadBatchResultLink.click()},inputInteger:e=>-1!=["Integer","Long"].indexOf(e.type),inputMin:e=>"Integer"==e.type?-2147483648:"Long"==e.type?-0x8000000000000000:void 0,inputMax:e=>"Integer"==e.type?2147483647:"Long"==e.type?0x8000000000000000:void 0}};var ut=(0,A.Z)(dt,ct,[],!1,null,"615b5b14",null);ut.options.__file="src/view/decision/project/knowledgepackage/test-dialog.vue";const pt=ut.exports,ht={name:"test-btn",components:{"test-dialog":pt},props:{assets:Object},data:()=>({loading:!1,showTestDialog:!1}),methods:{test(){this.loading=!0,this.$axios.post("/knowledgepackage/temptest",this.$qs.stringify({assetsUuid:this.assets.uuid})).then((e=>{0==e.data.code?(this.showTestDialog=!0,this.$store.commit("setPkg",e.data.data)):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.loading=!1})).then((()=>{this.loading=!1}))}}};var mt=(0,A.Z)(ht,lt,[],!1,null,"526486a5",null);mt.options.__file="src/view/decision/project/assets/test-btn.vue";const ft=mt.exports;var gt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"referContent"},[s("el-button",{attrs:{icon:"el-icon-warning-outline"},on:{click:function(t){e.show=!0}}},[e._v("\n    规则校验\n  ")]),e._v(" "),s("el-dialog",{attrs:{title:"规则校验",visible:e.show,"append-to-body":""},on:{"update:visible":function(t){e.show=t},closed:e.closed}},[s("el-checkbox-group",{model:{value:e.checkTypes,callback:function(t){e.checkTypes=t},expression:"checkTypes"}},[s("el-checkbox",{attrs:{label:"MISSING_RANGE"}},[e._v("范围缺失校验")]),e._v(" "),s("el-checkbox",{attrs:{label:"EQUIVALENT"}},[e._v("重复规则校验")]),e._v(" "),s("el-checkbox",{attrs:{label:"ALWAYS_TRUE"}},[e._v("永真规则校验")]),e._v(" "),s("el-checkbox",{attrs:{label:"OVERLAP"}},[e._v("重叠条件校验")])],1),e._v(" "),s("el-table",{attrs:{data:e.verifierResults,"highlight-current-row":""}},[s("el-table-column",{attrs:{label:"类型",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.verifierTypes[t.row.veriferType])+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"content",label:"结果"}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",loading:e.loading,icon:"el-icon-error"},on:{click:e.submit}},[e._v("\n        "+e._s(e.loading?"提交中...":"确 定")+"\n      ")])],1)],1)],1)};gt._withStripped=!0;const vt={name:"refer-btn",props:{assets:Object},data:()=>({loading:!1,show:!1,checkTypes:["MISSING_RANGE","EQUIVALENT","ALWAYS_TRUE","OVERLAP"],verifierResults:[],verifierTypes:{MISSING_RANGE:"范围缺失校验",EQUIVALENT:"重复规则校验",ALWAYS_TRUE:"永真规则校验",OVERLAP:"重叠条件校验"}}),methods:{submit(){if(this.checkTypes.length<1)return void this.$message.warning("请至少选择一项校验");this.loading=!0;let e={uuid:this.assets.uuid,versionNo:0};this.checkTypes.forEach(((t,s)=>{e[`types[${s}]`]=t})),this.$axios.post("/assets/verifier",this.$qs.stringify(e)).then((e=>{this.loading=!1,0==e.data.code?(this.$message.success("校验成功"),this.verifierResults=e.data.data,console.log(e.data.data)):this.$message.error(e.data.msg?e.data.msg:"校验失败")})).catch((()=>{this.$message.error("校验失败")}))},closed(){this.verifierResults=[]}}};var bt=(0,A.Z)(vt,gt,[],!1,null,"683a3f4e",null);bt.options.__file="src/view/decision/project/assets/assets-validation-rules.vue";const wt=bt.exports;let yt;const _t={name:"index",components:{lhs:Qe,rhs:it,deleteBtn:Te,referBtn:Ne,importBtn:rt,testBtn:ft,assetsValidation:wt,assetsToolbar:Me},data:()=>({rules:[],showAttrDialog:!1,editRuleIndex:0,saveLoading:!1,saveVersionLoading:!1,showNewVersionDialog:!1,nowVersion:[],targetVersion:[],showFireRules:!0,fullscreen:!1}),props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},mounted(){this.initData()},methods:{initData(){if(this.assets.content){const e=JSON.parse(this.assets.content);e.rules&&(yt=e.rules,this.filterRules())}else this.rules=[];this.rules.length<1&&this.addRule()},addRule(e){const t={name:this.getRuleName(),attrs:[]};!0===e&&(t.loop=e),this.rules.push(t)},getRuleName(){let e=this.rules.length+1,t="规则"+e;for(;-1!=this.$utils.arrayFindIndex(this.rules,(e=>e.name==t));)t="规则"+ ++e;return t},importTpl(e){this.assets.content=e,this.initData()},setAttr(e){this.editRuleIndex=e,this.showAttrDialog=!0},moveUp(e){e>0&&this.swapRule(e,e-1)},moveDown(e){e<this.rules.length-1&&this.swapRule(e,e+1)},copyRule(e){let t=JSON.parse(JSON.stringify(this.rules[e]));this.$utils.clearTmpKey(t),t.name=this.getRuleName(),this.rules.splice(e+1,0,t)},swapRule(e,t){let s=[];this.rules.forEach((e=>{s.push(e)}));const i=s[e];s[e]=s[t],s[t]=i,this.rules=s},openNameInput(e){this.$refs["name_"+e][0].focus()},editName(e,t){if(!t)return void(this.rules[e].name="规则"+(e+1));let s=!1;return this.rules.some(((i,a)=>{if(i.name==t&&e!=a)return s=!0,!0})),s?(this.rules[e].name="规则"+(e+1),void this.$message.warning("规则不能重名")):void 0},saveCallback(e){const t=JSON.parse(JSON.stringify(this.rules));this.$utils.clearTmpKey(t),e(JSON.stringify({rules:t}))},guidedTemplate(){this.$emit("addTemplate")},refresh(e){if(!0===e.changeVersion){const t=JSON.parse(e.content);t.rules?this.rules=t.rules:this.rules=[]}else this.$emit("refresh",e)},filterRules(){0!=this.fireRules.length&&this.showFireRules?this.rules=yt.filter((e=>{const t=this.assets.versionNo?`向导式决策集-${this.assets.name}_V${this.assets.versionNo}-${e.name}`:`向导式决策集-${this.assets.name}-${e.name}`;return-1!=this.fireRules.indexOf(t)||-1!=this.fireRules.indexOf(`${t}-ELSE分支`)})):this.rules=yt}}};var xt=(0,A.Z)(_t,We,[],!1,null,"13701b1f",null);xt.options.__file="src/view/decision/project/guidedrule/index.vue";const kt=xt.exports;var $t=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[e.readonly?e._e():s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",{ref:"toolbar"},[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets},on:{callback:e.saveCallback,template:e.ruleTemplate,refresh:e.refresh}}),e._v(" "),s("test-btn",{attrs:{assets:e.assets}}),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.addRow}},[e._v("添加行")]):e._e(),e._v(" "),e.tableData.rows.length>10?s("el-button",{attrs:{icon:"el-icon-place"},on:{click:function(t){e.fixHeader=!e.fixHeader}}},[e._v(e._s(e.fixHeader?"取消固定表头":"固定表头"))]):e._e(),e._v(" "),s("dropdown",{attrs:{"split-button":""},on:{click:e.exportExcel}},[s("i",{staticClass:"el-icon-download"}),e._v("\n          "+e._s(e.exportLoading?"导出中...":"导出文件")+"\n          "),e.$hasPerm("project.asset:edit")?s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",[s("el-upload",{attrs:{action:"","on-change":e.importExcel,"auto-upload":!1,"show-file-list":!1,accept:".xlsx"}},[s("i",{staticClass:"iconfont iconVersionupdaterule-copy"}),e._v(" 导入文件\n              ")])],1)],1):e._e()],1),e._v(" "),s("import-btn",{attrs:{assets:e.assets},on:{importTpl:e.importTpl}}),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-validation",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",[s("el-col",[e.fireRules.length>0?s("el-switch",{staticStyle:{"margin-bottom":"10px"},attrs:{"active-text":"仅显示触发规则"},on:{change:e.filterRules},model:{value:e.showFireRules,callback:function(t){e.showFireRules=t},expression:"showFireRules"}}):e._e(),e._v(" "),s("div",{staticClass:"el-table el-table--fit el-table--border el-table--enable-row-hover el-table--enable-row-transition ruletable-table",class:{"el-table--scrollable-y":e.fixHeader},style:{width:"100%;",height:e.tableHeight}},[s("div",{ref:"tableHeaderWrapper",staticClass:"el-table__header-wrapper"},[s("table",{staticClass:"el-table__header",staticStyle:{width:"100% !important"},attrs:{cellpadding:"0",cellspacing:"0",border:"0"}},[s("thead",{staticClass:"has-gutter"},[s("tr",[e._l(e.tableData.headers,(function(t,i){return s("th",{key:"header_"+t._id,staticClass:"is-center is-leaf",class:[{"action-column":"ASSIGN"==t.type},t.cssStyle]},["ATTR"==t.type?s("div",{staticClass:"cell"},[e.readonly?s("span",[e._v(e._s(e.getAttrLabel(i)))]):s("dropdown",{on:{command:function(t){return e.selectAttr(t,i)}}},[s("span",{staticStyle:{cursor:"pointer",color:"#909399"}},[e._v(e._s(e.getAttrLabel(i)))]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.getAttrItems(i),(function(t){return s("dropdown-item",{key:t.name,attrs:{command:t.name}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),e.readonly?e._e():s("dropdown",{staticStyle:{float:"right"},on:{command:function(t){return e.handleHeader(t,i)}}},[s("i",{staticClass:"el-icon-arrow-down el-icon--right icon-btn-mini"}),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-arrow-left",command:"addLeftAttr"}},[e._v("添加属性列（前）")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-arrow-right",command:"addRightAttr"}},[e._v("添加属性列（后）")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-delete",command:"deleteColumn",divided:""}},[e._v("删除当前属性列")])],1)],1)],1):s("div",{staticClass:"cell"},["ASSIGN"!==t.type?s("fact",{attrs:{readonly:e.readonly},model:{value:t.fact,callback:function(s){e.$set(t,"fact",s)},expression:"header.fact"}}):s("fact",{attrs:{scope:"ASSIGN",readonly:e.readonly},model:{value:t.fact,callback:function(s){e.$set(t,"fact",s)},expression:"header.fact"}}),e._v(" "),e.readonly?e._e():s("dropdown",{staticStyle:{float:"right"},on:{command:function(t){return e.handleHeader(t,i)}}},[s("i",{staticClass:"el-icon-arrow-down el-icon--right icon-btn-mini"}),e._v(" "),"CONDITION"==t.type?s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-arrow-left",command:"addLeftAttr"}},[e._v("添加属性列（前）")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-arrow-left",command:"addLeftCondition"}},[e._v("添加条件列（前）")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-arrow-right",command:"addRightCondition"}},[e._v("添加条件列（后）")]),e._v(" "),e.showDeleteCondition?s("dropdown-item",{attrs:{icon:"el-icon-delete",command:"deleteColumn",divided:""}},[e._v("删除当前条件列")]):e._e()],1):s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-arrow-left",command:"addLeftAssign"}},[e._v("添加赋值列（前）")]),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-arrow-right",command:"addRightAssign"}},[e._v("添加赋值列（后）")]),e._v(" "),e.showDeleteAction?s("dropdown-item",{attrs:{icon:"el-icon-delete",command:"deleteColumn",divided:""}},[e._v("删除当前动作列")]):e._e()],1)],1)],1)])})),e._v(" "),e.$hasPerm("project.asset:edit")&&!e.readonly?s("th",{staticClass:"is-center is-leaf",attrs:{width:"150"}},[s("div",{staticClass:"cell"},[e._v("操作")])]):e._e(),e._v(" "),e.fixHeader?s("th",{staticClass:"gutter",staticStyle:{width:"17px"}}):e._e()],2)])])]),e._v(" "),s("div",{staticClass:"el-table__body-wrapper is-scrolling-none",style:{height:e.tableBodyHeight}},[s("table",{staticClass:"el-table__body",staticStyle:{width:"100% !important"},attrs:{cellpadding:"0",cellspacing:"0",border:"0"}},[s("tbody",e._l(e.tableData.rows,(function(t,i){return s("tr",{key:"row_"+t[0]._id,staticClass:"el-table__row"},[e._l(t,(function(a,o){return s("td",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:e.contextmenuData(i,o),expression:"contextmenuData(i, j)"}],key:"cell_"+a._id,staticClass:"is-center",class:[{"action-column":"ASSIGN"==e.tableData.headers[o].type},e.tableData.headers[o].cssStyle]},[s("div",{staticClass:"cell"},["ATTR"===e.tableData.headers[o].type?[e.readonly?[s("span",[e._v(e._s(t[o].value))])]:["salience"===e.tableData.headers[o].name?s("el-input-number",{staticStyle:{width:"100%"},attrs:{controls:!1},model:{value:t[o].value,callback:function(s){e.$set(t[o],"value",s)},expression:"row[j].value"}}):"date-effective"===e.tableData.headers[o].name?s("date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择生效时间"},model:{value:t[o].value,callback:function(s){e.$set(t[o],"value",s)},expression:"row[j].value"}}):"date-expires"===e.tableData.headers[o].name?s("date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss","disabled-date":e.expiredTimeDisabledDate,placeholder:"请选择失效时间"},model:{value:t[o].value,callback:function(s){e.$set(t[o],"value",s)},expression:"row[j].value"}}):"activation-group"===e.tableData.headers[o].name||"agenda-group"===e.tableData.headers[o].name?s("el-input",{staticStyle:{width:"100%"},model:{value:t[o].value,callback:function(s){e.$set(t[o],"value",s)},expression:"row[j].value"}}):"enabled"===e.tableData.headers[o].name?s("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:t[o].value,callback:function(s){e.$set(t[o],"value",s)},expression:"row[j].value"}}):e._e()]]:e.tableData.headers[o].fact?["CONDITION"==e.tableData.headers[o].type?s("lhs-editor",{attrs:{"left-type":e.getHeaderType(e.tableData.headers[o]),readonly:e.readonly},model:{value:t[o],callback:function(s){e.$set(t,o,s)},expression:"row[j]"}}):s("expression",{attrs:{"input-type":e.getHeaderType(e.tableData.headers[o]),readonly:e.readonly},model:{value:t[o].right,callback:function(s){e.$set(t[o],"right",s)},expression:"row[j].right"}}),e._v(" "),e.readonly?e._e():s("i",{staticClass:"el-icon-delete icon-btn-mini",on:{click:function(t){return e.$set(e.tableData.rows[i],o,{})}}})]:[e._v("-")]],2)])})),e._v(" "),e.$hasPerm("project.asset:edit")&&!e.readonly?s("td",{staticClass:"is-center",attrs:{width:"150"}},[s("div",{staticClass:"cell"},[s("i",{staticClass:"el-icon-document-copy icon-btn",on:{click:function(t){return e.duplicateRow(i)}}}),e._v(" "),s("i",{staticClass:"el-icon-top icon-btn",on:{click:function(t){return e.moveUp(i)}}}),e._v(" "),s("i",{staticClass:"el-icon-bottom icon-btn",on:{click:function(t){return e.moveDown(i)}}}),e._v(" "),s("i",{staticClass:"el-icon-delete icon-btn",on:{click:function(t){return e.$delete(e.tableData.rows,i)}}})])]):e._e()],2)})),0)]),e._v(" "),0==e.tableData.rows.length?s("div",{staticClass:"el-table__empty-block",staticStyle:{height:"100%",width:"100%"}},[s("span",{staticClass:"el-table__empty-text"},[e._v("暂无数据")])]):e._e()])])],1)],1)],1)};let Tt;$t._withStripped=!0;const Dt={name:"index",props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},components:{lhs:Qe,deleteBtn:Te,testBtn:ft,referBtn:Ne,importBtn:rt,assetsValidation:wt,assetsToolbar:Me},data(){return{showAttrDialog:!1,saveLoading:!1,saveVersionLoading:!1,showNewVersionDialog:!1,execlSetUrl:"/execl/importruletable",execlDownUrl:"/execl/downruletabletemplate",tableData:{headers:[{type:"CONDITION",_id:this.$utils.randomCode(16)},{type:"ASSIGN",_id:this.$utils.randomCode(16)}],rows:[]},showVersionDialog:!1,nowVersion:{headers:[{type:"CONDITION"},{type:"ASSIGN"}],rows:[]},expiredTimeDisabledDate:e=>e.getTime()<(new Date).getTime(),targetVersion:{headers:[{type:"CONDITION"},{type:"ASSIGN"}],rows:[]},fixHeader:!1,_copyCondition:null,_copyAction:null,showFireRules:!0,exportLoading:!1,fullscreen:!1}},computed:{showDeleteCondition(){let e=0;return this.tableData.headers.forEach((t=>{"CONDITION"==t.type&&e++})),e>1},showDeleteAction(){let e=0;return this.tableData.headers.forEach((t=>{"ASSIGN"==t.type&&e++})),e>1},tableHeight(){return this.fixHeader?document.querySelector(".el-main").offsetHeight-40-(document.querySelector(".el-page-header").offsetHeight+20)-document.querySelector(".el-tabs__header").offsetHeight-(this.$refs.toolbar.$el.offsetHeight+5)-20+"px":"100%"},tableBodyHeight(){if(!this.fixHeader)return"100%";const e=this.$refs.tableHeaderWrapper.offsetHeight;return parseInt(this.tableHeight)-e+"px"}},mounted(){this.renderTableData()},methods:{renderTableData(){this.$utils.isBlank(this.assets.content)||(Tt=JSON.parse(this.assets.content),Tt.headers.forEach((e=>{e._id||(e._id=this.$utils.randomCode(16))})),Tt.rows.forEach((e=>{e.forEach((e=>{e._id||(e._id=this.$utils.randomCode(16))}))})),this.filterRules())},handleHeader(e,t){const s=JSON.parse(JSON.stringify(this.tableData.headers)),i=JSON.parse(JSON.stringify(this.tableData.rows));"addLeftAttr"==e?(s.splice(t,0,{type:"ATTR",_id:this.$utils.randomCode(16),name:""}),i.forEach((e=>e.splice(t,0,{_id:this.$utils.randomCode(16),value:""})))):"addRightAttr"==e?(s.splice(t+1,0,{type:"ATTR",_id:this.$utils.randomCode(16),name:""}),i.forEach((e=>e.splice(t+1,0,{_id:this.$utils.randomCode(16),value:""})))):"addLeftCondition"==e?(s.splice(t,0,{type:"CONDITION",_id:this.$utils.randomCode(16)}),i.forEach((e=>e.splice(t,0,{_id:this.$utils.randomCode(16)})))):"addRightCondition"==e?(s.splice(t+1,0,{type:"CONDITION",_id:this.$utils.randomCode(16)}),i.forEach((e=>e.splice(t+1,0,{_id:this.$utils.randomCode(16)})))):"addLeftAssign"==e?(s.splice(t,0,{type:"ASSIGN",_id:this.$utils.randomCode(16)}),i.forEach((e=>e.splice(t,0,{_id:this.$utils.randomCode(16)})))):"addRightAssign"==e?(s.splice(t+1,0,{type:"ASSIGN",_id:this.$utils.randomCode(16)}),i.forEach((e=>e.splice(t+1,0,{_id:this.$utils.randomCode(16)})))):"deleteColumn"==e&&(s.splice(t,1),i.forEach((e=>e.splice(t,1)))),this.tableData.headers=s,this.tableData.rows=i},addRow(){let e=[];this.tableData.headers.forEach((t=>{e.push({_id:this.$utils.randomCode(16)})})),this.tableData.rows.push(e)},importTpl(e){this.assets.content=e,this.renderTableData()},duplicateRow(e){const t=JSON.parse(JSON.stringify(this.tableData.rows[e]));t.forEach((e=>{e._id=this.$utils.randomCode(16)})),this.tableData.rows.splice(e+1,0,t)},moveUp(e){e>0&&this.swapRow(e,e-1)},moveDown(e){e<this.tableData.rows.length-1&&this.swapRow(e,e+1)},swapRow(e,t){let s=[];this.tableData.rows.forEach((e=>{s.push(e)}));const i=s[e];s[e]=s[t],s[t]=i,this.tableData.rows=s},save(){const e=JSON.parse(JSON.stringify(this.tableData));this.$utils.clearTmpKey(e),this.saveLoading=!0,this.$axios.post("/assets/savecontent",this.$qs.stringify({uuid:this.assets.uuid,content:JSON.stringify(e)})).then((e=>{this.saveLoading=!1,0==e.data.code?this.$message.success("保存成功"):this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败"),this.saveLoading=!1}))},execlUpSuccess(e){this.assets.content=e,this.renderTableData()},getHeaderType(e){return this.$store.getters.getExpressionType({type:"FACT",fact:e.fact})},rowKey(e){return e[0]._id||(e[0]._id=this.$utils.randomCode(16)),e[0]._id},contextmenuData(e,t){const s=this.tableData.headers[t];if(!s.fact)return null;const i=this.tableData.rows[e][t],a=[],o=this;return"CONDITION"==s.type?(a.push({text:"复制条件",command:i,click:e=>o._copyCondition=e}),a.push({text:"粘贴条件",command:{i:e,j:t},click:function({i:e,j:t}){if(!o._copyCondition)return;let s=o.$utils.copy(o._copyCondition);s._id=o.$utils.randomCode(16),o.$set(o.tableData.rows[e],t,s)}})):(a.push({text:"复制动作",command:i,click:e=>o._copyAction=e}),a.push({text:"粘贴动作",command:{i:e,j:t},click:function({i:e,j:t}){if(!o._copyAction)return;let s=o.$utils.copy(o._copyAction);s._id=o.$utils.randomCode(16),o.$set(o.tableData.rows[e],t,s)}})),{items:a}},saveCallback(e){const t=JSON.parse(JSON.stringify(this.tableData));this.$utils.clearTmpKey(t),e(JSON.stringify(t))},ruleTemplate(){this.$emit("addTemplate")},selectAttr(e,t){this.tableData.headers[t].name!==e&&(this.tableData.headers[t].name=e,this.tableData.rows.forEach((e=>{e[t].value=""})))},getAttrLabel(e){const t=this.tableData.headers[e];return this.$attr.getLabel(t.name)||"请选择"},exportExcel(){if(this.exportLoading)return;const e=[];this.tableData.headers.forEach((t=>{if("ATTR"==t.type){const s=this.$attr.getLabel(t.name);s&&e.push("属性列:"+s)}else if("CONDITION"==t.type){if(t.fact){const s=this.$store.getters.getFactText(t.fact.id,t.fact.fieldId);s&&e.push("条件列:"+s)}}else if("ASSIGN"==t.type&&t.fact){const s=this.$store.getters.getFactText(t.fact.id,t.fact.fieldId);s&&e.push("赋值列:"+s)}}));const t=this;t.exportLoading=!0,this.$axios({method:"post",url:"/assets/writeexcel",data:[e],responseType:"blob"}).then((e=>{if(t.exportLoading=!1,"application/json"==e.data.type){const s=new FileReader;s.onload=function(){const e=JSON.parse(s.result);if(401==e.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(e.msg?e.msg:"导出失败")},s.readAsText(e.data)}else{let t=window.URL.createObjectURL(new Blob([e.data])),s=document.createElement("a");s.style.display="none",s.href=t,s.target="_blank",s.setAttribute("download",this.assets.name+".xlsx"),document.body.appendChild(s),s.click()}})).catch((()=>{t.exportLoading=!1,t.$message.error("导出失败")}))},importExcel(e){if(!this.$utils.checkUploadFile(e,["xlsx","xls"]))return;const t=new FormData;t.append("file",e.raw),this.$axios.post("/assets/readexcel",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(0==e.data.code){if(!e.data.data.csv||e.data.data.csv.length<=0)return void this.$message.error("导入文件失败，请检查文件是否正确");const t=e.data.data.csv[0].lines,s=this.parseHeaders(t[0]);if(s.length<=0)return void this.$message.error("导入失败，请检查文件是否正确");const i=[];t.forEach(((e,t)=>{if(t>0){const t=this.parseRow(e,s);i.push(t)}})),this.tableData.headers=s,this.tableData.rows=i,this.$message.success("导入成功")}else this.$message.error(e.data.msg?e.data.msg:"导入失败")})).catch((e=>{this.$message.error("导入失败"),console.error(e)}))},parseHeaders(e){const t=[];return e.forEach((e=>{if(e.startsWith("属性列:")){const s=e.substring(4),i=this.$attr.getName(s);i&&t.push({_id:this.$utils.randomCode(16),type:"ATTR",name:i})}else if(e.startsWith("条件列:")||e.startsWith("赋值列:")){const s=e.substring(4),i=this.$store.getters.getFactExpressionByText(s);i&&t.push({_id:this.$utils.randomCode(16),type:e.startsWith("条件列:")?"CONDITION":"ASSIGN",fact:i})}})),t},parseRow(e,t){const s=[];return t.forEach(((t,i)=>{const a={_id:this.$utils.randomCode(16)};s.push(a);const o=e[i]?e[i].trim():"";if("ATTR"===t.type)try{if("date-effective"==t.name||"date-expires"==t.name){const e=this.transformValue("Date",o);e&&(a.value=e)}else if("enabled"==t.name){const e=this.transformValue("Boolean",o);e&&(a.value=e)}else if("salience"==t.name){const e=this.transformValue("Integer",o);e&&(a.value=e)}else a.value=o}catch(e){console.error(e)}else if("CONDITION"===t.type){const e=this.getHeaderType(t),s=this.transformValue(e,o);s&&(a.constraint={conjunction:"AND",constraints:[{op:"EQ",right:{type:"INPUT",input:{type:e,value:s}}}]})}else if("ASSIGN"===t.type){const e=this.getHeaderType(t),s=this.transformValue(e,o);s&&(a.right={type:"INPUT",input:{type:e,value:s}})}})),s},transformValue(e,t){try{if("Integer"==e||"Long"==e)return parseInt(t);if("Double"==e||"BigDecimal"==e)return parseFloat(t);if("Boolean"==e){if("true"===(t=t.toLowerCase()))return!0;if("false"===t)return!1}else{if("Date"!=e)return t;{const e=new Date(t).getTime();if(e)return this.$moment(e).format("YYYY-MM-DD HH:mm:ss",!1)}}}catch(e){return console.error(e),null}},refresh(e){if(!0===e.changeVersion){const t=JSON.parse(e.content);t.headers.some((e=>{e._id||(e._id=this.$utils.randomCode(16))})),t.rows.forEach((e=>{e.forEach((e=>{e._id||(e._id=this.$utils.randomCode(16))}))})),this.tableData=t}else this.$emit("refresh",e)},getAttrItems(e){const t=[];return this.$attr.items.forEach((s=>{let i=!1;this.tableData.headers.some(((t,a)=>{if("ATTR"==t.type&&e!==a&&t.name==s.name)return i=!0,!0})),i||t.push(s)})),t},filterRules(){if(0==this.fireRules.length||!this.showFireRules)return this.tableData.headers=Tt.headers,void(this.tableData.rows=Tt.rows);const e=[];this.fireRules.forEach((t=>{const s=this.assets.versionNo?t.substring(`决策表-${this.assets.name}_V${this.assets.versionNo}-`.length):t.substring(`决策表-${this.assets.name}-`.length),i=parseInt(s.substring(1,s.length-1));i&&Tt.rows.forEach(((t,s)=>{i==s+1&&e.push(t)}))})),this.tableData.headers=Tt.headers,this.tableData.rows=e}}};var St=(0,A.Z)(Dt,$t,[],!1,null,"22a2edcd",null);St.options.__file="src/view/decision/project/ruletable/index.vue";const Ct=St.exports;var Nt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[e.readonly?e._e():s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets},on:{callback:e.saveCallback,refresh:e.refresh,template:e.ruletreeTemplate}}),e._v(" "),s("test-btn",{attrs:{assets:e.assets}}),e._v(" "),s("import-btn",{attrs:{assets:e.assets},on:{importTpl:e.importTpl}}),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-validation",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",{ref:"treeContent",staticStyle:{"overflow-x":"auto"}},[s("el-col",[e.$hasPerm("project.asset:edit")&&!e.readonly?s("el-button",{attrs:{type:"text"},on:{click:function(t){e.showAttrDialog=!0}}},[e._v("\n        设置属性\n      ")]):e._e(),e._v(" "),e._l(e.attrs,(function(t,i){return s("el-tag",{key:t.name,staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"warning",closable:!e.readonly},on:{close:function(t){return e.attrs.splice(i,1)}}},[e._v("\n        "+e._s(e.$attr.getLabel(t.name))+"： "+e._s(t.value)+"\n      ")])})),e._v(" "),e.fireRules.length>0?s("el-switch",{staticStyle:{"margin-bottom":"10px"},attrs:{"active-text":"仅显示触发规则"},on:{change:e.filterRules},model:{value:e.showFireRules,callback:function(t){e.showFireRules=t},expression:"showFireRules"}}):e._e(),e._v(" "),s("div",{ref:"treeContainer",attrs:{id:"treeContainer"}})],2)],1),e._v(" "),s("attr",{attrs:{show:e.showAttrDialog},on:{"update:show":function(t){e.showAttrDialog=t}},model:{value:e.attrs,callback:function(t){e.attrs=t},expression:"attrs"}})],1)};Nt._withStripped=!0;class Lt{constructor(e,t,s={}){this.context=e,this.parentNode=t,this.data=s,this.children=[]}mount(e){const t=e.$mount();this.context.container.appendChild(t.$el),this.vm=t,this.dom=t.$el,this.context.readonly&&(this.vm.readonly=this.context.readonly),this.initChildren()}initChildren(){this.data.children&&0!=this.data.children.length&&this.data.children.forEach((e=>{this.addChild(e)}))}addChild(e){const t=this.context.newNode(e,this);return this.children.push(t),this.context.traverse(),t}repeatNode(){const e=this.parentNode.children.indexOf(this);if(-1!=e){const t=this.context.newNode(JSON.parse(JSON.stringify(this.data)),this.parentNode);this.parentNode.children.splice(e,0,t),this.context.traverse()}}delete(){this.deleteRecursively(),this.context.traverse()}deleteRecursively(){for(;this.children.length>0;)this.children[this.children.length-1].deleteRecursively();if(!this.isRootNode()){const e=this.parentNode.children.indexOf(this);this.parentNode.children.splice(e,1),this.parentNode.data.children.splice(e,1),this.vm.$destroy(),this.dom.remove(),this.connection.path.remove(),this.context.deleteNode(this)}}isRootNode(){return this==this.context.rootNode}traverse(){if(this.w=this.dom.offsetWidth,this.h=this.dom.offsetHeight,this.parentNode?this.x=this.parentNode.x+this.parentNode.w+10:this.x=0,0==this.children.length)this.context.height>0?this.y=this.context.height+10:this.y=this.context.height,this.context.height=this.y+this.h;else{this.children.forEach((e=>{e.traverse()}));const e=this.children[0],t=this.children[this.children.length-1];this.y=e.y+(t.y+t.h-e.y-this.h)/2}this.x<0&&(this.x=0),this.y<0&&(this.y=0);const e=this.x+this.w;e>this.context.width&&(this.context.width=e)}setPosition(){this.dom.style.left=this.x+"px",this.dom.style.top=this.y+"px"}copyNode(){this.context.clipboard={node:this,type:"COPY"}}cutNode(){this.context.clipboard={node:this,type:"CUT"}}pasteNode(){if(!this.context.clipboard)return;const e=this.context.clipboard.type,t=this.context.clipboard.node,s=JSON.parse(JSON.stringify(t.data));this.context.startTransaction((()=>{if("CUT"==e){if(this.isOnThePath(t))return"不能剪切当前节点所在分支";t.delete(),this.context.clipboard=null}this.data.children||(this.data.children=[]),this.data.children.push(s),this.addChild(s)}))}isOnThePath(e){if(this==e)return!0;let t=!1;return e.children.length>0&&e.children.some((e=>{if(t=this.isOnThePath(e),t)return!0})),t}destroy(){this.vm.$destroy()}}var At=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"tree-node"},[e.readonly?s("fact",{attrs:{readonly:e.readonly},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}}):s("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:e.contextmenuData,expression:"contextmenuData"}]},[s("fact",{model:{value:e.data,callback:function(t){e.data=t},expression:"data"}})],1),e._v(" "),e.readonly?e._e():s("el-dialog",{attrs:{title:"按区间范围添加条件",visible:e.showSectionConditionDialog,"append-to-body":""},on:{"update:visible":function(t){e.showSectionConditionDialog=t},open:e.open,closed:e.closed}},[e._l(e.sections,(function(t,i){return s("div",{key:i,staticStyle:{"margin-bottom":"5px"}},[s("el-input-number",{staticStyle:{width:"100px"},attrs:{controls:!1,max:e.getMax(i)},model:{value:t.min,callback:function(s){e.$set(t,"min",s)},expression:"e.min"}}),e._v("\n      到\n      "),s("el-input-number",{staticStyle:{width:"100px"},attrs:{controls:!1,min:e.getMin(i)},model:{value:t.max,callback:function(s){e.$set(t,"max",s)},expression:"e.max"}}),e._v(" "),s("el-select",{staticStyle:{width:"120px"},model:{value:t.type,callback:function(s){e.$set(t,"type",s)},expression:"e.type"}},[s("el-option",{attrs:{value:"[]",label:"闭区间 []"}}),e._v(" "),s("el-option",{attrs:{value:"()",label:"开区间 ()"}}),e._v(" "),s("el-option",{attrs:{value:"[)",label:"左闭右开 [)"}}),e._v(" "),s("el-option",{attrs:{value:"(]",label:"左开右闭 (]"}})],1),e._v(" "),s("el-button",{on:{click:function(t){return e.delSection(i)}}},[e._v("删除")])],1)})),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showSectionConditionDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.submitSectionCondition}},[e._v("确 定")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addSection}},[e._v("添加区间")])],1)],2)],1)};At._withStripped=!0;const Et={name:"fact-node",props:{data:{type:Object,default:function(){return{}}},readonly:{type:Boolean,default:!1}},watch:{data:{deep:!0,handler:function(){this.resetInput(),this.resize()}}},data(){return{contextmenuData:{items:[{text:"添加条件",icon:"el-icon-s-unfold",command:{type:"CONDITION"},click:this.operate},{text:"按区间范围添加条件",icon:"el-icon-s-unfold",command:{type:"SECTION_CONDITION"},click:this.operate,filter:()=>{const e=this.data.id,t=this.data.fieldId;if(e&&t){const s=this.$store.getters.getFactField(e,t);if(this.$utils.isNumber(s.type))return!0}return!1}},{text:"ELSE分支",icon:"el-icon-s-unfold",command:{type:"ELSE_CONDITION"},click:this.operate,filter:()=>{const e=this.getChildNodes();if(e.length>0){let t=!1;return e.some((e=>{if(!0===e.condition.other)return t=!0,!0})),!t}return!1}},{text:"复制分支",icon:"el-icon-document-copy",command:{type:"COPY"},click:this.operate,filter:()=>!this.isRootNode()},{text:"剪切分支",icon:"el-icon-scissors",command:{type:"CUT"},click:this.operate,filter:()=>!this.isRootNode()},{text:"粘贴分支",icon:"el-icon-document-copy",command:{type:"PASTE"},click:this.operate,filter:()=>this.canPaste()},{text:"删除节点",icon:"el-icon-delete",command:{type:"DELETE"},click:this.operate,divided:!0}]},showSectionConditionDialog:!1,sections:[]}},methods:{operate(e){if("CONDITION"==e.type)this.addChild();else if("SECTION_CONDITION"==e.type)this.showSectionConditionDialog=!0;else if("ELSE_CONDITION"==e.type)this.addChild({other:!0});else if("COPY"==e.type)this.copyNode();else if("CUT"==e.type)this.cutNode();else if("PASTE"==e.type){const e=this.pasteNode();e&&this.$message.warning(e)}else"DELETE"==e.type&&this.delete()},submitSectionCondition(){this.sections.forEach((e=>{if(this.$utils.isNotBlank(e.min)&&this.$utils.isNotBlank(e.max)){let t;t=e.type.startsWith("[")?this.addChild({op:"GTE",right:{type:"INPUT",input:{value:e.min,type:"Double"}}}):this.addChild({op:"GT",right:{type:"INPUT",input:{value:e.min,type:"Double"}}}),e.type.endsWith("]")?t.vm.addChild("CONDITION",{op:"LTE",right:{type:"INPUT",input:{value:e.max,type:"Double"}}}):t.vm.addChild("CONDITION",{op:"LT",right:{type:"INPUT",input:{value:e.max,type:"Double"}}})}else if(this.$utils.isNotBlank(e.min)){const t={right:{type:"INPUT",input:{value:e.min,type:"Double"}}};e.type.startsWith("[")?t.op="GTE":t.op="GT",this.addChild(t)}else if(this.$utils.isNotBlank(e.max)){const t={right:{type:"INPUT",input:{value:e.max,type:"Double"}}};e.type.endsWith("]")?t.op="LTE":t.op="LT",this.addChild(t)}})),this.showSectionConditionDialog=!1},addSection(){this.sections.push({type:"[]"})},open(){this.addSection()},closed(){this.sections=[]},delSection(e){this.sections.splice(e,1)},getMin(e){return this.sections[e].min||-1/0},getMax(e){return this.sections[e].max||1/0}}};var Ft=(0,A.Z)(Et,At,[],!1,null,"44c9c246",null);Ft.options.__file="src/view/decision/project/ruletree/fact-node.vue";const Ot=Ft.exports,It=i.default.extend(Ot);class Pt extends Lt{constructor(e,t,s){super(e,t,s),this.init()}init(){const e=this;super.mount(new It({store:k,propsData:{data:e.data.fact},methods:{addChild(t={}){const s={nodeType:"CONDITION",condition:t};return e.data.children||(e.data.children=[]),e.data.children.push(s),e.addChild(s)},delete(){e.delete()},resetInput(){e.children.forEach((e=>e.initInputType()))},isRootNode:()=>e.isRootNode(),getChildNodes:()=>e.data.children||[],canPaste(){const t=e.context.clipboard;return t&&"CONDITION"==t.node.data.nodeType},copyNode(){e.copyNode()},cutNode(){e.cutNode()},pasteNode:()=>e.pasteNode(),resize(){e.context.traverse()}}}))}}var Mt=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("div",{staticClass:"tree-node"},[e.data.other?[e._v("\n    ELSE分支\n  ")]:[e.inputType?s("op",{key:Math.random(),attrs:{"input-type":e.inputType,readonly:""},model:{value:e.data.op,callback:function(t){e.$set(e.data,"op",t)},expression:"data.op"}}):e._e(),e._v(" "),e.inputType?s("expression",{attrs:{"input-type":e.getRightInputType(),readonly:""},model:{value:e.data.right,callback:function(t){e.$set(e.data,"right",t)},expression:"data.right"}}):e._e(),e._v(" "),e.inputType?e._e():[e._v("\n      -\n    ")]]],2):s("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:e.contextmenuData,expression:"contextmenuData"}],staticClass:"tree-node"},[e.data.other?[e._v("\n    ELSE分支\n  ")]:[e.inputType?s("op",{key:Math.random(),attrs:{"input-type":e.inputType},model:{value:e.data.op,callback:function(t){e.$set(e.data,"op",t)},expression:"data.op"}}):e._e(),e._v(" "),e.inputType?s("expression",{attrs:{"input-type":e.getRightInputType()},model:{value:e.data.right,callback:function(t){e.$set(e.data,"right",t)},expression:"data.right"}}):e._e(),e._v(" "),e.inputType?e._e():[e._v("\n       -\n    ")]]],2)};Mt._withStripped=!0;const Rt={name:"condition-node",props:{data:{type:Object,default:function(){return{}}},inputType:String,readonly:{type:Boolean,default:!1}},watch:{data:{deep:!0,handler:function(){this.resize()}}},data(){return{contextmenuData:{items:[{text:"添加条件",icon:"el-icon-s-unfold",command:{type:"CONDITION"},click:this.operate,filter:()=>!0!==this.data.other},{text:"复制条件",icon:"el-icon-document-copy",command:{type:"REPEAT"},click:this.operate,filter:()=>!0!==this.data.other},{text:"添加动作",icon:"el-icon-s-tools",command:{type:"ACTION"},click:this.operate},{text:"添加模型",icon:"iconfont iconshujumoxing",command:{type:"FACT"},click:this.operate},{text:"复制分支",icon:"el-icon-document-copy",command:{type:"COPY"},click:this.operate,filter:()=>!0!==this.data.other},{text:"剪切分支",icon:"el-icon-scissors",command:{type:"CUT"},click:this.operate,filter:()=>!0!==this.data.other},{text:"粘贴分支",icon:"el-icon-document-copy",command:{type:"PASTE"},click:this.operate,filter:()=>{const e=this.getClipboard();return!!e&&(!0!==this.data.other||"CONDITION"!=e.node.data.nodeType)}},{text:"删除节点",icon:"el-icon-delete",command:{type:"DELETE"},click:this.operate,divided:!0}]}}},methods:{operate(e){if("CONDITION"==e.type)this.addChild(e.type);else if("REPEAT"==e.type)this.repeatCondition();else if("ACTION"==e.type)this.addChild("ACTION");else if("FACT"==e.type)this.addChild("FACT");else if("COPY"==e.type)this.copyNode();else if("CUT"==e.type)this.cutNode();else if("PASTE"==e.type){const e=this.pasteNode();e&&this.$message.warning(e)}else"DELETE"==e.type&&this.delete()},getRightInputType(){return"字符串长度为"===this.data.op||"字符串长度不为"===this.data.op?"Integer":this.inputType}}};var jt=(0,A.Z)(Rt,Mt,[],!1,null,"4c1f3281",null);jt.options.__file="src/view/decision/project/ruletree/condition-node.vue";const Bt=jt.exports,Ut=i.default.extend(Bt);class Vt extends Lt{constructor(e,t,s){super(e,t,s),this.init()}init(){const e=this;super.mount(new Ut({store:k,propsData:{data:e.data.condition,inputType:e.getInputType()},methods:{addChild(t,s){let i={nodeType:t};return"CONDITION"==t?i.condition=s||{}:"ACTION"==t?i.rhs=s||{actions:[{}]}:"FACT"==t&&(i.fact={}),e.data.children||(e.data.children=[]),e.data.children.push(i),e.addChild(i)},delete(){e.delete()},repeatCondition(){e.repeatNode()},copyNode(){e.copyNode()},cutNode(){e.cutNode()},pasteNode:()=>e.pasteNode(),getClipboard:()=>e.context.clipboard,resize(){e.context.traverse()}}}))}initInputType(){this.vm.inputType=this.getInputType()}getInputType(){let e;const t=this.findFactParentNode().data.fact;if(t&&t.id){const s=k.getters.getFactField(t.id,t.fieldId);s&&(e=s.type)}return e}findFactParentNode(){return this.parentNode instanceof Pt?this.parentNode:this.parentNode.findFactParentNode()}}var Ht=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("div",{staticClass:"tree-node"},e._l(e.data.actions,(function(t,i){return s("div",{key:i},[s("action",{attrs:{readonly:e.readonly},model:{value:e.data.actions[i],callback:function(t){e.$set(e.data.actions,i,t)},expression:"data.actions[i]"}})],1)})),0):s("div",{directives:[{name:"contextmenu",rawName:"v-contextmenu",value:e.contextmenuData,expression:"contextmenuData"}],staticClass:"tree-node"},[e._l(e.data.actions,(function(t,i){return s("div",{key:i},[s("action",{model:{value:e.data.actions[i],callback:function(t){e.$set(e.data.actions,i,t)},expression:"data.actions[i]"}}),e._v(" "),s("i",{staticClass:"el-icon-delete",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$delete(e.data.actions,i)}}}),e._v(" "),s("i",{staticClass:"el-icon-document-copy",staticStyle:{cursor:"pointer"},on:{click:function(t){return e.copyAction(i)}}})],1)})),e._v(" "),!e.data.actions||e.data.actions.length<1?[e._v("\n    右键添加动作\n  ")]:e._e()],2)};Ht._withStripped=!0;const qt={name:"action-node",props:{data:{type:Object,default:function(){return{actions:[]}}},readonly:{type:Boolean,default:!1}},watch:{data:{deep:!0,handler:function(){this.resize()}}},data(){return{contextmenuData:{items:[{text:"添加动作",icon:"el-icon-edit",command:{type:"ADD"},click:this.operate},{text:"复制分支",icon:"el-icon-document-copy",command:{type:"COPY"},click:this.operate},{text:"剪切分支",icon:"el-icon-scissors",command:{type:"CUT"},click:this.operate},{text:"删除节点",icon:"el-icon-delete",command:{type:"DELETE"},click:this.operate,divided:!0}]}}},methods:{operate(e){"ADD"==e.type?this.data.actions.push({}):"COPY"==e.type?this.copyNode():"CUT"==e.type?this.cutNode():"DELETE"==e.type&&this.delete()},copyAction(e){const t=this.$utils.copy(this.data.actions[e]);this.data.actions.splice(e,0,t)}}};var zt=(0,A.Z)(qt,Ht,[],!1,null,"6217cefc",null);zt.options.__file="src/view/decision/project/ruletree/action-node.vue";const Wt=zt.exports,Gt=i.default.extend(Wt);class Jt extends Lt{constructor(e,t,s){super(e,t,s),this.init()}init(){const e=this;super.mount(new Gt({store:k,propsData:{data:e.data.rhs},methods:{delete(){e.delete()},copyNode(){e.copyNode()},cutNode(){e.cutNode()},resize(){e.context.traverse()}}}))}}class Zt{constructor(e,t,s){this.context=e,this.parentNode=t,this.childNode=s,this.childNode.connection=this}drawPath(){if(!this.path){const e=document.createElementNS("http://www.w3.org/2000/svg","path");this.context.paper.appendChild(e),this.path=e,e.setAttribute("fill","none"),e.setAttribute("stroke","#787878"),e.setAttribute("stroke-width","1")}this.path.setAttribute("d",this.buildD())}buildD(){return this.startX=this.parentNode.x+this.parentNode.w-10,this.startY=this.parentNode.y+this.parentNode.h/2,this.endX=this.childNode.x,this.endY=this.childNode.y+this.childNode.h/2,"M"+this.startX+","+this.startY+" C"+this.startX+","+this.endY+","+this.startX+","+this.endY+","+this.endX+","+this.endY}}class Yt{constructor(e){this.container=e,this.paper=this.initPaper(),this.width=0,this.height=0,this.nodes=[],this.connections=[]}initPaper(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");return e.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),e.setAttribute("version","1.1"),e.setAttribute("height","100%"),e.setAttribute("style","overflow: hidden; position: relative;"),this.container.innerHTML="",this.container.appendChild(e),e}initTree(e){this.state="INITING",this.rootNode=new Pt(this,null,e),this.nodes.push(this.rootNode),this.state="READY",this.traverse()}traverse(){"READY"==this.state&&i.default.nextTick((()=>{this.width=0,this.height=0,this.rootNode.traverse(),this.connections.forEach((e=>e.drawPath())),this.nodes.forEach((e=>e.setPosition())),this.container.style.width=this.width+5+"px",this.container.style.height=this.height+20+"px",this.paper.setAttribute("width",this.width)}))}newNode(e,t){let s;return s="CONDITION"==e.nodeType?new Vt(this,t,e):"ACTION"==e.nodeType?new Jt(this,t,e):new Pt(this,t,e),this.nodes.push(s),this.connections.push(new Zt(this,t,s)),s}deleteNode(e){let t=this.nodes.indexOf(e);-1!=t&&(this.nodes.splice(t,1),t=this.connections.indexOf(e.connection),-1!=t&&this.connections.splice(t,1))}startTransaction(e,t=!0){this.freeze(),e(),this.unfreeze(),t&&this.traverse()}freeze(){this.state="FREEZE"}unfreeze(){this.state="READY"}destroy(){this.nodes.forEach((e=>e.destroy()))}}const Kt={name:"index",components:{deleteBtn:Te,testBtn:ft,referBtn:Ne,importBtn:rt,assetsValidation:wt,assetsToolbar:Me},props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},watch:{assets:{deep:!0,handler:function(){}}},data:()=>({attrs:[],tree:{children:[]},showAttrDialog:!1,showFireRules:!0,originalTree:null,stack:[],branchNum:0,context:null,fullscreen:!1}),mounted(){this.initTree()},methods:{initTree(){if(this.assets.content){const e=JSON.parse(this.assets.content);e.tree&&(this.attrs=e.attrs,this.originalTree=e.tree,this.filterRules())}else this.attrs=[],this.tree={fact:{},children:[]},this.renderTree()},importTpl(e){this.assets.content=e,this.initTree()},saveCallback(e){e(JSON.stringify({attrs:this.attrs,tree:this.tree}))},ruletreeTemplate(){this.$emit("addTemplate")},refresh(e){if(!0===e.changeVersion){const t=JSON.parse(e.content);t.tree?(this.attrs=t.attrs,this.tree=t.tree):(this.attrs=[],this.tree={fact:{},children:[]}),this.renderTree()}else this.$emit("refresh",e)},renderTree(){this.$nextTick((()=>{const e=new Yt(this.$refs.treeContainer);e.readonly=this.readonly,e.initTree(this.tree),this.context=e}))},filterRules(){if(0==this.fireRules.length||!this.showFireRules)return this.tree.fact=this.originalTree.fact,this.tree.children=this.originalTree.children,void this.renderTree();this.stack=[],this.branchNum=0,this.tree.fact=this.originalTree.fact,this.tree.children=[],this.traversal(this.originalTree),this.renderTree()},traversal(e){this.pushStack(e),e.children&&0!=e.children.length?e.children.forEach((t=>{t._parent=e,this.traversal(t)})):this.handleStack()},pushStack(e){if(0!=this.stack.length){for(;this.stack[this.stack.length-1]!=e._parent;)this.stack.pop();this.stack.push(e)}else this.stack.push(e)},handleStack(){this.branchNum++,this.fireRules.forEach((e=>{if((this.assets.versionNo?parseInt(e.substring(`决策树-${this.assets.name}_V${this.assets.versionNo}-`.length)):parseInt(e.substring(`决策树-${this.assets.name}-`.length)))==this.branchNum){let e=this.tree;this.stack.forEach(((t,s)=>{if(s>0){const i={};Object.keys(t).forEach((e=>{"children"==e||e.startsWith("_")||(i[e]=t[e])})),s<this.stack.length-1&&(i.children=[]),e.children.push(i),e=i}}))}}))}},destroyed(){this.context.destroy()}};var Xt=(0,A.Z)(Kt,Nt,[],!1,null,"76afc756",null);Xt.options.__file="src/view/decision/project/ruletree/index.vue";const Qt=Xt.exports;var es=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:{fullscreen:e.fullscreen}},[e.readonly?e._e():s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",[s("el-col",{staticClass:"toolbar"},[s("div",{staticClass:"pin"},[s("save-btn",{attrs:{assets:e.assets},on:{callback:e.saveCallback,refresh:e.refresh,template:e.scorecardTemplate}}),e._v(" "),s("test-btn",{attrs:{assets:e.assets}}),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{icon:"el-icon-plus"},on:{click:e.addRow}},[e._v("添加行")]):e._e(),e._v(" "),s("import-btn",{attrs:{assets:e.assets},on:{importTpl:e.importTpl}}),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-validation",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",[s("el-col",[e.$hasPerm("project.asset:edit")&&!e.readonly?s("el-button",{attrs:{type:"text"},on:{click:function(t){e.showAttrDialog=!0}}},[e._v("设置属性")]):e._e(),e._v(" "),e._l(e.scorecard.attrs,(function(t,i){return s("el-tag",{key:t.name,staticStyle:{"margin-right":"10px"},attrs:{size:"small",type:"warning",closable:!e.readonly},on:{close:function(t){return e.scorecard.attrs.splice(i,1)}}},[e._v("\n        "+e._s(e.$attr.getLabel(t.name))+"： "+e._s(t.value)+"\n      ")])})),e._v(" "),s("el-form",{staticStyle:{"margin-top":"5px"},attrs:{inline:!0}},[s("el-form-item",{attrs:{label:"支持权重："}},[s("el-switch",{attrs:{disabled:e.readonly},model:{value:e.scorecard.weight,callback:function(t){e.$set(e.scorecard,"weight",t)},expression:"scorecard.weight"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"评分计算方式："}},[s("el-select",{staticStyle:{width:"100px"},attrs:{size:"mini",placeholder:"请选择",disabled:e.readonly},model:{value:e.scorecard.scoringType,callback:function(t){e.$set(e.scorecard,"scoringType",t)},expression:"scorecard.scoringType"}},[s("el-option",{attrs:{label:"求和",value:"SUM"}}),e._v(" "),s("el-option",{attrs:{label:"求积",value:"MUL"}}),e._v(" "),s("el-option",{attrs:{label:"模型评分转换",value:"MODELTRANSFORM"}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"初始评分："}},[s("el-input-number",{staticStyle:{width:"100px"},attrs:{size:"mini",controls:!1,disabled:e.readonly},model:{value:e.scorecard.defaultScore,callback:function(t){e.$set(e.scorecard,"defaultScore",t)},expression:"scorecard.defaultScore"}})],1),e._v(" "),s("br"),e._v(" "),s("el-form-item",{attrs:{label:"将评分赋给："}},[s("fact",{attrs:{"input-type":"Double",readonly:e.readonly},model:{value:e.scorecard.assign,callback:function(t){e.$set(e.scorecard,"assign",t)},expression:"scorecard.assign"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"将原因码赋给："}},[s("fact",{attrs:{"input-type":"String",readonly:e.readonly},model:{value:e.scorecard.reasonCodes,callback:function(t){e.$set(e.scorecard,"reasonCodes",t)},expression:"scorecard.reasonCodes"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"将原因信息赋给："}},[s("fact",{attrs:{"input-type":"String",readonly:e.readonly},model:{value:e.scorecard.reasonMsgs,callback:function(t){e.$set(e.scorecard,"reasonMsgs",t)},expression:"scorecard.reasonMsgs"}})],1)],1)],2)],1),e._v(" "),s("el-row",[s("el-col",[e.fireRules.length>0?s("el-switch",{staticStyle:{"margin-bottom":"10px"},attrs:{"active-text":"仅显示触发规则"},on:{change:e.filterRules},model:{value:e.showFireRules,callback:function(t){e.showFireRules=t},expression:"showFireRules"}}):e._e(),e._v(" "),s("el-table",{staticClass:"scorecard-table",attrs:{data:e.scorecard.rows,"row-key":e.rowKey,border:"","span-method":e.rowspan}},[s("el-table-column",{attrs:{label:"字段",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?[t.row.fact?s("span",{domProps:{innerHTML:e._s(e.getLeftText(t.row.fact))}}):s("span",[e._v("请选择")])]:[s("fact",{on:{change:function(s,i){return e.changeField(s,i,t.$index)}},model:{value:t.row.fact,callback:function(s){e.$set(t.row,"fact",s)},expression:"scope.row.fact"}}),e._v(" "),s("i",{staticClass:"el-icon-delete icon-btn-mini",on:{click:function(s){return e.deleteRowGroup(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-plus icon-btn-mini",on:{click:function(s){return e.insertRow(t)}}})],e._v(" "),e.scorecard.weight?s("div",[s("label",[e._v("权重：")]),e._v(" "),s("el-input-number",{attrs:{size:"small",controls:!1,min:0,max:1,disabled:e.readonly},model:{value:t.row.weight,callback:function(s){e.$set(t.row,"weight","string"==typeof s?s.trim():s)},expression:"scope.row.weight"}})],1):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"condition",label:"条件",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?[t.row.fact?s("span",{domProps:{innerHTML:e._s(e.$lhs.getText(t.row.condition))}}):s("span",[e._v("-")])]:[t.row.fact?s("lhs-editor",{attrs:{"left-type":e.getLeftType(t.row.fact)},model:{value:t.row.condition,callback:function(s){e.$set(t.row,"condition",s)},expression:"scope.row.condition"}}):s("span",[e._v("-")]),e._v(" "),s("i",{staticClass:"el-icon-delete icon-btn-mini",on:{click:function(s){return e.deleteRow(t)}}}),e._v(" "),s("i",{staticClass:"el-icon-document-copy icon-btn-mini",on:{click:function(s){return e.copyRow(t)}}})]]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"score",align:"center",label:null!=e.scorecard.scoreLabel&&""!=e.scorecard.scoreLabel.trim()?e.scorecard.scoreLabel:"分值","render-header":e.renderScoreHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[s("expression",{attrs:{"input-type":"Double",readonly:e.readonly},model:{value:t.row.score,callback:function(s){e.$set(t.row,"score",s)},expression:"scope.row.score"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"原因码",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?s("span",[e._v(e._s(t.row.reasonCode))]):s("el-popover",{on:{"after-enter":function(s){e.$refs["reasonCode_"+t.$index].focus()}}},[s("el-input",{ref:"reasonCode_"+t.$index,model:{value:t.row.reasonCode,callback:function(s){e.$set(t.row,"reasonCode",s)},expression:"scope.row.reasonCode"}}),e._v(" "),s("el-link",{attrs:{slot:"reference",underline:!1},slot:"reference"},[e._v("\n                "+e._s(t.row.reasonCode?t.row.reasonCode:"-")+"\n              ")])],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"原因信息",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?s("span",[e._v(e._s(t.row.reasonMsg))]):s("el-popover",{on:{"after-enter":function(s){e.$refs["reasonMsg_"+t.$index].focus()}}},[s("el-input",{ref:"reasonMsg_"+t.$index,model:{value:t.row.reasonMsg,callback:function(s){e.$set(t.row,"reasonMsg",s)},expression:"scope.row.reasonMsg"}}),e._v(" "),s("el-link",{attrs:{slot:"reference",underline:!1},slot:"reference"},[e._v("\n                "+e._s(t.row.reasonMsg?t.row.reasonMsg:"-")+"\n              ")])],1)]}}])})],1)],1)],1),e._v(" "),s("attr",{attrs:{show:e.showAttrDialog},on:{"update:show":function(t){e.showAttrDialog=t}},model:{value:e.scorecard.attrs,callback:function(t){e.$set(e.scorecard,"attrs",t)},expression:"scorecard.attrs"}})],1)};es._withStripped=!0;const ts={name:"index",components:{lhs:Qe,deleteBtn:Te,testBtn:ft,referBtn:Ne,importBtn:rt,assetsValidation:wt,assetsToolbar:Me},props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},data(){const e={name:this.assets.name,attrs:[],weight:!1,scoringType:"SUM",assign:{},scoreLabel:null,rows:[],defaultScore:0,reasonCodes:{},reasonMsgs:{}};return{saveLoading:!1,empty:e,scorecard:JSON.parse(JSON.stringify(e)),showAttrDialog:!1,showVersionDialog:!1,showFireRules:!0,fullscreen:!1}},mounted(){this.initData()},methods:{initData(){this.assets.content?this.filterRules():this.scorecard=this.$utils.copy(this.empty)},importTpl(e){this.assets.content=e,this.initData()},renderScoreHeader(e,{column:t,$index:s}){return this.readonly?e("span",[t.label]):e("span",[t.label,e("el-popover",[e("el-input",{model:{value:this.scorecard.scoreLabel,callback:e=>{this.$set(this.scorecard,"scoreLabel",e)}}}),e("i",{class:"el-icon-edit",style:"cursor: pointer;",slot:"reference"})])])},addRow(){this.scorecard.rows.push({})},getLeftText(e){return this.$store.getters.getFactText(e.id,e.fieldId)},rowspan({row:e,column:t,rowIndex:s,columnIndex:i}){if(0===i){const e=this.scorecard.rows,t=e[s];if(!t.fact)return[1,1];if(s>0){const i=e[s-1];if(i.fact&&t.fact.id==i.fact.id&&t.fact.fieldId==i.fact.fieldId)return[0,0]}let i=1;for(let a=s+1;a<e.length;a++){const s=e[a];if(!s.fact||t.fact.id!=s.fact.id||t.fact.fieldId!=s.fact.fieldId)break;i++}return[i,1]}},insertRow(e){let t;const s=this.scorecard.rows,i=e.row;if(i.fact)for(let a=e.$index;a<s.length;a++){const e=s[a];if(!e.fact||i.fact.id!=e.fact.id||i.fact.fieldId!=e.fact.fieldId)break;t=a}else t=e.$index;i.fact?s.splice(t+1,0,{fact:this.$utils.copy(i.fact)}):s.splice(t+1,0,{})},copyRow(e){let t=this.$utils.copy(e.row);t._id=this.$utils.randomCode(10),this.scorecard.rows.splice(e.$index+1,0,t)},deleteRow(e){this.scorecard.rows.splice(e.$index,1)},deleteRowGroup(e){const t=this.scorecard.rows,s=t[e.$index];if(!s.fact)return void t.splice(e.$index,1);let i=1;for(let a=e.$index+1;a<t.length;a++){const e=t[a];if(!e.fact||s.fact.id!=e.fact.id||s.fact.fieldId!=e.fact.fieldId)break;i++}t.splice(e.$index,i)},rowKey(e){return e._id||(e._id=this.$utils.randomCode(4)),e._id},scorecardTemplate(){this.$emit("addTemplate")},saveCallback(e){let t=this.scorecard.rows;this.scorecard.weight?t.forEach(((e,s)=>{if(s>0){const e=t[s-1],i=t[s];e.fact&&i.fact&&e.fact.id==i.fact.id&&e.fact.fieldId==i.fact.fieldId&&(t[s].weight=t[s-1].weight)}})):t.forEach((e=>{delete e.weight}));const s=this.$utils.copy(this.scorecard);this.$utils.clearTmpKey(s),e(JSON.stringify(s))},getLeftType(e){return this.$store.getters.getExpressionType({type:"FACT",fact:e})},refresh(e){!0===e.changeVersion?this.scorecard=JSON.parse(e.content):this.$emit("refresh",e)},changeField(e,t,s){if(!t)return;const i=this.scorecard.rows;for(let a=s+1,o=i.length;a<o;a++){const s=i[a];if(!s.fact||t.id!=s.fact.id||t.fieldId!=s.fact.fieldId)break;s.fact={id:e.id,fieldId:e.fieldId}}},filterRules(){const e=JSON.parse(this.assets.content);if(this.fireRules.length>0&&this.showFireRules){const t=[];this.fireRules.forEach((s=>{const i=this.assets.versionNo?s.substring(`评分卡-${this.assets.name}_V${this.assets.versionNo}-`.length):s.substring(`评分卡-${this.assets.name}-`.length),a=parseInt(i.substring(1,i.length-1));a&&e.rows.forEach(((e,s)=>{a==s+1&&t.push(e)}))})),e.rows=t}this.scorecard=e}}};var ss=(0,A.Z)(ts,es,[],!1,null,"a1d86fc6",null);ss.options.__file="src/view/decision/project/scorecard/index.vue";const is=ss.exports;var as=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("div",{ref:"wrapper",class:{fullscreen:t.fullscreen}},[t.readonly?t._e():i("assets-toolbar",{attrs:{fullscreen:t.fullscreen},on:{"update:fullscreen":function(e){t.fullscreen=e}}}),t._v(" "),t.readonly?t._e():i("el-row",{ref:"toolbar",staticClass:"toolbar"},[i("el-col",[i("save-btn",{attrs:{assets:t.assets},on:{callback:t.saveCallback,refresh:t.refresh}}),t._v(" "),i("test-btn",{attrs:{assets:t.assets}}),t._v(" "),i("assets-editor-dialog",{attrs:{assets:t.assets},on:{refresh:t.refresh}}),t._v(" "),i("delete-btn",{attrs:{assets:t.assets},on:{delete:function(e){t.$emit("delete",e)}}})],1)],1),t._v(" "),i("el-row",{staticStyle:{"margin-bottom":"0px"}},[i("el-col",[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.diagramLoading,expression:"diagramLoading"}],staticClass:"diagram-wrap",attrs:{"element-loading-text":"初始化编辑框..."}},[t.readonly?t._e():i("div",{staticClass:"diagram-palette",attrs:{id:"paletteDiv"+t.date}}),t._v(" "),i("div",{staticClass:"diagram-main",style:{height:t.diagramHeight},attrs:{id:"diagramDiv"+t.date}}),t._v(" "),i("ul",{ref:"contextMenu",staticClass:"el-dropdown-menu el-popper",staticStyle:{top:"-1000px","transform-origin":"center bottom 0px"}},[i("li",{ref:"contextMenu-setRule",staticClass:"el-dropdown-menu__item",on:{click:function(e){return t.cxcommand(0)}}},[i("i",{staticClass:"iconfont iconguize"}),t._v("\n            "+t._s(t.readonly?"查看规则":"设置规则")+"\n          ")]),t._v(" "),i("li",{ref:"contextMenu-setDecision",staticClass:"el-dropdown-menu__item",on:{click:function(e){return t.cxcommand(1)}}},[i("i",{staticClass:"iconfont iconfenzhijiedian"}),t._v("\n            "+t._s(t.readonly?"查看决策":"设置决策")+"\n          ")]),t._v(" "),i("li",{ref:"contextMenu-setScript",staticClass:"el-dropdown-menu__item",on:{click:function(e){return t.cxcommand(2)}}},[i("i",{staticClass:"iconfont iconjiaobenrenwu"}),t._v("\n            "+t._s(t.readonly?"查看脚本":"设置脚本")+"\n          ")]),t._v(" "),i("li",{ref:"contextMenu-delNode",staticClass:"el-dropdown-menu__item",on:{click:function(e){return t.cxcommand(3)}}},[i("i",{staticClass:"el-icon-delete"}),t._v("\n            删除节点\n          ")])])])])],1),t._v(" "),i("el-dialog",{attrs:{title:"规则文件列表",top:t.$dialogTop,width:"60%",visible:t.showRuleEditDialog,"append-to-body":""},on:{"update:visible":function(e){t.showRuleEditDialog=e}}},[t.readonly?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:t.rules.length>0},on:{click:t.addRule}},[t._v("添加规则文件")]),t._v(" "),i("el-table",{attrs:{data:t.rules}},[i("el-table-column",{attrs:{prop:"name",label:"文件名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"versionNo",label:"版本号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.versionNo||0==e.row.versionNo?"V"+e.row.versionNo:""))]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"版本描述"},scopedSlots:t._u([{key:"default",fn:function(e){return e.row.versionDes?[e.row.versionDes.length<12?i("span",[t._v(t._s(e.row.versionDes))]):i("el-tooltip",{attrs:{placement:"top",content:e.row.versionDes}},[i("span",[t._v(t._s(e.row.versionDes.length>12?e.row.versionDes.substring(0,12)+"...":e.row.versionDes))])])]:void 0}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return e.row.createTime?[t._v("\n              "+t._s(t._f("formatDateTime")(e.row.createTime))+"\n            ")]:void 0}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:"文件类型",formatter:function(t){return e.$utils.getAssetsTypeText(t.type)}}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),t.viewAssets(e.row)}}},[t._v("查看")]),t._v(" "),t.readonly?t._e():i("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),t.delRule(e)}}},[t._v("删除")])]}}])})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showRuleEditDialog=!1}}},[t._v("取 消")]),t._v(" "),t.readonly?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:t.submitEditRule}},[t._v("确 定")])],1),t._v(" "),i("el-dialog",{attrs:{title:"添加规则文件",top:t.$dialogTop,width:"60%",visible:t.showRuleAddDialog,"append-to-body":""},on:{"update:visible":function(e){t.showRuleAddDialog=e},closed:t.closedSearch}},[i("div",{staticClass:"searchContent"},[i("el-input",{staticClass:"search",staticStyle:{width:"220px"},attrs:{placeholder:"搜索"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.searchName,callback:function(e){t.searchName=e},expression:"searchName"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:t.search},slot:"suffix"})])],1),t._v(" "),i("el-tabs",{staticClass:"tbContent",attrs:{type:"border-card"}},t._l(t.ruleGroup,(function(e){return i("el-tab-pane",{key:e.type,attrs:{label:e.type}},[i("el-table",{staticClass:"tb-edit",staticStyle:{height:"300px","overflow-y":"auto"},attrs:{data:e.list,"highlight-current-row":""},on:{"cell-click":t.cellClick}},[i("el-table-column",{attrs:{prop:"name",label:"文件名称"}}),t._v(" "),i("el-table-column",{staticStyle:{width:"60%"},attrs:{label:"版本号",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{ref:"input_original_"+e.row.uuid,refInFor:!0,staticClass:"scopSelect",attrs:{placeholder:"请选择"},on:{change:function(s){return t.selectVerion(e.row)}},model:{value:e.row.select,callback:function(s){t.$set(e.row,"select",s)},expression:"scope.row.select"}},t._l(e.row.assetsVersions,(function(e,t){return i("el-option",{key:t,attrs:{value:e.versionNo,label:"V"+e.versionNo}})})),1),t._v(" "),i("span",{staticClass:"originSelect"},[t._v(t._s("V"+e.row.select))])]}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{label:"版本描述"},scopedSlots:t._u([{key:"default",fn:function(e){return e.row.versionDes?[e.row.versionDes.length<12?i("span",[t._v(t._s(e.row.versionDes))]):i("el-tooltip",{attrs:{placement:"top",content:e.row.versionDes}},[i("span",[t._v(t._s(e.row.versionDes.length>12?e.row.versionDes.substring(0,12)+"...":e.row.versionDes))])])]:void 0}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n              "+t._s(t._f("formatDateTime")(e.row.createTime))+"\n            ")]}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(s){return[i("el-button",{attrs:{type:"text"},on:{click:function(e){return e.stopPropagation(),t.viewAssets(s.row)}}},[t._v("查看")]),t._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){return i.stopPropagation(),t.submitAddRule(s.row,s.$index,e.list)}}},[t._v("添加")])]}}],null,!0)})],1)],1)})),1)],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.readonly?"查看决策":"设置决策",visible:t.showDecisionEditDialog,"append-to-body":""},on:{"update:visible":function(e){t.showDecisionEditDialog=e}}},[i("el-form",{attrs:{model:t.decisionForm,"label-width":"80px",inline:!0}},[i("el-form-item",{attrs:{label:"分支类型"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:t.readonly},model:{value:t.decisionForm.type,callback:function(e){t.$set(t.decisionForm,"type",e)},expression:"decisionForm.type"}},[i("el-option",{attrs:{label:"条件",value:"CONDITION"}}),t._v(" "),i("el-option",{attrs:{label:"百分比",value:"PERCENTAGE"}})],1)],1),t._v(" "),"CONDITION"==t.decisionForm.type?i("el-form-item",{attrs:{label:"策略配置"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:t.readonly},model:{value:t.decisionForm.strategy,callback:function(e){t.$set(t.decisionForm,"strategy",e)},expression:"decisionForm.strategy"}},[i("el-option",{attrs:{label:"XOR",value:"XOR"}}),t._v(" "),i("el-option",{attrs:{label:"OR",value:"OR"}})],1),t._v(" "),i("el-tooltip",[i("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n            XOR：仅流向第一条满足条件的分支\n            "),i("br"),t._v("\n            OR：流向所有满足条件的分支\n          ")]),t._v(" "),i("i",{staticClass:"el-icon-question"})])],1):t._e()],1),t._v(" "),t.showDecisionEditDialog?i("el-table",{attrs:{data:t.decisionForm.connections}},[i("el-table-column",{attrs:{label:"CONDITION"==t.decisionForm.type?"条件":"百分比(单位%)"},scopedSlots:t._u([{key:"default",fn:function(e){return["CONDITION"==t.decisionForm.type?[i("lhs-editor",{attrs:{readonly:t.readonly},model:{value:e.row.lhs,callback:function(s){t.$set(e.row,"lhs",s)},expression:"scope.row.lhs"}})]:[i("el-input-number",{attrs:{controls:!1,disabled:t.readonly,precision:0,min:0,max:t.maxPercentage(e.$index)},model:{value:e.row.percentage,callback:function(s){t.$set(e.row,"percentage",s)},expression:"scope.row.percentage"}})]]}}],null,!1,1798074835)}),t._v(" "),i("el-table-column",{attrs:{label:"流向"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{attrs:{placeholder:"请选择",disabled:t.readonly},model:{value:e.row.key,callback:function(s){t.$set(e.row,"key",s)},expression:"scope.row.key"}},t._l(t.decisionForm.toNodes,(function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1)]}}],null,!1,4187221402)})],1):t._e(),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showDecisionEditDialog=!1}}},[t._v("取 消")]),t._v(" "),t.readonly?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:t.submitEditDecision}},[t._v("确 定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:t.readonly?"查看脚本":"设置脚本",visible:t.showScriptEditDialog,"append-to-body":""},on:{"update:visible":function(e){t.showScriptEditDialog=e}}},[i("rhs",{attrs:{"from-flow":!0,readonly:t.readonly},model:{value:t.script.rhs,callback:function(e){t.$set(t.script,"rhs",e)},expression:"script.rhs"}}),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showScriptEditDialog=!1}}},[t._v("取 消")]),t._v(" "),t.readonly?t._e():i("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:t.submitEditScript}},[t._v("确 定")])],1)],1),t._v(" "),i("assets-view",{attrs:{"assets-uuid":t.viewingAssets.uuid,"assets-version":t.viewingAssets.version,show:t.viewingAssets.show},on:{"update:show":function(e){return t.$set(t.viewingAssets,"show",e)}}})],1)};as._withStripped=!0;var os=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("span",{staticStyle:{color:"rgb(255, 0, 0)"}},[e._v(e._s(e.text))]):s("dropdown",{on:{command:e.changeOp}},[s("span",{staticClass:"el-dropdown-link dashed-wrapper",staticStyle:{color:"rgb(255, 0, 0)"}},[e._v(e._s(e.text))]),e._v(" "),e.items.length>0?s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.items,(function(t,i){return s("dropdown-item",{key:i,attrs:{command:t.value}},[e._v(e._s(t.text))])})),1):s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{disabled:""}},[e._v("无")])],1)],1)};os._withStripped=!0;const ns={name:"op",props:{value:String,inputType:[String,Object],readonly:{type:Boolean,default:!1}},computed:{items:function(){return this.$op.filterItems(this.inputType)},text:function(){return this.$op.getText(this.op)||"操作符"}},watch:{inputType:function(e,t){if(e!=t&&this.op){let e=!1,t=this.items;t.some((t=>{if(t.value==this.op)return e=!0,!0})),e||(t.length>0?this.changeOp(t[0].value):this.changeOp(null))}}},data(){return{op:this.value}},mounted(){if(!this.op){const e=this.items;e.length>0&&this.changeOp(e[0].value)}},methods:{changeOp(e){this.op=e,this.$emit("input",e),this.$emit("draw")}}};var rs=(0,A.Z)(ns,os,[],!1,null,"47049bf2",null);rs.options.__file="src/view/decision/project/components/op.vue";const ls=rs.exports;let cs=null,ds=null;const us={name:"index",components:{lhs:Qe,rhs:it,op:ls,deleteBtn:Te,testBtn:ft,assetsToolbar:Me},props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},watch:{readonly:function(e,t){!0===t&&!0!==e&&this.$nextTick((()=>{this.initPalette(),this.diagram.isReadOnly=!1}))},fullscreen:function(){this.setDiagramHeight()}},data:()=>({saveLoading:!1,palette:null,diagram:null,flow:{},showRuleEditDialog:!1,showRuleAddDialog:!1,showDecisionEditDialog:!1,rules:[],ruleGroup:[],activeNode:null,decisionForm:{},showScriptEditDialog:!1,script:{},date:(new Date).valueOf(),saveVersionLoading:!1,showNewVersionDialog:!1,searchName:"",sName:"",sDirName:"",nowVersion:[],targetVersion:[],viewingAssets:{uuid:"",version:0,show:!1},diagramLoading:!1,diagramHeight:"100%",fullscreen:!1}),mounted(){window.addEventListener("resize",this.setDiagramHeight),this.setDiagramHeight(),this.initData(),this.initGoJS()},destroyed(){window.removeEventListener("resize",this.setDiagramHeight)},methods:{async initGoJS(){null==cs&&(this.diagramLoading=!0,cs=await s.e(160).then(s.t.bind(s,7160,23)),ds=cs.GraphObject.make,this.diagramLoading=!1),this.initDiagram(),this.readonly||this.initPalette()},textStyle:()=>({font:"bold 11pt Helvetica, Arial, sans-serif",stroke:"whitesmoke"}),nodeStyle:()=>[new cs.Binding("location","loc",cs.Point.parse).makeTwoWay(cs.Point.stringify),{locationSpot:cs.Spot.Center}],initData(){this.assets.content?this.flow=JSON.parse(this.assets.content):this.flow={}},initDiagram(){const e=ds(cs.Diagram,"diagramDiv"+this.date,{initialContentAlignment:cs.Spot.Center,allowDrop:!0,scrollsPageOnFocus:!1,isReadOnly:!0===this.readonly,"grid.gridCellSize":new cs.Size(30,20),"draggingTool.isGridSnapEnabled":!0,"resizingTool.isGridSnapEnabled":!0,"rotatingTool.snapAngleMultiple":90,"rotatingTool.snapAngleEpsilon":45,"undoManager.isEnabled":!0,ExternalObjectsDropped:t=>{let s,i=0;for(var a=e.nodes.iterator;a.next();)"Start"==a.value.data.category&&i++;for(a=t.subject.iterator;a.next();)"Start"==a.value.data.category&&i>1&&(s=!0);s&&(e.commandHandler.deleteSelection(),this.$message.warning("只能有一个开始节点"))}});var t=this.$refs.contextMenu,s=ds(cs.HTMLInfo,{show:function(e,s,a){const o=e.part.data.category;if(i.readonly&&("Start"==o||"Diverge"==o||"Converge"==o))return;if(s.div.id=="paletteDiv"+i.date)return;i.activeNode=e.part,i.$refs["contextMenu-setRule"].style.display="Rule"==o?"block":"none",i.$refs["contextMenu-setDecision"].style.display="Decision"==o?"block":"none",i.$refs["contextMenu-setScript"].style.display="Script"==o?"block":"none",i.readonly&&(i.$refs["contextMenu-delNode"].style.display="none");const n=s.lastInput.viewPoint;let r=n.x,l=n.y;r+t.offsetWidth>s.div.offsetWidth&&(r-=t.offsetWidth),l+t.offsetHeight>s.div.offsetHeight&&(l-=t.offsetHeight),i.readonly?t.style.left=r+"px":t.style.left=r+120+"px",t.style.top=l+"px"},hide:this.hideContextMenu,mainElement:t});t.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1}),!1);const i=this;e.nodeTemplateMap.add("Start",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"Circle",{fill:"#79C900",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!1,toMaxLinks:0}),ds(cs.TextBlock,"开始",i.textStyle(),{editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.nodeTemplateMap.add("Rule",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"RoundedRectangle",{fill:"#faaa00",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new cs.Binding("figure","figure")),ds(cs.TextBlock,"规则",i.textStyle(),{margin:8,maxSize:new cs.Size(160,NaN),wrap:cs.TextBlock.WrapFit,editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.nodeTemplateMap.add("Decision",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"Diamond",{fill:"#56abe4",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new cs.Binding("figure","figure")),ds(cs.TextBlock,"决策",i.textStyle(),{margin:8,maxSize:new cs.Size(160,NaN),wrap:cs.TextBlock.WrapFit,editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.nodeTemplateMap.add("Diverge",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"Diamond",{fill:"#eb4f38",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new cs.Binding("figure","figure")),ds(cs.TextBlock,"分支",i.textStyle(),{margin:8,maxSize:new cs.Size(160,NaN),wrap:cs.TextBlock.WrapFit,editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.nodeTemplateMap.add("Converge",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"Diamond",{fill:"#ae58a7",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1/0},new cs.Binding("figure","figure")),ds(cs.TextBlock,"聚合",i.textStyle(),{margin:8,maxSize:new cs.Size(160,NaN),wrap:cs.TextBlock.WrapFit,editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.nodeTemplateMap.add("Script",ds(cs.Node,"Table",i.nodeStyle(),{contextMenu:s},ds(cs.Panel,"Auto",ds(cs.Shape,"RoundedRectangle",{fill:"#669999",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new cs.Binding("figure","figure")),ds(cs.TextBlock,"脚本",i.textStyle(),{margin:8,maxSize:new cs.Size(160,NaN),wrap:cs.TextBlock.WrapFit,editable:!0},new cs.Binding("text","name").makeTwoWay())))),e.linkTemplate=ds(cs.Link,{routing:cs.Link.AvoidsNodes,curve:cs.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,resegmentable:!0,mouseEnter:function(e,t){t.findObject("HIGHLIGHT").stroke="rgba(30,144,255,0.2)"},mouseLeave:function(e,t){t.findObject("HIGHLIGHT").stroke="transparent"},selectionAdorned:!1},new cs.Binding("points").makeTwoWay(),ds(cs.Shape,{isPanelMain:!0,strokeWidth:8,stroke:"transparent",name:"HIGHLIGHT"}),ds(cs.Shape,{isPanelMain:!0,stroke:"gray",strokeWidth:2},new cs.Binding("stroke","isSelected",(function(e){return e?"dodgerblue":"gray"})).ofObject()),ds(cs.Shape,{toArrow:"standard",strokeWidth:0,fill:"gray"}),ds(cs.Panel,"Auto",{name:"LABEL",segmentIndex:2,segmentFraction:.5},new cs.Binding("visible","visible").makeTwoWay(),ds(cs.Shape,"RoundedRectangle",{visible:!1,fill:"#F8F8F8",strokeWidth:0}),ds(cs.TextBlock,{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#333333",editable:!0,textEdited:(e,t,s)=>{const i=e.panel.findMainElement();(s=s.trim())?(e.text=s.trim(),i.visible=!0):i.visible=!1}},new cs.Binding("text").makeTwoWay()))),e.toolManager.linkingTool.temporaryLink.routing=cs.Link.Orthogonal,e.toolManager.relinkingTool.temporaryLink.routing=cs.Link.Orthogonal,e.toolManager.linkingTool.linkValidation=(e,t,s,i,a)=>{let o=!0;for(var n=e.linksConnected.iterator;n.next();)if(n.value.fromNode==s||n.value.toNode==s){o=!1;break}return o};const a=cs.Model.fromJson(this.flow);e.model=ds(cs.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:a.nodeDataArray,linkDataArray:a.linkDataArray});const o=e.commandHandler;o.pasteSelection=t=>{t||(t=e.lastInput.documentPoint),cs.CommandHandler.prototype.pasteSelection.call(o,t)},this.diagram=e,this.fireRules.length>0&&this.fireRules.forEach((t=>{const s=t.substring(t.lastIndexOf("-")),i=e.findNodeForKey(s);if(i){const e=ds(cs.Adornment,"Auto",ds(cs.Shape,{fill:null,stroke:"red",strokeWidth:3}),ds(cs.Placeholder,{margin:0})).copy();e.adornedObject=i,e.location=i.position,i.addAdornment("diff",e)}}))},initPalette(){this.palette=ds(cs.Palette,"paletteDiv"+this.date,{scrollsPageOnFocus:!1,nodeTemplateMap:this.diagram.nodeTemplateMap,model:ds(cs.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:[{category:"Start",name:"开始"},{category:"Rule",name:"规则"},{category:"Script",name:"脚本"},{category:"Decision",name:"决策"},{category:"Diverge",name:"分支"},{category:"Converge",name:"聚合"}]})})},cxcommand(e){0==e?this.editRule():1==e?this.editDecision():2==e?this.editScript():3==e&&this.diagram.commandHandler.deleteSelection(),this.hideContextMenu()},editRule(){this.activeNode.data.rules?this.rules=this.$utils.copy(this.activeNode.data.rules):this.rules=[],this.showRuleEditDialog=!0},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.uuid][0];"版本号"==t.label&&a&&this.$nextTick((function(){a.toggleMenu()}))},addRule(){this.showRuleAddDialog=!0,this.$axios.get("/assets/query",{params:{projectUuid:this.assets.projectUuid,name:this.searchName}}).then((e=>{0==e.data.code&&(this.ruleGroup=[],e.data.data.forEach((e=>{"fact"!=e.type&&"constant"!=e.type&&(e.list.forEach((e=>{e.select=e.assetsVersions[0].versionNo,e.versionDes=e.assetsVersions[0].versionDes,e.createTime=e.assetsVersions[0].createTime})),"ruleflow"==e.type&&(e.list=e.list.filter((e=>e.uuid!=this.assets.uuid))),e.list=e.list.filter((e=>{let t=!1;return this.rules.some((s=>{if(e.uuid==s.uuid)return t=!0,!0})),!t})),e.type=this.$utils.getAssetsTypeText(e.type),this.ruleGroup.push(e))})))}))},submitEditRule(){this.activeNode.data.rules=this.rules,this.showRuleEditDialog=!1},search(){this.addRule()},closedSearch(){this.searchName="",this.sName="",this.sDirName="",this.checkList=[]},submitAddRule(e,t,s){if("ruleflow"==e.type){let e=!1;if(this.rules.some((t=>{if("ruleflow"==t.type)return e=!0,!0})),e)return void this.$message.warning("一个规则节点只能添加一个决策流")}this.rules.push({uuid:e.uuid,name:e.name,type:e.type,versionNo:e.select,versionDes:e.versionDes,createTime:e.createTime}),s.splice(t,1),this.$message.success("添加成功"),this.showRuleAddDialog=!1},delRule(e){this.rules.splice(e.$index,1)},selectVerion(e){e.assetsVersions.forEach((t=>{e.select==t.versionNo&&(e.versionDes=t.versionDes,e.createTime=t.createTime)}))},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.select?e.select:e.versionNo,this.viewingAssets.show=!0},editDecision(){this.activeNode.data.decision||(this.activeNode.data.decision={}),this.$set(this.decisionForm,"type",this.activeNode.data.decision.type||"CONDITION"),this.$set(this.decisionForm,"strategy",this.activeNode.data.decision.strategy||"XOR");let e=[],t=[];for(var s=this.activeNode.findLinksOutOf().iterator;s.next();){const i=s.value.toNode.data;let a,o;this.activeNode.data.decision.connections&&this.activeNode.data.decision.connections.some((e=>{if(e.key==i.key)return"CONDITION"==this.activeNode.data.decision.type?a=this.$utils.copy(e.lhs):o=e.percentage,!0})),e.push({key:i.key,lhs:a,percentage:o}),t.push({key:i.key,name:i.name})}this.decisionForm.connections=e,this.decisionForm.toNodes=t,this.showDecisionEditDialog=!0},maxPercentage(e){let t=100;return"PERCENTAGE"==this.decisionForm.type&&this.decisionForm.connections.forEach(((s,i)=>{e!=i&&s.percentage&&(t-=s.percentage)})),t},submitEditDecision(){const e=this.decisionForm.connections;if(e.length>1)for(let t=0;t<e.length;t++)for(let s=t+1;s<e.length;s++)if(e[t].key==e[s].key)return this.$message.warning("决策流向不能重复"),!1;let t=this.$utils.copy(this.decisionForm);t.connections.forEach((e=>{"CONDITION"==t.type?delete e.percentage:delete e.lhs})),this.activeNode.data.decision=t,this.showDecisionEditDialog=!1,this.decisionForm={}},editScript(){this.activeNode.data.script?this.script=this.$utils.copy(this.activeNode.data.script):this.script={},this.showScriptEditDialog=!0},submitEditScript(){this.activeNode.data.script=this.script,this.showScriptEditDialog=!1},getInputType(e,t){if(!e||!e.field)return null;if("字符串长度为"===t||"字符串长度不为"===t)return"Integer";{const t=this.$store.getters.getFactById(e.id,e.field.id);if(t&&t.fields.length>0)return t.fields[0].type}},saveCallback(e){this.flow=JSON.parse(this.diagram.model.toJSON()),e(JSON.stringify(this.flow))},refresh(e){if(!0===e.changeVersion){this.flow=JSON.parse(e.content);const t=cs.Model.fromJson(this.flow);this.diagram.model=ds(cs.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:t.nodeDataArray,linkDataArray:t.linkDataArray})}else this.$emit("refresh",e)},hideContextMenu(){this.$refs.contextMenu.style.top="-1000px"},setDiagramHeight(){if(this.fullscreen)this.$nextTick((()=>{const e=this.$refs.wrapper,t=this.$refs.toolbar.$el,s=window.getComputedStyle(e,null),i=window.getComputedStyle(t,null),a=parseInt(s.getPropertyValue("padding-top")),o=parseInt(s.getPropertyValue("padding-bottom")),n=parseInt(i.getPropertyValue("margin-bottom"));this.diagramHeight=window.innerHeight-t.offsetHeight-n-a-o-2+"px",this.updateDialogHeight()}));else try{if(-1!=this.$parent.$el.className.indexOf("el-dialog__wrapper")){const e=this.$parent.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=window.getComputedStyle(e,null),a=window.getComputedStyle(s,null),o=parseInt(i.getPropertyValue("margin-top")),n=parseInt(a.getPropertyValue("padding-top")),r=parseInt(a.getPropertyValue("padding-bottom"));this.diagramHeight=window.innerHeight-t.offsetHeight-n-r-2*o+"px",this.updateDialogHeight()}else setTimeout((()=>{this.diagramHeight=document.getElementById("assets-main").offsetHeight-40-document.getElementById("assets-header").offsetHeight-document.getElementById("assets-tabs").getElementsByClassName("el-tabs__header")[0].offsetHeight-30-(this.readonly?0:this.$refs.toolbar.$el.offsetHeight+10)-2+"px",this.updateDialogHeight()}),0)}catch(e){console.error(e),this.diagramHeight="500px",this.updateDialogHeight()}},updateDialogHeight(){null!=this.diagram&&(this.diagram.div.style.height=this.diagramHeight,this.diagram.requestUpdate()),null!=this.palette&&(this.palette.div.style.height=this.diagramHeight,this.palette.requestUpdate())}}};var ps=(0,A.Z)(us,as,[],!1,null,"cf0c1436",null);ps.options.__file="src/view/decision/project/ruleflow/index.vue";const hs=ps.exports;var ms=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{ref:"wrapper",class:{fullscreen:e.fullscreen}},[e.readonly?e._e():s("assets-toolbar",{attrs:{fullscreen:e.fullscreen},on:{"update:fullscreen":function(t){e.fullscreen=t}}}),e._v(" "),e.readonly?e._e():s("el-row",{ref:"toolbar",staticClass:"toolbar"},[s("el-col",[s("div",{staticClass:"pin"},[s("save-btn",{ref:"saveBtn",attrs:{assets:e.assets},on:{callback:e.saveCallback,refresh:e.refresh}}),e._v(" "),s("test-btn",{attrs:{assets:e.assets}}),e._v(" "),s("refer-btn",{attrs:{assets:e.assets}}),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("delete-btn",{attrs:{assets:e.assets},on:{delete:function(t){e.$emit("delete",t)}}})],1)])],1),e._v(" "),s("el-row",[s("el-container",[e.readonly?e._e():s("el-aside",{staticStyle:{background:"#fff","overflow-y":"hidden"},attrs:{width:"250px"}},[s("el-tree",{ref:"tree",staticClass:"rulescriptTree",attrs:{data:e.bomNodes,"node-key":"id","expand-on-click-node":!1,"default-expanded-keys":e.defaultExpandedKeys},on:{"node-click":e.handleNodeClick,"node-expand":e.treeExpandCollapse,"node-collapse":e.treeExpandCollapse}})],1),e._v(" "),s("el-main",{directives:[{name:"loading",rawName:"v-loading",value:e.editorLoading,expression:"editorLoading"}],ref:"main",staticStyle:{overflow:"hidden",padding:"0px"},attrs:{"element-loading-text":"初始化编辑框..."}},[e.fireRules.length>0?s("el-switch",{staticStyle:{"margin-bottom":"10px"},attrs:{"active-text":"仅显示触发规则"},on:{change:e.filterRules},model:{value:e.showFireRules,callback:function(t){e.showFireRules=t},expression:"showFireRules"}}):e._e(),e._v(" "),s("div",{ref:"editor",style:{height:e.editorHeight}})],1)],1)],1)],1)};ms._withStripped=!0;const fs={name:"index",components:{deleteBtn:Te,testBtn:ft,referBtn:Ne,assetsToolbar:Me},data:()=>({editor:null,showAddFunDialog:!1,bomNodes:[],defaultExpandedKeys:[],script:"",showFireRules:!0,editorLoading:!1,editorHeight:"100%",fullscreen:!1}),props:{assets:Object,readonly:{type:Boolean,default:!1},fireRules:{type:Array,default:function(){return[]}}},watch:{readonly:function(e,t){!0===t&&!0!==e&&this.$nextTick((()=>{this.editor.updateOptions({readOnly:!1})}))},fullscreen:function(){this.setEditorHeight()}},mounted(){window.addEventListener("resize",this.resizeEditor),this.setEditorHeight(),this.initData(),setTimeout((()=>{this.initEditor()}),0),this.loadBomNodes()},destroyed(){window.removeEventListener("resize",this.resizeEditor)},methods:{loadBomNodes(){const e={id:"fact",label:"数据模型",children:[]},t={id:"thirdapis",label:"外部接口",children:[]};this.defaultExpandedKeys.push(e.id),this.$store.state.facts.forEach(((t,s)=>{const i={id:t.uuid,label:t.name+"("+t.id+")",type:"fact",data:t,children:[]};t.fields.forEach((e=>{if("Derive"!=e.type){let t=e.label;t!=e.name&&(t+="("+e.name+")"),i.children.push({id:e.id,label:t,type:"factField",data:e})}})),e.children.push(i),0===s&&this.defaultExpandedKeys.push(i.id)})),this.$store.state.thirdapis.forEach(((e,s)=>{const i={id:e.uuid,label:e.name,type:"api",data:e};t.children.push(i)})),this.bomNodes.push(e),this.bomNodes.push(t)},async initEditor(){const e=this;try{this.editorLoading=!0;const t=await s.e(720).then(s.bind(s,59595)),i=t.editor.create(this.$refs.editor,{readOnly:this.readonly,language:"java"});i.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KEY_S,(function(){const t=JSON.stringify({script:e.editor.getValue()});e.$refs.saveBtn.saveContent(t)})),this.editorLoading=!1,this.editor=i,this.filterRules(),i.focus()}catch(e){this.editorLoading=!1,this.$message.error("初始化编辑框失败")}},initData(){if(this.assets.content){const e=JSON.parse(this.assets.content);this.script=e.script}else this.script='rule "规则1"\n    when\n\n    then\n\nend'},saveCallback(e){e(JSON.stringify({script:this.editor.getValue()}))},handleNodeClick(e){if(!e.data)return;let t;if("fact"==e.type?t=e.data.import+"()":"factField"==e.type?t=e.data.name:"api"==e.type&&(t=`外部接口:(${e.data.name},输入,输出)`),!t)return;const s={identifier:{major:1,minor:1},range:this.editor.getSelection(),text:t,forceMoveMarkers:!0};this.editor.executeEdits(null,[s])},refresh(e){if(!0===e.changeVersion){const t=JSON.parse(e.content);this.script=t.script,this.editor.setValue(this.script)}else this.$emit("refresh",e)},filterRules(){if(0==this.fireRules.length||!this.showFireRules)return void this.editor.setValue(this.script);let e=[];this.fireRules.forEach((t=>{const s=this.assets.versionNo?t.substring(`脚本式决策集-${this.assets.name}_V${this.assets.versionNo}-`.length):t.substring(`脚本式决策集-${this.assets.name}-`.length),i=new RegExp(`rule\\s+?"${s}"[\\s\\S]+?end`,"g"),a=this.script.match(i);a&&a.length>0&&e.push(...a)})),this.editor.setValue(e.join("\n\n"))},setEditorHeight(){if(this.fullscreen)this.$nextTick((()=>{const e=this.$refs.wrapper,t=this.$refs.toolbar.$el,s=window.getComputedStyle(e,null),i=window.getComputedStyle(t,null),a=parseInt(s.getPropertyValue("padding-top")),o=parseInt(s.getPropertyValue("padding-bottom")),n=parseInt(i.getPropertyValue("margin-bottom")),r=window.innerHeight-t.offsetHeight-n-a-o;this.editorHeight=Math.max(r,this.$refs.tree.$el.offsetHeight)+"px",this.layoutEditor()}));else try{if(-1!=this.$parent.$el.className.indexOf("el-dialog__wrapper")){const e=this.$parent.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=window.getComputedStyle(e,null),a=window.getComputedStyle(s,null),o=parseInt(i.getPropertyValue("margin-top")),n=parseInt(a.getPropertyValue("padding-top")),r=parseInt(a.getPropertyValue("padding-bottom"));this.editorHeight=window.innerHeight-t.offsetHeight-n-r-2*o+"px",this.layoutEditor()}else setTimeout((()=>{const e=document.getElementById("assets-main").offsetHeight-40-document.getElementById("assets-header").offsetHeight-document.getElementById("assets-tabs").getElementsByClassName("el-tabs__header")[0].offsetHeight-30-(this.readonly?0:this.$refs.toolbar.$el.offsetHeight+10)-2;this.$refs.tree?this.editorHeight=Math.max(e,this.$refs.tree.$el.offsetHeight)+"px":this.editorHeight=e+"px",this.layoutEditor()}),0)}catch(e){console.error(e),this.editorHeight="400px",this.layoutEditor()}},layoutEditor(){null!=this.editor&&this.$nextTick((()=>{this.editor.layout()}))},resizeEditor(){this.setEditorHeight(),this.editor.layout()},treeExpandCollapse(){setTimeout((()=>{this.setEditorHeight()}),300)}},beforeDestroy(){null!=this.editor&&this.editor.dispose()}};var gs=(0,A.Z)(fs,ms,[],!1,null,"4beb4e42",null);gs.options.__file="src/view/decision/project/rulescript/index.vue";const vs=gs.exports;var bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"searchModelContent"},[s("div",{staticClass:"searchVarContent"},[s("el-input",{staticClass:"treeInput",attrs:{placeholder:"输入关键字"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchResources(t)}},model:{value:e.searchInput,callback:function(t){e.searchInput="string"==typeof t?t.trim():t},expression:"searchInput"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:function(t){return e.initData()}},slot:"suffix"})]),e._v(" "),s("el-select",{staticClass:"treeSelect",attrs:{placeholder:"请选择"},on:{change:e.selectSearch},model:{value:e.searchCondition,callback:function(t){e.searchCondition=t},expression:"searchCondition"}},[s("el-option",{key:"variable",attrs:{label:"搜变量",value:"variable"}}),e._v(" "),s("el-option",{key:"rule",attrs:{label:"搜规则",value:"rule"}})],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.searchList}},[s("el-table-column",{attrs:{prop:"name",label:"名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.link(t.row.uuid)}}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.$utils.getAssetsTypeText(t.row.type)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.link(t.row.uuid)}}},[e._v("打开")])]}}])})],1)],1)};bs._withStripped=!0;const ws={name:"index",props:{searchData:Object},watch:{searchData(e){this.searchInput=this.searchData.searchInput,this.searchCondition=this.searchData.searchCondition,this.initData()}},data:()=>({tableLoading:!1,searchList:[],tablePage:1,total:0,searchInput:"",searchCondition:""}),mounted(){this.searchInput=this.searchData.searchInput,this.searchCondition=this.searchData.searchCondition,this.initData()},methods:{toPage(e){this.tablePage=e,this.initData()},submit(){this.initData()},initData(){if(!this.searchInput)return;this.tableLoading=!0;let e={projectUuid:this.$route.params.uuid,keyword:this.searchInput,type:this.searchCondition};this.$axios.get("/assets/search",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?this.searchList=e.data.data:this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},selectSearch(e){this.initData()},searchResources(){this.initData()},link(e){this.$emit("activateAssets",e)}}};var ys=(0,A.Z)(ws,bs,[],!1,null,null,null);ys.options.__file="src/view/decision/project/searchResult/index.vue";const _s=ys.exports;var xs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"toolbar"},[e.$hasPerm("project.pkg:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showEditDialog=!0,e.$store.commit("setPkg",{})}}},[e._v("\n      添加知识包\n    ")]):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"table-style",attrs:{"element-loading-text":"数据加载中...",data:e.packages}},[s("el-table-column",{attrs:{prop:"code"},scopedSlots:e._u([{key:"header",fn:function(t){return[e._v("\n        编码\n        "),s("el-tooltip",{attrs:{content:"调用时标识当前知识包",placement:"top"}},[s("i",{staticClass:"el-icon-info"})])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"名称",prop:"name"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(t.row.name))]),e._v(" "),t.row.auditCount>0&&e.$hasPerm("project.pkg.baseline:audit")?s("el-tooltip",{attrs:{content:"有"+t.row.auditCount+"个基线待审核",placement:"top"}},[s("el-tag",{attrs:{type:"danger",size:"mini",effect:"dark"}},[e._v(e._s(t.row.auditCount))])],1):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述"}}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("project.pkg.baseline:view")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.showBaseLine(t.row)}}},[e._v("基线列表")]):e._e(),e._v(" "),e.$hasPerm("project.pkg:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.edit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$hasPerm("project.pkg:del")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.del(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),s("edit-dialog",{attrs:{active:e.showEditDialog},on:{"update:active":function(t){e.showEditDialog=t},submit:e.loadPackages}}),e._v(" "),s("test-dialog",{attrs:{active:e.showTestDialog},on:{"update:active":function(t){e.showTestDialog=t},publish:e.loadPackages}}),e._v(" "),e.showbaseLineDialog?s("baseline-dialog",{attrs:{active:e.showbaseLineDialog,baselineData:e.baselineRowData},on:{"update:active":function(t){e.showbaseLineDialog=t},closed:e.loadPackages,submit:e.createMicro}}):e._e()],1)};xs._withStripped=!0;var ks=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:e.form.uuid?"编辑知识包":"添加知识包",width:"30%",visible:e.show,"close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t},open:e.open,closed:e.closed}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"名称",prop:"name"}},[s("el-input",{ref:"input",attrs:{placeholder:"知识包名称，不可重名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"描述",prop:"description"}},[s("el-input",{attrs:{type:"textarea",placeholder:"还没有描述-这个知识包是做什么的？",autosize:{minRows:6},maxlength:100,"show-word-limit":!0},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.loading},on:{click:e.submit}},[e._v("\n      "+e._s(e.loading?"提交中...":"确 定")+"\n    ")])],1)],1)};ks._withStripped=!0;const $s={name:"edit-dialog",props:{active:Boolean},watch:{active:function(e){this.show=e}},data(){return{loading:!1,show:this.active,form:{},rules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"}],description:[{max:100,message:"长度不超过100个字符",trigger:"blur"}]}}},methods:{open(){this.form=JSON.parse(JSON.stringify(this.$store.state.pkg)),this.$nextTick((function(){this.$refs.input.focus()}))},closed(){this.$refs.form.resetFields(),this.$emit("update:active",!1)},submit(){this.$refs.form.validate((e=>{if(e){let e=this.form.uuid?"/knowledgepackage/edit":"/knowledgepackage/add",t={};this.form.uuid?t.uuid=this.form.uuid:t.projectUuid=this.$route.params.uuid,t.name=this.form.name,t.description=this.form.description,this.loading=!0,this.$axios.post(e,this.$qs.stringify(t)).then((e=>{this.loading=!1,0==e.data.code?(this.show=!1,this.$emit("submit"),this.$message.success("保存成功")):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.loading=!1,this.$message.error("操作失败")}))}}))}}};var Ts=(0,A.Z)($s,ks,[],!1,null,"2af7d2c8",null);Ts.options.__file="src/view/decision/project/knowledgepackage/edit-dialog.vue";const Ds=Ts.exports;var Ss=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"基线列表",top:e.$dialogTop,visible:e.show,width:"70%"},on:{"update:visible":function(t){e.show=t},closed:e.closed}},[s("div",{staticClass:"toolbar"},[e.$hasPerm("project.pkg.baseline:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.addBaseline}},[e._v("\n      新增基线\n    ")]):e._e(),e._v(" "),s("el-button",{attrs:{icon:"el-icon-document-copy"},on:{click:e.openDiff}},[e._v("\n      对比差异\n    ")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"table",attrs:{"element-loading-text":"数据加载中...",data:e.baselines},on:{"sort-change":e.sortChange,"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"versionNo",label:"基线版本",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        V"+e._s(t.row.versionNo)+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"creator.realname",label:"发布者"}}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"发布日期",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"stateText",label:"基线状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[3==t.row.state?s("span",{staticStyle:{color:"#67C23A"}},[e._v(e._s(t.row.stateText))]):4!=t.row.state?s("span",[e._v(e._s(t.row.stateText))]):t.row.auditReason?s("el-tooltip",{attrs:{placement:"top"}},[s("span",{attrs:{slot:"content"},domProps:{innerHTML:e._s(t.row.auditReason)},slot:"content"}),e._v(" "),s("el-link",{attrs:{type:"danger"}},[e._v(e._s(t.row.stateText))])],1):s("el-link",{attrs:{type:"danger"}},[e._v(e._s(t.row.stateText))])]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"300px"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.state&&e.$hasPerm("project.pkg.baseline:publish")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.genMicro(t.row)}}},[e._v("发布")]):e._e(),e._v(" "),1==t.row.state&&e.$hasPerm("project.pkg.baseline:audit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.auditMicro(t.row)}}},[e._v("审核")]):e._e(),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.checkBaseline(t.row)}}},[e._v("文件列表")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.test(t.row)}}},[e._v("仿真测试")]),e._v(" "),e.showMoreOperation(t.row)?s("dropdown",{staticClass:"moreOperation",on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n            更多\n            "),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.showDownloadOperation(t.row)?s("dropdown-item",{attrs:{command:{row:t.row,op:"download"},icon:"el-icon-download"}},[e._v("\n              下载基线\n            ")]):e._e(),e._v(" "),e.showDelOperation(t.row)?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-delete"}},[e._v("\n              废除基线\n            ")]):e._e()],1)],1):e._e()]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}}),e._v(" "),s("assets-dialog",{attrs:{isAdd:e.addBaselineShow,baseline:e.baselineAssets,active:e.showAssetsDialog},on:{"update:active":function(t){e.showAssetsDialog=t},test:e.test,reload:e.reload}}),e._v(" "),s("test-dialog",{attrs:{active:e.showTestDialog},on:{"update:active":function(t){e.showTestDialog=t}}}),e._v(" "),s("baseline-diff",{attrs:{show:e.showDiffDialog,"diff-data":e.diffData},on:{"update:show":function(t){e.showDiffDialog=t}}}),e._v(" "),s("baseline-audit",{attrs:{active:e.showAuditDialog,auditData:e.auditData},on:{"update:active":function(t){e.showAuditDialog=t},reload:e.reload}})],1)};Ss._withStripped=!0;var Cs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"资源文件列表",top:e.$dialogTop,visible:e.show,width:"60%","append-to-body":""},on:{"update:visible":function(t){e.show=t},open:e.loadAssets,closed:e.closed}},[e.isAdd?s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAssetsAddDialog=!0}}},[e._v("\n      添加资源文件\n    ")])],1):e._e(),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.assets}},[s("el-table-column",{attrs:{label:"文件名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"文件类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v(e._s(e.$utils.getAssetsTypeText(t.row.type)))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"versionNo",label:"版本号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.versionNo||0==t.row.versionNo?"V"+t.row.versionNo:""))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"版本描述"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.versionDes?[t.row.versionDes.length<12?s("span",[e._v(e._s(t.row.versionDes))]):s("el-tooltip",{attrs:{placement:"top",content:t.row.versionDes}},[s("span",[e._v(e._s(t.row.versionDes.length>12?t.row.versionDes.substring(0,12)+"...":t.row.versionDes))])])]:void 0}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.viewAssets(t.row)}}},[e._v("查看")]),e._v(" "),e.isAdd?s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.delAssets(t.row)}}},[e._v("\n          删除\n        ")]):e._e()]}}])})],1),e._v(" "),e.isAdd?s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.saveLoading},on:{click:e.saveAssets}},[e._v("\n      "+e._s(e.saveLoading?"提交中...":"确 定")+"\n    ")])],1):e._e(),e._v(" "),s("assets-add-dialog",{attrs:{active:e.showAssetsAddDialog,assets:e.assets},on:{"update:active":function(t){e.showAssetsAddDialog=t},view:e.viewAssets,add:e.submitAddAssets,closed:e.loadAssets}}),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};Cs._withStripped=!0;var Ns=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"添加资源文件",top:e.$dialogTop,size:e.$dialogTop,visible:e.show,width:"60%","append-to-body":""},on:{"update:visible":function(t){e.show=t},closed:e.closed,open:e.open}},[s("div",{staticStyle:{"text-align":"right","margin-bottom":"10px"}},[s("el-input",{staticClass:"search",staticStyle:{width:"220px"},attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:function(t){return e.search()}},slot:"suffix"})])],1),e._v(" "),s("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"border-card","element-loading-text":"数据加载中..."}},e._l(e.assetsGroup,(function(t){return s("el-tab-pane",{key:t.type,attrs:{label:t.type}},[s("el-table",{staticClass:"tb-edit",staticStyle:{height:"300px","overflow-y":"auto"},attrs:{data:t.list,"highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"文件名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"版本号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{ref:"input_original_"+t.row.uuid,refInFor:!0,staticClass:"scopSelect",attrs:{placeholder:"请选择"},on:{change:function(s){return e.selectVerion(t.row)}},model:{value:t.row.select,callback:function(s){e.$set(t.row,"select",s)},expression:"scope.row.select"}},e._l(t.row.assetsVersions,(function(e,t){return s("el-option",{key:t,attrs:{value:e.versionNo,label:"V"+e.versionNo}})})),1),e._v(" "),s("span",{staticClass:"originSelect"},[e._v(e._s("V"+t.row.select))])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"版本描述"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.versionDes?[t.row.versionDes.length<12?s("span",[e._v(e._s(t.row.versionDes))]):s("el-tooltip",{attrs:{placement:"top",content:t.row.versionDes}},[s("span",[e._v(e._s(t.row.versionDes.length>12?t.row.versionDes.substring(0,12)+"...":t.row.versionDes))])])]:void 0}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n          ")]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(i){return[s("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.viewAssets(i.row)}}},[e._v("查看")]),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.add(i.row,t.type,i.$index,t.list)}}},[e._v("添加")])]}}],null,!0)})],1)],1)})),1),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};Ns._withStripped=!0;const Ls={name:"assets-add-dialog",props:{active:Boolean,assets:{type:Array,default:function(){return[]}},filterExists:{type:Boolean,default:!0}},watch:{active:function(e){this.show=e}},data(){return{show:this.active,loading:!1,assetsGroup:[],name:"",checkList:[],sName:"",sDirName:"",viewingAssets:{uuid:"",version:0,show:!1}}},methods:{closed(){this.$emit("update:active",!1),this.$emit("closed"),this.name="",this.checkList=[]},open(){this.loading=!0,this.$axios.get("/assets/query",{params:{projectUuid:this.$route.params.uuid,name:this.name}}).then((e=>{0==e.data.code?(this.assetsGroup=[],e.data.data.forEach((e=>{"fact"!=e.type&&"constant"!=e.type&&(e.list.forEach((e=>{e.select=e.assetsVersions[0].versionNo,e.versionDes=e.assetsVersions[0].versionDes,e.createTime=e.assetsVersions[0].createTime})),this.filterExists&&(e.list=e.list.filter((e=>{let t=!1;return this.assets.some((s=>{if(e.uuid==s.uuid)return t=!0,!0})),!t}))),e.type=this.$utils.getAssetsTypeText(e.type),this.assetsGroup.push(e))}))):this.$message.error(e.data.msg?e.data.msg:"查询失败"),this.loading=!1})).catch((()=>{this.loading=!1,this.$message.error("查询失败")}))},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.select,this.viewingAssets.show=!0},selectVerion(e){e.assetsVersions.forEach((t=>{e.select==t.versionNo&&(e.versionDes=t.versionDes,e.createTime=t.createTime)}))},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.uuid][0];"版本号"==t.label&&a&&this.$nextTick((function(){a.toggleMenu()}))},search(){this.open()},add(e,t,s,i){this.$emit("add",e,t),this.filterExists&&i.splice(s,1)}}};var As=(0,A.Z)(Ls,Ns,[],!1,null,"089f7722",null);As.options.__file="src/view/decision/project/knowledgepackage/assets-add-dialog.vue";const Es=As.exports,Fs={name:"assets-dialog",props:{active:Boolean,isAdd:Boolean,baseline:Object},components:{"assets-add-dialog":Es},watch:{active:function(e){this.show=e}},data(){return{show:this.active,tableLoading:!1,assets:[],showAssetsAddDialog:!1,viewingAssets:{uuid:"",version:0,show:!1},saveLoading:!1}},methods:{closed(){this.assets=[],this.$emit("update:active",!1),this.$emit("closed")},loadAssets(){if(this.isAdd)return;const e=this.$store.state.pkg;this.assets=[],this.tableLoading=!0,this.$axios.get("/knowledgepackage/assets",{params:{uuid:e.packageUuid?e.packageUuid:e.uuid,baselineVersion:this.baseline.versionNo}}).then((e=>{this.tableLoading=!1,0==e.data.code&&(e.data.data.forEach((e=>{e.versionDes=e.description})),this.assets=e.data.data)})).catch((()=>{this.tableLoading=!1}))},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.versionNo,this.viewingAssets.show=!0},saveAssets(){if(this.assets.length<=0)return void this.$message.warning("请选择资源文件");let e=[];this.assets.forEach((t=>{e.push({assetsUuid:t.uuid,assetsVersion:t.versionNo})})),e=JSON.stringify(e),this.saveLoading=!0,this.$axios.post("/baseline/save",this.$qs.stringify({packageUuid:this.$store.state.pkg.uuid,assets:e})).then((e=>{this.saveLoading=!1,0==e.data.code?(this.$message.success("添加成功"),this.show=!1,this.$emit("reload")):this.$message.error(e.data.msg?e.data.msg:"添加失败")})).catch((()=>{this.$message.error("添加失败"),this.saveLoading=!1}))},submitAddAssets(e){let t=!1;this.assets.forEach((s=>{s.uuid==e.uuid&&(this.$message.warning("请勿重复添加"),t=!0)})),t||(e.versionNo=e.select,this.$message.success("添加成功"),this.assets.push(e))},delAssets(e){this.assets.forEach(((t,s)=>{t.uuid==e.uuid&&this.assets.splice(s,1)}))},test(){this.$emit("test",{uuid:this.$store.state.pkg.uuid})}}};var Os=(0,A.Z)(Fs,Cs,[],!1,null,"31abb943",null);Os.options.__file="src/view/decision/project/knowledgepackage/assets-dialog.vue";const Is=Os.exports;var Ps=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"基线差异",visible:e.show,width:"60%","append-to-body":""},on:{"update:visible":e.close,closed:e.closed,open:e.initData}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"table",staticClass:"compareTab",attrs:{"element-loading-text":"数据加载中...",data:e.tableData,"row-key":"uuid",border:"",indent:4,"default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}}},[s("el-table-column",{attrs:{prop:"typeName",label:e.diffData.name,align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:e.oldBaseline,prop:"baselineV1",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[!t.row.typeName&&t.row.baselineV1?s("span",{class:{remove:!t.row.baselineV2}},[e._v("\n          "+e._s(t.row.name)+"\n          "),s("span",{class:{active:!t.row.same}},[e._v("V"+e._s(t.row.baselineV1))])]):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{label:e.newBaseline,prop:"baselineV2",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[!t.row.typeName&&t.row.baselineV2?s("span",{class:{add:!t.row.baselineV1}},[e._v("\n          "+e._s(t.row.name)+"\n          "),s("span",{class:{active:!t.row.same}},[e._v("V"+e._s(t.row.baselineV2))])]):e._e()]}}])})],1)],1)};Ps._withStripped=!0;const Ms={name:"baseline-diff",props:{show:Boolean,diffData:Object},data:()=>({tableLoading:!1,tableData:[],oldBaseline:"",newBaseline:""}),methods:{close(){this.$emit("update:show",!1)},closed(){this.tableData=[]},initData(){this.diffData.baselines.sort(),this.oldBaseline=`V${this.diffData.baselines[0]}`,this.newBaseline=`V${this.diffData.baselines[1]}`,this.tableLoading=!0,this.$axios.get("/baseline/compare",{params:{packageUuid:this.diffData.uuid,baselineV1:this.diffData.baselines[0],baselineV2:this.diffData.baselines[1]}}).then((e=>{this.tableLoading=!1,0==e.data.code&&(e.data.data.forEach((e=>{e.typeName=this.$utils.getAssetsTypeText(e.typeName)})),this.tableData=e.data.data)})).catch((()=>{this.tableLoading=!1}))}}};var Rs=(0,A.Z)(Ms,Ps,[],!1,null,"70e3437e",null);Rs.options.__file="src/view/decision/project/knowledgepackage/baseline-diff.vue";const js=Rs.exports;var Bs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"审核基线",width:"30%",visible:e.show,"append-to-body":""},on:{"update:visible":function(t){e.show=t},closed:e.closed}},[s("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"是否通过",prop:"state"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},[s("el-option",{attrs:{label:"通过",value:"2"}}),e._v(" "),s("el-option",{attrs:{label:"不通过",value:"4"}})],1)],1),e._v(" "),"4"==e.form.state?s("el-form-item",{attrs:{label:"描述理由",prop:"auditReason"}},[s("el-input",{attrs:{type:"textarea",placeholder:"请填写不通过理由",autosize:{minRows:6},maxlength:100,"show-word-limit":""},model:{value:e.form.auditReason,callback:function(t){e.$set(e.form,"auditReason",t)},expression:"form.auditReason"}})],1):e._e()],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.loading},on:{click:e.submit}},[e._v("\n      "+e._s(e.loading?"提交中...":"确 定")+"\n    ")])],1)],1)};Bs._withStripped=!0;const Us={name:"edit-dialog",props:{active:Boolean,auditData:Object},watch:{active:function(e){this.show=e},auditData:function(e){this.auditData=e}},data(){return{loading:!1,show:this.active,form:{state:"2",auditReason:""},rules:{auditReason:[{max:100,message:"长度不超过100个字符",trigger:"blur"}]}}},methods:{closed(){this.$refs.form.resetFields(),this.$emit("update:active",!1),this.$emit("closed")},submit(){this.$refs.form.validate((e=>{if(e){this.loading=!0;let e={};e.uuid=this.auditData.uuid,e.state=this.form.state,e.auditReason=this.form.auditReason,e.packageUuid=this.auditData.packageUuid,this.$axios.post("/baseline/audit",this.$qs.stringify(e)).then((e=>{this.loading=!1,0==e.data.code?(this.show=!1,this.$emit("reload"),this.$message.success("审批成功")):this.$message.error(e.data.msg?e.data.msg:"审批失败")})).catch((()=>{this.loading=!1,this.$message.error("审批失败")}))}}))}}};var Vs=(0,A.Z)(Us,Bs,[],!1,null,"6c51c5b2",null);Vs.options.__file="src/view/decision/project/knowledgepackage/baseline-audit.vue";const Hs={name:"index",components:{"assets-dialog":Is,"test-dialog":pt,baselineDiff:js,baselineAudit:Vs.exports},props:{active:Boolean,baselineData:Object},data(){return{tableLoading:!1,showAssetsDialog:!1,showTestDialog:!1,showDiffDialog:!1,showAuditDialog:!1,baselines:[],page:1,pageNum:10,total:0,sortOption:{sortField:"",sortDirection:""},testLoading:!1,saveLoading:!1,show:this.active,addBaselineShow:!1,baselineAssets:null,diffData:{uuid:"",name:"",baselines:[]},tabSelect:[],auditData:{}}},watch:{active:function(e){this.show=e},baselineData:function(e){this.baselineData=e}},mounted(){this.initData()},methods:{closed(){this.assets=[],this.$emit("update:active",!1),this.$emit("closed")},reload(){this.initData()},initData(){this.tableLoading=!0,this.$axios.get("/baseline",{params:{page:this.page,pageNum:this.pageNum,packageUuid:this.baselineData.uuid}}).then((e=>{this.tableLoading=!1,0==e.data.code&&(e.data.data.forEach((e=>{switch(e.state){case 0:e.stateText="待发布";break;case 1:e.stateText="待审核";break;case 2:e.stateText="待生效";break;case 3:e.stateText="已生效";break;case 4:e.stateText="已拒绝";break;default:e.stateText="未知"}e.auditReason?e.auditReason=e.auditReason.replace(/\n/g,"<br>"):e.auditReason=""})),this.baselines=e.data.data,this.total=e.data.total)})).catch((()=>{this.tableLoading=!1}))},openDiff(){2==this.tabSelect.length?(this.diffData.uuid=this.baselineData.uuid,this.diffData.name=this.baselineData.name,this.diffData.baselines=this.tabSelect.map((e=>e.versionNo)),this.showDiffDialog=!0):this.$message.warning("请勾选两个版本对比")},moreOperation({row:e,op:t}){"download"==t?this.download(e):"del"==t?this.del(e):"check"==t&&this.checkBaseline(e)},test(e){this.showTestDialog=!0,this.baselineData.baselineVersion=e.versionNo,this.$store.commit("setPkg",this.baselineData)},del(e){this.$confirm("此操作将永久废除该基线, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/baseline/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.loading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.loading=!1}))}))},addBaseline(){this.$store.commit("setPkg",this.baselineData),this.showAssetsDialog=!0,this.addBaselineShow=!0},checkBaseline(e){this.$store.commit("setPkg",this.baselineData),this.showAssetsDialog=!0,this.addBaselineShow=!1,this.baselineAssets=e},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.initData()},download(e){const t=this;t.tableLoading=!0,this.$axios({method:"get",url:"/knowledgepackage/download?uuid="+t.baselineData.uuid+"&baselineVersion="+e.versionNo,responseType:"blob"}).then((s=>{if(t.tableLoading=!1,"application/json"==s.data.type){const e=new FileReader;e.onload=function(){const s=JSON.parse(e.result);if(401==s.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(s.msg?s.msg:"下载失败")},e.readAsText(s.data)}else{let i=window.URL.createObjectURL(new Blob([s.data])),a=document.createElement("a");a.style.display="none",a.href=i,a.target="_blank",a.setAttribute("download",t.baselineData.name+"_V"+e.versionNo+".baseline"),document.body.appendChild(a),a.click()}t.tableLoading=!1})).catch((()=>{t.$message.error("下载失败"),t.tableLoading=!1}))},genMicro(e){this.tableLoading=!0,this.$axios.post("/baseline/publish",this.$qs.stringify({baselineVersion:e.versionNo,packageUuid:this.baselineData.uuid})).then((e=>{0==e.data.code?(this.$message.success("发布成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")})).then((()=>{this.tableLoading=!1}))},auditMicro(e){this.auditData=e,this.auditData.packageUuid=this.baselineData.uuid,this.showAuditDialog=!0},handleSelectionChange(e){this.tabSelect=[],e.forEach((e=>{this.tabSelect.push(e)}))},showMoreOperation(e){return this.showDownloadOperation(e)||this.showDelOperation(e)},showDownloadOperation(e){return!!this.$hasPerm("project.pkg.baseline:download")&&(2==e.state||3==e.state)},showDelOperation(e){return!!this.$hasPerm("project.pkg.baseline:del")&&3!=e.state}}};var qs=(0,A.Z)(Hs,Ss,[],!1,null,"69178701",null);qs.options.__file="src/view/decision/project/knowledgepackage/baseline-dialog.vue";const zs={name:"index",components:{"edit-dialog":Ds,"test-dialog":pt,"baseline-dialog":qs.exports},data:()=>({tableLoading:!1,packages:[],showEditDialog:!1,showAssetsDialog:!1,showTestDialog:!1,showbaseLineDialog:!1,permissionForm:{show:!1,accounts:[],accountUuid:"",resources:[],loading:!1,all:!1},editingIndex:null,baselineRowData:null}),mounted(){this.loadPackages()},methods:{edit(e){this.showEditDialog=!0,this.$store.commit("setPkg",e)},showBaseLine(e){this.baselineRowData=e,this.showbaseLineDialog=!0},loadPackages(){this.tableLoading=!0,this.$axios.get("/knowledgepackage",{params:{projectUuid:this.$route.params.uuid}}).then((e=>{if(0==e.data.code){this.packages=e.data.data,this.$store.commit("setPkgs",this.packages);let t=[];e.data.data.forEach((e=>{t.push({...e,r:!1})})),this.permissionForm.resources=t}})).then((()=>{this.tableLoading=!1}))},del(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.tableLoading=!0,this.$axios.post("/knowledgepackage/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{0==e.data.code?(this.loadPackages(),this.$message.success("删除成功")):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败")})).then((()=>{this.tableLoading=!1}))}))},addRule(e){this.showAssetsDialog=!0,this.$store.commit("setPkg",e)},test(e){this.showTestDialog=!0,this.$store.commit("setPkg",e)},changePermissionAccount(e){this.permissionForm.loading=!0,this.$axios.post("/permission/accounthas",this.$qs.stringify({accountUuid:e,dataType:1,dataUuid:this.$route.params.uuid})).then((e=>{if(0==e.data.code){let t=0;this.permissionForm.resources.forEach((s=>{let i=!1;e.data.data.some((e=>{if(s.uuid==e.resourceId&&!this.$utils.isBlank(e.permission))return i=!0,t++,!0})),s.r=i})),this.permissionForm.all=t==this.permissionForm.resources.length}})).catch((()=>{this.$message.error("操作失败")})).then((()=>{this.permissionForm.loading=!1}))},submitPermission(e){if(this.$utils.isBlank(this.permissionForm.accountUuid))return this.$message.warning("请选择用户"),void(e.r=!e.r);this.doSubmitPermission(e.uuid,e.r?"r":"")},doSubmitPermission(e,t){this.$axios.post("/permission/authorization",this.$qs.stringify({accountUuid:this.permissionForm.accountUuid,resourceId:e,type:3,permission:t})).then((e=>{0!=e.data.code&&this.$message.error(e.data.msg?e.data.msg:"操作失败")}))},createMicro(e){this.$set(this.packages[this.editingIndex],"microUuid",e)}}};var Ws=(0,A.Z)(zs,xs,[],!1,null,"73094127",null);Ws.options.__file="src/view/decision/project/knowledgepackage/knowledgepackage.vue";const Gs=Ws.exports;var Js=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"testcase"},[e.readonly?e._e():s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",loading:e.saveLoading,icon:"iconfont iconbaocun"},on:{click:e.saveSubmitTest}},[e._v("\n      "+e._s(e.saveLoading?"保存中...":"保存")+"\n    ")]),e._v(" "),s("el-button",{attrs:{loading:e.testLoading,icon:"el-icon-lightning"},on:{click:function(){return!e.testLoading&&e.submitTest()}}},[e._v("\n      "+e._s(e.testLoading?"测试中...":"测试")+"\n    ")]),e._v(" "),s("assets-editor-dialog",{attrs:{assets:e.assets},on:{refresh:e.refresh}}),e._v(" "),s("el-popconfirm",{attrs:{title:"确定删除？"},on:{confirm:e.deleData}},[s("el-button",{attrs:{slot:"reference",icon:"el-icon-delete"},slot:"reference"},[e._v("删除")])],1)],1),e._v(" "),s("div",{staticClass:"addFile"},[s("span",{staticClass:"title"},[e._v("已选中：")]),e._v(" "),e.readonly?s("span",[e._v("\n      "+e._s(e.fileName?e.fileName:"请选择")+"\n    ")]):s("span",{staticClass:"selectAsset",on:{click:function(t){e.showAssetsAddDialog=!0}}},[e._v("\n      "+e._s(e.fileName?e.fileName:"请选择")+"\n    ")])]),e._v(" "),s("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.testData.result,expression:"testData.result"}],staticClass:"toolbar",attrs:{title:"测试成功",closable:!1,type:"success","show-icon":""}},[s("p",[e._v("\n      触发了"),s("b",[e._v(e._s(e.testResult.fireNum))]),e._v("条规则，\n      耗时"),s("b",[e._v(e._s(e.testResult.fireTime))]),e._v("毫秒\n    ")]),e._v(" "),e.testResult.fireNodes&&e.testResult.fireNodes.length>0?[s("p",[e._v("决策流轨迹：")]),e._v(" "),e._l(e.testResult.fireNodes,(function(t,i){return s("p",{key:t.processId,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"success",underline:!1,icon:"el-icon-view"},on:{click:function(t){return e.showFlow(i)}}},[e._v("\n          "+e._s(t.flowName)+"\n        ")])],1)}))]:e._e(),e._v(" "),e.testResult.fireNum>0?[s("p",[e._v("规则列表：")]),e._v(" "),e._l(e.testResult.fireRules,(function(t,i){return s("p",{key:t.name,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"success",underline:!1,icon:"el-icon-view"},on:{click:function(t){return e.showAssets(i)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])],1)}))]:e._e()],2),e._v(" "),s("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.testDataLoading,expression:"testDataLoading"}],attrs:{gutter:10}},[s("el-col",{attrs:{span:6}},[s("el-table",{ref:"modelTable",attrs:{data:e.testData.facts,"row-style":{cursor:"pointer"},"row-class-name":e.setRowIndex,"highlight-current-row":"",border:""},on:{"row-click":e.clickTestFact}},[s("el-table-column",{attrs:{prop:"name",label:"数据模型",align:"center"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:18}},e._l(e.testData.facts,(function(t,i){return s("el-table",{directives:[{name:"show",rawName:"v-show",value:i==e.testData.activeIndex,expression:"index == testData.activeIndex"}],key:t.id,ref:"singleTable"+i,refInFor:!0,staticClass:"tb-edit",attrs:{data:t.fields,"row-style":{cursor:"pointer"},"highlight-current-row":"",border:""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isNumber(t.row.type)&&!e.readonly?s("el-input-number",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{"step-strictly":e.inputInteger(t.row),controls:!1},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isBoolean(t.row.type)&&!e.readonly?s("el-select",{ref:"input_original_"+t.row.id,refInFor:!0,attrs:{placeholder:"请选择"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)&&!e.readonly?s("date-picker",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isDateTime(t.row.type)&&!e.readonly?s("date-picker",{ref:"input_original_"+t.row.id,refInFor:!0,staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isCollection(t.row.type)&&!e.readonly?s("test-collection",{ref:"input_original_"+t.row.id,refInFor:!0,attrs:{type:t.row.subType},model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.$utils.isObject(t.row.type)&&!e.readonly?s("test-object",{ref:"input_original_"+t.row.id,refInFor:!0,model:{value:t.row.original,callback:function(s){e.$set(t.row,"original",s)},expression:"scope.row.original"}}):e.readonly?e._e():s("el-input",{ref:"input_original_"+t.row.id,refInFor:!0,model:{value:t.row.original,callback:function(s){e.$set(t.row,"original","string"==typeof s?s.trim():s)},expression:"scope.row.original"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n              "+e._s(t.row.original?"true"===t.row.original?"是":"否":"")+"\n            ")]):e.$utils.isCollection(t.row.type)||e.$utils.isObject(t.row.type)?e._e():s("span",[e._v("\n              "+e._s(t.row.original)+"\n            ")])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"期望值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.readonly?e._e():s("el-input",{ref:"input_expectedValue_"+t.row.id,refInFor:!0,model:{value:t.row.expectedValue,callback:function(s){e.$set(t.row,"expectedValue","string"==typeof s?s.trim():s)},expression:"scope.row.expectedValue"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",{class:[t.row.expectedValue!=(t.row.value?"true"===t.row.value?"是":"否":"")?"activeClass":""]},[e._v(e._s(t.row.expectedValue))]):s("span",{class:[t.row.expectedValue!=t.row.value?"activeClass":""]},[e._v(e._s(t.row.expectedValue))])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{label:"结果",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isBoolean(t.row.type)?s("span",{class:[t.row.expectedValue!==(t.row.value?"true"===t.row.value?"是":"否":"")?"activeClass":""]},[e._v(e._s(t.row.value?"true"===t.row.value?"是":"否":""))]):e.$utils.isObject(t.row.type)&&t.row.value?s("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[s("span",{class:[t.row.expectedValue!=t.row.value?"activeClass":""]},[e._v(e._s(t.row.value))]),e._v(" "),s("el-link",{attrs:{slot:"reference",icon:"el-icon-view"},slot:"reference"})],1):s("span",{class:[t.row.expectedValue!=t.row.value?"activeClass":""]},[e._v(e._s(t.row.value))])]}}],null,!0)}),e._v(" "),s("el-table-column",{attrs:{prop:"label",label:"中文名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"数据类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isCollection(t.row.type)?s("span",[e._v(e._s(t.row.type+"<"+e.getSubTypeName(t.row.subType)+">"))]):e.$utils.isObject(t.row.type)?s("span",[e._v(e._s(e.getObjectTypeName(t.row.subType)))]):s("span",[e._v(e._s(t.row.type))])]}}],null,!0)})],1)})),1)],1),e._v(" "),s("ruleflow-trace",{attrs:{"flow-uuid":e.ruleflowTrace.uuid,"flow-version":e.ruleflowTrace.version,nodes:e.ruleflowTrace.nodes,show:e.ruleflowTrace.show},on:{"update:show":function(t){return e.$set(e.ruleflowTrace,"show",t)}}}),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}}),e._v(" "),s("assets-add-dialog",{attrs:{active:e.showAssetsAddDialog,assets:[{uuid:e.ruleUuid}],"filter-exists":!1},on:{"update:active":function(t){e.showAssetsAddDialog=t},add:e.submitAddAssets}})],1)};Js._withStripped=!0;const Zs={name:"test-dialog",props:{assets:Object,active:Boolean,temp:Boolean,readonly:{type:Boolean,default:!1}},components:{"assets-add-dialog":Es},watch:{active:function(e){this.show=e}},data(){return{show:this.active,testLoading:!1,saveLoading:!1,testDataLoading:!1,testData:{activeIndex:0,facts:[]},showBatchDialog:!1,batchLoading:!1,batchData:{activeIndex:0,facts:null},batchTest:[],lastSubmitFacts:null,testResult:{},showAssetsAddDialog:!1,fileName:"",ruleUuid:"",pkg:{},ruleflowTrace:{uuid:"",version:0,nodes:[],show:!1},viewingAssets:{uuid:"",version:0,show:!1},uuids:""}},mounted(){this.initData(),this.assets.content||this.temptest()},methods:{initData(){this.assets.content&&(this.testData=JSON.parse(this.assets.content),this.fileName=this.testData.fileData.fileName,this.ruleUuid=this.testData.fileData.ruleUuid,this.assetsVersion=this.testData.fileData.assetsVersion,this.testData.result=null,this.pkg=this.testData.fileData.pkg)},temptest(){this.ruleUuid&&(this.loading=!0,this.$axios.post("/knowledgepackage/temptest",this.$qs.stringify({assetsUuid:this.ruleUuid,assetsVersion:this.assetsVersion})).then((e=>{this.loading=!1,0==e.data.code?(this.$store.commit("setPkg",e.data.data),this.pkg=e.data.data,this.open(e.data.data.uuid)):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.loading=!1})))},open(e){this.testDataLoading=!0,this.testData.result=null,this.lastSubmitFacts=null,this.$axios.get("/knowledgepackage/testdata",{params:{uuid:e,baselineVersion:1}}).then((e=>{this.testDataLoading=!1,0==e.data.code?(this.testData.facts=e.data.data,this.$refs.modelTable.setCurrentRow(this.testData.facts[0]),this.clickTestFact({index:0})):this.$message.error(e.data.msg?e.data.msg:"加载失败")})).catch((()=>{this.$message.error("加载失败"),this.testDataLoading=!1}))},close(){this.show=!1},submitAddAssets(e,t){this.showAssetsAddDialog=!1,this.fileName=`${t}-${e.name}-V${e.select}`,this.ruleUuid=e.uuid,this.assetsVersion=e.select,this.temptest()},submitTest(){this.testData.facts.forEach((e=>{e.fields.forEach((e=>{this.$utils.isCollection(e.type)&&Array.isArray(e.original)&&(e.original=JSON.stringify(e.original))}))})),this.testLoading=!0,this.testData.result=null,this.lastSubmitFacts=this.testData.facts;let e={};if(e="{}"==JSON.stringify(this.pkg)&&this.testData.fileData?this.testData.fileData.pkg?this.testData.fileData.pkg:{}:this.pkg,!e.uuid)return this.$message.warning("请选择资源文件"),void(this.testLoading=!1);this.$axios.post("/knowledgepackage/test",this.$qs.stringify({uuid:e.uuid,facts:JSON.stringify(this.testData.facts),baselineVersion:1})).then((e=>{if(this.testLoading=!1,0==e.data.code){const t=e.data.data;void 0===t.result.fireNum&&(t.result.fireNum=0),this.testData.result=t.result,this.testData.facts=t.facts,this.testResult=t.result}else this.$message.error(e.data.msg?e.data.msg:"测试失败")})).catch((()=>{this.$message.error("测试失败"),this.testLoading=!1}))},saveSubmitTest(){if(!this.ruleUuid)return void this.$message.warning("请选择资源文件");this.testData.fileData={fileName:this.fileName,ruleUuid:this.ruleUuid,assetsVersion:this.assetsVersion,pkg:this.pkg?this.pkg:this.testData.fileData.pkg},this.testData.facts.forEach((e=>{e.fields.forEach((e=>{e.value&&(e.value="")}))}));const e={content:JSON.stringify(this.testData),ruleUuid:this.ruleUuid,uuid:this.assets.uuid,assetsVersion:this.assetsVersion};this.saveLoading=!0,this.$axios.post("/testcase/save",this.$qs.stringify(e)).then((e=>{this.saveLoading=!1,0==e.data.code?this.$message.success("保存成功"):this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败"),this.saveLoading=!1}))},refresh(){},deleData(){this.$axios.post("/testcase/delete",this.$qs.stringify({caseUuid:this.assets.uuid})).then((e=>{0==e.data.code?(this.$message.success("删除成功"),this.$emit("delete",this.assets.uuid)):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败")})).then((()=>{this.loading=!1}))},setRowIndex({row:e,rowIndex:t}){e.index=t},clickTestFact(e){this.testData.activeIndex=e.index},changeNumberInput(e){0==e.value&&(e.value=void 0)},getSubTypeName(e){if(this.$utils.isObject(e)){const t=this.$store.getters.getFactById(e);return t?t.name:""}return e},getObjectTypeName(e){const t=this.$store.getters.getFactById(e);return t?t.name:""},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.id][0],o=this.$refs["input_expectedValue_"+e.id][0];"值"==t.label&&a?this.$nextTick((function(){this.$utils.isBoolean(e.type)?a.toggleMenu():a.focus()})):"期望值"==t.label&&o&&this.$nextTick((function(){o.focus()}))},chooseHistory(e){if(this.testData.facts.length>0){let t={};e.forEach((e=>{e.fields.forEach((s=>{t[e.id+"_"+s.id]=s.original}))})),this.testData.facts.forEach((e=>{e.fields.forEach((s=>{s.original=t[e.id+"_"+s.id]}))}))}},showFlow(e){const t=this.testResult.fireNodes[e];this.ruleflowTrace.uuid=t.flowUuid,this.ruleflowTrace.version=t.versionNo,this.ruleflowTrace.nodes=t.nodes,this.ruleflowTrace.show=!0},showAssets(e){const t=this.testResult.fireRules[e];this.viewingAssets.uuid=t.uuid,this.viewingAssets.version=t.version,this.viewingAssets.show=!0},inputInteger:e=>-1!=["Integer","Long"].indexOf(e.type)}};var Ys=(0,A.Z)(Zs,Js,[],!1,null,"474f847d",null);Ys.options.__file="src/view/decision/project/testcase/index.vue";const Ks=Ys.exports;var Xs=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:e.deleAll}},[e._v("清空回收站")]),e._v(" "),s("el-button",{attrs:{loading:e.saveLoading,icon:"el-icon-success"},on:{click:e.returnBack}},[e._v("\n      "+e._s(e.saveLoading?"还原中...":"批量还原")+"\n    ")]),e._v(" "),s("el-button",{attrs:{loading:e.testLoading,icon:"el-icon-delete"},on:{click:e.del}},[e._v("\n      "+e._s(e.testLoading?"删除中...":"批量删除")+"\n    ")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],ref:"table",attrs:{"element-loading-text":"数据加载中...",data:e.recycleData},on:{"sort-change":e.sortChange,"selection-change":e.checkSelect}},[s("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),s("el-table-column",{attrs:{prop:"assetsType",label:"文件类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("span",[e._v("\n          "+e._s(e.$utils.getAssetsTypeText(t.row.assetsType))+e._s("dir"==t.row.type?"/文件夹":"")+e._s("tpl"==t.row.type?"模板":"")+"\n        ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"assetsName",label:"文件名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"creator.realname",label:"删除人"}}),e._v(" "),s("el-table-column",{attrs:{label:"删除日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-popconfirm",{attrs:{title:"确定彻底删除？"},on:{confirm:function(s){return e.del(t.row,!1)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("彻底删除")])],1),e._v(" "),s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.returnBack(t.row,!1)}}},[e._v("还原")])]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"page-size":e.pageNum,"current-page":e.page},on:{"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},change:e.initData}})],1)};Xs._withStripped=!0;const Qs={name:"index",data:()=>({tableLoading:!1,recycleData:[],page:1,pageNum:10,total:0,sortOption:{sortField:"",sortDirection:""},tabSelect:[],testLoading:!1,saveLoading:!1}),computed:{isReload(){return this.$store.state.reloadRecyle}},watch:{isReload(e){e&&this.initData()}},mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/recycle",{params:{page:this.page,pageNum:this.pageNum,assetsType:this.assetsType,projectUuid:this.$route.params.uuid}}).then((e=>{0==e.data.code&&(this.recycleData=e.data.data,this.total=e.data.total,this.$store.commit("setRecyle",!1))})).then((()=>{this.tableLoading=!1}))},checkSelect(e){this.tabSelect=[],e.forEach((e=>{this.tabSelect.push({uuid:e.uuid,type:e.type,assetsUuid:e.assetsUuid})}))},del(e=[],t=!0){let s,i=this.tabSelect.length;i||!t?(s=t&&i?this.tabSelect:[{uuid:e.uuid,type:e.type,assetsUuid:e.assetsUuid}],this.$axios.post("/recycle/delete",this.$qs.stringify({deleteJson:JSON.stringify(s)})).then((e=>{this.loading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.loading=!1}))):this.$message.warning("请选择要删除的文件")},deleAll(){this.$confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/recycle/empty",this.$qs.stringify({projectUuid:this.$route.params.uuid})).then((e=>{0==e.data.code?(this.$message.success("清空成功"),this.initData(),this.$emit("delete")):this.$message.error(e.data.msg?e.data.msg:"清空失败")})).catch((()=>{this.$message.error("清空失败")}))}))},returnBack(e=[],t=!0){let s,i=this.tabSelect.length;if(t&&i)s=this.tabSelect;else{if(t)return void this.$message.warning("请选择要还原的文件");s=[{uuid:e.uuid,type:e.type,assetsUuid:e.assetsUuid}]}this.$axios.post("/recycle/restore",this.$qs.stringify({restoreData:JSON.stringify(s),projectUuid:this.$route.params.uuid})).then((e=>{0==e.data.code?(this.$message.success("还原成功"),this.initData(),this.$emit("reduction",e.data.data)):this.$message.error(e.data.msg?e.data.msg:"还原失败")})).catch((()=>{this.$message.error("还原失败")}))},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.initData()}}};var ei=(0,A.Z)(Qs,Xs,[],!1,null,"7ecd4e64",null);ei.options.__file="src/view/decision/project/recycle/index.vue";const ti=ei.exports;var si=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"treeMenu"},[e.isHaveMenu(e.menuData.type)?s("div",{staticClass:"searchModel"},[s("span",[e.menuData.locked?s("i",{staticClass:"el-icon-lock"}):e.menuData.editor?s("i",{staticClass:"el-icon-edit"}):e._e(),e._v(" "),"menu-fact"==e.menuData.type?s("i",{class:e.menuData.icon}):s("i",{class:e.menuData.leaf?e.menuData.icon:"el-icon-folder-opened"}),e._v(" "),s("span",[e._v(e._s(e.menuData.label))])]),e._v(" "),"menu-fact"==e.menuData.type&&e.$hasPerm("project.asset:add")?s("span",[s("dropdown",{attrs:{trigger:"hover"}},[s("span",{staticStyle:{color:"#fff"}},[s("i",{staticClass:"el-icon-more"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",[s("el-upload",{attrs:{action:"","on-change":e.upload,"auto-upload":!1,"show-file-list":!1,accept:".jar, .class, .java"}},[s("i",{staticClass:"iconfont iconVersionupdaterule-copy"}),e._v(" 上传文件\n            ")])],1)],1)],1)],1):e.menuData.leaf?e.menuData.leaf?s("span",[s("dropdown",{attrs:{trigger:"hover"},on:{command:e.handleFilecom}},[s("span",{staticStyle:{color:"#fff"}},[s("i",{staticClass:"el-icon-more"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[!e.menuData.type.startsWith("tpl_")&&"testcase"!=e.menuData.type&&e.$hasPerm("project.asset:edit")?[s("dropdown-item",{attrs:{icon:"el-icon-edit",command:e.beforeHandleCommand("move",e.menuData)}},[e._v("\n              移动\n            ")]),e._v(" "),s("dropdown-item",{attrs:{icon:"iconfont iconlist-2-copy",command:e.beforeHandleCommand("copy",e.menuData)}},[e._v("\n              复制\n            ")])]:e._e(),e._v(" "),!e.menuData.type.startsWith("tpl_")&&e.$hasPerm("project.asset:lock")?s("dropdown-item",{attrs:{icon:e.menuData.locked||e.menuData.editor?"el-icon-unlock":"el-icon-lock",command:e.beforeHandleCommand("lock",e.menuData)}},[e._v("\n            "+e._s(e.menuData.locked||e.menuData.editor?"解锁":"锁定")+"\n          ")]):e._e(),e._v(" "),e.$hasPerm("project.asset:del")?s("dropdown-item",{attrs:{icon:"el-icon-delete",command:e.beforeHandleCommand("del",e.menuData)}},[e._v("\n            删除\n          ")]):e._e()],2)],1)],1):e._e():s("span",[s("dropdown",{attrs:{trigger:"hover"},on:{command:e.handleDircom}},[s("span",{staticStyle:{color:"#fff"}},[s("i",{staticClass:"el-icon-more"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$hasPerm("project.asset:edit")?s("dropdown-item",{attrs:{icon:"el-icon-edit",command:e.beforeHandleCommand("edit",e.menuData)}},[e._v("\n            编辑\n          ")]):e._e(),e._v(" "),e.$hasPerm("project.asset:lock")?s("dropdown-item",{attrs:{icon:e.menuData.locked?"el-icon-unlock":"el-icon-lock",command:e.beforeHandleCommand("lock",e.menuData)}},[e._v("\n            "+e._s(e.menuData.locked?"解锁":"锁定")+"\n          ")]):e._e(),e._v(" "),e.$hasPerm("project.asset:del")?s("dropdown-item",{attrs:{icon:"el-icon-delete",command:e.beforeHandleCommand("del",e.menuData)}},[e._v("\n            删除\n          ")]):e._e()],1)],1)],1)]):s("div",[s("span",[e.menuData.locked?s("i",{staticClass:"el-icon-lock"}):e._e(),e._v(" "),e.menuData.icon?s("i",{class:e.menuData.icon}):s("i",{class:e.menuData.leaf?e.menuData.icon:"el-icon-folder-opened"}),e._v(" "),s("span",[e._v(e._s(e.menuData.label))])])])])};si._withStripped=!0;const ii={name:"index",props:{menuNode:Object,menuData:Object},watch:{},data:()=>({haveMenu:["menu-fact","fact","constant","guidedrule","rulescript","ruletable","ruletree","scorecard","ruleflow","tpl_guidedrule","tpl_ruletable","tpl_ruletree","tpl_scorecard","testcase"]}),methods:{handleDircom(e){this.$emit("handleCommand","DIR",e)},isHaveMenu(e){return-1!=this.haveMenu.indexOf(e)},handleFilecom(e){this.$emit("handleCommand","FILE",e)},beforeHandleCommand:(e,t)=>({command:e,data:t}),upload(e){this.$emit("importFact",e)}}};var ai=(0,A.Z)(ii,si,[],!1,null,null,null);ai.options.__file="src/view/decision/project/assets/treeMenu.vue";const oi=ai.exports;var ni=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-tabs",[s("el-tab-pane",{attrs:{label:"概述",lazy:""}},[s("profile",{attrs:{project:e.project},on:{"jump-activity":function(t){return e.$emit("jump-activity",t)}}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"活动",lazy:""}},[s("activity",{attrs:{project:e.project},on:{"jump-activity":function(t){return e.$emit("jump-activity",t)}}})],1)],1)};ni._withStripped=!0;var ri=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-row",{staticStyle:{"margin-bottom":"15px"},attrs:{gutter:15}},[s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{header:"快速编辑"}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dashAssetsLoading,expression:"dashAssetsLoading"}],style:{height:e.dashAssetsHeight,overflow:"auto"},attrs:{"element-loading-text":"数据加载中..."}},[e.dashAssets.length>0?e._l(e.dashAssets,(function(t){return s("p",{staticClass:"dash-assets-item",on:{click:function(s){return e.jumpAssets(t)}}},[s("el-link",{attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),e.jumpAssets(t)}}},[e._v(e._s(t.assetsName))]),e._v(" "),s("span",{staticClass:"pull-right font-secondary",staticStyle:{"margin-right":"10px"}},[e._v(e._s(e.$utils.getAssetsTypeText(t.assetsType)))])],1)})):e.dashAssetsLoading?e._e():s("div",{staticClass:"font-secondary",style:{textAlign:"center",lineHeight:e.dashAssetsHeight}},[e._v("暂无数据")])],2)])],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-card",{attrs:{header:"项目信息"}},[s("div",{ref:"dash_base"},[s("p",{staticStyle:{"margin-top":"0px"}},[s("span",{staticClass:"font-common"},[e._v("项目名称：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.project.name))])]),e._v(" "),s("p",[s("span",{staticClass:"font-common"},[e._v("创建人：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.project.creator&&e.project.creator.realname))])]),e._v(" "),s("p",[s("span",{staticClass:"font-common"},[e._v("创建时间：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e._f("formatDateTime")(e.project.createTime)))])]),e._v(" "),s("p",[s("span",{staticClass:"font-common"},[e._v("更新时间：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e._f("formatDateTime")(e.project.updateTime)))])]),e._v(" "),s("p",{staticStyle:{"margin-bottom":"0px"}},[s("span",{staticClass:"font-common"},[e._v("项目详情：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.project.description))])])])])],1)],1),e._v(" "),s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:10}},[s("el-card",{attrs:{header:"项目成员"}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.projectMembersLoading,expression:"projectMembersLoading"}],attrs:{data:e.projectMembers,border:"",height:"300","element-loading-text":"数据加载中..."}},[s("el-table-column",{attrs:{label:"姓名",prop:"realname"}}),e._v(" "),s("el-table-column",{attrs:{label:"机构",prop:"org.name"}}),e._v(" "),s("el-table-column",{attrs:{label:"活跃度"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("el-progress",{attrs:{percentage:e.row.percentage,"show-text":!1}})]}}])})],1)],1)],1),e._v(" "),s("el-col",{attrs:{span:14}},[s("el-card",{attrs:{header:"资源占比"}},[s("echarts-pie",{attrs:{data:e.countAssets}})],1)],1)],1)],1)};ri._withStripped=!0;const li={name:"profile",props:{project:Object},data:()=>({projectMembers:[],projectMembersLoading:!1,dashAssetsLoading:!1,dashAssets:[],dashAssetsHeight:"100%"}),mounted(){this.dashAssetsHeight=this.$refs.dash_base.offsetHeight+"px",this.loadProjectMembers(),this.loadDashAssets()},methods:{loadProjectMembers(){this.projectMembersLoading=!0,this.$axios.get("/project/dash-members?projectUuid="+this.project.uuid).then((e=>{if(this.projectMembersLoading=!1,0==e.data.code){const t=e.data.data.members;if(t.length>0){const e=t.reduce(((e,t)=>({activity:(e.activity||0)+(t.activity||0)}))).activity;this.projectMembers=t.map((t=>(t.percentage=e>0?t.activity/e*100:0,t)))}}})).catch((e=>{console.error(e),this.projectMembersLoading=!1}))},countAssets(){return this.$axios.get("/project/count-assets?projectUuid="+this.project.uuid).then((e=>{if(0==e.data.code){const t=e.data.data;return Object.keys(t).map((e=>({value:t[e],name:this.$utils.getAssetsTypeText(e)})))}return[]}))},loadDashAssets(){this.dashAssetsLoading=!0,this.$axios.get("/project/dash-assets",{params:{projectUuid:this.project.uuid}}).then((e=>{this.dashAssetsLoading=!1,0==e.data.code&&this.dashAssets.push(...e.data.data)})).catch((e=>{this.dashAssetsLoading=!1}))},jumpAssets(e){this.$emit("jump-activity",{assetsUuid:e.assetsUuid,assetsType:e.assetsType})}}};var ci=(0,A.Z)(li,ri,[],!1,null,"6f1983b1",null);ci.options.__file="src/view/decision/project/home/profile.vue";const di=ci.exports;var ui=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.timelineLoading,expression:"timelineLoading"}],style:{height:e.timelineLoading?"150px":"100%"},attrs:{"element-loading-text":"数据加载中..."}},[e.timeline.length>0?[s("el-timeline",[e._l(e.timeline,(function(t){return s("el-timeline-item",{key:t.date,attrs:{timestamp:t.date,placement:"top"}},[s("el-card",[e._l(t.activities,(function(t){return[s("el-link",{attrs:{type:"primary"},on:{click:function(s){return e.jump(t)}}},[e._v(e._s(e.parseDesc(t)))]),e._v(" "),s("p",{staticClass:"font-common"},[e._v(e._s(e._f("getRealname")(t.user))+" "+e._s(e._f("formatTime")(t.createTime)))])]})),e._v(" "),e.hasMoreActivities(t)?[t.activitiesMoreLoading?s("span",{staticClass:"font-secondary"},[e._v("正在加载..."),s("i",{staticClass:"el-icon-loading"})]):s("el-link",{attrs:{type:"info"},on:{click:function(s){return e.loadMoreActivities(t)}}},[e._v("\n              加载更多"),s("i",{staticClass:"el-icon-bottom"})])]:e._e()],2)],1)})),e._v(" "),e.hasMoreTimeline()?[e.timelineMoreLoading?s("span",{staticClass:"font-secondary"},[e._v("正在加载..."),s("i",{staticClass:"el-icon-loading"})]):s("el-link",{attrs:{type:"info"},on:{click:e.loadMoreTimeline}},[e._v("\n          加载更多"),s("i",{staticClass:"el-icon-bottom"})])]:e._e()],2)]:e.timelineLoading?e._e():s("div",{staticClass:"font-secondary",staticStyle:{"text-align":"center"}},[e._v("暂无数据")])],2)};ui._withStripped=!0;const pi={ASSETS_ADD:"新建资源",ASSETS_IMPORT:"导入资源",ASSETS_SAVE:"保存资源",ASSETS_EDIT:"编辑资源",ASSETS_DEL:"删除资源",ASSETS_LOCK:"锁定资源",ASSETS_UNLOCK:"解锁资源",ASSETS_COPY:"复制资源",ASSETS_MOVE:"移动资源",ASSETS_VERSION:"保存新版本",TEMPLATE_SAVE:"保存模板",PKG_ADD:"添加知识包",PKG_EDIT:"编辑知识包",PKG_DEL:"删除知识包",BASELINE_ADD:"新增基线",BASELINE_PUB:"发布基线",BASELINE_DEL:"废除基线"},hi={name:"activity",props:{project:Object},data:()=>({timelineLoading:!1,timeline:[],timelinePage:1,timelinePageNum:3,timelineMoreLoading:!1,activitiesPage:1,activitiesPageNum:10}),mounted(){this.loadTimeline()},methods:{loadTimeline(){this.showTimelineLoading(),this.$axios.get("/project/activities",{params:{projectUuid:this.project.uuid,page:this.timelinePage}}).then((e=>{this.hideTimelineLoading(),0==e.data.code&&this.timeline.push(...e.data.data.timeline)})).catch((e=>{this.hideTimelineLoading()}))},hasMoreTimeline(){return this.timeline.length%this.timelinePageNum==0},loadMoreTimeline(){this.timelinePage++,this.loadTimeline()},showTimelineLoading(){1==this.timelinePage?this.timelineLoading=!0:this.timelineMoreLoading=!0},hideTimelineLoading(){1==this.timelinePage?this.timelineLoading=!1:this.timelineMoreLoading=!1},hasMoreActivities(e){return e.activities.length%this.activitiesPageNum==0},loadMoreActivities(e){this.$set(e,"activitiesMoreLoading",!0),this.$axios.get("/project/activities/"+e.date,{params:{projectUuid:this.project.uuid,page:++this.activitiesPage}}).then((t=>{e.activitiesMoreLoading=!1,0==t.data.code&&e.activities.push(...t.data.data.activities)})).catch((t=>{e.activitiesMoreLoading=!1}))},jump(e){this.$emit("jump-activity",e)},parseDesc:e=>`${pi[e.code]}：${e.description}`}};var mi=(0,A.Z)(hi,ui,[],!1,null,"e24c7f92",null);mi.options.__file="src/view/decision/project/home/activity.vue";const fi={name:"home",components:{profile:di,activity:mi.exports},props:{project:Object}};var gi=(0,A.Z)(fi,ni,[],!1,null,"d7ce3bf2",null);gi.options.__file="src/view/decision/project/home/home.vue";const vi=gi.exports;var bi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-container",[s("el-aside",{attrs:{width:"250px"}},[s("el-input",{staticClass:"search",staticStyle:{"margin-bottom":"10px"},attrs:{size:"mini","suffix-icon":"el-icon-search",clearable:"",placeholder:"搜索"},on:{change:e.search},model:{value:e.searchWords,callback:function(t){e.searchWords="string"==typeof t?t.trim():t},expression:"searchWords"}}),e._v(" "),s("el-tree",{ref:"tree",attrs:{data:e.treeData,"highlight-current":"","node-key":"label"},on:{"node-click":e.clickTreeNode}})],1),e._v(" "),s("el-main",{staticStyle:{"padding-top":"0px"}},[s("div",{staticClass:"toolbar"},[e.$hasPerm("function:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n          添加函数\n        ")]):e._e(),e._v(" "),e.activeFunction.jarName?s("el-button",{attrs:{icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.downloadFunc}},[e._v("\n          "+e._s(e.downloadLoading?"加载中...":"下载函数")+"\n        ")]):e.$hasPerm("function:edit")?s("el-button",{attrs:{icon:"el-icon-edit",disabled:e.$utils.isBlank(e.activeFunction.uuid),loading:e.editLoading},on:{click:e.editFunc}},[e._v("\n          "+e._s(e.editLoading?"加载中...":"编辑函数")+"\n        ")]):e._e(),e._v(" "),e.$hasPerm("function:delete")?s("el-popconfirm",{attrs:{title:"确定删除当前函数？"},on:{confirm:function(t){return e.deleteFunc(e.activeFunction.uuid)}}},[s("el-button",{attrs:{slot:"reference",icon:"el-icon-delete",disabled:e.$utils.isBlank(e.activeFunction.uuid),loading:e.deleteLoading},slot:"reference"},[e._v("\n            "+e._s(e.deleteLoading?"加载中...":"删除函数")+"\n          ")])],1):e._e()],1),e._v(" "),e.activeFunction.uuid?s("el-row",{staticStyle:{margin:"20px 0px"}},[s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建人：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e.activeFunction.creator.realname))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("创建时间：")]),e._v(" "),s("span",{staticClass:"font-primary"},[e._v(e._s(e._f("formatDateTime")(e.activeFunction.createTime)))])]),e._v(" "),s("el-col",{attrs:{span:8}},[s("span",{staticClass:"font-common"},[e._v("更新时间：")]),e._v(" "),e.activeFunction.updateTime?s("span",{staticClass:"font-primary"},[e._v("\n            "+e._s(e._f("formatDateTime")(e.activeFunction.updateTime))+"\n          ")]):e._e()])],1):e._e(),e._v(" "),s("el-table",{ref:"table",attrs:{data:e.methods,border:""}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-table",{style:{width:e.expandTableWidth()},attrs:{data:t.row.params,border:""}},[s("el-table-column",{attrs:{type:"index"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数类型",prop:"type"}})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"函数中文名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"函数英文名称",prop:"declare"}}),e._v(" "),s("el-table-column",{attrs:{label:"函数返回类型",prop:"returnType"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.clickTest(t.row)}}},[e._v("测试")])]}}])})],1)],1)],1),e._v(" "),s("el-dialog",{ref:"dialog",attrs:{title:"编写函数集",visible:e.showAddDialog,fullscreen:"","custom-class":"func-dialog","before-close":e.beforeCloseEditDialog},on:{"update:visible":function(t){e.showAddDialog=t},opened:e.openDialog,closed:e.closeAddDialog}},[s("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.editorLoading,expression:"editorLoading"}],attrs:{"element-loading-text":"初始化编辑框..."},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[s("el-tab-pane",{attrs:{label:"编写",name:"src"}},[s("el-form",{ref:"srcForm",attrs:{model:e.srcForm,rules:e.srcRules}},[s("el-form-item",{attrs:{prop:"src"}},[s("div",{ref:"editor",class:{"monaco-editor-loading":e.editorInLoading},style:{height:e.editorHeight},attrs:{name:"src"}})])],1)],1),e._v(" "),e.srcForm.uuid?e._e():s("el-tab-pane",{attrs:{label:"上传",name:"jar"}},[s("el-form",{ref:"jarForm",attrs:{model:e.jarForm,rules:e.jarRules}},[s("el-form-item",{attrs:{label:"函数包",prop:"file"}},[s("el-upload",{ref:"upload",attrs:{action:"",accept:".jar",limit:1,"on-change":e.changeFile,"on-remove":function(){return e.jarForm.file=null},"auto-upload":!1,"show-file-list":!0}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-files"}},[e._v("选择文件")])],1)],1)],1)],1)],1),e._v(" "),s("span",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.closeEditDialog}},[e._v("取 消")]),e._v(" "),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.addLoading,expression:"addLoading"}],attrs:{type:"primary"},on:{click:e.submit}},[e._v(e._s(e.addLoading?"提交中...":"确 定"))])],1)],1),e._v(" "),s("el-dialog",{ref:"testDialog",attrs:{title:"单元测试",top:e.$dialogTop,visible:e.showTestDialog},on:{"update:visible":function(t){e.showTestDialog=t},opened:e.openTestDialog,closed:e.closeTestDialog}},[s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-lightning",loading:e.testLoading},on:{click:e.submitTest}},[e._v("\n          "+e._s(e.testLoading?"加载中...":"测 试")+"\n        ")])],1),e._v(" "),s("el-col",{style:{maxHeight:e.testMaxHeight,overflow:"auto"},attrs:{span:20}},[s("h1",{staticStyle:{"margin-top":"0px"}},[e._v(e._s(e.testMethod.funcName)+"."+e._s(e.testMethod.name))]),e._v(" "),e.testMethod.params.length>0?[s("p",{staticClass:"font-primary test-title"},[e._v("输入参数")]),e._v(" "),s("el-table",{ref:"paramsTable",staticClass:"tb-edit",attrs:{data:e.testMethod.params,border:"","row-style":{cursor:"pointer"},"highlight-current-row":""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isNumber(t.row.type)?s("el-input-number",{ref:"param_value_"+t.$index,staticStyle:{width:"100%"},attrs:{"step-strictly":e.inputInteger(t.row),min:e.inputMin(t.row),max:e.inputMax(t.row),controls:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isBoolean(t.row.type)?s("el-select",{ref:"param_value_"+t.$index,attrs:{placeholder:"请选择"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)?s("date-picker",{ref:"param_value_"+t.$index,staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isCollection(t.row.type)?s("test-collection",{ref:"param_value_"+t.$index,attrs:{stringify:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isObject(t.row.type)?s("test-object",{ref:"param_value_"+t.$index,attrs:{stringify:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):s("el-input",{ref:"param_value_"+t.$index,model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n                  "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n                ")]):e.$utils.isCollection(t.row.type)||e.$utils.isObject(t.row.type)?e._e():s("span",[e._v("\n                  "+e._s(t.row.value)+"\n                ")])]}}],null,!1,1703483623)}),e._v(" "),s("el-table-column",{attrs:{label:"参数名称",prop:"name",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"参数类型",prop:"type",align:"center"}})],1)]:e._e(),e._v(" "),s("p",{staticClass:"font-primary test-title"},[e._v("返回结果")]),e._v(" "),s("el-table",{attrs:{data:e.testMethod.returnValue,border:""}},[s("el-table-column",{attrs:{label:"返回值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.value)+"\n            ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"返回类型",prop:"type",align:"center"}})],1)],2)],1)],1)],1)};bi._withStripped=!0;const wi={name:"func",data(){return{loading:!1,functions:[],methods:[],treeData:[],activeFunction:{},searchWords:"",showAddDialog:!1,activeTab:"src",srcForm:{uuid:"",src:"",projectUuid:this.$route.params.uuid},addLoading:!1,jarForm:{file:null},srcRules:{src:[{required:!0,message:"请编写函数",trigger:"blur"}]},jarRules:{file:[{required:!0,message:"请上传函数包",trigger:"change"}]},editLoading:!1,downloadLoading:!1,editor:null,editorLoading:!1,editorHeight:"100%",showTestDialog:!1,testMethod:{funcName:"",name:"",params:[],returnValue:[]},testLoading:!1,deleteLoading:!1,testMaxHeight:"100%",editorInLoading:!1,initVersionId:-1,editVersionId:-1}},mounted(){window.addEventListener("resize",this.setEditorHeight),this.loadFunctions()},methods:{loadFunctions(e){this.loading=!0,this.$axios.get("/function/project",{params:{projectUuid:this.$route.params.uuid}}).then((t=>{0==t.data.code&&(this.functions=t.data.data,this.setTreeData(),this.activeTreeNode(e)),this.loading=!1})).catch((()=>{this.loading=!1}))},search(){this.setTreeData(),this.activeTreeNode()},setTreeData(){this.treeData=[],this.functions.forEach((e=>{if(this.searchWords){const t=e.methods.filter((e=>-1!=e.name.indexOf(this.searchWords)||-1!=e.declare.indexOf(this.searchWords)));t.length>0&&this.treeData.push({label:e.name,func:{uuid:e.uuid,name:e.name,methods:t}})}else this.treeData.push({label:e.name,func:e})}))},activeTreeNode(e){this.treeData.length>0?this.$nextTick((()=>{const t=e?this.$utils.arrayFind(this.treeData,(t=>t.label==e)):this.treeData[0];t&&(this.$refs.tree.setCurrentKey(t.label),this.clickTreeNode(t))})):this.activeFunction={}},clickTreeNode(e){this.methods=e.func.methods,this.activeFunction=e.func},submit(e){"src"==this.activeTab?this.submitSrc(e):this.submitJar()},submitSrc(e){this.srcForm.src=this.editor.getValue().trim(),this.$refs.srcForm.validate((t=>{if(t){this.addLoading=!0;const t=this.srcForm.uuid?"/function/edit":"/function/add";this.$axios.post(t,this.$qs.stringify(this.srcForm)).then((t=>{if(0==t.data.code)this.$message.success("操作成功"),!0!==e&&(this.showAddDialog=!1),this.loadFunctions(t.data.data.name),this.$store.dispatch("loadFunctions",{projectUuid:this.$route.params.uuid});else if(t.data.msg){const e=t.data.msg.replace(/\n/g,"<br>").replace(/ /g,"&ensp;");this.$message.error({message:e,duration:5e3,dangerouslyUseHTMLString:!0,showClose:!0})}else this.$message.error("操作失败");this.addLoading=!1})).catch((e=>{console.error(e),this.$message.error("操作失败"),this.addLoading=!1}))}}))},changeFile(e){this.jarForm.file=e,this.$refs.jarForm.validate()},submitJar(){this.$refs.jarForm.validate((e=>{if(e){const e=new FormData;e.append("file",this.jarForm.file.raw),this.addLoading=!0,this.$axios.post("/function/upload",e,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{0==e.data.code?(this.$message.success("上传成功"),this.showAddDialog=!1,this.loadFunctions(),this.$store.dispatch("loadFunctions",{projectUuid:this.$route.params.uuid})):this.$message.error(e.data.msg?e.data.msg:"上传失败"),this.addLoading=!1})).catch((()=>{this.$message.error("上传失败"),this.addLoading=!1}))}}))},closeAddDialog(){this.jarForm.file&&this.$refs.upload.clearFiles(),this.srcForm.uuid="",this.$refs.srcForm&&this.$refs.srcForm.resetFields(),this.$refs.jarForm&&this.$refs.jarForm.resetFields()},deleteFunc(e){this.deleteLoading=!0,this.$axios.post("/function/delete",this.$qs.stringify({uuid:e})).then((e=>{this.deleteLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.loadFunctions()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.deleteLoading=!1}))},editFunc(){this.editLoading=!0,this.$axios.get("/function/view",{params:{uuid:this.activeFunction.uuid}}).then((e=>{0==e.data.code?(this.showAddDialog=!0,this.$nextTick((()=>{this.srcForm.uuid=this.activeFunction.uuid,this.srcForm.src=e.data.data}))):this.$message.error(e.data.msg?e.data.msg:"操作失败"),this.editLoading=!1})).catch((()=>{this.$message.error("操作失败"),this.editLoading=!1}))},downloadFunc(){const e=this;this.downloadLoading=!0,this.$axios({method:"get",url:"/function/download?uuid="+this.activeFunction.uuid,responseType:"blob"}).then((t=>{if(this.downloadLoading=!1,"application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"下载失败")},s.readAsText(t.data)}else{let s=window.URL.createObjectURL(new Blob([t.data])),i=document.createElement("a");i.style.display="none",i.href=s,i.target="_blank",i.setAttribute("download",e.activeFunction.jarName),document.body.appendChild(i),i.click()}})).catch((()=>{this.$message.error("下载失败"),this.downloadLoading=!1}))},openDialog(){this.initEditor().then((()=>{this.editor.setValue(this.srcForm.src),this.editor.focus(),this.initVersionId=this.editVersionId})).catch((e=>{console.error(e),this.$message.error("初始化编辑框失败")}))},async initEditor(){if(this.setEditorHeight(),null==this.editor)try{this.editorLoading=!0;const e=await s.e(720).then(s.bind(s,59595)),t=e.editor.create(this.$refs.editor,{language:"java"});this.bindEditorCommand(t,e),this.bindEditorAction(t,e),this.bindEditorEvent(t),this.editorLoading=!1,this.editor=t}catch(e){throw this.editorLoading=!1,new Error(e)}else this.editor.layout()},bindEditorCommand(e,t){const s=this;e.addCommand(t.KeyMod.CtrlCmd|t.KeyCode.KEY_S,(function(){s.submit(!0)}))},bindEditorAction(e,t){this.addEncryptAction(e,t),this.addTestAction(e,t)},bindEditorEvent(e){e.onDidChangeModelContent((e=>{this.editVersionId=e.versionId}))},addEncryptAction(e,t){const s=this;e.addAction({id:"encrypt",label:"加密",contextMenuGroupId:"navigation",run:function(t){const i=t.getSelection(),a=t.getModel().getValueInRange(i);return s.$utils.isBlank(a)?(s.$message.warning("没有选中内容"),null):(s.editorInLoading=!0,s.$axios.post("/function/encrypt",s.$qs.stringify({text:a})).then((t=>{s.editorInLoading=!1,0==t.data.code?e.executeEdits(null,[{range:i,text:t.data.data,forceMoveMarkers:!0}]):s.$message.error(t.data.msg?t.data.msg:"加密失败")})).catch((e=>{s.editorInLoading=!1,s.$message.error("加密失败")})),null)}})},addTestAction(e,t){const s=this;e.addAction({id:"test",label:"单元测试",contextMenuGroupId:"navigation",run:function(e){let t=e.getPosition().lineNumber,i=0;do{if(-1!=e.getModel().getLineContent(t).indexOf("@FunctionMethodProperty")){i=t;break}}while(--t>0);if(i<=0)return s.$message.warning("没有找到函数注解"),null;let a="";const o=e.getModel().getLineCount();do{const t=e.getModel().getLineContent(i);if(a+=t,t.trim().endsWith(")"))break}while(++i<=o);const n=a.match(/name[\s\S]*?=[\s\S]*?"(.+?)"/);if(null==n)return s.$message.warning("没有找到函数名称"),null;try{const t=n[1].trim();s.editorInLoading=!0,s.$axios.post("/function/method/params",s.$qs.stringify({src:e.getValue(),name:t})).then((e=>{if(s.editorInLoading=!1,0==e.data.code){const t=e.data.data;s.testMethod.funcName=t.funcName,s.testMethod.name=t.name,s.testMethod.params=t.params.map(((e,t)=>(e.index=t,e))),s.testMethod.returnValue=[{type:t.returnType}],s.showTestDialog=!0}else s.$message.error(e.data.msg?e.data.msg:"单元测试失败")})).catch((e=>{s.$message.error("单元测试失败"),s.editorInLoading=!1}))}catch(e){console.error(e)}return null}})},setEditorHeight(){if(!this.showAddDialog)return;const e=this.$refs.dialog.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=e.querySelector(".el-dialog__footer"),a=s.querySelector(".el-tabs__header"),o=window.getComputedStyle(a,null),n=window.getComputedStyle(i,null),r=parseInt(o.getPropertyValue("margin-bottom")),l=parseInt(n.getPropertyValue("padding-top")),c=parseInt(n.getPropertyValue("padding-bottom"));this.editorHeight=window.innerHeight-t.offsetHeight-a.offsetHeight-i.offsetHeight-r-l-c-1+"px",null!=this.editor&&this.$nextTick((()=>{this.editor.layout()}))},expandTableWidth(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?this.$refs.table.$el.offsetWidth-100+"px":"100%"},inputInteger:e=>-1!=["Integer","Long"].indexOf(e.type),inputMin:e=>"Integer"==e.type?-2147483648:"Long"==e.type?-0x8000000000000000:void 0,inputMax:e=>"Integer"==e.type?2147483647:"Long"==e.type?0x8000000000000000:void 0,cellClick(e,t){const s=this.$refs["param_value_"+e.index];"参数值"==t.label&&s&&this.$nextTick((function(){this.$utils.isBoolean(e.type)?s.toggleMenu():s.focus()}))},submitTest(){const e=this.$utils.arrayFind(this.testMethod.params,(e=>this.$utils.isBlank(e.value)));if(null!=e)return this.$refs.paramsTable.setCurrentRow(e),this.$nextTick((()=>{this.$utils.isBoolean(e.type)?this.$refs[`param_value_${e.index}`].toggleMenu():this.$refs[`param_value_${e.index}`].focus()})),void this.$message.warning("请填写输入参数");const t={name:this.testMethod.name},s=[];this.testMethod.params.forEach((e=>{s.push({type:e.type,value:e.value})})),t.params=JSON.stringify(s),this.showAddDialog?t.src=this.editor.getValue():t.funcName=this.testMethod.funcName,this.testLoading=!0,this.$axios.post("/function/method/test",this.$qs.stringify(t)).then((e=>{this.testLoading=!1,0==e.data.code?this.$set(this.testMethod.returnValue[0],"value",e.data.data):this.$message.error(e.data.msg?e.data.msg:"单元测试失败")})).catch((e=>{this.testLoading=!1,this.$message.error("单元测试失败")}))},clickTest(e){this.testMethod.funcName=this.activeFunction.name,this.testMethod.name=e.name,this.testMethod.params=e.params.map(((e,t)=>(e.index=t,e))),this.testMethod.returnValue=[{type:e.returnType}],this.showTestDialog=!0},openTestDialog(){const e=this.$refs.testDialog.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=window.getComputedStyle(e,null),a=window.getComputedStyle(s,null),o=parseInt(i.getPropertyValue("margin-top")),n=parseInt(a.getPropertyValue("padding-top")),r=parseInt(a.getPropertyValue("padding-bottom"));this.testMaxHeight=window.innerHeight-o-t.offsetHeight-n-r-20+"px"},closeTestDialog(){this.testMethod.params.forEach((e=>e.value=null))},closeEditDialog(){this.beforeCloseEditDialog((()=>this.showAddDialog=!1))},beforeCloseEditDialog(e){this.initVersionId==this.editVersionId?e():this.$confirm("内容未保存, 是否继续退出?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e()}))}},beforeDestroy(){null!=this.editor&&this.editor.dispose(),window.removeEventListener("resize",this.setEditorHeight)}};var yi=(0,A.Z)(wi,bi,[],!1,null,"00ca3927",null);yi.options.__file="src/view/decision/project/func/func.vue";const _i={name:"assets",components:{"fact-assets":Ue,"constant-assets":ze,"guidedrule-assets":kt,"ruletable-assets":Ct,"ruletree-assets":Qt,"scorecard-assets":is,"ruleflow-assets":hs,"rulescript-assets":vs,pkg:Gs,searchResult:_s,treeMenu:oi,testcase:Ks,recycle:ti,home:vi,func:yi.exports},watch:{filterText(e){this.$refs.MenuTree.filter(e)},activeTab(e){this.$refs.MenuTree.setCurrentKey(e)},assetsLink(e,t){this.activateAssets(e.uuid)},asideCollapse(){this.resizePin()}},computed:{assetsLink(){return this.$store.state.assetsLink},asideWidth(){return this.asideCollapse?"40px":"250px"}},data(){const e=this;return{defaultProps:{children:"children",label:"label"},treeProps:{isLeaf:"leaf"},filterText:"",highlightCurrent:!0,expandedKey:[],defaultExpend:["setVariable","ruleConfiguration"],assetsGroup:[{id:"setVariable",uuid:"setVariable",label:"设置变量",icon:"el-icon-setting",children:[{id:"fact",uuid:"fact",type:"menu-fact",label:"数据模型",icon:"iconfont iconshujumoxing",children:[],leaf:!1},{id:"constant",uuid:"constant",type:"menu-constant",label:"枚举常量",icon:"iconfont iconxinzengchangliang",children:[],leaf:!1}]},{id:"ruleConfiguration",uuid:"ruleConfiguration",label:"规则配置",icon:"iconfont iconguize",children:[{id:"guidedrule",uuid:"guidedrule",type:"menu-guidedrule",label:"向导式决策集",icon:"iconfont iconweibiaoti-",children:[],leaf:!1},{id:"rulescript",uuid:"rulescript",type:"menu-rulescript",label:"脚本式决策集",icon:"iconfont el-icon-edit",children:[],leaf:!1},{id:"ruletable",uuid:"ruletable",type:"menu-ruletable",label:"决策表",icon:"iconfont iconjuecebiao",children:[],leaf:!1},{id:"ruletree",uuid:"ruletree",type:"menu-ruletree",label:"决策树",icon:"iconfont iconjuxingkaobei",children:[],leaf:!1},{id:"scorecard",uuid:"scorecard",type:"menu-scorecard",label:"评分卡",icon:"iconfont iconpingfenqia",children:[],leaf:!1},{id:"ruleflow",uuid:"ruleflow",type:"menu-ruleflow",label:"决策流",icon:"iconfont icongongzuoliu",children:[],leaf:!1}]},{id:"func",uuid:"func",label:"自定义函数",icon:"iconfont iconhanshu",leaf:!0},{id:"template",uuid:"template",label:"规则模板",icon:"el-icon-document-copy",children:[{id:"menu-tpl_guidedrule",uuid:"menu-tpl_guidedrule",type:"menu-tpl_guidedrule",label:"向导式决策集模板",icon:"iconfont iconweibiaoti-",children:[],leaf:!1},{id:"menu-tpl_ruletable",uuid:"menu-tpl_ruletable",type:"menu-tpl_ruletable",label:"决策表模板",icon:"iconfont iconjuecebiao",children:[],leaf:!1},{id:"menu-tpl_ruletree",uuid:"menu-tpl_ruletree",type:"menu-tpl_ruletree",label:"决策树模板",icon:"iconfont iconjuxingkaobei",children:[],leaf:!1},{id:"menu-tpl_scorecard",uuid:"menu-tpl_scorecard",type:"menu-tpl_scorecard",label:"评分卡模板",icon:"iconfont iconpingfenqia",children:[],leaf:!1}]},{id:"testcase",uuid:"testcase",label:"测试案例",icon:"el-icon-s-claim",children:[],leaf:!1},{id:"modelPackaging",uuid:"modelPackaging",label:"模型打包",icon:"el-icon-suitcase",children:[{id:"pkg",uuid:"pkg",label:"知识包",type:"pkg",leaf:!0}]},{id:"recycle",uuid:"recycle",label:"回收站",icon:"el-icon-delete",leaf:!0}],treeAssetsGroup:[],dirs:[],newFile:{type:"",name:"",description:"",tag:"",typeStr:"",dirParentId:"",dir:"",parentType:""},newFileRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"},{validator:function(t,s,i){!s||"fact"!=e.newFile.type&&"constant"!=e.newFile.type||-1==s.indexOf(".")?i():i(new Error("不能包含字符[.]"))}}],dir:[{validator:function(t,s,i){s||"dir"!=e.newFile.type?i():i(new Error("请选择文件夹"))}}]},showAddFileDialog:!1,activeTab:"",assetsArr:[],tagFilters:[],rightClickTab:"",folder:{id:"",name:""},showDirDialog:!1,dirs:[],addLoading:!1,showEditFolderDialog:!1,editLoading:!1,assetsLoading:!1,showDirMoveDialog:!1,dirsMove:[],moveNode:{},project:null,searchCondition:"variable",searchInput:"",node_had:null,resolve_had:null,dirsSelect:{},importLoading:!1,asideCollapse:!1}},mounted(){this.init()},beforeDestroy(){this.$refs.main.$el.removeEventListener("scroll",this.pin),window.removeEventListener("resize",this.resizePin),document.removeEventListener("click",this.hideContextMenu)},methods:{init(){this.$axios.get("/project/"+this.$route.params.uuid).then((e=>{0==e.data.code?(this.project=e.data.data,this.loadAssetsGroup(),this.loadBoms(),this.bindEvent()):(this.$message.error(e.data.msg?e.data.msg:"系统繁忙，请稍候再试"),this.$router.push("/decision/project"))})).catch((e=>{this.$message.error("系统繁忙，请稍候再试"),this.$router.push("/decision/project")}))},loadBoms(){"decisionKnowledgePackage"==this.$route.name&&this.activateAssets("pkg"),this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,callback:()=>{this.$route.params.assetsUuid&&this.activateAssets(this.$route.params.assetsUuid)}})},bindEvent(){this.$refs.main.$el.addEventListener("scroll",this.pin),window.addEventListener("resize",this.resizePin),document.querySelector(".el-tabs__header").addEventListener("contextmenu",this.showContextMenu),document.addEventListener("click",this.hideContextMenu),window.addEventListener("unload",this.unlockEditOnunload)},unbindEvent(){this.$refs.main.$el.removeEventListener("scroll",this.pin),window.removeEventListener("resize",this.resizePin),document.querySelector(".el-tabs__header").removeEventListener("contextmenu",this.showContextMenu),document.removeEventListener("click",this.hideContextMenu),window.removeEventListener("unload",this.unlockEditOnunload)},add(e){this.newFile.type=e,this.newFile.typeStr=this.$utils.getAssetsTypeText(e),this.showAddFileDialog=!0},closeAddDialog(){this.$refs.newFileForm.resetFields(),this.clearDir()},addSave(){this.$refs.newFileForm.validate((e=>{e&&(this.addLoading=!0,"dir"!=this.newFile.type?this.$axios.post("/assets/add",this.$qs.stringify({projectUuid:this.$route.params.uuid,name:this.newFile.name,description:this.newFile.description,type:this.newFile.type,dirParentId:this.newFile.dirParentId})).then((e=>{this.addLoading=!1,0==e.data.code?(this.showAddFileDialog=!1,this.$message.success("新建成功"),this.newFile.uuid=e.data.data,this.newFile.leaf=!0,this.newFile.dirParentId=this.newFile.dirParentId?this.newFile.dirParentId:this.newFile.type,this.appendTree(this.newFile),this.$refs.newFileForm.resetFields(),this.clearDir()):this.$message.error(e.data.msg?e.data.msg:"新建失败")})).catch((e=>{console.error(e),this.$message.error("新建失败"),this.addLoading=!1})):this.$axios.post("/folder",this.$qs.stringify({dirId:this.newFile.level,dirName:this.newFile.name,parentId:this.newFile.dirParentId,categoryName:this.newFile.parentType,projectUuid:this.$route.params.uuid})).then((e=>{this.addLoading=!1,0==e.data.code?(this.showAddFileDialog=!1,this.$message.success("新建成功"),this.newFile.uuid=e.data.data,this.newFile.leaf=!1,this.newFile.type=this.newFile.parentType,this.newFile.dirParentId=this.newFile.dirParentId?this.newFile.dirParentId:this.newFile.type,this.appendTree(this.newFile),this.$refs.newFileForm.resetFields(),this.clearDir()):this.$message.error(e.data.msg?e.data.msg:"新建失败")})).catch((()=>{this.$message.error("新建失败"),this.addLoading=!1})))}))},appendTree(e,t=!1,s=!0){let i=e.dirParentId;t&&(i="menu-"+i);const a=this.$refs.MenuTree.getNode(i),o=!!e.leaf,n={uuid:e.uuid,type:e.type,label:e.name,leaf:o};a&&a.loaded&&i&&this.$refs.MenuTree.append(n,a),o&&s&&this.activateAssets(e.uuid,t)},loadTreeNode(e,t){if(0===e.level)return this.node_had=e,this.resolve_had=t,t(this.treeAssetsGroup);let s="",i="";if(1===e.level&&"testcase"==e.data.id)s="testcase";else{if(1===e.level&&"recycle"==e.data.id)return t([]);if(1===e.level)return t(e.data.children)}if(2===e.level&&e.data.leaf){const s="modelPackaging"==e.parent.data.id,i="testcase"==e.parent.data.id;if(s||i)return t([])}else 2!==e.level||e.data.leaf?e.level>2&&(s=e.data.type,i=e.data.uuid):s=-1!=e.data.type.indexOf("menu-")?e.data.type.substring(5):e.data.type;this.$axios.get("/assets/tree",{params:{projectUuid:this.$route.params.uuid,type:s,parentUuid:i}}).then((e=>{if(0==e.data.code)return t(e.data.data);this.$message.error(e.data.msg?e.data.msg:"获取失败")})).catch((()=>{this.$message.error("获取失败")}))},loadAssetsGroup(){var e=JSON.stringify(this.assetsGroup);this.treeAssetsGroup=JSON.parse(e),this.node_had.childNodes=[],this.loadTreeNode(this.node_had,this.resolve_had),this.$nextTick((()=>{this.defaultExpend.forEach((e=>{this.$refs.MenuTree.store.nodesMap[e].expanded=!0}))})),this.setCurrentTab()},deleteAssets(e){this.removeTab(e);const t=this.$refs.MenuTree.getNode(e);t&&this.$refs.MenuTree.remove(t)},setCurrentTab(){this.assetsArr.length&&this.assetsArr.forEach((e=>{this.activeTab==e.uuid&&(this.expandedKey=[],this.expandedKey.push(e.uuid),this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey(e.uuid)})))}))},removeTab(e){if(!e)return;let t=this.assetsArr,s=this.activeTab,i=-1;t.some(((a,o)=>{if(a.uuid===e){if(s===e){let e=t[o+1]||t[o-1];e&&(s=e.uuid)}return i=o,!0}})),-1!=i&&(this.unlockEdit([t[i]]),this.assetsArr.splice(i,1)),this.activeTab=s},activateAssets(e,t=!1){let s;this.assetsArr.some((t=>{if(t.uuid==e)return s=!0,!0})),s?this.activeTab=e:t?t&&(this.assetsLoading=!0,this.$axios.get("/template/"+e).then((t=>{this.assetsLoading=!1,0==t.data.code?(t.data.data.isTemplate=!0,this.pushAssetsArr(t.data.data),this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey(t.data.data.uuid),this.activeTab=e}))):this.$message.error(t.data.msg?t.data.msg:"查询失败")})).catch((()=>{this.$message.error("查询失败"),this.assetsLoading=!1}))):"pkg"!=e&&"search"!=e?(this.assetsLoading=!0,this.$axios.get("/assets/"+e).then((t=>{if(this.assetsLoading=!1,0!=t.data.code||this.$utils.isBlank(t.data.data))this.$message.error(t.data.msg?t.data.msg:"查询失败");else{const s=t.data.data;this.expandedKey=[s.uuid],this.pushAssetsArr(s),this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey(s.uuid),this.activeTab=e})),this.lockEdit(s)}})).catch((e=>{console.error(e),this.$message.error("查询失败"),this.assetsLoading=!1}))):(this.assetsArr.push({uuid:"pkg",type:"pkg",id:"pkg",name:"知识包"}),this.expandedKey=["pkg"],this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey("pkg"),this.activeTab=e})))},pushAssetsArr(e){let t;this.assetsArr.some((s=>{if(s.uuid==e.uuid)return t=!0,!0})),t||this.assetsArr.push(e)},pin(){const e=document.querySelectorAll(".pin");if((this.$refs.main.$el.pageYOffset||this.$refs.main.$el.scrollTop)>140){const t=this.$refs.tabs.$el.offsetWidth-2+"px",s=this.$refs.aside.$el.offsetWidth+20+"px";e.forEach((e=>{-1==e.className.indexOf("pin-wrap")&&(e.offsetHeight>0&&(e.parentNode.style.height=e.offsetHeight+"px"),e.className="pin pin-wrap el-card is-always-shadow el-card__body",e.style.width=t,e.style.left=s)}))}else e.forEach((e=>e.className="pin"))},resizePin(){const e=document.querySelectorAll(".pin-wrap");0!=e.length&&this.$nextTick((()=>{const t=this.$refs.tabs.$el.offsetWidth-2+"px",s=this.$refs.aside.$el.offsetWidth+20+"px";e.forEach((e=>{e.style.width=t,e.style.left=s}))}))},showContextMenu(e){const t=e.target.closest('[id^="tab-"]');null!=t?(this.rightClickTab=t.id.substring(4),this.$refs["contextMenu-closeOther"].style.display="block"):this.$refs["contextMenu-closeOther"].style.display="none";const s=this.$refs.contextMenu;let i,a=e.y;return i=e.x+s.offsetWidth>window.innerWidth?e.x-s.offsetWidth:e.x,s.style.left=i+"px",s.style.top=a+"px",e.preventDefault(),!1},hideContextMenu(e){this.$refs.contextMenu&&(this.$refs.contextMenu.style.top="-100px")},closeAll(){this.activeTab="";const e=this.assetsArr;this.assetsArr=[],this.unlockEdit(e)},closeOther(){this.activeTab=this.rightClickTab;const e=this.assetsArr.filter((e=>e.uuid!=this.rightClickTab));this.assetsArr=this.assetsArr.filter((e=>e.uuid==this.rightClickTab)),this.unlockEdit(e)},selectDir(){if(this.dirs=[],this.dirsSelect={},"dir"!=this.newFile.type){let e=this.newFile.type;this.dirs=[{id:e,uuid:e,type:e,label:this.$utils.getAssetsTypeText(e),children:[],leaf:!1,level:0}]}else{let e=[];this.assetsGroup[0].children.concat(this.assetsGroup[1].children).forEach((t=>{e.push({id:t.id,uuid:t.uuid,type:t.uuid,label:this.$utils.getAssetsTypeText(t.id),children:[],leaf:!1,level:0})})),this.dirs=e}this.showDirDialog=!0},handleNodeSelectClick(e){this.dirsSelect=e},loadSelectTreeNode(e,t){return 0===e.level?t(this.dirs):1!=e.level?e.data.children&&e.data.children.length>0?t(e.data.children):t([]):void this.$axios.get("/assets/folderTree",{params:{projectUuid:this.$route.params.uuid,type:e.data.uuid}}).then((e=>{if(0==e.data.code)return t(e.data.data)}))},confirmSelectDir(){const e=this.dirsSelect;null==e?this.$message.warning("请选择文件夹"):(this.newFile.dir=e.label,this.newFile.parentType=e.type,this.newFile.dirParentId=0==e.level?0:e.uuid,this.newFile.level=e.level+1,this.showDirDialog=!1)},clearDir(){this.newFile.dir="",this.newFile.dirParentId=""},moveNodeFolder(e){let t=[];this.moveNode=e,this.$axios.get("/assets/folderTree",{params:{projectUuid:this.$route.params.uuid,type:e.type}}).then((s=>{0==s.data.code&&("constant"==e.type||"fact"==e.type?this.assetsGroup[0].children.some((i=>{e.type==i.id&&t.push({id:0,label:this.$utils.getAssetsTypeText(i.id),children:s.data.data,uuid:e.type})})):this.assetsGroup[1].children.some((i=>{e.type==i.id&&t.push({id:0,label:this.$utils.getAssetsTypeText(i.id),children:s.data.data,uuid:e.type})})),this.dirsMove=t,this.showDirMoveDialog=!0)}))},copyNodeAction(e){this.$axios.post("/assets/copy",this.$qs.stringify({name:e.label,uuid:e.uuid,projectUuid:this.$route.params.uuid,nowVersion:e.nowVersion,type:e.type})).then((t=>{if(0==t.data.code){const s={uuid:t.data.data.uuid,type:e.type,name:t.data.data.name,leaf:!0,dirParentId:"0"==t.data.data.dirParentId?e.type:t.data.data.dirParentId};this.appendTree(s),this.$message.success("复制成功")}else this.$message.error(t.data.msg?t.data.msg:"复制失败")})).catch((()=>{this.$message.error("复制失败")}))},confirmSelectDirMove(){const e=this.$refs.dirMoveTree.getCurrentNode();null==e?this.$message.warning("请选择文件夹"):(this.$axios.post("/assets/edit",this.$qs.stringify({uuid:this.moveNode.uuid,dirParentId:e.uuid})).then((t=>{if(0==t.data.code){this.$message.success("操作成功");const t={name:this.moveNode.label,uuid:this.moveNode.uuid,dirParentId:e.uuid,type:this.moveNode.type,leaf:!0};this.deleteAssets(this.moveNode.uuid),this.appendTree(t)}else this.$message.error(t.data.msg?t.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")})),this.showDirMoveDialog=!1)},editFolder(e){this.folder.id=e.uuid,this.folder.name=e.label,this.showEditFolderDialog=!0},lockFolder(e){let t=e.locked?"/folder/unlock":"/folder/lock";this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((t=>{if(0==t.data.code){this.$message.success("操作成功");let t=this.$refs.MenuTree.getNode(e.uuid);null!=t&&this.$set(t.data,"locked",!e.locked)}else this.$message.error(t.data.msg?t.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")}))},delFolder(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.$axios.post("/folder/delete",this.$qs.stringify({uuid:e.uuid})).then((t=>{if(0==t.data.code){this.$message.success("删除成功");const t=this.$refs.MenuTree.getNode(e.uuid);t&&this.$refs.MenuTree.remove(t),this.$store.commit("setRecyle",!0)}else this.$message.error(t.data.msg?t.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败")}))}))},submitEditFolder(){this.$refs.editFolderForm.validate((e=>{e&&(this.editLoading=!0,this.$axios.post("/folder",this.$qs.stringify({uuid:this.folder.id,dirName:this.folder.name})).then((e=>{if(this.editLoading=!1,0==e.data.code){this.$message.success("修改成功");const e={uuid:this.folder.id,name:this.folder.name};this.refreshAssets(e,!1),this.showEditFolderDialog=!1}else this.$message.error(e.data.msg?e.data.msg:"修改失败")})).catch((()=>{this.$message.error("修改失败"),this.editLoading=!1})))}))},handleNodeClick(e){if(!e.leaf)return;if("pkg"===e.id)return void this.activateAssets(e.uuid);if("recycle"===e.id)return void this.activeRecycle();if("func"===e.id)return void this.activeFunc();const t="-1"!=e.type.indexOf("tpl_");this.activateAssets(e.uuid,t)},activeRecycle(){let e;this.activeTab="recycle",this.assetsArr.some(((t,s)=>{if("recycle"==t.uuid)return e=!0,this.$refs.recycledom[0].initData(),!0})),e||(this.assetsArr.push({uuid:"recycle",type:"recycle",id:"recycle",name:"回收站"}),this.expandedKey=[],this.expandedKey.push("recycle"),this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey("recycle")})))},activeFunc(){this.activeTab="func",-1==this.$utils.arrayFindIndex(this.assetsArr,(e=>"func"==e.uuid))&&(this.assetsArr.push({uuid:"func",type:"func",id:"func",name:"自定义函数"}),this.expandedKey=[],this.expandedKey.push("func"),this.$nextTick((()=>{this.$refs.MenuTree.setCurrentKey("func")})))},allowDrop(e,t,s){const i=e.data.type,a=t.data.leaf,o=-1!=t.data.type.indexOf("menu-")?t.data.type.substring(5):t.data.type;return t.data.id,!a&&i==o},nodeDrop(e,t){const s=e.data.uuid,i=-1!=t.data.type.indexOf("menu-")?0:t.data.uuid;this.$axios.post("/assets/edit",this.$qs.stringify({uuid:s,dirParentId:i})).then((e=>{0==e.data.code?(this.$message.success("操作成功"),this.loadAssetsGroup()):(this.loadAssetsGroup(),this.$message.error(e.data.msg?e.data.msg:"操作失败"))})).catch((()=>{this.$message.error("操作失败")}))},allowDrag:e=>e.data.leaf,filterNode:(e,t)=>!e||-1!==t.label.indexOf(e),handleCommand(e,t){switch(t.command){case"edit":this.editFolder(t.data);break;case"lock":"DIR"==e?this.lockFolder(t.data):this.lockAssets(t.data);break;case"del":"DIR"==e?this.delFolder(t.data):this.delAssets(t.data);break;case"move":this.moveNodeFolder(t.data);break;case"copy":this.copyNodeAction(t.data)}},refreshAssets(e,t=!0){const s=this.$refs.MenuTree.getNode(e.uuid);null!=s&&(this.assetsArr.forEach((t=>{t.uuid==e.uuid&&(t.name=e.name,t.locked=e.locked)})),this.$set(s.data,"label",e.name),this.$set(s.data,"locked",e.locked),e.locked||this.$set(s.data,"editor",null))},importFact(e){let t=new FormData;t.append("file",e.raw),t.append("projectUuid",this.$route.params.uuid),this.$axios.post("/assets/importJavaFile",t).then((e=>{if(0==e.data.code){this.$message.success("上传成功");const t=!1,s=!1;e.data.data.forEach((e=>{const i={name:e.name,uuid:e.uuid,dirParentId:"fact",type:"fact",leaf:!0};this.appendTree(i,t,s),this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,ignoreFunc:!0,ignoreModel:!0,ignoreThirdApi:!0})}))}else this.$message.error(e.data.msg?e.data.msg:"上传失败")}))},searchResources(){const e={searchInput:this.filterText,searchCondition:this.searchCondition};let t=!1;this.assetsArr.forEach(((s,i)=>{"search"==s.type&&(this.assetsArr[i].searchVal=e,t=!0)})),t||this.assetsArr.push({uuid:"search",type:"search",id:"search",name:"搜索",searchVal:e}),this.activeTab="search"},addTemplate(){const e=this.$store.state.addTreeNode;this.appendTree(e,!0),this.$store.commit("setAddTreeNode",{})},reduction(e){let t=!1;e.forEach((e=>{"face"!=e.type&&"constant"!=e.type||(t=!0),this.appendTree(e,!1,!1)})),t&&this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,ignoreFunc:!0,ignoreModel:!0,ignoreThidApi:!0})},isAssetsReadonly(e){return e.isTemplate||e.editor&&e.editor.uuid!=this.$store.getters.userUuid},lockEdit(e){if(e.editor){if(e.editor.uuid!=this.$store.getters.userUuid){const t=e.editor.realname,s=this.$moment(e.editTime).format("MM-DD HH:MM");this.$message.warning({message:`${t}正在编辑，编辑时间：${s}`,showClose:!0,duration:5e3});const i=this.$refs.MenuTree.getNode(e.uuid);null==i||i.data.editor||this.$set(i.data,"editor",e.editor)}}else this.doLockEdit(e.uuid,!0)},unlockEdit(e){const t=[];e.forEach((e=>{this.canUnlock(e)&&t.push(e.uuid)})),t.length>0&&this.doLockEdit(t.join(","),!1)},doLockEdit(e,t){this.$axios.post("/assets/lockedit",this.$qs.stringify({uuids:e,lock:t})).then((s=>{0==s.data.code&&this.$refs.MenuTree&&e.split(",").forEach((e=>{const s=this.$refs.MenuTree.getNode(e);null!=s&&(t?this.$set(s.data,"editor",{uuid:this.$store.getters.userUuid}):this.$set(s.data,"editor",null))}))}))},canUnlock(e){return-1!=["fact","constant","guidedrule","rulescript","ruletable","ruletree","scorecard","ruleflow","testcase"].indexOf(e.type)&&!e.isTemplate&&!this.isAssetsReadonly(e)},importAssets(e){let t=new FormData;t.append("file",e.raw),t.append("projectUuid",this.$route.params.uuid),this.$axios.post("/assets/import",t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{if(0==e.data.code){this.$message.success("导入成功");const t=!1,s=!1;e.data.data.tree.forEach((e=>{this.appendTree(e,t,s)})),this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,ignoreFunc:!0,ignoreModel:!0,ignoreThidApi:!0,callback:()=>{this.activateAssets(e.data.data.uuid)}})}else this.$message.error(e.data.msg?e.data.msg:"导入失败");this.importLoading=!1})).catch((()=>{this.importLoading=!1}))},lockAssets(e){const t=e.locked||e.editor?"/assets/unlock":"/assets/lock";this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((t=>{if(0==t.data.code){this.$message.success("操作成功");const t=this.$refs.MenuTree.getNode(e.uuid);null!=t&&(e.editor?(this.$set(t.data,"locked",!1),this.$set(t.data,"editor",null),this.assetsArr.forEach((t=>{t.uuid==e.uuid&&(t.locked=!1,t.editor=null)}))):(this.$set(t.data,"locked",!e.locked),this.assetsArr.forEach((t=>{t.uuid==e.uuid&&(t.locked=e.locked)}))))}else this.$message.error(t.data.msg?t.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")}))},delAssets(e){this.$confirm("确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let t,s={};"testcase"==e.type?(t="/testcase/delete",s.caseUuid=e.uuid):(s.uuid=e.uuid,t=e.type.startsWith("tpl_")?"/template/delete":"/assets/delete"),this.$axios.post(t,this.$qs.stringify(s)).then((t=>{if(0==t.data.code){this.$message.success("删除成功"),this.removeTab(e.uuid);const t=this.$refs.MenuTree.getNode(e.uuid);t&&this.$refs.MenuTree.remove(t),this.$store.commit("setRecycle",!0),"fact"!=e.type&&"constant"!=e.type||this.$store.dispatch("loadBoms",{projectUuid:this.$route.params.uuid,ignoreFunc:!0,ignoreModel:!0,ignoreThirdApi:!0})}else this.$message.error(t.data.msg?t.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败")}))}))},unlockEditOnunload(){this.unlockEdit(this.assetsArr)},jumpActivity(e){"tpl"==e.assetsType?this.activateAssets(e.assetsUuid,!0):"pkg"==e.assetsType?this.activateAssets("pkg"):this.activateAssets(e.assetsUuid)}},beforeRouteLeave(e,t,s){this.unlockEdit(this.assetsArr),this.unbindEvent(),s()}};var xi=(0,A.Z)(_i,ye,[],!1,null,"2ea2a587",null);xi.options.__file="src/view/decision/project/assets/assets.vue";const ki=xi.exports;var $i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-aside",{staticClass:"menu",attrs:{width:"250px"}},[s("el-menu",{attrs:{"default-active":e.$route.path,router:!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},e._l(e.menus,(function(t,i){return e.$hasPerm(t.permission)?s("div",{key:i},[s("el-menu-item",{attrs:{index:t.path}},[s("i",{class:t.icon}),e._v(" "),s("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.label))])])],1):e._e()})),0)],1),e._v(" "),s("el-main",[s("router-view")],1)],1)};$i._withStripped=!0;const Ti={data:()=>({menus:[{path:"/settings/org",label:"机构管理",icon:"iconfont icongongsi",permission:"org:view"},{path:"/settings/user",label:"用户管理",icon:"iconfont iconyonghuguanli",permission:"user:view"},{path:"/settings/role",label:"角色权限",icon:"iconfont iconyonghu",permission:"role:list"},{path:"/settings/logs",label:"操作日志",icon:"iconfont iconpingfenqia",permission:"log:view"},{path:"/settings/login",label:"登录信息",icon:"iconfont icondenglu",permission:"login:view"}]}),mounted(){"settings"==this.$route.name&&this.linkRouter()},watch:{$route(e,t){"settings"==e.name&&this.linkRouter()}},methods:{linkRouter(){let e=[];this.menus.forEach(((t,s)=>{this.$hasPerm(t.permission)&&e.push(t)})),e.length&&this.$router.push(e[0].path)}}};var Di=(0,A.Z)(Ti,$i,[],!1,null,null,null);Di.options.__file="src/view/settings/home.vue";const Si=Di.exports;var Ci=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("org:add")?s("el-button",{staticClass:"toolbar",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n        添加机构\n      ")]):e._e(),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"==typeof t?t.trim():t},expression:"searchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.list}},[s("el-table-column",{attrs:{prop:"name",label:"机构名称"}}),e._v(" "),s("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("org:viewuser")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showUsers(t.row)}}},[e._v("用户")]):e._e(),e._v(" "),e.$hasPerm("org:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.edit(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$hasPerm("org:del")?s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除机构？"},on:{confirm:function(s){return e.del(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1):e._e()]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}})],1),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑机构":"添加机构",width:"30%",visible:e.showAddDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDialog=t},opened:function(t){return e.$refs.input.focus()},closed:e.closed}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"机构名称",prop:"name"}},[s("el-input",{ref:"input",attrs:{maxlength:40,"show-word-limit":"",placeholder:"请填写机构名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showAddDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.submit}},[e._v("\n        "+e._s(e.addLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("user-list",{attrs:{show:e.listingUser.show,"org-uuid":e.listingUser.orgUuid},on:{"update:show":function(t){return e.$set(e.listingUser,"show",t)}}})],1)};Ci._withStripped=!0;var Ni=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"用户列表",width:"60%",visible:e.show},on:{"update:visible":e.close,open:e.open,closed:e.closed}},[s("div",{staticClass:"toolbar pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.loadUsers(t)}},model:{value:e.keywords,callback:function(t){e.keywords="string"==typeof t?t.trim():t},expression:"keywords"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.loadUsers},slot:"suffix"})])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.users}},[e.$hasPerm("user:detail")?s("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.disabled?s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("el-button",{staticStyle:{"text-decoration":"line-through",color:"red"},attrs:{type:"text"},on:{click:function(s){return e.showUserProfile(t.row)}}},[e._v(e._s(t.row.username))])],1):s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showUserProfile(t.row)}}},[e._v(e._s(t.row.username))])]}}],null,!1,577639691)}):s("el-table-column",{attrs:{prop:"username",label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.disabled?s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("span",{staticStyle:{"text-decoration":"line-through",color:"red"}},[e._v(e._s(t.row.username))])]):s("span",[e._v(e._s(t.row.username))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"realname",label:"真实姓名"}}),e._v(" "),s("el-table-column",{attrs:{label:"最后登录"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.lastLoginTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"expiredTime",label:"过期时间"}}),e._v(" "),e.orgUuid?e._e():s("el-table-column",{attrs:{label:"所属机构","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.org?t.row.org.name:"")+"\n      ")]}}],null,!1,3365803921)}),e._v(" "),e.$hasPerm("user:viewlog")?s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showLogs(t.row)}}},[e._v("操作日志")])]}}],null,!1,4179144038)}):e._e()],1),e._v(" "),s("pagination",{attrs:{total:e.total,"page-size":e.pageNum,"current-page":e.page},on:{"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},change:e.loadUsers}}),e._v(" "),s("user-logs-dialog",{attrs:{show:e.userLogs.show,"user-uuid":e.userLogs.userUuid},on:{"update:show":function(t){return e.$set(e.userLogs,"show",t)}}}),e._v(" "),s("user-profile",{attrs:{show:e.userProfile.show,"user-uuid":e.userProfile.userUuid},on:{"update:show":function(t){return e.$set(e.userProfile,"show",t)}}})],1)};Ni._withStripped=!0;var Li=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"用户操作日志",width:"60%",visible:e.show,"append-to-body":!0},on:{"update:visible":e.close,open:e.open,closed:e.closed}},[s("user-logs",{attrs:{"user-uuid":e.userUuid}})],1)};Li._withStripped=!0;var Ai=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"form",attrs:{inline:"",model:e.form}},[s("el-form-item",{staticClass:"timePickIn",attrs:{label:"操作描述",prop:"optName"}},[s("el-input",{attrs:{placeholder:"操作描述"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.optName,callback:function(t){e.$set(e.form,"optName",t)},expression:"form.optName"}})],1),e._v(" "),s("el-form-item",{staticClass:"timePickIn",attrs:{label:"操作地址",prop:"clientIp"}},[s("el-input",{attrs:{placeholder:"操作地址"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.clientIp,callback:function(t){e.$set(e.form,"clientIp",t)},expression:"form.clientIp"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"是否成功",prop:"success"}},[s("el-select",{attrs:{placeholder:"是否成功"},model:{value:e.form.success,callback:function(t){e.$set(e.form,"success",t)},expression:"form.success"}},[s("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),s("el-option",{attrs:{label:"成功",value:"1"}}),e._v(" "),s("el-option",{attrs:{label:"失败",value:"0"}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"开始日期",prop:"beginTime"}},[s("date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"开始日期","disabled-date":e.beginTimeDisabledDate},model:{value:e.form.beginTime,callback:function(t){e.$set(e.form,"beginTime",t)},expression:"form.beginTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束日期",prop:"endTime"}},[s("date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"结束日期","disabled-date":e.endTimeDisabledDate},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查 询")]),e._v(" "),s("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重 置")])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.logs,align:"center"}},[s("el-table-column",{attrs:{prop:"optName",label:"操作描述"}}),e._v(" "),s("el-table-column",{attrs:{prop:"user",label:"操作用户"}}),e._v(" "),s("el-table-column",{attrs:{prop:"clientIp",label:"操作地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.beginTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"useTime",label:"请求用时(毫秒)",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"success",label:"是否成功",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.success?s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}}):s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}})]}}])})],1),e._v(" "),s("pagination",{ref:"pager",attrs:{load:e.loadUserLos}})],1)};Ai._withStripped=!0;const Ei={name:"user-logs",props:{userUuid:String},data(){return{tableLoading:!1,logs:[],form:{optName:"",userUuid:"",beginTime:"",endTime:"",clientIp:"",success:""},beginTimeDisabledDate:e=>!!(this.form.endTime&&e.getTime()>new Date(this.form.endTime+" 00:00:00").getTime())||e.getTime()>(new Date).getTime(),endTimeDisabledDate:e=>!!(this.form.beginTime&&e.getTime()<new Date(this.form.beginTime+" 00:00:00").getTime())||e.getTime()>(new Date).getTime()}},watch:{userUuid(){this.$refs.form.resetFields(),this.$refs.pager.refresh(1)}},methods:{search(){this.$refs.pager.refresh(1)},loadUserLos(e,t,s){this.form.userUuid=this.userUuid,this.tableLoading=!0;let i=this.$utils.copy(this.form);i.page=e,i.pageNum=t,this.$axios.get("/user/logs",{params:i}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.logs=e.data.data,s(e.data.total)):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},reset(){this.$refs.form.resetFields(),this.search()},close(){this.$emit("update:show",!1)},closed(){this.$refs.form.resetFields()}}};var Fi=(0,A.Z)(Ei,Ai,[],!1,null,null,null);Fi.options.__file="src/view/settings/user/user-logs.vue";const Oi=Fi.exports,Ii={components:{UserLogs:Oi},name:"user-logs-dialog",props:{show:Boolean,userUuid:String},data:()=>({}),mounted(){},watch:{userUuid(e,t){this.$nextTick((()=>{this.userUuid=e}))}},methods:{open(){},close(){this.$emit("update:show",!1)},closed(){}}};var Pi=(0,A.Z)(Ii,Li,[],!1,null,null,null);Pi.options.__file="src/view/settings/user/user-logs-dialog.vue";const Mi={name:"user-list",components:{UserLogsDialog:Pi.exports},props:{show:Boolean,orgUuid:String,roleId:Number},data:()=>({tableLoading:!1,users:[],total:0,page:1,pageNum:10,keywords:"",userLogs:{show:!1,userUuid:""},userProfile:{show:!1,userUuid:""}}),mounted(){},methods:{open(){this.loadUsers()},loadUsers(){let e;this.orgUuid?e=this.loadUsersByOrg():this.roleId&&(e=this.loadUsersByRole()),e&&(this.tableLoading=!0,this.users=[],e.then((e=>{this.tableLoading=!1,0==e.data.code&&(this.users=e.data.data,this.total=e.data.total)})).catch((()=>{this.tableLoading=!1})))},loadUsersByOrg(){return this.$axios.get("/org/users",{params:{orgUuid:this.orgUuid,page:this.page,pageNum:this.pageNum,keywords:this.keywords}})},loadUsersByRole(){return this.$axios.get("/role/users",{params:{roleId:this.roleId,page:this.page,pageNum:this.pageNum,keywords:this.keywords}})},close(){this.$emit("update:show",!1)},closed(){this.users=[],this.page=1},showLogs(e){this.userLogs.show=!0,this.userLogs.userUuid=e.uuid},showUserProfile(e){this.userProfile.show=!0,this.userProfile.userUuid=e.uuid}}};var Ri=(0,A.Z)(Mi,Ni,[],!1,null,"70808512",null);Ri.options.__file="src/view/settings/user/user-list.vue";const ji=Ri.exports,Bi={name:"index",components:{UserList:ji},data:()=>({tableLoading:!1,showAddDialog:!1,list:[],addLoading:!1,form:{uuid:"",name:""},rules:{name:[{required:!0,message:"请填写机构名称",trigger:"blur"},{max:40,message:"长度不超过40个字符",trigger:"blur"}]},total:0,page:1,pageNum:10,searchName:"",listingUser:{show:!1,orgUuid:""}}),mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/org",{params:{page:this.page,pageNum:this.pageNum,name:this.searchName}}).then((e=>{0==e.data.code&&(this.list=e.data.data,this.total=e.data.total),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},search(){this.toPage(1)},edit(e){this.form.uuid=e.uuid,this.form.name=e.name,this.showAddDialog=!0},del(e){this.tableLoading=!0,this.$axios.post("/org/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))},closed(){this.$refs.form.resetFields(),this.form.uuid=""},submit(){this.$refs.form.validate((e=>{if(e){this.addLoading=!0;const e=this.form.uuid?"/org/edit":"/org/add";this.$axios.post(e,this.$qs.stringify(this.form)).then((e=>{this.addLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData(),this.showAddDialog=!1):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.addLoading=!1}))}}))},showUsers(e){this.listingUser.show=!0,this.listingUser.orgUuid=e.uuid}}};var Ui=(0,A.Z)(Bi,Ci,[],!1,null,"30bede5c",null);Ui.options.__file="src/view/settings/org/index.vue";const Vi=Ui.exports;var Hi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("user:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n      添加用户\n    ")]):e._e(),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchWords,callback:function(t){e.searchWords="string"==typeof t?t.trim():t},expression:"searchWords"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...","highlight-current-row":"",data:e.users}},[e.$hasPerm("user:detail")?s("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.disabled?s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("el-button",{staticStyle:{"text-decoration":"line-through",color:"red"},attrs:{type:"text"},on:{click:function(s){return e.showUserProfile(t.row)}}},[e._v(e._s(t.row.username))])],1):s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showUserProfile(t.row)}}},[e._v(e._s(t.row.username))])]}}],null,!1,577639691)}):s("el-table-column",{attrs:{prop:"username",label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.disabled?s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("span",{staticStyle:{"text-decoration":"line-through",color:"red"}},[e._v(e._s(t.row.username))])]):s("span",[e._v(e._s(t.row.username))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"realname",label:"真实姓名","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"最后登录"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.lastLoginTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"expiredTime",label:"过期时间"}}),e._v(" "),s("el-table-column",{attrs:{label:"所属机构","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.org?t.row.org.name:"")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("user:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.editUser(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$hasAnyPerm("user:edit:pwd","user:edit:validation","user:del")?s("dropdown",{staticClass:"moreOperation",on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n            更多"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$hasPerm("user:edit:validation")?s("dropdown-item",{attrs:{command:{row:t.row,op:"enable"},icon:t.row.disabled?"el-icon-unlock":"el-icon-lock"}},[e._v("\n              "+e._s(t.row.disabled?"启用":"禁用")+"\n            ")]):e._e(),e._v(" "),e.$hasPerm("user:del")?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-delete",divided:""}},[e._v("\n              删除\n            ")]):e._e()],1)],1):e._e()]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}}),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑用户":"添加用户",top:e.$dialogTop,visible:e.showAddDialog,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){e.showAddDialog=t},opened:function(t){return e.$refs.realnameInput.focus()},closed:e.closeAddDialog}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"90px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"真实姓名",prop:"realname"}},[s("el-input",{ref:"realnameInput",attrs:{maxlength:20,"show-word-limit":"",placeholder:"请填写真实姓名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitAdd(t)}},model:{value:e.form.realname,callback:function(t){e.$set(e.form,"realname","string"==typeof t?t.trim():t)},expression:"form.realname"}})],1),e._v(" "),""==e.form.uuid?s("el-form-item",{attrs:{label:"登录用户",prop:"username"}},[s("el-input",{attrs:{maxlength:20,"show-word-limit":"",placeholder:"请填写用户名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitAdd(t)}},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username","string"==typeof t?t.trim():t)},expression:"form.username"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"登录密码",prop:"password",required:""==e.form.uuid}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:"请填写密码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitAdd(t)}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password","string"==typeof t?t.trim():t)},expression:"form.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"所属机构",prop:"orgUuid"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","remote-method":e.remoteSearchOrg,loading:e.remoteLoading,"loading-text":"数据加载中...",clearable:"",placeholder:"请选择机构"},on:{focus:e.remoteSearchOrg},model:{value:e.form.orgUuid,callback:function(t){e.$set(e.form,"orgUuid",t)},expression:"form.orgUuid"}},e._l(e.orgs,(function(e){return s("el-option",{key:e.uuid,attrs:{label:e.name,value:e.uuid}})})),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"角色设置",prop:"roleIds"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",multiple:"",placeholder:"请选择角色"},on:{focus:e.remoteSearchRole},model:{value:e.form.roleIds,callback:function(t){e.$set(e.form,"roleIds",t)},expression:"form.roleIds"}},e._l(e.roles,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e._v(" "),s("el-form-item",{attrs:{label:"过期时间",prop:"expiredTime"}},[s("date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss","disabled-date":e.disabledDate},model:{value:e.form.expiredTime,callback:function(t){e.$set(e.form,"expiredTime",t)},expression:"form.expiredTime"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showAddDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.submitAdd}},[e._v("\n        "+e._s(e.addLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("user-profile",{attrs:{show:e.userProfile.show,"user-uuid":e.userProfile.userUuid},on:{"update:show":function(t){return e.$set(e.userProfile,"show",t)}}})],1)};Hi._withStripped=!0;const qi={name:"index",data(){return{users:[],showAddDialog:!1,tableLoading:!1,addLoading:!1,companies:[],searchWords:"",total:0,page:1,pageNum:10,disabledDate:e=>e.getTime()<(new Date).getTime(),form:{uuid:"",realname:"",username:"",password:"",orgUuid:"",roleIds:[],expiredTime:""},rules:{realname:[{required:!0,message:"请填写真实姓名",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"}],username:[{required:!0,message:"请填写用户名",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"},{type:"string",pattern:/^[a-zA-Z0-9]+$/,message:"只支持英文字母或数字",trigger:"blur"}],password:[{min:6,message:"长度至少6位",trigger:"blur"},{validator:(e,t,s)=>{this.form.uuid||t?s():s(new Error("请填写密码"))},trigger:"blur"}],orgUuid:[{required:!0,message:"请选择机构",trigger:"change"}],expiredTime:[{validator:(e,t,s)=>{t&&t<=this.$moment(new Date).format("YYYY-MM-DD HH:mm:ss")?s(new Error("过期时间不能小于或等于当前时间")):s()},trigger:"blur"}]},orgs:[],remoteLoading:!1,roles:[],userProfile:{show:!1,userUuid:""}}},mounted(){this.initData()},methods:{moreOperation({row:e,op:t}){"enable"==t?this.enable(e):"del"==t&&this.del(e)},initData(){this.tableLoading=!0,this.$axios.get("/user/search",{params:{page:this.page,pageNum:this.pageNum,username:this.searchWords}}).then((e=>{0==e.data.code&&(this.users=e.data.data,this.total=e.data.total),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},submitAdd(){this.$refs.form.validate((e=>{if(e){this.addLoading=!0;const e=this.form.uuid?"/user/edit":"/user/add",t={realname:this.form.realname,password:this.form.password,"org.uuid":this.form.orgUuid,expiredTime:this.form.expiredTime,roleIds:this.form.roleIds.join(",")};this.form.uuid?t.uuid=this.form.uuid:t.username=this.form.username,this.$axios.post(e,this.$qs.stringify(t)).then((e=>{0==e.data.code?(this.$message.success("操作成功"),this.showAddDialog=!1,this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败"),this.addLoading=!1})).catch((()=>{this.$message.error("操作失败"),this.addLoading=!1}))}}))},enable(e){let t=e.disabled?"/user/enable":"/user/disable";this.tableLoading=!0,this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.tableLoading=!1}))},del(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.tableLoading=!0,this.$axios.post("/user/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))}))},search(){this.page=1,this.initData()},remoteSearchOrg(e){"object"==typeof e&&(e=""),this.remoteLoading=!0,this.$axios.get("/org/top50",{params:{name:e}}).then((e=>{this.remoteLoading=!1,0==e.data.code&&(this.orgs=e.data.data)}))},remoteSearchRole(){this.$axios.get("/role").then((e=>{0==e.data.code&&(this.roles=e.data.data)}))},closeAddDialog(){this.form.uuid="",this.form.realname="",this.form.username="",this.form.password="",this.form.orgUuid="",this.form.roleIds=[],this.form.expiredTime="",this.roles=[]},editUser(e){this.form.uuid=e.uuid,this.form.realname=e.realname,this.form.orgUuid=e.org.uuid,this.form.expiredTime=e.expiredTime,this.orgs=[{uuid:e.org.uuid,name:e.org.name}],this.$axios.get("/user/role",{params:{uuid:e.uuid}}).then((e=>{0==e.data.code&&this.form.uuid&&(0==this.roles.length&&(this.roles=e.data.data),this.form.roleIds=e.data.data.map((e=>e.id)))})),this.showAddDialog=!0,console.log(this.form)},showUserProfile(e){this.userProfile.show=!0,this.userProfile.userUuid=e.uuid}}};var zi=(0,A.Z)(qi,Hi,[],!1,null,"ee88312e",null);zi.options.__file="src/view/settings/user/index.vue";const Wi=zi.exports;var Gi=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("el-tabs",{on:{"tab-click":e.clickTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"角色管理",name:"first"}},[s("div",[s("div",{staticClass:"toolbar"},[e.$hasPerm("role:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("\n              添加角色\n            ")]):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.roles,"highlight-current-row":""}},[s("el-table-column",{attrs:{label:"角色编码",prop:"code"}}),e._v(" "),s("el-table-column",{attrs:{label:"角色名称",prop:"name"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("role:viewuser")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showUsers(t.row)}}},[e._v("用户")]):e._e(),e._v(" "),e.$hasPerm("role:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.editRole(t.row)}}},[e._v("\n                  编辑\n                ")]):e._e(),e._v(" "),e.$hasPerm("role:delete")&&e.canDelete(t.row.code)?s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除？"},on:{confirm:function(s){return e.delRole(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1):e._e()]}}])})],1)],1)]),e._v(" "),s("el-tab-pane",{attrs:{label:"权限管理",name:"second"}},["second"==e.activeName?s("permisson"):e._e()],1)],1)],1),e._v(" "),s("el-dialog",{attrs:{title:this.roleForm.id>0?"编辑角色":"新增角色",top:e.$dialogTop,visible:e.showRoleDialog,width:"1000px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showRoleDialog=t},opened:function(t){return e.$refs.name.focus()},closed:e.closeRoleDialog}},[s("el-form",{ref:"roleForm",attrs:{model:e.roleForm,rules:e.roleForm.id>0?e.editRules:e.addRules,"label-width":"80px",inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{prop:"name",label:"角色名称"}},[s("el-input",{ref:"name",model:{value:e.roleForm.name,callback:function(t){e.$set(e.roleForm,"name","string"==typeof t?t.trim():t)},expression:"roleForm.name"}})],1),e._v(" "),0==e.roleForm.id?s("el-form-item",{attrs:{prop:"code",label:"角色编码"}},[s("el-input",{model:{value:e.roleForm.code,callback:function(t){e.$set(e.roleForm,"code","string"==typeof t?t.trim():t)},expression:"roleForm.code"}})],1):e._e()],1),e._v(" "),s("div",[s("el-divider",[e._v("权限设置")]),e._v(" "),e._l(e.permissions,(function(t,i){return s("el-row",{key:i,attrs:{gutter:16}},[i>0?s("el-divider"):e._e(),e._v(" "),s("el-col",{staticClass:"permissionName",attrs:{span:3}},[e._v(e._s(t.module)+"：")]),e._v(" "),s("el-col",{attrs:{span:20}},[s("el-checkbox",{attrs:{indeterminate:t.isIndeterminate},on:{change:function(s){return e.handleGroupCheckAll(s,t)}},model:{value:t.checkAll,callback:function(s){e.$set(t,"checkAll",s)},expression:"group.checkAll"}},[e._v("\n            全选\n          ")]),e._v(" "),s("el-checkbox-group",{on:{change:function(s){return e.handleGroupCheck(s,t)}},model:{value:t.checked,callback:function(s){e.$set(t,"checked",s)},expression:"group.checked"}},e._l(t.permissions,(function(t){return s("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v("\n              "+e._s(t.name)+"\n            ")])})),1)],1)],1)}))],2),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showRoleDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.confirmLoading},on:{click:e.handleOkEdit}},[e._v("\n        "+e._s(e.confirmLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("user-list",{attrs:{show:e.listingUser.show,"role-id":e.listingUser.roleId},on:{"update:show":function(t){return e.$set(e.listingUser,"show",t)}}})],1)};Gi._withStripped=!0;var Ji=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._l(e.groups,(function(t){return s("div",{key:t.module},[s("p",{staticClass:"openTab",on:{click:function(e){t.open=!t.open}}},[t.open?s("i",{staticClass:"el-icon-minus"}):s("i",{staticClass:"el-icon-plus"}),e._v("\n      "+e._s(t.module)+"\n    ")]),e._v(" "),s("el-divider"),e._v(" "),t.open?s("div",{staticClass:"tabCont"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.permissions,"max-height":"250"}},[s("el-table-column",{attrs:{label:"权限",prop:"name",fixed:"",width:"150"}}),e._v(" "),e._l(e.roles,(function(t,i){return s("el-table-column",{key:t.code,scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-checkbox",{attrs:{disabled:!e.canEditRole,checked:t.row.roles[i].checked},on:{change:function(s){return e.onChange(t.row.roles[i].id,t.row.id,s)}}})]}}],null,!0)},[s("template",{slot:"header"},[s("span",[e._v(e._s(t.name))])])],2)}))],2)],1):e._e()],1)})),0)};Ji._withStripped=!0;const Zi={data:()=>({groups:[],permissionGroups:[],roles:[]}),mounted(){this.init()},computed:{canEditRole(){return this.$hasPerm("role:edit")}},methods:{init(){this.$axios.get("/role/permission?pretty").then((e=>{0==e.data.code?(this.permissionGroups=e.data.data,this.$axios.get("/role").then((e=>{0==e.data.code?(this.roles=e.data.data,this.merge()):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常")}))):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常")}))},merge(){this.permissionGroups.forEach((e=>{let t={module:e.module,open:!1,permissions:[]};e.permissions.forEach((e=>{let s={id:e.id,name:e.name,roles:[]};this.roles.forEach((t=>{let i=!1;t.permissions.some((t=>{if("*"==t.code||t.id==e.id)return i=!0,!0})),s.roles.push({id:t.id,checked:i})})),t.permissions.push(s)})),this.groups.push(t)}))},onChange(e,t,s){const i={roleId:e,permissionId:t},a=s?"/role/addpermission":"/role/delpermission";this.$axios.post(a,this.$qs.stringify(i)).then((e=>{0==e.data.code?this.$message.success("编辑成功"):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常")}))}}};var Yi=(0,A.Z)(Zi,Ji,[],!1,null,"244e0e2d",null);Yi.options.__file="src/view/settings/permission/index.vue";const Ki=Yi.exports,Xi={components:{UserList:ji,permisson:Ki},data:()=>({tableLoading:!1,roles:[],permissions:[],showRoleDialog:!1,roleForm:{id:0,code:"",name:""},activeName:"first",confirmLoading:!1,editRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]},addRules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],code:[{required:!0,message:"请输入角色编码",trigger:"blur"}]},listingUser:{show:!1,roleId:0}}),mounted(){this.loadRoles(),this.loadPermissions()},methods:{loadRoles(){this.tableLoading=!0,this.$axios.get("/role").then((e=>{this.tableLoading=!1,0==e.data.code?this.roles=e.data.data:this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},loadPermissions(){this.$axios.get("/role/permission?pretty").then((e=>{0==e.data.code&&(this.permissions=e.data.data)}))},canDelete:e=>-1==["SystemAdmin","OrgAdmin","ModelingUser"].indexOf(e),handleAdd(){this.roleForm={id:0,code:"",name:""},this.permissions.forEach((e=>{this.$set(e,"checked",[]),this.$set(e,"checkAll",!1),this.$set(e,"isIndeterminate",!1)})),this.showRoleDialog=!0},editRole(e){this.roleForm={id:e.id,name:e.name,code:e.code},this.permissions.forEach((t=>{let s=[];e.permissions.forEach((e=>{"*"==e.code?t.permissions.forEach((e=>{s.push(e.id)})):t.module==e.module&&s.push(e.id)})),this.$set(t,"checked",s);const i=s.length,a=i===t.permissions.length,o=i>0&&i<t.permissions.length;this.$set(t,"checkAll",a),this.$set(t,"isIndeterminate",o)})),this.showRoleDialog=!0},handleOkEdit(e){this.$refs.roleForm.validate((e=>{if(e){this.confirmLoading=!0;const e=this.roleForm.id>0?"/role/edit":"/role/add";let t={name:this.roleForm.name,code:this.roleForm.code};this.roleForm.id>0&&(t.id=this.roleForm.id);let s=[];this.permissions.forEach((e=>{e.checked.forEach((e=>{s.push(e)}))})),t.permissionIds=s.join(","),this.$axios.post(e,this.$qs.stringify(t)).then((e=>{this.confirmLoading=!1,0==e.data.code?(this.$message.success("保存成功"),this.showRoleDialog=!1,this.loadRoles()):this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败"),this.confirmLoading=!1}))}}))},delRole(e){this.tableLoading=!0,this.$axios.post("/role/delete",this.$qs.stringify({id:e.id})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.loadRoles()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))},closeRoleDialog(){this.$refs.roleForm.resetFields()},getGroupCheckedCount(e){let t=0;return e.checked.forEach((e=>{e>0&&t++})),t},handleGroupCheckAll(e,t){t.checked=[],e&&t.permissions.forEach((e=>{t.checked.push(e.id)})),t.isIndeterminate=!1},handleGroupCheck(e,t){const s=t.checked.length;t.checkAll=s==t.permissions.length,t.isIndeterminate=s>0&&s<t.permissions.length},clickTab(e){"first"==e.name&&this.loadRoles()},showUsers(e){this.listingUser.show=!0,this.listingUser.roleId=e.id,console.log(this.listingUser)}}};var Qi=(0,A.Z)(Xi,Gi,[],!1,null,null,null);Qi.options.__file="src/view/settings/role/index.vue";const ea=Qi.exports;var ta=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("el-alert",{staticClass:"toolbar",attrs:{type:"info","show-icon":"",title:"在线人数："+e.total,closable:!1}}),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.onlines},on:{"sort-change":e.sortChange}},[s("el-table-column",{attrs:{label:"在线账号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.showUserProfile(t.row)}}},[e._v(e._s(t.row.user.realname))])]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"登录时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.loginTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",prop:"onlineTime",label:"在线时长"}}),e._v(" "),s("el-table-column",{attrs:{prop:"user.lastLoginIP",label:"登录IP"}}),e._v(" "),e.$hasPerm("login:offline")?s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$store.getters.userUuid!=t.row.user.uuid?s("el-popconfirm",{attrs:{title:"确认强制下线？"},on:{confirm:function(s){return e.forceLogout(t.row.user)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("强制下线")])],1):e._e()]}}],null,!1,3441308415)}):e._e()],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}}),e._v(" "),s("user-profile",{attrs:{show:e.userProfile.show,"user-uuid":e.userProfile.userUuid},on:{"update:show":function(t){return e.$set(e.userProfile,"show",t)}}})],1)};ta._withStripped=!0;const sa={name:"index",data:()=>({tableLoading:!1,onlines:[],page:1,pageNum:10,total:0,sortOption:{sortField:"",sortDirection:""},userProfile:{show:!1,userUuid:""}}),mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/user/onlines",{params:{page:this.page,pageNum:this.pageNum,sortField:this.sortOption.sortField,sortDirection:this.sortOption.sortDirection}}).then((e=>{this.tableLoading=!1,0==e.data.code&&(this.onlines=e.data.data,this.total=e.data.total)})).catch((()=>{this.tableLoading=!1}))},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.initData()},forceLogout(e){this.tableLoading=!0,this.$axios.post("/user/forcelogout",this.$qs.stringify({uuid:e.uuid,loginIp:e.lastLoginIP})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.tableLoading=!1}))},showUserProfile(e){this.userProfile.show=!0,this.userProfile.userUuid=e.user.uuid}}};var ia=(0,A.Z)(sa,ta,[],!1,null,"cbd7cd3e",null);ia.options.__file="src/view/settings/login/index.vue";const aa=ia.exports;var oa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("el-form",{ref:"form",attrs:{inline:"",model:e.form}},[s("el-form-item",{staticClass:"timePickIn",attrs:{label:"操作描述",prop:"optName"}},[s("el-input",{attrs:{placeholder:"操作描述"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.optName,callback:function(t){e.$set(e.form,"optName",t)},expression:"form.optName"}})],1),e._v(" "),s("el-form-item",{staticClass:"timePickIn",attrs:{label:"操作用户",prop:"user"}},[s("el-input",{attrs:{placeholder:"操作用户"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.user,callback:function(t){e.$set(e.form,"user",t)},expression:"form.user"}})],1),e._v(" "),s("el-form-item",{staticClass:"timePickIn",attrs:{label:"操作地址",prop:"clientIp"}},[s("el-input",{attrs:{placeholder:"操作地址"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.clientIp,callback:function(t){e.$set(e.form,"clientIp",t)},expression:"form.clientIp"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开始日期",prop:"beginTime"}},[s("date-picker",{attrs:{placeholder:"开始日期","disabled-date":e.beginTimeDisabledDate},model:{value:e.form.beginTime,callback:function(t){e.$set(e.form,"beginTime",t)},expression:"form.beginTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束日期",prop:"endTime"}},[s("date-picker",{attrs:{placeholder:"结束日期","disabled-date":e.endTimeDisabledDate},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"是否成功",prop:"success"}},[s("el-select",{attrs:{placeholder:"是否成功"},model:{value:e.form.success,callback:function(t){e.$set(e.form,"success",t)},expression:"form.success"}},[s("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),s("el-option",{attrs:{label:"成功",value:"1"}}),e._v(" "),s("el-option",{attrs:{label:"失败",value:"0"}})],1)],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查 询")]),e._v(" "),s("el-button",{attrs:{icon:"el-icon-delete"},on:{click:e.reset}},[e._v("重 置")])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.logs,align:"center"}},[s("el-table-column",{attrs:{prop:"optName",label:"操作描述"}}),e._v(" "),s("el-table-column",{attrs:{prop:"user",label:"操作用户"}}),e._v(" "),s("el-table-column",{attrs:{prop:"clientIp",label:"操作地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.beginTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"useTime",label:"请求用时(毫秒)",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"success",label:"是否成功",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.success?s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}}):s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}})]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}})],1)};oa._withStripped=!0;const na={name:"index",data(){return{tableLoading:!1,logs:[],page:1,pageNum:10,total:0,form:{optName:"",user:"",beginTime:"",endTime:"",clientIp:"",success:""},beginTimeDisabledDate:e=>!!(this.form.endTime&&e.getTime()>this.form.endTime.getTime())||e.getTime()>(new Date).getTime(),endTimeDisabledDate:e=>!!(this.form.beginTime&&e.getTime()<this.form.beginTime.getTime())||e.getTime()>(new Date).getTime()}},mounted(){this.initData()},methods:{search(){this.page=1,this.initData()},initData(){this.tableLoading=!0;let e=this.$utils.copy(this.form);e.beginTime&&(e.beginTime=this.$moment(e.beginTime).format("YYYY-MM-DD",!1)),e.endTime&&(e.endTime=this.$moment(e.endTime).format("YYYY-MM-DD",!1)),e.page=this.page,e.pageNum=this.pageNum,this.$axios.get("/logs",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.logs=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},reset(){this.$refs.form.resetFields(),this.search()}}};var ra=(0,A.Z)(na,oa,[],!1,null,"fba89766",null);ra.options.__file="src/view/settings/logs/index.vue";const la=ra.exports;var ca=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",[s("el-aside",{staticClass:"menu",attrs:{width:"250px"}},[s("el-menu",{attrs:{"default-active":e.$route.path,router:!0,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[e._l(e.menus,(function(t){return e.$hasPerm(t.permission)&&!t.children?s("el-menu-item",{key:t.path,attrs:{index:t.path}},[s("i",{staticClass:"micon",class:t.icon}),e._v(" "),s("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.label))])]):e._e()})),e._v(" "),e._l(e.menus,(function(t,i){return e.$hasPerm(t.permission)&&t.children?s("el-submenu",{key:t.path,attrs:{index:t.path}},[s("template",{slot:"title"},[s("i",{staticClass:"micon",class:t.icon}),e._v(" "),s("span",[e._v(e._s(t.label))])]),e._v(" "),e._l(t.children,(function(t){return s("el-menu-item",{key:t.path,attrs:{index:t.path}},[e._v(e._s(t.label))])}))],2):e._e()}))],2)],1),e._v(" "),s("el-main",[s("router-view")],1)],1)};ca._withStripped=!0;const da={data:()=>({menus:[{path:"/microservice/list",label:"服务列表",icon:"iconfont iconlist-2-copy",permission:"microservice:view"},{path:"/microservice/token",label:"令牌管理",icon:"el-icon-medal",permission:"token:view"},{path:"/microservice/client",label:"集群节点",icon:"iconfont iconfuwuqi",permission:"client:view"},{path:"/microservice/report/summary",label:"统计报表",icon:"el-icon-s-data",permission:"report:view",children:[{path:"/microservice/report/summary",label:"汇总报表"},{path:"/microservice/report/detail",label:"明细报表"},{path:"/microservice/report/approval",label:"审批类报表"}]}]}),watch:{$route(e,t){"micro"==e.name&&this.linkRouter()}},mounted(){"micro"==this.$route.name&&this.linkRouter()},methods:{linkRouter(){let e=[];this.menus.forEach(((t,s)=>{this.$hasPerm(t.permission)&&e.push(t)})),e.length&&this.$router.push(e[0].path)}}};var ua=(0,A.Z)(da,ca,[],!1,null,null,null);ua.options.__file="src/view/microservice/home.vue";const pa=ua.exports;var ha=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("microservice:trace")?s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:function(t){e.showTraceDialog=!0}}},[e._v("\n        查询轨迹\n      ")]):e._e(),e._v(" "),s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"==typeof t?t.trim():t},expression:"searchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.tableData}},[s("el-table-column",{attrs:{label:"名称",prop:"name","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"所属项目",prop:"projectName","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"所属用户",prop:"projectCreatorName",width:"80","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("microservice:online")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.deploy(t.row)}}},[e._v("\n            生效上线\n          ")]):e._e(),e._v(" "),e.$hasPerm("microservice:apidoc")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.apidoc(t.row)}}},[e._v("\n            调用文档\n          ")]):e._e(),e._v(" "),s("dropdown",{staticClass:"moreOperation",on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n              更多"),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$hasPerm("microservice:edit")?s("dropdown-item",{attrs:{command:{row:t.row,op:"edit"},icon:"el-icon-edit"}},[e._v("\n                编辑服务\n              ")]):e._e(),e._v(" "),e.$hasPerm("microservice:client")?s("dropdown-item",{attrs:{command:{row:t.row,op:"view"},icon:"el-icon-monitor"}},[e._v("\n                上线节点\n              ")]):e._e(),e._v(" "),e.$hasPerm("microservice:shutdown")?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-circle-close"}},[e._v("\n                停用服务\n              ")]):e._e()],1)],1)]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}})],1),e._v(" "),s("el-dialog",{attrs:{title:"编辑服务",visible:e.showEditDialog,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.showEditDialog=t},opened:function(t){return e.$refs.nameInput.focus()}}},[s("el-form",{ref:"form",attrs:{"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}},[s("el-form-item",{attrs:{label:"服务名称"}},[s("el-input",{ref:"nameInput",attrs:{type:"text",maxlength:20,"show-word-limit":"",placeholder:"请填写服务名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitEdit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"服务简介"}},[s("el-input",{attrs:{type:"textarea",value:e.form.description,autosize:{minRows:6},maxlength:100,"show-word-limit":"",placeholder:"请填写服务简介"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showEditDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.editLoading},on:{click:e.submitEdit}},[e._v("\n        "+e._s(e.editLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"引用AI模型列表",visible:e.showAiModelDialog},on:{"update:visible":function(t){e.showAiModelDialog=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.aiModelLoading,expression:"aiModelLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.aiModelData}},[s("el-table-column",{attrs:{prop:"modelName",label:"模型名称"}}),e._v(" "),s("el-table-column",{attrs:{label:"是否可用",formatter:function(e){return e.enable?"是":"否"}}}),e._v(" "),s("el-table-column",{attrs:{prop:"createTime",label:"创建时间"}})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"服务上线节点",visible:e.showAiClientDialog},on:{"update:visible":function(t){e.showAiClientDialog=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.showAiClientLoading,expression:"showAiClientLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.aiClientData}},[s("el-table-column",{attrs:{prop:"name",label:"名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"baseUrl",label:"地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"是否启用",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.disabled?s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}}):s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}})]}}])})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"查询轨迹",visible:e.showTraceDialog,top:e.$dialogTop},on:{"update:visible":function(t){e.showTraceDialog=t},opened:function(t){return e.$refs.seqNoInput.focus()},closed:e.closeTraceDialog}},[s("el-form",{ref:"traceForm",attrs:{model:e.traceForm,"label-width":"80px",inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"流水号",prop:"seqNo"}},[s("el-input",{ref:"seqNoInput",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitQueryTrace(t)}},model:{value:e.traceForm.seqNo,callback:function(t){e.$set(e.traceForm,"seqNo",t)},expression:"traceForm.seqNo"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.traceLoading},on:{click:e.submitQueryTrace}},[e._v("\n          "+e._s(e.traceLoading?"提交中...":"搜 索")+"\n        ")]),e._v(" "),s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showTraceDialog=!1}}},[e._v("\n          取 消\n        ")])],1)],1),e._v(" "),null!=e.traceResult?s("div",{staticStyle:{padding:"0px 20px"}},[s("p",[e._v("触发了"),s("b",[e._v(e._s(e.traceResult.fireNum))]),e._v("条规则，耗时"),s("b",[e._v(e._s(e.traceResult.fireTime))]),e._v("毫秒")]),e._v(" "),e.traceResult.fireNodes&&e.traceResult.fireNodes.length>0?[s("p",[e._v("决策流轨迹：")]),e._v(" "),e._l(e.traceResult.fireNodes,(function(t,i){return s("p",{key:t.processId,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"info",icon:"el-icon-view"},on:{click:function(t){return e.showFlow(i)}}},[e._v("\n            "+e._s(t.flowName)+"\n          ")])],1)}))]:e._e(),e._v(" "),e.traceResult.fireNum>0?[s("p",[e._v("规则列表：")]),e._v(" "),e._l(e.traceResult.fireRules,(function(t,i){return s("p",{key:t.name,staticStyle:{"margin-left":"20px"}},[s("el-link",{attrs:{type:"info",icon:"el-icon-view"},on:{click:function(t){return e.showAssets(i)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)}))]:e._e(),e._v(" "),e.resData.facts.length>0?[s("p",[e._v("执行结果：")]),e._v(" "),s("el-row",{attrs:{gutter:10}},[s("el-col",{attrs:{span:6}},[s("el-table",{ref:"modelTable",attrs:{data:e.resData.facts,"row-style":{cursor:"pointer"},"row-class-name":e.setRowIndex,"highlight-current-row":"","current-row-key":e.resData.facts[e.resData.activeIndex].uuid,"row-key":"uuid",border:""},on:{"row-click":e.clickResFact}},[s("el-table-column",{attrs:{prop:"name",label:"数据模型",align:"center"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:18}},e._l(e.resData.facts,(function(t,i){return s("el-table",{directives:[{name:"show",rawName:"v-show",value:i==e.resData.activeIndex,expression:"index == resData.activeIndex"}],key:t.uuid,attrs:{data:t.fields,"highlight-current-row":"",border:""}},[s("el-table-column",{attrs:{prop:"label",label:"中文名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"结果",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isObject(t.row.type)||e.$utils.isCollection(t.row.type)?s("el-popover",{attrs:{placement:"right",width:"400",trigger:"click"}},[s("span",[e._v(e._s(t.row.value))]),e._v(" "),s("el-link",{attrs:{slot:"reference",icon:"el-icon-view"},slot:"reference"})],1):s("span",[e._v(e._s(t.row.value))])]}}],null,!0)})],1)})),1)],1)]:e._e()],2):e._e()],1),e._v(" "),e.showbaseLineDialog?s("approval-label",{attrs:{active:e.showbaseLineDialog,pkg:e.rowData},on:{"update:active":function(t){e.showbaseLineDialog=t},reloadData:e.reloadData}}):e._e(),e._v(" "),s("deployment",{attrs:{show:e.deployment.show,"micro-uuid":e.deployment.microUuid},on:{"update:show":function(t){return e.$set(e.deployment,"show",t)}}}),e._v(" "),s("ruleflow-trace",{attrs:{"flow-uuid":e.ruleflowTrace.uuid,"flow-version":e.ruleflowTrace.version,nodes:e.ruleflowTrace.nodes,show:e.ruleflowTrace.show},on:{"update:show":function(t){return e.$set(e.ruleflowTrace,"show",t)}}}),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,"fire-rules":e.viewingAssets.fireRules,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};ha._withStripped=!0;var ma=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:"设置审批字段",top:e.$dialogTop,visible:e.show,"append-to-body":""},on:{"update:visible":function(t){e.show=t},closed:function(t){return e.$emit("update:active",!1)}}},[e.pkg.approvalLabel?s("div",{staticClass:"nameStyle"},[JSON.parse(e.pkg.approvalLabel).factName?s("span",[s("span",[e._v("已设置审批字段")]),e._v(" "),s("span",{staticStyle:{color:"#67c23a"}},[e._v(e._s(JSON.parse(e.pkg.approvalLabel).factName))])]):e._e()]):s("span",[e._v("暂无设置审批字段")]),e._v(" "),s("el-row",{directives:[{name:"loading",rawName:"v-loading",value:e.testDataLoading,expression:"testDataLoading"}],attrs:{"element-loading-text":"数据加载中...",gutter:10}},[s("el-col",{attrs:{span:6}},[s("el-table",{ref:"modelTable",attrs:{data:e.testData.facts,"row-style":{cursor:"pointer"},"row-class-name":e.setRowIndex,"highlight-current-row":"",border:""},on:{"row-click":e.clickTestFact}},[s("el-table-column",{attrs:{prop:"name",label:"数据模型",align:"center"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:18}},e._l(e.testData.facts,(function(t,i){return s("el-table",{directives:[{name:"show",rawName:"v-show",value:i==e.testData.activeIndex,expression:"index == testData.activeIndex"}],key:t.id,staticClass:"tb-edit",attrs:{data:t.fields,"row-style":{cursor:"pointer"},"highlight-current-row":"",border:""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{prop:"label",label:"中文名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"type",label:"结果",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isShow(t.row)?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.setting(t.row)}}},[e._v("设置审批字段")]):e._e()]}}],null,!0)})],1)})),1)],1)],1),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}})],1)};ma._withStripped=!0;const fa={name:"assets-add-dialog",props:{active:Boolean,pkg:Object},mounted(){this.open()},watch:{active:function(e){this.show=e}},data(){return{show:this.active,loading:!1,assetsGroup:[],name:"",checkList:[],sName:"",sDirName:"",viewingAssets:{uuid:"",version:0,show:!1},testDataLoading:!1,testLoading:!1,testData:{activeIndex:0,facts:[]},publishLoading:!1,showBatchDialog:!1,batchLoading:!1,batchData:{activeIndex:0,facts:null},batchTest:[],lastSubmitFacts:null,showVersionDialong:!1,highLightData:[],highLightKey:[],targetVersion:{},testResult:{}}},methods:{open(){this.loading=!0,this.$axios.get("/micro/approvaldata",{params:{uuid:this.pkg.uuid}}).then((e=>{0==e.data.code?(this.testData.facts=e.data.data,this.testData.facts.forEach((e=>{e.fields=e.fields.fielder((e=>{this.$utils.isDerive(e.type)}))})),this.$refs.modelTable.setCurrentRow(this.testData.facts[0]),this.clickTestFact({index:0})):this.$message.error(e.data.msg?e.data.msg:"加载失败"),this.loading=!1})).catch((()=>{this.loading=!1}))},setting(e){this.testDataLoading=!0;let t={};t.field=e.approvalName,t.id=this.testData.facts[this.testData.activeIndex].id,t.factName=`${this.testData.facts[this.testData.activeIndex].name}-${e.approvalLabel}`,this.$axios.post("/micro/approval",this.$qs.stringify({uuid:this.pkg.uuid,approvalLabel:JSON.stringify(t)})).then((e=>{0==e.data.code?(this.$emit("reloadData"),this.$message.success("操作成功"),this.close()):this.$message.error(e.data.msg?e.data.msg:"加载失败"),this.testDataLoading=!1}))},isShow(e){if(e.children)return!1;{let t=!0;switch(e.type){case"Date":case"List":case"Map":case"Dervie":t=!1}return t}},close(){this.show=!1},getObjectTypeName(e){const t=this.$store.getters.getFactById(e);return t?t.name:""},clickTestFact(e){this.testData.activeIndex=e.index},setRowIndex({row:e,rowIndex:t}){e.index=t},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.select,this.viewingAssets.show=!0},selectVerion(e){e.assetsVersions.forEach((t=>{e.select==t.versionNo&&(e.versionDes=t.versionDes,e.createTime=t.createTime)}))},cellClick(e,t,s,i){const a=this.$refs["input_original_"+e.uuid][0];"版本号"==t.label&&a&&this.$nextTick((function(){a.toggleMenu()}))},search(){if(0!=this.checkList.length){for(let e=0;e<this.checkList.length;e++)2==this.checkList.length?(this.sName=this.name,this.sDirName=this.name):"name"==this.checkList[e]?(this.sName=this.name,this.sDirName=""):"dirName"==this.checkList[e]&&(this.sName="",this.sDirName=this.name);this.open()}else this.$message.error("请选择筛选条件")}}};var ga=(0,A.Z)(fa,ma,[],!1,null,"c2ec53e6",null);ga.options.__file="src/view/microservice/list/approvalLabel.vue";const va=ga.exports;var ba=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-dialog",{attrs:{title:"生效上线",top:e.$dialogTop,visible:e.show,width:"80%"},on:{"update:visible":e.close,open:e.initData}},[s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("新增上线")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.deployments}},[s("el-table-column",{attrs:{prop:"typeText",label:"上线方式"}}),e._v(" "),s("el-table-column",{attrs:{label:"最大进件量",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.incomingQuantity?t.row.incomingQuantity:"")+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"到期时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.expiredTime?t.row.expiredTime.substring(0,10):"")+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"primaryBaseline",label:"生效模型",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"primaryPercent",label:"生效流量",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"testBaseline",label:"测试模型",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"testPercent",label:"测试流量",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"上线时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return["COMMON"!=t.row.type&&0==t.$index&&1==e.page?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.edit(t.row)}}},[e._v("\n            编辑\n          ")]):e._e(),e._v(" "),e.$hasPerm("report:view")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.openReport(t.row)}}},[e._v("报表")]):e._e()]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initData}})],1),e._v(" "),s("el-dialog",{attrs:{title:"新增上线",top:e.$dialogTop,visible:e.showAddDialog,width:"460px"},on:{"update:visible":function(t){e.showAddDialog=t},open:e.openAddDialog,closed:e.closeAddDialog}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.baselineLoading,expression:"baselineLoading"}],ref:"form",attrs:{"element-loading-text":"数据加载中...",model:e.form,"label-width":"120px",rules:e.rules}},[s("el-form-item",{attrs:{label:"上线方式",prop:"type"}},[s("el-select",{staticStyle:{width:"240px"},attrs:{disabled:e.isEdit,placeholder:"请选择上线方式"},on:{change:e.changeType},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[s("el-option",{attrs:{label:"直接上线",value:"COMMON"}}),e._v(" "),s("el-option",{attrs:{label:"AB测试",value:"AB_TEST"}}),e._v(" "),s("el-option",{attrs:{label:"冠军挑战者",value:"CHAMPION_CHALLENGER"}})],1)],1),e._v(" "),"COMMON"!=e.form.type?s("el-form-item",{attrs:{label:"最大进件量",prop:"incomingQuantity"}},[s("el-input-number",{staticStyle:{width:"240px"},attrs:{min:1,"step-strictly":"",controls:!1},model:{value:e.form.incomingQuantity,callback:function(t){e.$set(e.form,"incomingQuantity",t)},expression:"form.incomingQuantity"}})],1):e._e(),e._v(" "),"COMMON"!=e.form.type?s("el-form-item",{attrs:{label:"到期时间",prop:"expiredTime"}},[s("date-picker",{staticStyle:{width:"240px"},attrs:{"value-format":"yyyy-MM-dd",placeholder:"请选择到期时间","disabled-date":e.expiredTimeDisabledDate},model:{value:e.form.expiredTime,callback:function(t){e.$set(e.form,"expiredTime",t)},expression:"form.expiredTime"}})],1):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"生效模型",prop:"primaryBaseline"}},[s("el-select",{staticStyle:{width:"240px"},attrs:{disabled:e.isEdit,placeholder:"请选择生效模型"},model:{value:e.form.primaryBaseline,callback:function(t){e.$set(e.form,"primaryBaseline",t)},expression:"form.primaryBaseline"}},e._l(e.baselines,(function(e){return s("el-option",{key:e.versionNo,attrs:{label:"V"+e.versionNo,value:e.versionNo}})})),1)],1),e._v(" "),"CHAMPION_CHALLENGER"==e.form.type?s("el-form-item",{attrs:{label:"生效流量",prop:"primaryPercent"}},[s("el-input-number",{staticStyle:{width:"240px"},attrs:{controls:!1,"step-strictly":"",max:100,min:0},on:{change:e.changePrimaryPercent},model:{value:e.form.primaryPercent,callback:function(t){e.$set(e.form,"primaryPercent",t)},expression:"form.primaryPercent"}})],1):e._e(),e._v(" "),"COMMON"!=e.form.type?s("el-form-item",{attrs:{label:"测试模型",prop:"testBaseline"}},[s("el-select",{staticStyle:{width:"240px"},attrs:{disabled:e.isEdit,placeholder:"请选择测试模型"},model:{value:e.form.testBaseline,callback:function(t){e.$set(e.form,"testBaseline",t)},expression:"form.testBaseline"}},e._l(e.baselines,(function(e){return s("el-option",{key:e.versionNo,attrs:{label:"V"+e.versionNo,value:e.versionNo}})})),1)],1):e._e(),e._v(" "),"CHAMPION_CHALLENGER"==e.form.type?s("el-form-item",{attrs:{label:"测试流量",prop:"testPercent"}},[s("el-input-number",{staticStyle:{width:"240px"},attrs:{controls:!1,"step-strictly":"",max:100,min:0},on:{change:e.changeTestPercent},model:{value:e.form.testPercent,callback:function(t){e.$set(e.form,"testPercent",e._n(t))},expression:"form.testPercent"}})],1):e._e()],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showAddDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.submitLoading},on:{click:e.submit}},[e._v("\n        "+e._s(e.submitLoading?"提交中...":"确 定")+"\n      ")])],1)],1),e._v(" "),s("report",{attrs:{"deployment-uuid":e.report.deploymentUuid,show:e.report.show},on:{"update:show":function(t){return e.$set(e.report,"show",t)}}})],1)};ba._withStripped=!0;var wa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"查看报表",top:e.$dialogTop,visible:e.show,width:"70%"},on:{"update:visible":e.close,open:e.search}},[s("el-form",{attrs:{inline:""}},[s("el-form-item",{attrs:{label:"开始时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{"disabled-date":e.startDateDisabledDate,placeholder:"开始日期"},model:{value:e.startDate,callback:function(t){e.startDate=t},expression:"startDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"结束时间","disabled-date":e.endDateDisabledDate},model:{value:e.endDate,callback:function(t){e.endDate=t},expression:"endDate"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查 询")])],1),e._v(" "),e.$hasPerm("report:export")?s("el-form-item",[s("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.exportReport}},[e._v("导 出")])],1):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.reports}},[s("el-table-column",{attrs:{label:"模型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.pkgBaseline?"V"+t.row.pkgBaseline:"-")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"reqCount",label:"调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqCount",label:"批量调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqSuccessRatio",label:"批量调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.batchReqSuccessRatio?t.row.batchReqSuccessRatio+"%":"-")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqCount",label:"联机调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqSuccessRatio",label:"联机调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.onlineReqSuccessRatio?t.row.onlineReqSuccessRatio+"%":"-")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"reqPassSuccessRatio",label:"调用通过率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.reqPassSuccessRatio?t.row.reqPassSuccessRatio+"%":"-")+"\n      ")]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.search}})],1)};wa._withStripped=!0;const ya={name:"report",props:{deploymentUuid:String,show:Boolean},data(){return{tableLoading:!1,reports:[],page:1,pageNum:10,total:0,startDate:"",endDate:"",startDateDisabledDate:e=>""!=this.endDate?e.getTime()>Date.now()||e.getTime()>this.endDate:e.getTime()>Date.now(),endDateDisabledDate:e=>e.getTime()<this.startDate||e.getTime()>Date.now()}},methods:{search(){this.tableLoading=!0;let e={keywords:this.deploymentUuid,page:this.page,pageNum:this.pageNum};this.startDate&&(e.startDate=this.$moment(this.startDate).format("YYYY-MM-DD")),this.endDate&&(e.endDate=this.$moment(this.endDate).format("YYYY-MM-DD")),this.$axios.get("/report/deployment",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.reports=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},exportReport(){const e=this;let t={startDate:this.startDate,endDate:this.endDate};t.startDate&&(t.startDate=this.$moment(this.startDate).format("YYYY-MM-DD")),t.endDate&&(t.endDate=this.$moment(this.endDate).format("YYYY-MM-DD"));const s=`/report/exportDeployment?keywords=${this.deploymentUuid}&startDate=${t.startDate}&endDate=${t.endDate}`;e.tableLoading=!0,this.$axios({method:"get",url:s,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"导出失败")},s.readAsText(t.data)}else{let e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.style.display="none",s.href=e,s.target="_blank",s.setAttribute("download","统计报表.xlsx"),document.body.appendChild(s),s.click()}e.tableLoading=!1})).catch((()=>{e.$message.error("导出失败"),e.tableLoading=!1}))},close(){this.$emit("update:show",!1)}}};var _a=(0,A.Z)(ya,wa,[],!1,null,"2409de70",null);_a.options.__file="src/view/microservice/list/report.vue";const xa={name:"index",components:{report:_a.exports},props:{microUuid:String,show:Boolean},computed:{isEdit(){return""!=this.form.uuid}},data(){return{tableLoading:!1,deployments:[],page:1,pageNum:10,total:0,form:{uuid:"",type:"COMMON",incomingQuantity:1,expiredTime:"",primaryBaseline:"",primaryPercent:50,testBaseline:"",testPercent:50},rules:{type:[{required:!0,message:"请选择上线方式",trigger:"change"}],primaryBaseline:[{required:!0,message:"请选择生效模型",trigger:"change"},{validator:(e,t,s)=>{t&&t==this.form.testBaseline&&"COMMON"!=this.form.type?s(new Error("生效模型和测试模型不能一样")):s()},trigger:"change"}],primaryPercent:[{required:!0,message:"请填写生效流量",trigger:"blur"}],incomingQuantity:[{validator:(e,t,s)=>{t||this.form.expiredTime?s():s(new Error("最大进件量和到期时间至少填写一项"))},trigger:"blur"}],expiredTime:[{validator:(e,t,s)=>{t||this.form.incomingQuantity?s():s(new Error("最大进件量和到期时间至少填写一项"))},trigger:"blur"}],testBaseline:[{required:!0,message:"请选择测试模型",trigger:"change"},{validator:(e,t,s)=>{t&&t==this.form.primaryBaseline&&"COMMON"!=this.form.type?s(new Error("生效模型和测试模型不能一样")):s()},trigger:"change"}],testPercent:[{required:!0,message:"请填写测试流量",trigger:"blur"}]},expiredTimeDisabledDate:e=>e.getTime()<(new Date).getTime(),showAddDialog:!1,baselineLoading:!1,baselines:[],submitLoading:!1,report:{deploymentUuid:"",show:!1}}},methods:{initData(){this.tableLoading=!0,this.$axios.get("/microdeployment",{params:{microUuid:this.microUuid,page:this.page,pageNum:this.pageNum}}).then((e=>{this.tableLoading=!1,0==e.data.code&&(e.data.data.forEach((e=>{switch(e.type){case"COMMON":e.typeText="直接上线";break;case"AB_TEST":e.typeText="AB测试";break;case"CHAMPION_CHALLENGER":e.typeText="冠军挑战者"}e.models.forEach((t=>{t.primary?(e.primaryBaseline=`V${t.pkgBaseline.versionNo}`,t.percent&&(e.primaryPercent=`${t.percent}%`)):(e.testBaseline=`V${t.pkgBaseline.versionNo}`,t.percent&&(e.testPercent=`${t.percent}%`))}))})),this.deployments=e.data.data,this.total=e.data.total)})).catch((()=>{this.tableLoading=!1}))},openReport(e){this.report.deploymentUuid=e.uuid,this.report.show=!0},submit(){this.$refs.form.validate((e=>{if(e){const e={microUuid:this.microUuid,type:this.form.type},t=this.$utils.arrayFind(this.baselines,(e=>e.versionNo==this.form.primaryBaseline));if(e["models[0].primary"]=!0,e["models[0].pkgBaseline.packageUuid"]=t.packageUuid,e["models[0].pkgBaseline.versionNo"]=t.versionNo,"COMMON"!=this.form.type){e.incomingQuantity=this.form.incomingQuantity,e.expiredTime=this.form.expiredTime;const t=this.$utils.arrayFind(this.baselines,(e=>e.versionNo==this.form.testBaseline));e["models[1].primary"]=!1,e["models[1].pkgBaseline.packageUuid"]=t.packageUuid,e["models[1].pkgBaseline.versionNo"]=t.versionNo,"CHAMPION_CHALLENGER"==this.form.type&&(e["models[0].percent"]=this.form.primaryPercent,e["models[1].percent"]=this.form.testPercent)}this.form.uuid&&(e.uuid=this.form.uuid),e.expiredTime&&(e.expiredTime+=" 23:59:59"),this.submitLoading=!0,this.$axios.post("/microdeployment/deploy",this.$qs.stringify(e)).then((e=>{this.submitLoading=!1,0==e.data.code?(this.$message.success("上线成功"),this.initData(),this.showAddDialog=!1):this.$message.error(e.data.msg?e.data.msg:"上线失败")})).catch((()=>{this.$message.error("上线失败"),this.submitLoading=!1}))}}))},changeType(){this.$refs.form.clearValidate()},close(){this.$emit("update:show",!1)},openAddDialog(){this.baselineLoading=!0,this.$axios.get("/micro/baseline",{params:{microUuid:this.microUuid}}).then((e=>{if(this.baselineLoading=!1,0==e.data.code){if(!e.data.data||e.data.data.length<1)return void this.$message.warning("暂无可用基线");this.baselines=e.data.data,this.form.primaryBaseline=e.data.data[0].versionNo}})).catch((()=>{this.$message.error("获取基线失败"),this.baselineLoading=!1}))},closeAddDialog(){this.form.uuid=""},changePrimaryPercent(e){this.form.testPercent=100-e},changeTestPercent(e){this.form.primaryPercent=100-e},edit(e){this.setForm(e),this.showAddDialog=!0},setForm(e){this.form.uuid=e.uuid,this.form.type=e.type,e.incomingQuantity&&(this.form.incomingQuantity=e.incomingQuantity),e.expiredTime&&(this.form.expiredTime=e.expiredTime),e.models.forEach((e=>{e.primary?(this.form.primaryBaseline=e.pkgBaseline.versionNo,e.percent&&(this.form.primaryPercent=e.percent)):(this.form.testBaseline=e.pkgBaseline.versionNo,e.percent&&(this.form.testPercent=e.percent))}))}}};var ka=(0,A.Z)(xa,ba,[],!1,null,"56b867d9",null);ka.options.__file="src/view/microservice/list/deployment.vue";const $a={name:"index",components:{approvalLabel:va,deployment:ka.exports},data:()=>({rowData:"",tableLoading:!1,tableData:[],total:0,page:1,pageNum:10,showEditDialog:!1,showDeployDialog:!1,editLoading:!1,value:"",form:{uuid:"",name:"",type:"",description:""},types:[],showAiModelDialog:!1,aiModelLoading:!1,aiModelData:[],searchName:"",showAiClientDialog:!1,showAiClientLoading:!1,aiClientData:[],showbaseLineDialog:!1,showTraceDialog:!1,traceForm:{seqNo:""},traceLoading:!1,traceResult:null,traceProjectUuid:null,ruleflowTrace:{uuid:"",version:0,nodes:[],show:!1},viewingAssets:{uuid:"",version:0,show:!1,fireRules:[]},resData:{activeIndex:0,facts:[]},deployment:{microUuid:"",show:!1}}),mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/micro",{params:{page:this.page,pageNum:this.pageNum,name:this.searchName}}).then((e=>{0==e.data.code&&(e.data.total>0?this.tableData=e.data.data:this.tableData=[],this.total=e.data.total),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},reloadData(){this.initData()},moreOperation({row:e,op:t}){"edit"==t?this.edit(e):"del"==t?this.del(e):"apidoc"==t?this.apidoc(e):"online"==t?this.online(e):"view"==t&&this.viewClient(e)},del(e){this.$confirm("此操作将停用该服务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.tableLoading=!0,this.$axios.post("/microdeployment/offline",this.$qs.stringify({microUuid:e.uuid,packageUuid:e.packageUuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("停用成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"停用失败")})).catch((()=>{this.$message.error("停用失败"),this.tableLoading=!1}))}))},setApprovalLabel(e){this.rowData=e,this.showbaseLineDialog=!0},deploy(e){this.deployment.microUuid=e.uuid,this.deployment.show=!0},edit(e){this.showEditDialog=!0,this.form.uuid=e.uuid,this.form.name=e.name,this.form.type=e.typeName,this.form.description=e.description},submitEdit(){this.editLoading=!0,this.$axios.post("/micro/update",this.$qs.stringify({uuid:this.form.uuid,name:this.form.name,typeName:this.form.type,description:this.form.description})).then((e=>{this.editLoading=!1,0==e.data.code?(this.$message.success("编辑成功"),this.initData(),this.showEditDialog=!1):this.$message.error(e.data.msg?e.data.msg:"编辑失败")})).catch((()=>{this.$message.error("编辑失败"),this.editLoading=!1}))},apidoc(e){this.$router.push({path:"/microservice/"+e.uuid+"/apidoc"})},online(e){this.$axios.post("/micro/update",this.$qs.stringify({uuid:e.uuid,onlinApproval:1})).then((t=>{0==t.data.code?(this.$message.success("操作成功"),e.onlinApproval=1):this.$message.error(t.data.msg?t.data.msg:"操作失败")}))},viewClient(e){this.showAiClientDialog=!0,this.showAiClientLoading=!0,this.$axios.get("/client/bymicro/"+e.uuid).then((e=>{0==e.data.code&&(this.aiClientData=e.data.data),this.showAiClientLoading=!1})).catch((()=>{this.showAiClientLoading=!1}))},search(){this.page=1,this.initData()},submitQueryTrace(){this.traceForm.seqNo?(this.traceLoading=!0,this.traceResult=null,this.$axios.get("/decision/trace?seqNo="+this.traceForm.seqNo).then((e=>{this.traceLoading=!1,0==e.data.code?(this.traceResult=e.data.data.trace,this.traceProjectUuid!=e.data.data.projectUuid?(this.traceProjectUuid=e.data.data.projectUuid,this.$store.dispatch("loadBoms",{projectUuid:this.traceProjectUuid,callback:()=>{this.parseResData(e.data.data.result)}})):this.parseResData(e.data.data.result)):this.$message.error(e.data.msg?e.data.msg:"查询失败")})).catch((e=>{this.$message.error("查询失败"),this.traceLoading=!1}))):this.$message.warning("请输入流水号")},showFlow(e){const t=this.traceResult.fireNodes[e];this.ruleflowTrace.uuid=t.flowUuid,this.ruleflowTrace.version=t.versionNo,this.ruleflowTrace.nodes=t.nodes,this.ruleflowTrace.show=!0},showAssets(e){const t=this.traceResult.fireRules[e];this.viewingAssets.uuid=t.uuid,this.viewingAssets.version=t.version,this.viewingAssets.fireRules=[t.name],this.viewingAssets.show=!0},closeTraceDialog(){this.traceForm.seqNo="",this.traceResult=null},setRowIndex({row:e,rowIndex:t}){e.index=t},clickResFact(e){this.resData.activeIndex=e.index},parseResData(e){const t=JSON.parse(e),s=[];Object.keys(t).forEach((e=>{this.$store.state.facts.some((i=>{if(e==i.enName){const a={uuid:i.uuid,name:i.name,fields:[]};return Object.keys(t[e]).forEach((s=>{i.fields.some((i=>{if(s==i.name){let o=t[e][s];if(this.$utils.isBoolean(i.type))o="true"===o?"是":"否";else if(this.$utils.isObject(i.type)||this.$utils.isCollection(i.type))try{o=JSON.stringify(o)}catch(e){console.error(e)}return a.fields.push({label:i.label,value:o,type:i.type}),!0}}))})),s.push(a),!0}}))})),this.resData.facts=s,this.clickResFact({index:0})}}};var Ta=(0,A.Z)($a,ha,[],!1,null,"36dd0fee",null);Ta.options.__file="src/view/microservice/list/index.vue";const Da=Ta.exports;var Sa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("aimodel:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addModel()}}},[e._v("添加模型")]):e._e(),e._v(" "),s("div",{staticStyle:{display:"inline-block",float:"right","margin-left":"12px"}},[s("el-input",{staticClass:"search",staticStyle:{width:"220px"},attrs:{placeholder:"请输入搜索内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchName,callback:function(t){e.searchName="string"==typeof t?t.trim():t},expression:"searchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},on:{click:function(t){return e.search()}},slot:"prefix"})])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading||e.opLoading,expression:"tableLoading || opLoading"}],attrs:{"element-loading-text":"正在加载...","row-class-name":e.tableRowClassName,data:e.models},on:{"sort-change":e.sortChange}},[s("el-table-column",{attrs:{label:"模型名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.enable?s("span",[e._v(e._s(t.row.modelName))]):s("el-tooltip",{attrs:{placement:"top",content:"已禁用"}},[s("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(t.row.modelName))])])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"jarName",label:"模型文件","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.microDoalogInfo(t.row)}}},[e._v("查看被引用服务")]),e._v(" "),s("dropdown",{staticClass:"moreOperation",on:{command:e.moreOperation}},[s("span",{staticClass:"el-dropdown-link"},[e._v("\n              更多\n              "),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$hasPerm("aimodel:edit")?s("dropdown-item",{attrs:{command:{row:t.row,op:"edit"},icon:"el-icon-edit"}},[e._v("编辑")]):e._e(),e._v(" "),e.$hasPerm("aimodel:edit")?s("dropdown-item",{attrs:{command:{row:t.row,op:"enable"},icon:t.row.enable?"el-icon-lock":"el-icon-unlock"}},[e._v(e._s(t.row.enable?"禁用":"启用"))]):e._e(),e._v(" "),e.$hasPerm("aimodel:download")?s("dropdown-item",{attrs:{command:{row:t.row,op:"download"},icon:"el-icon-download"}},[e._v("下载模型文件")]):e._e(),e._v(" "),e.$hasPerm("aimodel:download")?s("dropdown-item",{attrs:{command:{row:t.row,op:"downloadParam"},icon:"el-icon-download"}},[e._v("下载参数文件")]):e._e(),e._v(" "),e.$hasPerm("aimodel:del")?s("dropdown-item",{attrs:{command:{row:t.row,op:"del"},icon:"el-icon-delete",divided:""}},[e._v("删除")]):e._e()],1)],1)]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total},on:{change:e.toPage}})],1),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑模型":"添加模型",width:"30%",visible:e.showModelDialog,"close-on-click-modal":!1},on:{"update:visible":function(t){e.showModelDialog=t},opened:function(t){return e.$refs.input.focus()},closed:e.resetForm}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"模型名称",prop:"modelName"}},[s("el-input",{ref:"input",attrs:{maxlength:100,"show-word-limit":!1},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.add(t)}},model:{value:e.form.modelName,callback:function(t){e.$set(e.form,"modelName","string"==typeof t?t.trim():t)},expression:"form.modelName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"模型文件",prop:"jarName"}},[s("el-upload",{ref:"upload1",attrs:{action:"",accept:".jar, .xml, .pmml",limit:1,"on-change":e.changeFile,"on-remove":function(){e.form.jarName=null},"auto-upload":!1,"show-file-list":!0},model:{value:e.form.jarName,callback:function(t){e.$set(e.form,"jarName",t)},expression:"form.jarName"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-files"}},[e._v("选择文件")]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("文件不超过100Mb")])],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showModelDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.add}},[e._v(e._s(e.addLoading?"提交中...":"确 定"))])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"引用服务列表",visible:e.showMicroDialog},on:{"update:visible":function(t){e.showMicroDialog=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading||e.opLoading,expression:"tableLoading || opLoading"}],attrs:{"element-loading-text":"正在加载...",data:e.microData}},[s("el-table-column",{attrs:{prop:"name",label:"服务名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"typeName",label:"服务类型"}}),e._v(" "),s("el-table-column",{attrs:{label:"是否可用",formatter:function(e){return e.enable?"是":"否"}}})],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"AI模型权限配置",visible:e.showPermissionDialog},on:{"update:visible":function(t){e.showPermissionDialog=t}}},[s("div",{staticClass:"toolbar"},[s("el-cascader",{attrs:{options:e.accounts,placeholder:"选择要授权的用户",props:{value:"uuid",label:"username"}},on:{change:e.handleChange}})],1),e._v(" "),e._l(e.resourceData,(function(t,i){return s("div",{key:i,staticClass:"clearfix",staticStyle:{"line-height":"30px"}},[s("div",{staticStyle:{float:"left"}},[e._v(e._s(t.modelName))]),e._v(" "),s("div",{staticStyle:{float:"right"}},[s("span",[e._v(e._s(t.permission[0]?"可见":"不可见"))]),e._v(" "),s("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:function(s){return e.setRowClick(t,7)}},model:{value:t.permission[0],callback:function(s){e.$set(t.permission,0,s)},expression:"item.permission[0]"}})],1)])}))],2)],1)};Sa._withStripped=!0;const Ca={name:"index",data(){const e=this;return{showModelDialog:!1,showPermissionDialog:!1,tableLoading:!1,opLoading:!1,models:[],total:0,page:1,searchName:"",addLoading:!1,innerVisible:!1,form:{uuid:"",modelName:"",jarName:"",params:""},rules:{modelName:[{required:!0,message:"请输入模型名称",trigger:"blur"},{max:100,message:"长度不超过100个字符",trigger:"blur"}],jarName:[{validator:function(t,s,i){e.form.uuid||e.file?i():i(new Error("请上传模型文件"))}}],paramName:[{validator:function(t,s,i){e.form.uuid,i()}}]},file:null,paramFile:null,microLoading:!1,showMicroDialog:!1,microData:[],accounts:[],resourceData:[],accountUuid:"",searchName:"",sortOption:{sortField:"",sortDirection:""}}},mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/aimodel",{params:{page:this.page,isAll:!1,modelName:this.searchName,sortField:this.sortOption.sortField,sortDirection:this.sortOption.sortDirection}}).then((e=>{0==e.data.code&&(e.data.data.forEach((e=>{e.permission=[!1,!1,!1,!1]})),this.total=e.data.total,this.models=e.data.data,this.resourceData=e.data.data),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},search(){this.initData()},sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.initData()},addModel(){this.form.uuid="",this.form.modelName="",this.form.jarName="",this.form.params="",this.showModelDialog=!0},tableRowClassName:({row:e,rowIndex:t})=>!1===e.enable?"disabled":"",toPage(e){this.page=e,this.initData()},moreOperation({row:e,op:t}){"edit"==t?this.edit(e):"enable"==t?this.enable(e):"del"==t?this.del(e):"download"==t?this.download(e):"downloadParam"==t&&this.downloadParam(e)},add(){this.$refs.form.validate((e=>{if(e){this.addLoading=!0;let e=this.form.uuid?"/aimodel/edit":"/aimodel/add",t=new FormData;this.form.uuid&&t.append("uuid",this.form.uuid),this.file&&t.append("formFile",this.file.raw),t.append("modelName",this.form.modelName),this.$axios.post(e,t,{headers:{"Content-Type":"multipart/form-data"}}).then((e=>{0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")})).then((()=>{this.addLoading=!1,this.showModelDialog=!1}))}}))},changeFile(e){this.file=e},resetForm(){this.$refs.form.resetFields(),this.file&&this.$refs.upload1.clearFiles(),this.file=null},edit(e){this.form.uuid=e.uuid,this.form.modelName=e.modelName,this.form.params=e.params,this.showModelDialog=!0},enable(e){this.$confirm("确认"+(e.enable?"禁用":"启用"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let t=e.enable?"/aimodel/disable":"/aimodel/enable";this.opLoading=!0,this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((e=>{0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败")})).then((()=>{this.opLoading=!1}))}))},download(e){this.opLoading=!0;const t=this;this.$axios({method:"get",url:"/aimodel/down?uuid="+e.uuid,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){var i=new FileReader;i.onload=function(){const e=JSON.parse(i.result);t.$message.error(e.msg?e.msg:"下载失败")},i.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.jarName),document.body.appendChild(i),i.click()}})).catch((()=>{t.$message.error("下载失败")})).then((()=>{this.opLoading=!1}))},downloadParam(e){this.opLoading=!0;const t=this;this.$axios({method:"get",url:"/aimodel/downmodelparams?uuid="+e.uuid,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){var i=new FileReader;i.onload=function(){const e=JSON.parse(i.result);t.$message.error(e.msg?e.msg:"下载失败")},i.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.className+".csv"),document.body.appendChild(i),i.click()}})).catch((()=>{t.$message.error("下载失败")})).then((()=>{this.opLoading=!1}))},del(e){this.$confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{this.opLoading=!0,this.$axios.post("/aimodel/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败")})).then((()=>{this.opLoading=!1}))}))},microDoalogInfo(e){this.showMicroDialog=!0,this.microLoading=!0,this.$axios.get("/aimodel/micros",{params:{uuid:e.uuid}}).then((e=>{0==e.data.code&&(this.microData=e.data.data)})).catch((()=>{this.microLoading=!1})).then((()=>{this.microLoading=!1}))},initAccounts(){this.$axios.get("/user/search?page=-1").then((e=>{0==e.data.code&&(this.accounts=e.data.data.list)}))},handleChange(e){for(let e in this.resourceData)this.$set(this.resourceData,e,{...this.resourceData[e],permission:[!1,!1,!1,!1]});this.setResource(e[0],this.resourceData,3),this.accountUuid=e[0]},setResource(e,t,s){this.$axios.post("/permission/accounthas",this.$qs.stringify({accountUuid:e,dataType:s})).then((e=>{if(0==e.data.code){let s=e.data.data;for(let e=0;e<t.length;e++){for(let i=0;i<s.length;i++)t[e].uuid==s[i].resourceId&&this.$set(t,e,{...t[e],permission:this.infoPermission(s[i].permission)});0==s.length&&this.$set(t,e,{...t[e],permission:[!1,!1,!1,!1]})}}}))},infoPermission(e){let t=["r","w","d","x"],s=[!1,!1,!1,!1],i=e.split(",");for(let e=0;e<t.length;e++)for(let a=0;a<i.length;a++)t[e]==i[a]&&(s[e]=!0);return s},setRowClick(e,t){if(""==this.accountUuid)return this.$message.warning("请选择用户");let s=[],i=["r","w","d","x"];(e.permission[1]||e.permission[2]||e.permission[3])&&(e.permission[0]=!0);for(let t=0;t<e.permission.length;t++)e.permission[t]&&s.push(i[t]);this.$axios.post("/permission/authorization",this.$qs.stringify({accountUuid:this.accountUuid,resourceId:e.uuid,type:t,permission:s.join(",")})).then((e=>{0==e.data.code?this.$message.success("操作成功"):this.$message.error(e.data.msg?e.data.msg:"操作失败")}))}}};var Na=(0,A.Z)(Ca,Sa,[],!1,null,"5ebde407",null);Na.options.__file="src/view/microservice/aimodel/index.vue";const La=Na.exports;var Aa=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-page-header",{attrs:{content:"查看调用方式"},on:{back:function(){return e.$router.go(-1)}}}),e._v(" "),s("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"数据加载中..."}},[s("h4",{staticClass:"h4-title"},[e._v("接入点 / API point")]),e._v(" "),s("div",{staticClass:"content"},[s("p",[e._v("接口地址："),s("span",[e._v(e._s(e.address))])]),e._v(" "),s("p",[e._v("请求格式："),s("span",[e._v("JSON")])]),e._v(" "),s("p",[e._v("返回格式："),s("span",[e._v("JSON")])]),e._v(" "),s("p",[e._v("请求方式："),s("span",[e._v("HTTP协议，支持POST方法")])])]),e._v(" "),s("br"),e._v(" "),s("h4",{staticClass:"h4-title"},[e._v("请求示例 / Request example")]),e._v(" "),s("pre",{staticClass:"language-javascript"},[s("code",{staticClass:"language-javascript"},[e._v("curl -H "),s("span",{staticClass:"token string"},[e._v('"Content-Type:application/json"')]),e._v(" -H "),s("span",{staticClass:"token string"},[e._v('"token:{token}"')]),e._v(" -X POST --data "),s("span",{staticClass:"token string"},[e._v("'"+e._s(e.requestExample)+"'")]),e._v(" "+e._s(e.address))])]),e._v(" "),s("br"),e._v(" "),s("h4",{staticClass:"h4-title"},[e._v("返回示例 / Response example")]),e._v(" "),s("pre",{staticClass:"language-json"},[s("code",{staticClass:"language-json"},[e._v(e._s(e.responseExample))])])])],1)};Aa._withStripped=!0;const Ea={name:"index",data:()=>({address:"",service:"",requestExample:"",responseExample:"",loading:!1}),mounted(){this.loading=!0,this.$axios.get("/micro/apidoc",{params:{uuid:this.$route.params.uuid}}).then((e=>{if(this.loading=!1,0==e.data.code){const t=e.data.data;this.address="{host}"+t.serviceUrl.substring(t.serviceUrl.indexOf("/",7)),this.service=t.serviceId,this.requestExample=JSON.stringify(t.input.data),this.responseExample=t.output.result}else this.$message.error(e.data.msg?e.data.msg:"查询出错")})).catch((()=>{this.loading=!1}))}};var Fa=(0,A.Z)(Ea,Aa,[],!1,null,"15cf12ee",null);Fa.options.__file="src/view/microservice/apidoc/index.vue";const Oa=Fa.exports;var Ia=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-card",[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.list}},[s("el-table-column",{attrs:{prop:"baseUrl",label:"地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"是否启用",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.disabled?s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}}):s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("client:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.disable(t.row)}}},[e._v("\n            "+e._s(t.row.disabled?"启用":"禁用")+"\n          ")]):e._e(),e._v(" "),e.$hasPerm("client:del")?s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除节点？"},on:{confirm:function(s){return e.del(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1):e._e()]}}])})],1)],1)],1)};Ia._withStripped=!0;const Pa={name:"index",data:()=>({tableLoading:!1,list:[]}),mounted(){this.initData()},methods:{initData(){this.tableLoading=!0,this.$axios.get("/client").then((e=>{this.tableLoading=!1,0==e.data.code&&(this.list=e.data.data)})).catch((()=>{this.tableLoading=!1}))},disable(e){this.tableLoading=!0;const t=e.disabled?"/client/enable":"/client/disable";this.$axios.post(t,this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.tableLoading=!1}))},del(e){this.tableLoading=!0,this.$axios.post("/client/delete",this.$qs.stringify({uuid:e.uuid})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initData()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))}}};var Ma=(0,A.Z)(Pa,Ia,[],!1,null,"3b86659b",null);Ma.options.__file="src/view/microservice/client/index.vue";const Ra=Ma.exports;var ja=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("div",{staticClass:"toolbar"},[e.$hasPerm("token:add")?s("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:function(t){e.showAddDialog=!0}}},[e._v("\n      添加令牌\n    ")]):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.tableData}},[s("el-table-column",{attrs:{prop:"name",label:"名称","show-overflow-tooltip":""}}),e._v(" "),s("el-table-column",{attrs:{label:"全部服务",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.all?s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}}):s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"token",width:"300",label:"token"}}),e._v(" "),s("el-table-column",{attrs:{prop:"creatorName",label:"创建人"}}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$hasPerm("token:edit")?s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.edit(t.row)}}},[e._v("\n          编辑\n        ")]):e._e(),e._v(" "),e.$hasPerm("token:del")?s("el-popconfirm",{staticStyle:{"margin-left":"10px"},attrs:{title:"确定删除令牌？"},on:{confirm:function(s){return e.del(t.row)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1):e._e()]}}])})],1),e._v(" "),s("pagination",{ref:"pager",attrs:{load:e.loadData}}),e._v(" "),s("el-dialog",{attrs:{title:e.form.uuid?"编辑令牌":"添加令牌",top:e.$dialogTop,visible:e.showAddDialog,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.showAddDialog=t},open:e.openAddDialog,opened:function(t){return e.$refs.nameInput.focus()},closed:function(t){return e.closed()}}},[s("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px",inline:""},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{prop:"name",label:"令牌名称"}},[s("el-input",{ref:"nameInput",attrs:{maxlength:40,"show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name","string"==typeof t?t.trim():t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{prop:"all",label:"全部服务"}},[s("el-switch",{model:{value:e.form.all,callback:function(t){e.$set(e.form,"all",t)},expression:"form.all"}})],1)],1),e._v(" "),e.form.all?e._e():s("div",[s("el-divider",[e._v("服务设置")]),e._v(" "),s("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.microLoading,expression:"microLoading"}],attrs:{"element-loading-text":"数据加载中...",filterable:"","filter-placeholder":"搜索",titles:["未选择","已选择"],"button-content":["选择","取消"],data:e.micros},model:{value:e.form.microUuids,callback:function(t){e.$set(e.form,"microUuids",t)},expression:"form.microUuids"}})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showAddDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.addLoading},on:{click:e.submit}},[e._v("\n        "+e._s(e.addLoading?"提交中...":"确 定")+"\n      ")])],1)],1)],1)};ja._withStripped=!0;const Ba={data:()=>({tableData:[],tableLoading:!1,showAddDialog:!1,addLoading:!1,form:{uuid:"",name:"",all:!1,microUuids:[]},rules:{name:[{required:!0,message:"请填写令牌名称",trigger:"blur"},{max:40,message:"长度不超过40个字符",trigger:"blur"}]},microLoading:!1,micros:[]}),methods:{loadData(e,t,s){this.tableLoading=!0,this.$axios.get("/token",{params:{page:e,pageNum:t}}).then((e=>{0==e.data.code&&(e.data.total>0?this.tableData=e.data.data:this.tableData=[],s(e.data.total)),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},closed(){this.form.uuid="",this.form.name="",this.form.all=!1,this.form.microUuids=[]},submit(){this.$refs.form.validate((e=>{if(e){const e=this.form.uuid?"/token/edit":"/token/add",t={name:this.form.name};this.form.all?t.all=!0:t.microUuids=this.form.microUuids.join(","),this.form.uuid&&(t.uuid=this.form.uuid),this.addLoading=!0,this.$axios.post(e,this.$qs.stringify(t)).then((e=>{this.addLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.showAddDialog=!1,this.$refs.pager.refresh()):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.addLoading=!1}))}}))},del(e){this.tableLoading=!0,this.$axios.post("/token/delete",this.$qs.stringify({uuid:e.uuid,token:e.token})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.$refs.pager.refresh()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))},openAddDialog(){this.microLoading=!0,this.micros=[],this.$axios.get("/token/micro").then((e=>{this.microLoading=!1,0==e.data.code&&e.data.data.forEach((e=>{this.micros.push({key:e.uuid,label:e.name})}))})).catch((()=>{this.microLoading=!1}))},edit(e){this.form.uuid=e.uuid,this.form.name=e.name,this.form.all=e.all,this.form.microUuids=e.microUuids,this.showAddDialog=!0}}};var Ua=(0,A.Z)(Ba,ja,[],!1,null,"09e86282",null);Ua.options.__file="src/view/microservice/token/index.vue";const Va=Ua.exports;var Ha=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("el-form",{attrs:{inline:"",model:e.form}},[s("el-form-item",{attrs:{label:"关键词"}},[s("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"请输入关键词"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.query(t)}},model:{value:e.form.keywords,callback:function(t){e.$set(e.form,"keywords",t)},expression:"form.keywords"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开始时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"开始时间","disabled-date":e.startDateDisabledDate},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"结束时间","disabled-date":e.endDateDisabledDate},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.query}},[e._v("查 询")])],1),e._v(" "),e.$hasPerm("report:export")?s("el-form-item",[s("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.exportReport}},[e._v("导 出")])],1):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.list}},[s("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ownerUserName",label:"归属用户"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ownerOrgName",label:"归属机构"}}),e._v(" "),s("el-table-column",{attrs:{prop:"reqCount",label:"调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"reqPassCountRatio",label:"调用通过率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.reqPassCountRatio?t.row.reqPassCountRatio+"%":"-")+"\n      ")]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.query}})],1)};Ha._withStripped=!0;const qa={name:"index",data(){return{tableLoading:!1,list:[],page:1,total:0,form:{keywords:"",startDate:"",endDate:""},startDateDisabledDate:e=>""!=this.form.endDate?e.getTime()>Date.now()||e.getTime()>this.form.endDate:e.getTime()>Date.now(),endDateDisabledDate:e=>e.getTime()<this.form.startDate||e.getTime()>Date.now()}},mounted(){this.query()},methods:{query(){this.tableLoading=!0;let e=this.$utils.copy(this.form);e.startDate&&(e.startDate=this.$moment(e.startDate).format("YYYY-MM-DD")),e.endDate&&(e.endDate=this.$moment(e.endDate).format("YYYY-MM-DD")),e.page=this.page,e.pageNum=this.pageNum,this.$axios.get("/report/approval",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.list=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error(res.data.msg?res.data.msg:"系统异常"),this.tableLoading=!1}))},exportReport(){const e=this;let t=this.$utils.copy(this.form);t.startDate&&(t.startDate=this.$moment(t.startDate).format("YYYY-MM-DD")),t.endDate&&(t.endDate=this.$moment(t.endDate).format("YYYY-MM-DD")),this.$axios({method:"get",url:`/report/exportApproval?keywords=${t.keywords}&startDate=${t.startDate}&endDate=${t.endDate}`,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"导出失败")},s.readAsText(t.data)}else{let e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.style.display="none",s.href=e,s.target="_blank",s.setAttribute("download","审批类报表.xlsx"),document.body.appendChild(s),s.click()}e.tableLoading=!1})).catch((()=>{e.$message.error("导出失败"),e.tableLoading=!1}))}}};var za=(0,A.Z)(qa,Ha,[],!1,null,null,null);za.options.__file="src/view/microservice/report/approval.vue";const Wa=za.exports;var Ga=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("el-form",{attrs:{inline:"",model:e.form}},[s("el-form-item",{attrs:{label:"关键词"}},[s("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"请输入关键词"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.query(t)}},model:{value:e.form.keywords,callback:function(t){e.$set(e.form,"keywords",t)},expression:"form.keywords"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开始时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"开始时间","value-format":"yyyy-MM-dd","disabled-date":e.startDateDisabledDate},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"结束时间","value-format":"yyyy-MM-dd","disabled-date":e.endDateDisabledDate},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.query}},[e._v("查 询")])],1),e._v(" "),e.$hasPerm("report:export")?s("el-form-item",[s("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.exportReport}},[e._v("导 出")])],1):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.list}},[s("el-table-column",{attrs:{prop:"ruleName",label:"规则名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ownerUserName",label:"归属用户"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ownerOrgName",label:"归属机构"}}),e._v(" "),s("el-table-column",{attrs:{prop:"reqCount",label:"调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqCount",label:"批量调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqSuccessRatio",label:"批量调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.batchReqSuccessRatio?t.row.batchReqSuccessRatio+"%":"-")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqCount",label:"联机调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqSuccessRatio",label:"联机调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.onlineReqSuccessRatio?t.row.onlineReqSuccessRatio+"%":"-")+"\n      ")]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.query}})],1)};Ga._withStripped=!0;const Ja={name:"index",data(){return{tableLoading:!1,list:[],page:1,pageNum:10,total:0,form:{keywords:"",startDate:"",endDate:""},startDateDisabledDate:e=>""!=this.form.endDate?e.getTime()>Date.now()||e.getTime()>new Date(this.form.endDate+" 00:00:00"):e.getTime()>Date.now(),endDateDisabledDate:e=>e.getTime()<new Date(this.form.startDate," 00:00:00")||e.getTime()>Date.now()}},mounted(){this.query()},methods:{query(){this.tableLoading=!0;let e=this.$utils.copy(this.form);e.page=this.page,e.pageNum=this.pageNum,this.$axios.get("/report/detail",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.list=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error(res.data.msg?res.data.msg:"系统异常"),this.tableLoading=!1}))},exportReport(){const e=this;let t=this.$utils.copy(this.form);t.startDate&&(t.startDate=this.$moment(t.startDate).format("YYYY-MM-DD")),t.endDate&&(t.endDate=this.$moment(t.endDate).format("YYYY-MM-DD")),this.$axios({method:"get",url:`/report/exportDetail?keywords=${t.keywords}&startDate=${t.startDate}&endDate=${t.endDate}`,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"导出失败")},s.readAsText(t.data)}else{let e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.style.display="none",s.href=e,s.target="_blank",s.setAttribute("download","明细报表.xlsx"),document.body.appendChild(s),s.click()}e.tableLoading=!1})).catch((()=>{e.$message.error("导出失败"),e.tableLoading=!1}))}}};var Za=(0,A.Z)(Ja,Ga,[],!1,null,null,null);Za.options.__file="src/view/microservice/report/detail.vue";const Ya=Za.exports;var Ka=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",[s("el-form",{attrs:{inline:"",model:e.form}},[s("el-form-item",{attrs:{label:"机构名称"}},[s("el-input",{staticStyle:{width:"170px"},attrs:{placeholder:"请输入机构名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.query(t)}},model:{value:e.form.keywords,callback:function(t){e.$set(e.form,"keywords",t)},expression:"form.keywords"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"开始时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"开始时间","disabled-date":e.startDateDisabledDate},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束时间"}},[s("date-picker",{staticStyle:{width:"180px"},attrs:{placeholder:"结束时间","disabled-date":e.endDateDisabledDate},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.query}},[e._v("查 询")])],1),e._v(" "),e.$hasPerm("report:export")?s("el-form-item",[s("el-button",{attrs:{icon:"el-icon-download"},on:{click:e.exportReport}},[e._v("导 出")])],1):e._e()],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.list}},[s("el-table-column",{attrs:{prop:"orgName",label:"机构名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"ruleCount",label:"规则数量"}}),e._v(" "),s("el-table-column",{attrs:{prop:"reqCount",label:"调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqCount",label:"批量调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"batchReqSuccessRatio",label:"批量调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.batchReqSuccessRatio?t.row.batchReqSuccessRatio+"%":"-")+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqCount",label:"联机调用次数"}}),e._v(" "),s("el-table-column",{attrs:{prop:"onlineReqSuccessRatio",label:"联机调用正确率"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.onlineReqSuccessRatio?t.row.onlineReqSuccessRatio+"%":"-")+"\n      ")]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.toPage}})],1)};Ka._withStripped=!0;const Xa={name:"index",data(){return{tableLoading:!1,list:[],page:1,pageNum:10,total:0,form:{keywords:"",startDate:"",endDate:""},startDateDisabledDate:e=>""!=this.form.endDate?e.getTime()>Date.now()||e.getTime()>this.form.endDate:e.getTime()>Date.now(),endDateDisabledDate:e=>e.getTime()<this.form.startDate||e.getTime()>Date.now()}},mounted(){this.query()},methods:{query(){this.tableLoading=!0;let e=this.$utils.copy(this.form);e.startDate&&(e.startDate=this.$moment(e.startDate).format("YYYY-MM-DD")),e.endDate&&(e.endDate=this.$moment(e.endDate).format("YYYY-MM-DD")),e.page=this.page,e.pageNum=this.pageNum,this.$axios.get("/report/summary",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.list=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error(res.data.msg?res.data.msg:"系统异常"),this.tableLoading=!1}))},exportReport(){const e=this;let t=this.$utils.copy(this.form);t.startDate&&(t.startDate=this.$moment(t.startDate).format("YYYY-MM-DD")),t.endDate&&(t.endDate=this.$moment(t.endDate).format("YYYY-MM-DD")),this.$axios({method:"get",url:`/report/exportSummary?keywords=${t.keywords}&startDate=${t.startDate}&endDate=${t.endDate}`,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){const s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"导出失败")},s.readAsText(t.data)}else{let e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.style.display="none",s.href=e,s.target="_blank",s.setAttribute("download","汇总报表.xlsx"),document.body.appendChild(s),s.click()}e.tableLoading=!1})).catch((()=>{e.$message.error("导出失败"),e.tableLoading=!1}))}}};var Qa=(0,A.Z)(Xa,Ka,[],!1,null,"bf9043d0",null);Qa.options.__file="src/view/microservice/report/summary.vue";const eo=Qa.exports;var to=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-container",{style:{height:e.containerHeight}},[s("el-aside",[s("el-menu",{attrs:{router:"","default-active":e.defaultActive,"background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},[s("el-menu-item",{attrs:{index:"/ops/applogs"}},[s("span",{attrs:{slot:"title"},slot:"title"},[e._v("应用日志")])])],1)],1),e._v(" "),s("el-main",{attrs:{id:"ops-main"}},[s("router-view"),e._v(" "),s("el-backtop",{attrs:{target:"#ops-main"}})],1)],1)};to._withStripped=!0;const so={name:"ops",computed:{defaultActive(){return"opsAppLogs"==this.$route.name?"/ops/applogs":null}},data:()=>({containerHeight:window.innerHeight+"px"}),mounted(){window.addEventListener("resize",(()=>{this.containerHeight=window.innerHeight+"px"})),"ops"==this.$route.name&&this.$router.push("/ops/applogs")}};var io=(0,A.Z)(so,to,[],!1,null,"171a9744",null);io.options.__file="src/view/ops/ops.vue";const ao=io.exports;var oo=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{attrs:{inline:""}},[s("el-form-item",{attrs:{label:"历史日志"}},[s("date-picker",{attrs:{"value-format":"yyyy-MM-dd","disabled-date":e.disabledDate},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"每次加载行数"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.pageNum,callback:function(t){e.pageNum=t},expression:"pageNum"}},[s("el-option",{attrs:{label:"50",value:"50"}}),e._v(" "),s("el-option",{attrs:{label:"100",value:"100"}}),e._v(" "),s("el-option",{attrs:{label:"200",value:"200"}}),e._v(" "),s("el-option",{attrs:{label:"300",value:"300"}})],1)],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",loading:e.queryLoading,icon:"el-icon-search"},on:{click:e.query}},[e._v("\n        "+e._s(e.queryLoading?"加载中...":"查 询")+"\n      ")])],1)],1),e._v(" "),e.files.length>0?s("el-tabs",{attrs:{type:"border-card"},model:{value:e.activeFile,callback:function(t){e.activeFile=t},expression:"activeFile"}},e._l(e.files,(function(t){return s("el-tab-pane",{key:t.name,attrs:{label:t.name,name:t.name}},[t.hasMore?s("div",{staticStyle:{"text-align":"center"}},[t.loading?s("span",{staticClass:"font-secondary"},[e._v("正在加载..."),s("i",{staticClass:"el-icon-loading"})]):s("el-link",{attrs:{type:"info"},on:{click:function(s){return e.loadMore(t)}}},[e._v("\n          加载更多"),s("i",{staticClass:"el-icon-top"})])],1):e._e(),e._v(" "),s("div",{staticStyle:{position:"absolute",top:"10px",right:"10px"}},[t.downloadLoading?s("i",{staticClass:"el-icon-loading"}):s("el-tooltip",{attrs:{content:"下载",placement:"bottom"}},[s("i",{staticClass:"el-icon-download",staticStyle:{cursor:"pointer"},on:{click:function(s){return e.download(t)}}})])],1),e._v(" "),e._l(t.logs,(function(i,a){return s("p",{key:t.name+"_"+a,ref:t.name+"_"+a,refInFor:!0,class:{"scroll-to":t.scrollToIndex==a}},[e._v("\n        "+e._s(i)+"\n      ")])}))],2)})),1):e._e()],1)};oo._withStripped=!0;const no={name:"app-logs",watch:{activeFile:function(e){null!=e&&this.files.forEach((t=>{t.name==e&&0===t.page&&(t.page=1,this.loadLogs(t))}))}},data(){return{date:null,queryLoading:!1,pageNum:100,logDates:[],files:[],activeFile:null,disabledDate:e=>-1==this.logDates.indexOf(e.getTime())}},mounted(){this.loadDates(),this.loadFiles()},methods:{query(){this.activeFile=null,this.files=[],this.loadFiles()},loadDates(){this.$axios.get("/ops/applogs/dates").then((e=>{0==e.data.code&&(this.logDates=e.data.data.map((e=>new Date(e+" 00:00:00").getTime())))}))},loadFiles(){const e={};null!=this.date&&(e.date=this.date),this.queryLoading=!0,this.$axios.get("/ops/applogs/files",{params:e}).then((e=>{this.queryLoading=!1,0==e.data.code&&(this.files=e.data.data.map((e=>({name:e,logs:[],page:0,loading:!1,hasMore:!0}))),this.files.length>0&&(this.activeFile=this.files[0].name))})).catch((e=>{this.queryLoading=!1}))},loadLogs(e){const t={page:e.page,pageNum:this.pageNum,filename:e.name};e.loading=!0,this.$axios.get("/ops/applogs/lines",{params:t}).then((t=>{if(e.loading=!1,0==t.data.code){t.data.data.length>0?(e.logs.unshift(...t.data.data),t.data.data.length%this.pageNum!=0&&(e.hasMore=!1)):e.hasMore=!1;const s=t.data.data.length-1;e.scrollToIndex=s,this.$nextTick((()=>{document.getElementById("ops-main").scrollTo({top:this.$refs[e.name+"_"+s][0].offsetTop-200})}))}})).catch((t=>{e.loading=!1}))},loadMore(e){e.page++,this.loadLogs(e)},download(e){const t=this;this.$set(e,"downloadLoading",!0),this.$axios({method:"get",url:"/ops/applogs/download?filename="+e.name,responseType:"blob"}).then((s=>{if("application/json"==s.data.type){const e=new FileReader;e.onload=function(){const s=JSON.parse(e.result);if(401==s.code){localStorage.removeItem("hasLogin");const e=t.$router.currentRoute.fullPath;t.$router.push("/login?from="+e)}else t.$message.error(s.msg?s.msg:"下载失败")},e.readAsText(s.data)}else{let t=window.URL.createObjectURL(new Blob([s.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.target="_blank",i.setAttribute("download",e.name),document.body.appendChild(i),i.click()}t.$set(e,"downloadLoading",!1)})).catch((()=>{t.$message.error("下载失败"),t.$set(e,"downloadLoading",!1)}))}}};var ro=(0,A.Z)(no,oo,[],!1,null,"0980bc21",null);ro.options.__file="src/view/ops/app-logs/app-logs.vue";const lo=ro.exports;i.default.use(a.Z);const co=new a.Z({routes:[{path:"/",name:"index",component:P,redirect:"/decision",children:[{path:"/home",name:"home",component:B},{path:"/decision",name:"decision",component:ie,meta:{permisson:"menu:view:decision"},children:[{path:"/decision/project",name:"decisionProject",component:re,meta:{permisson:"project:view"}},{path:"/decision/func",name:"decisionFunc",meta:{permisson:"function:view"},component:ue},{path:"/decision/thirdapi",name:"decisionThirdApi",meta:{permisson:"thirdapi:view"},component:fe},{path:"/decision/aimodel",name:"decisionAiModel",meta:{permisson:"aimodel:view"},component:we}]},{path:"/decision/project/:uuid",name:"decisionProjectHome",component:ki},{path:"/decision/project/:uuid/assets/:assetsUuid",name:"decisionAssets",component:ki},{path:"/decision/project/:uuid/knowledgepackage",name:"decisionKnowledgePackage",component:ki},{path:"/settings",name:"settings",meta:{permisson:"menu:view:systemadmin"},component:Si,children:[{path:"/settings/org",name:"org",meta:{permisson:"org:view"},component:Vi},{path:"/settings/user",name:"user",meta:{permisson:"user:view"},component:Wi},{path:"/settings/role",meta:{permisson:"role:list"},name:"roleSettings",component:ea},{path:"/settings/permission",name:"permissionSettings",component:Ki},{path:"/settings/login",name:"loginSettings",meta:{permisson:"login:view"},component:aa},{path:"/settings/logs",name:"logs",meta:{permisson:"log:view"},component:la}]},{path:"/microservice",name:"micro",meta:{permisson:"menu:view:microservice"},component:pa,children:[{path:"/microservice/list",name:"microList",meta:{permisson:"microservice:view"},component:Da},{path:"/microservice/aimodel",name:"microAiModel",component:La},{path:"/microservice/:uuid/apidoc",name:"microApiDoc",component:Oa},{path:"/microservice/client",name:"microClient",meta:{permisson:"client:view"},component:Ra},{path:"/microservice/token",name:"token",component:Va,meta:{permisson:"client:view"}},{path:"/microservice/report/summary",name:"summary",component:eo,meta:{permisson:"report:view"}},{path:"/microservice/report/detail",name:"detail",component:Ya,meta:{permisson:"report:view"}},{path:"/microservice/report/approval",name:"approval",component:Wa,meta:{permisson:"report:view"}}]}]},{path:"/ops",name:"ops",component:ao,children:[{path:"/ops/applogs",name:"opsAppLogs",component:lo}]},{path:"/forcechangepwd",name:"forceChangePwd",component:J},{path:"/login",name:"login",component:Q},{path:"/nolicense",name:"nolicense",component:q},{path:"/500",name:"500",component:q},{path:"/403",name:"403",component:q},{path:"*",name:"404",component:q}]}),uo=["login","404","500","nolicense"],po=(e,t)=>{e.meta&&e.meta.permisson?S(e.meta.permisson)?t():"decision"==e.name?S("menu:view:microservice")?t("/microservice"):S("menu:view:systemadmin")?t("/settings"):t("/403"):t("/403"):t()};co.beforeEach(((e,t,s)=>{if("1"===localStorage.getItem("hasLogin")){if("login"==e.name)return void s("/");if("nolicense"==e.name)s();else if(null==k.state.user){const t=n.Loading.service({text:"数据加载中..."});k.dispatch("getUserProfile").then((()=>{t.close(),po(e,s)})).catch((i=>{t.close(),"403"!=e.name?s("/403"):s()}))}else po(e,s)}else-1!=uo.indexOf(e.name)?s():s("/login")}));const ho=co;i.default.use(r(),{size:"medium"}),["success","warning","info","error"].forEach((e=>{i.default.prototype.$message[e]=t=>("string"==typeof t&&(t={message:t,showClose:!0}),t.type=e,i.default.prototype.$message(t))})),i.default.prototype.$dialogTop="60px";var mo=function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)};mo._withStripped=!0;var fo=(0,A.Z)({name:"App"},mo,[],!1,null,"7ba5bd90",null);fo.options.__file="src/App.vue";const go=fo.exports,vo={getText(e,t=!1,s=!0,i=null){if(!e||!e.constraint)return"无";let a=this.getJoinConstraintText(e.constraint,t,s,i);if(!a)return"无";for(;a.startsWith("(")&&a.endsWith(")");)a=a.substring(1,a.length-1);return a},getJoinConstraintText(e,t,s,i=null){if(0==e.constraints.length)return null;const a=[];return e.constraints.forEach((e=>{let o=this.getConstraintText(e,t,s,i);o&&a.push(o)})),0==a.length?null:s?a.length>1?"("+a.join('<span style="color: #303133;"> '+this.$conjunction[e.conjunction]+" </span>")+")":a.join('<span style="color: #303133;"> '+this.$conjunction[e.conjunction]+" </span>"):"NOT"==e.conjunction?a.length>1?"!("+a.join(" 或者 ")+")":"!"+a.join(" 或者 "):a.length>1?"("+a.join(" "+this.$conjunction[e.conjunction]+" ")+")":a.join(" "+this.$conjunction[e.conjunction]+" ")},getConstraintText(e,t,s,i=null){return e.conjunction?this.getJoinConstraintText(e,t,s,i):this.getAConstraintText(e,t,s,i)},getAConstraintText(e,t,s,i=null){const a=this.getExpressionText(e.left,i);if(t&&this.$utils.isBlank(a))return null;const o=this.$op.getText(e.op);if(this.$utils.isBlank(o))return null;const n=this.getExpressionText(e.right,i);if(this.$utils.isBlank(n))return null;let r="";return s?(a&&(r+='<span style="color: rgb(180, 95, 4);">'+a+"</span> "),r+='<span style="color: red;">'+o+"</span>",r+=' <span style="color: rgb(180, 95, 4);">'+n+"</span>"):(a&&(r+=a+" "),r+=o,r+=" "+n),r},getExpressionText(e,t=null){if(!e)return null;let s;if("INPUT"==e.type?s=this.getInputExpressionText(e.input):"FACT"==e.type?s=this.getFactExpressionText(e.fact):"CONSTANT"==e.type?s=this.getConstantExpressionText(e.constant):"FUNC"==e.type?s=this.getFuncExpressionText(e.func,t):"MODEL"==e.type?s=this.getModelExpressionText(e.model):"COLLECTION_CHILD"==e.type&&(s=this.getCollectionChildExpressionText(e.collectionChild,t)),this.$utils.isBlank(s))return null;if(e.arith&&Object.keys(e.arith).length>0){const i=this.getArithText(e.arith,t);return i?s+" "+i:null}return s},getInputExpressionText(e){return!e||this.$utils.isBlank(e.value)?null:this.$utils.isBoolean(e.type)?"true"===e.value?"是":"否":e.value},getFactExpressionText(e){return e?this.$store.getters.getFactText(e.id,e.fieldId):null},getConstantExpressionText(e){return e?this.$store.getters.getConstantText(e.id,e.fieldId):null},getFuncExpressionText(e,t=null){if(!e)return null;const s=[];return e.params.forEach((e=>{const i=this.getParamExpressionText(e,t);i&&s.push(i)})),e.params.length>0&&0==s.length?null:e.method+"("+s.join(", ")+")"},getParamExpressionText(e,t=null){const s=e.value;return s?this.getExpressionText(s,t):null},getModelExpressionText(e){if(!e)return null;const t=this.$store.getters.getModelName(e.id);if(!t)return null;const s=e.input;if(!s)return null;const i=e.output;if(!i)return null;const a=this.getFactExpressionText(s);if(!a)return null;const o=this.getFactExpressionText(i);return o?t+"("+a+", "+o+")":null},getCollectionChildExpressionText(e,t){if(!t)return null;const s=this.$store.getters.getFactField(t.id,t.fieldId);return s?this.$utils.isBaseType(s.subType)?s.label:this.$store.getters.getFactText(e.id,e.fieldId):null},getArithText(e,t=null){if(!e.type)return null;const s=this.getExpressionText(e.right,t);if(!s)return null;let i;return"ADD"==e.type?i="+":"SUB"==e.type?i="-":"MUL"==e.type?i="x":"DIV"==e.type&&(i="÷"),e.parentheses?i+" ("+s+")":i+" "+s}},bo={install:function(e,t={}){vo.$op=e.prototype.$op,vo.$conjunction=e.prototype.$conjunction,vo.$utils=e.prototype.$utils,vo.$store=k,e.prototype.$lhs=vo}};var wo=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?[s("span",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px","font-size":"14px"}},[e._v(e._s(e.text))])]:[e.$utils.isBoolean(e.type)?s("dropdown",{ref:"input",on:{command:e.change}},[s("span",{staticClass:"el-dropdown-link dashed-wrapper",staticStyle:{color:"rgb(180, 95, 4)"}},[e._v(e._s(e.text))]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{command:"true"}},[e._v("是")]),e._v(" "),s("dropdown-item",{attrs:{command:"false"}},[e._v("否")])],1)],1):s("el-popover",{ref:"popover",on:{"after-enter":function(t){return e.$refs.input.focus()}}},[e.$utils.isNumber(e.type)?s("el-input-number",{ref:"input",attrs:{controls:!1,clearable:"","step-strictly":e.inputInteger()},on:{blur:e.change},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.change(t)}},model:{value:e.value.value,callback:function(t){e.$set(e.value,"value","string"==typeof t?t.trim():t)},expression:"value.value"}}):e.$utils.isDate(e.type)?s("date-picker",{ref:"input",attrs:{"value-format":"yyyy-MM-dd"},on:{change:e.change},model:{value:e.value.value,callback:function(t){e.$set(e.value,"value",t)},expression:"value.value"}}):e.$utils.isDateTime(e.type)?s("date-picker",{ref:"input",attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},on:{change:e.change},model:{value:e.value.value,callback:function(t){e.$set(e.value,"value",t)},expression:"value.value"}}):s("el-input",{ref:"input",attrs:{clearable:""},on:{blur:e.change},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.change(t)}},model:{value:e.value.value,callback:function(t){e.$set(e.value,"value",t)},expression:"value.value"}}),e._v(" "),s("el-button",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.text))])])],1)]],2)};wo._withStripped=!0;const yo={name:"valueInput",props:{inputType:{type:[String,Object],default:"String"},value:{type:Object,default:function(){return{}}},immediate:Boolean,readonly:{type:Boolean,default:!1}},computed:{type:function(){if(this.inputType){const e=this.inputType.indexOf(".");if(-1!=e)return this.inputType.substring(e+1)}return this.inputType},text:function(){return this.$utils.isBlank(this.value.value)?"请选择":this.$utils.isBoolean(this.type)?"true"===this.value.value?"是":"否":this.value.value}},mounted(){this.immediate&&this.show()},watch:{inputType:function(e,t){e!=t&&(this.$delete(this.value,"value"),this.$emit("input",this.value))}},methods:{show(){this.$utils.isBoolean(this.type)?this.$refs.input.show():this.$refs.popover.doShow()},change(e){this.$utils.isBoolean(this.type)?this.$set(this.value,"value",e):this.$refs.popover.doClose(),this.inputType&&this.$set(this.value,"type",this.inputType),"string"==typeof this.value.value&&(this.value.value=this.value.value.trim()),this.$emit("input",this.value),this.$emit("draw")},inputInteger(){return-1!=["Integer","Long"].indexOf(this.inputType)}}};var _o=(0,A.Z)(yo,wo,[],!1,null,"6cf89a6e",null);_o.options.__file="src/view/decision/project/components/input.vue";const xo=_o.exports;var ko=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?s("span",{staticStyle:{color:"darkcyan",padding:"0px","font-size":"14px"}},[e._v(e._s(e.value.method))]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showCascader?s("el-cascader",{ref:"cascader",attrs:{filterable:"",placeholder:"搜索","popper-class":"factPopper",options:e.options,props:e.cascaderProps},on:{change:e.changeFunc}}):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"darkcyan",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.value.method?e.value.method:"请选择"))])])],1),e._v(" "),e.value.method?[s("span",{staticStyle:{"font-size":"14px"}},[e._v("(")]),e._v(" "),e._l(e.value.params,(function(t,i){return s("div",{key:i,staticStyle:{display:"inline-block"}},[e.value.params[i].value?e._e():s("span",{staticStyle:{color:"darkcyan","font-size":"14px"}},[e._v(e._s(t.name)+": ")]),e._v(" "),s("expression",{attrs:{"input-type":t.type,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.params[i].value,callback:function(t){e.$set(e.value.params[i],"value",t)},expression:"value.params[i].value"}}),e._v(" "),e.value.params.length-1>i?s("span",{staticStyle:{"font-size":"14px"}},[e._v(",   ")]):e._e()],1)})),e._v(" "),s("span",{staticStyle:{"font-size":"14px"}},[e._v(")")])]:e._e()],2)};ko._withStripped=!0;const $o={name:"func",props:{inputType:[String,Object],value:{type:Object,default:function(){return{}}},immediate:Boolean,readonly:{type:Boolean,default:!1},loopTarget:Object},computed:{options:function(){const e=e=>{const t=[];return e.methods.forEach((e=>{if(this.$utils.isNotBlank(this.inputType)&&!this.$utils.isTypeMatch(e.returnType,this.inputType))return;const s={value:e.name,label:e.name};t.push(s)})),t},t=[];return this.$store.state.functions.forEach((s=>{t.push({value:s.name,label:s.name,children:e(s)})})),t}},watch:{inputType:function(e,t){e!=t&&(this.$delete(this.value,"name"),this.$delete(this.value,"method"),this.$delete(this.value,"params"),this.$emit("input",this.value))}},data:()=>({showPopover:!1,showCascader:!1,cascaderProps:{expandTrigger:"hover"}}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{changeFunc(e){this.showPopover=!1,this.$nextTick((()=>{const t=this.$store.getters.getFuncMethod(e[0],e[1]);this.value.params&&t.params.forEach(((e,t)=>{if(t<this.value.params.length){const s=this.value.params[t];s.type==e.type&&(e.value=s.value)}})),this.$set(this.value,"name",e[0]),this.$set(this.value,"method",e[1]),this.$set(this.value,"params",t.params),this.$emit("input",this.value),this.$emit("draw")}))},popoverShow(){this.showCascader=!0,this.$nextTick((()=>{this.$refs.cascader.$el.click()}))},popoverHide(){this.$nextTick((()=>{this.showCascader=!1}))}}};var To=(0,A.Z)($o,ko,[],!1,null,"65ec6d15",null);To.options.__file="src/view/decision/project/components/func.vue";const Do=To.exports;var So=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?s("span",{staticStyle:{color:"darkcyan","font-size":"14px",padding:"0px"}},[e._v(e._s(e.text))]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showSelector?s("el-select",{ref:"selector",attrs:{filterable:"",placeholder:"请选择"},on:{change:e.change},model:{value:e.uuid,callback:function(t){e.uuid=t},expression:"uuid"}},e._l(e.$store.state.models,(function(e){return s("el-option",{key:e.uuid,attrs:{label:e.modelName,value:e.uuid}})})),1):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"darkcyan",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.text))])])],1),e._v(" "),e.value.id?[e._v("\n    (\n    "),e.value.input?e._e():s("span",{staticStyle:{color:"darkcyan","font-size":"14px"}},[e._v("输入: ")]),e._v(" "),s("fact",{attrs:{"input-type":"Object",readonly:e.readonly},model:{value:e.value.input,callback:function(t){e.$set(e.value,"input",t)},expression:"value.input"}}),e._v("\n    ,\n    "),e.value.output?e._e():s("span",{staticStyle:{color:"darkcyan","font-size":"14px"}},[e._v("输出: ")]),e._v(" "),s("fact",{attrs:{"input-type":"Object",readonly:e.readonly},model:{value:e.value.output,callback:function(t){e.$set(e.value,"output",t)},expression:"value.output"}}),e._v("\n    )\n  ")]:e._e()],2)};So._withStripped=!0;const Co={name:"model",props:{value:{type:Object,default:function(){return{}}},immediate:Boolean,readonly:{type:Boolean,default:!1},loopTarget:Object},computed:{text:function(){if(!this.value)return"请选择";return this.$store.getters.getModelName(this.value.id)||"请选择"}},data:()=>({showPopover:!1,showSelector:!1,uuid:""}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{change(e){this.showPopover=!1,this.$nextTick((()=>{this.$set(this.value,"id",e),this.$emit("input",this.value),this.$emit("draw")}))},popoverShow(){this.showSelector=!0,this.$nextTick((()=>{this.$refs.selector.toggleMenu()}))},popoverHide(){this.$nextTick((()=>{this.showSelector=!1}))}}};var No=(0,A.Z)(Co,So,[],!1,null,"2824e2b0",null);No.options.__file="src/view/decision/project/components/model.vue";const Lo=No.exports;var Ao=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("span",{staticStyle:{"font-size":"14px",color:"rgb(180, 95, 4)",padding:"0px"}},[e._v("\n  "+e._s(e.text)+"\n")]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showCascader?s("cascader",{ref:"cascader",attrs:{filterable:"",placeholder:"搜索","popper-class":"factPopper",options:e.options,props:e.cascaderProps},on:{change:e.change}}):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.text))])])],1)};Ao._withStripped=!0;const Eo={name:"fact",props:{inputType:[String,Object],value:{type:Object,default:function(){return{}}},immediate:Boolean,scope:String,readonly:{type:Boolean,default:!1}},computed:{text:function(){return this.value&&this.$store.getters.getFactText(this.value.id,this.value.fieldId)||"请选择"},options:function(){const e=t=>{const s=[];return t.fields.forEach((t=>{if("ASSIGN"==this.scope&&this.$utils.isDerive(t.type))return;const i=!this.$utils.isObject(t.type);if(this.$utils.isNotBlank(this.inputType)&&i&&!this.$utils.isTypeMatch(t.type,this.inputType))return;const a={value:t.id,label:t.label};if(!i){const s=this.$store.state.factMap[t.subType];if(!s)return;a.children=e(s)}s.push(a)})),s},t=[];return this.$store.state.facts.forEach((s=>{-1==this.$store.state.subFactIds.indexOf(s.uuid)&&t.push({value:s.uuid,label:s.name,children:e(s)})})),t}},watch:{inputType:function(e,t){e!=t&&(this.$delete(this.value,"id"),this.$delete(this.value,"fieldId"),this.$emit("input",this.value))}},data:()=>({showPopover:!1,showCascader:!1,cascaderProps:{checkStrictly:!0,expandTrigger:"hover"}}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{change(e){const t=e[0],s=e.slice(1).join(",");if(this.$utils.isNotBlank(this.inputType)){let i=!1;if(1==e.length)i=!0;else{const e=this.$store.getters.getFactField(t,s);this.$utils.isObject(e.type)&&(i=!0)}if(i&&!this.$utils.isTypeMatch("Object",this.inputType))return}this.showPopover=!1,this.$nextTick((()=>{this.value.id?this.$emit("change",{id:t,fieldId:s},{id:this.value.id,fieldId:this.value.fieldId}):this.$emit("change",{id:t,fieldId:s},null),this.$set(this.value,"id",t),this.$set(this.value,"fieldId",s),this.$emit("input",this.value),this.$emit("draw")}))},popoverShow(){this.showCascader=!0,this.$nextTick((()=>{this.$refs.cascader.$el.click()}))},popoverHide(){this.$nextTick((()=>{this.showCascader=!1}))}}};var Fo=(0,A.Z)(Eo,Ao,[],!1,null,"321a0cbd",null);Fo.options.__file="src/view/decision/project/components/fact.vue";const Oo=Fo.exports;var Io=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("span",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px","font-size":"14px"}},[e._v("\n  "+e._s(e.text)+"\n")]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showCascader?s("el-cascader",{ref:"cascader",attrs:{filterable:"",placeholder:"搜索","popper-class":"factPopper",options:e.options,props:e.cascaderProps},on:{change:e.change}}):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.text))])])],1)};Io._withStripped=!0;const Po={name:"constant",props:{inputType:[String,Object],value:{type:Object,default:function(){return{}}},immediate:Boolean,readonly:{type:Boolean,default:!1}},computed:{text:function(){if(!this.value)return"请选择";return this.$store.getters.getConstantText(this.value.id,this.value.fieldId)||"请选择"},options:function(){const e=e=>{const t=[];return e.fields.forEach((e=>{if(this.$utils.isNotBlank(this.inputType)&&!this.$utils.isTypeMatch(e.type,this.inputType))return;const s={value:e.id,label:e.label};t.push(s)})),t},t=[];return this.$store.state.constants.forEach((s=>{t.push({value:s.uuid,label:s.name,children:e(s)})})),t}},watch:{inputType:function(e,t){e!=t&&(this.$delete(this.value,"id"),this.$delete(this.value,"fieldId"),this.$emit("input",this.value))}},data:()=>({showPopover:!1,showCascader:!1,cascaderProps:{expandTrigger:"hover"}}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{change(e){this.showPopover=!1,this.$nextTick((()=>{this.$set(this.value,"id",e[0]),this.$set(this.value,"fieldId",e[1]),this.$emit("input",this.value),this.$emit("draw")}))},popoverShow(){this.showCascader=!0,this.$nextTick((()=>{this.$refs.cascader.$el.click()}))},popoverHide(){this.$nextTick((()=>{this.showCascader=!1}))}}};var Mo=(0,A.Z)(Po,Io,[],!1,null,"46933975",null);Mo.options.__file="src/view/decision/project/components/constant.vue";const Ro=Mo.exports;var jo=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"设置属性",visible:e.show,width:"30%","append-to-body":""},on:{"update:visible":e.cancel,open:e.onShow}},[s("el-form",{ref:"form",attrs:{model:e.attrForm,"label-width":"auto"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"优先级"}},[s("el-input-number",{staticStyle:{width:"100%"},attrs:{"step-strictly":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)}},model:{value:e.attrForm.salience,callback:function(t){e.$set(e.attrForm,"salience",t)},expression:"attrForm.salience"}}),e._v(" "),s("div",{staticClass:"el-form-item__info"},[s("i",{staticClass:"el-icon-info"}),e._v("\n        优先级高的规则先执行\n      ")])],1),e._v(" "),s("el-form-item",{attrs:{label:"生效时间"}},[s("date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择生效时间","disabled-date":e.effectiveDisabledDate},model:{value:e.attrForm.dateEffective,callback:function(t){e.$set(e.attrForm,"dateEffective",t)},expression:"attrForm.dateEffective"}}),e._v(" "),s("div",{staticClass:"el-form-item__info"},[s("i",{staticClass:"el-icon-info"}),e._v("\n        生效时间之后的规则会执行\n      ")])],1),e._v(" "),s("el-form-item",{attrs:{label:"失效时间"}},[s("date-picker",{staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"请选择失效时间","disabled-date":e.expiresDisabledDate},model:{value:e.attrForm.dateExpires,callback:function(t){e.$set(e.attrForm,"dateExpires",t)},expression:"attrForm.dateExpires"}}),e._v(" "),s("div",{staticClass:"el-form-item__info"},[s("i",{staticClass:"el-icon-info"}),e._v("\n        失效时间之后的规则不执行\n      ")])],1),e._v(" "),s("el-form-item",{attrs:{label:"互斥组"}},[s("el-input",{staticStyle:{width:"100%"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)}},model:{value:e.attrForm.activationGroup,callback:function(t){e.$set(e.attrForm,"activationGroup",t)},expression:"attrForm.activationGroup"}}),e._v(" "),s("div",{staticClass:"el-form-item__info"},[s("i",{staticClass:"el-icon-info"}),e._v("\n        同一互斥组的规则，只执行第一条满足条件的规则\n      ")])],1),e._v(" "),s("el-form-item",{attrs:{label:"生效组"}},[s("el-input",{staticStyle:{width:"100%"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.save(t)}},model:{value:e.attrForm.agendaGroup,callback:function(t){e.$set(e.attrForm,"agendaGroup",t)},expression:"attrForm.agendaGroup"}}),e._v(" "),s("div",{staticClass:"el-form-item__info"},[s("i",{staticClass:"el-icon-info"}),e._v("\n        设置了生效组的规则，SDK调用需指定才会执行\n      ")])],1),e._v(" "),s("el-form-item",{attrs:{label:"是否可用"}},[s("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.attrForm.enabled,callback:function(t){e.$set(e.attrForm,"enabled",t)},expression:"attrForm.enabled"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:e.cancel}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.save}},[e._v("确 定")])],1)],1)};jo._withStripped=!0;const Bo={name:"attr",props:{show:Boolean,value:Array},data(){return{attrForm:{salience:null,dateEffective:null,dateExpires:null,activationGroup:null,agendaGroup:null,enabled:!0},effectiveDisabledDate:e=>!!this.attrForm.dateExpires&&e.getTime()>=new Date(this.attrForm.dateExpires).getTime(),expiresDisabledDate:e=>e.getTime()<(new Date).getTime()||!!this.attrForm.dateEffective&&e.getTime()<=new Date(this.attrForm.dateEffective).getTime()}},methods:{save(){if(this.attrForm.dateEffective&&this.attrForm.dateExpires&&this.attrForm.dateEffective>=this.attrForm.dateExpires)return void this.$message.warning("生效时间必须小于失效时间");let e=[];this.$utils.isNotBlank(this.attrForm.salience)&&e.push({name:"salience",value:this.attrForm.salience}),this.attrForm.dateEffective&&e.push({name:"date-effective",value:this.attrForm.dateEffective}),this.attrForm.dateExpires&&e.push({name:"date-expires",value:this.attrForm.dateExpires}),this.attrForm.activationGroup&&e.push({name:"activation-group",value:this.attrForm.activationGroup}),this.attrForm.agendaGroup&&e.push({name:"agenda-group",value:this.attrForm.agendaGroup}),!1===this.attrForm.enabled&&e.push({name:"enabled",value:!1}),this.$emit("update:show",!1),this.$emit("input",e)},cancel(){this.$emit("update:show",!1)},onShow(){this.attrForm={salience:null,dateEffective:null,dateExpires:null,activationGroup:null,agendaGroup:null,enabled:!0},this.value.forEach((e=>{"date-effective"==e.name?this.attrForm.dateEffective=e.value:"date-expires"==e.name?this.attrForm.dateExpires=e.value:"activation-group"==e.name?this.attrForm.activationGroup=e.value:"agenda-group"==e.name?this.attrForm.agendaGroup=e.value:this.attrForm[e.name]=e.value}))}}};var Uo=(0,A.Z)(Bo,jo,[],!1,null,"34b0c5c2",null);Uo.options.__file="src/view/decision/project/components/attr.vue";const Vo=Uo.exports;var Ho=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[!e.readonly&&Object.keys(e.items).length>0?s("dropdown",{style:{margin:e.value.type?"0px 5px":0},on:{command:e.changeType}},[s("span",{staticClass:"el-dropdown-link dashed-wrapper"},[[e.value.type?s("b",[e._v(e._s(e.text))]):s("i",{staticClass:"el-icon-caret-bottom"})]],2),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(Object.keys(e.items),(function(t,i){return s("dropdown-item",{key:i,attrs:{command:t}},[e._v(e._s(e.items[t]))])})),1)],1):e.value.type?s("span",{staticStyle:{"font-size":"14px",margin:"0px 5px"}},[e._v(e._s(e.text))]):e._e(),e._v(" "),e.value.parentheses?s("span",{staticStyle:{"font-size":"14px"}},[e._v("(")]):e._e(),e._v(" "),e.value.type?s("expression",{attrs:{"input-type":e.inputType,"loop-target":e.loopTarget,immediate:e.immediate,readonly:e.readonly},model:{value:e.value.right,callback:function(t){e.$set(e.value,"right",t)},expression:"value.right"}}):e._e(),e._v(" "),e.value.parentheses?s("span",{staticStyle:{"font-size":"14px"}},[e._v(")")]):e._e(),e._v(" "),e.showArith?s("arith",{attrs:{"input-type":e.inputType,"loop-target":e.loopTarget,readonly:e.readonly},on:{draw:function(t){return e.$emit("draw")}},model:{value:e.value.arith,callback:function(t){e.$set(e.value,"arith",t)},expression:"value.arith"}}):e._e()],1)};Ho._withStripped=!0;const qo={name:"arith",props:{inputType:[String,Object],value:{type:Object,default:function(){return{}}},readonly:{type:Boolean,default:!1},loopTarget:Object},data:()=>({immediate:!1}),computed:{text:function(){return this.items[this.value.type]},showArith:function(){const e=this.inputType;return"Date"==e||"Boolean"==e?(this.$delete(this.value,"arith"),!1):this.value.parentheses},items:function(){let e;return this.$utils.isString(this.inputType)?e={ADD:"+"}:this.$utils.isNumber(this.inputType)&&(e={ADD:"+",SUB:"-",MUL:"x",DIV:"÷"}),this.value.type&&(this.value.parentheses?e.DEL_PARENTHESES="删除括号":e.ADD_PARENTHESES="括号"),this.$utils.isNotBlank(this.value.type)&&(this.value.parentheses?e.DEL="删除符号":e.DEL="删除"),e||{}}},methods:{changeType(e){"DEL"==e?(this.$delete(this.value,"type"),this.$delete(this.value,"right"),this.$delete(this.value,"parentheses")):"ADD_PARENTHESES"==e?(this.$set(this.value,"parentheses",!0),this.$emit("input",this.value)):"DEL_PARENTHESES"==e?(this.$delete(this.value,"parentheses"),this.$emit("input",this.value)):e!=this.value.type&&(this.$set(this.value,"type",e),this.immediate=!0,this.$emit("input",this.value))}}};var zo=(0,A.Z)(qo,Ho,[],!1,null,"523b5ccb",null);zo.options.__file="src/view/decision/project/components/arith.vue";const Wo=zo.exports;var Go=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?e._e():s("dropdown",{on:{command:e.changeType}},[e.value.type?s("span",{staticClass:"el-dropdown-link dashed-wrapper"},[s("i",{staticClass:"el-icon-caret-bottom"})]):s("span",{staticClass:"el-dropdown-link dashed-wrapper"},[e._v("请选择")]),e._v(" "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(Object.keys(e.types),(function(t,i){return s("dropdown-item",{key:i,attrs:{command:t}},[e._v(e._s(e.types[t]))])})),1)],1),e._v(" "),"ASSIGN"==e.value.type?[s("fact",{attrs:{scope:"ASSIGN",immediate:e.childImmediate,readonly:e.readonly},model:{value:e.value.left,callback:function(t){e.$set(e.value,"left",t)},expression:"value.left"}}),e._v(" "),e.rightInputType?s("span",[e._v("=")]):e._e(),e._v(" "),e.rightInputType?s("expression",{attrs:{"input-type":e.rightInputType,"loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.right,callback:function(t){e.$set(e.value,"right",t)},expression:"value.right"}}):e._e()]:"FUNC"==e.value.type?s("func",{attrs:{immediate:e.childImmediate,"loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.func,callback:function(t){e.$set(e.value,"func",t)},expression:"value.func"}}):"THIRDAPI"==e.value.type?s("thirdapi",{attrs:{immediate:e.childImmediate,"loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.thirdApi,callback:function(t){e.$set(e.value,"thirdApi",t)},expression:"value.thirdApi"}}):"MODEL"==e.value.type?s("model",{attrs:{immediate:e.childImmediate,"loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.model,callback:function(t){e.$set(e.value,"model",t)},expression:"value.model"}}):e._e()],2)};Go._withStripped=!0;const Jo={name:"action",props:{value:{type:Object,default:function(){return{type:"ASSIGN"}}},readonly:{type:Boolean,default:!1},loopTarget:Object,immediate:Boolean},data(){return{types:{ASSIGN:"赋值",FUNC:"执行函数",THIRDAPI:"调用接口",MODEL:"调用模型"},childImmediate:this.immediate}},computed:{rightInputType:function(){return this.$store.getters.getExpressionType({fact:this.value.left,type:"FACT"})}},mounted(){this.value.type||this.$set(this.value,"type","ASSIGN")},methods:{changeType(e){e!=this.value.type&&(this.$delete(this.value,"left"),this.$delete(this.value,"right"),this.$delete(this.value,"func"),this.$set(this.value,"type",e),this.$emit("input",this.value),this.childImmediate=!0)}}};var Zo=(0,A.Z)(Jo,Go,[],!1,null,"f5659572",null);Zo.options.__file="src/view/decision/project/components/action.vue";const Yo=Zo.exports;var Ko=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?s("span",{staticStyle:{color:"darkcyan","font-size":"14px",padding:"0px"}},[e._v(e._s(e.text))]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showSelector?s("el-select",{ref:"selector",attrs:{filterable:"",placeholder:"请选择"},on:{change:e.change},model:{value:e.uuid,callback:function(t){e.uuid=t},expression:"uuid"}},e._l(e.$store.state.thirdapis,(function(e){return s("el-option",{key:e.uuid,attrs:{label:e.name,value:e.uuid}})})),1):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"darkcyan",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[s("span",{staticClass:"dashed-wrapper"},[e._v(e._s(e.text))])])],1),e._v(" "),e.value.id?[e._v("\n    (\n    "),e.value.input?e._e():s("span",{staticStyle:{color:"darkcyan","font-size":"14px"}},[e._v("输入: ")]),e._v(" "),s("expression",{attrs:{"input-type":"Object","loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.input,callback:function(t){e.$set(e.value,"input",t)},expression:"value.input"}}),e._v("\n    ,\n    "),e.value.output?e._e():s("span",{staticStyle:{color:"darkcyan","font-size":"14px"}},[e._v("输出: ")]),e._v(" "),s("expression",{attrs:{"input-type":"Object","loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.value.output,callback:function(t){e.$set(e.value,"output",t)},expression:"value.output"}}),e._v("\n    )\n  ")]:e._e()],2)};Ko._withStripped=!0;const Xo={name:"thirdapi",props:{value:{type:Object,default:function(){return{}}},immediate:Boolean,readonly:{type:Boolean,default:!1},loopTarget:Object},computed:{text:function(){if(!this.value)return"请选择";return this.$store.getters.getThirdApiName(this.value.id)||"请选择"}},data:()=>({showPopover:!1,showSelector:!1,uuid:""}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{change(e){this.showPopover=!1,this.$nextTick((()=>{this.$set(this.value,"id",e),this.$emit("input",this.value),this.$emit("draw")}))},popoverShow(){this.showSelector=!0,this.$nextTick((()=>{this.$refs.selector.toggleMenu()}))},popoverHide(){this.$nextTick((()=>{this.showSelector=!1}))}}};var Qo=(0,A.Z)(Xo,Ko,[],!1,null,"3bb2e4b8",null);Qo.options.__file="src/view/decision/project/components/thirdapi.vue";const en=Qo.exports;var tn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},[e.readonly?s("span",{staticStyle:{"font-size":"14px",color:"rgb(180, 95, 4)"}},[e._v(e._s(e.text))]):[e.baseType?s("span",{staticStyle:{"font-size":"14px",color:"rgb(180, 95, 4)"}},[e._v(e._s(e.text))]):s("el-popover",{on:{show:e.popoverShow,hide:e.popoverHide},model:{value:e.showPopover,callback:function(t){e.showPopover=t},expression:"showPopover"}},[e.showCascader?s("cascader",{ref:"cascader",attrs:{filterable:"",placeholder:"搜索","popper-class":"factPopper",options:e.options,props:e.cascaderProps},on:{change:e.change}}):e._e(),e._v(" "),s("el-button",{staticStyle:{color:"rgb(180, 95, 4)",padding:"0px"},attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("\n        "+e._s(e.text)+"\n      ")])],1)]],2)};tn._withStripped=!0;const sn={name:"collection-child",props:{inputType:[String,Object],value:{type:Object,default:function(){return{}}},loopTarget:Object,immediate:Boolean,readonly:{type:Boolean,default:!1}},computed:{field:function(){return this.$store.getters.getFactField(this.loopTarget.id,this.loopTarget.fieldId)},baseType:function(){const e=this.$store.getters.getFactField(this.loopTarget.id,this.loopTarget.fieldId);return this.$utils.isBaseType(e.subType)},text:function(){return this.baseType?this.field.label:this.value.id?this.$store.getters.getFactText(this.value.id,this.value.fieldId):"请选择"},options:function(){const e=t=>{const s=[];return t.fields.forEach((t=>{const i=!this.$utils.isObject(t.type);if(this.$utils.isNotBlank(this.inputType)&&i&&!this.$utils.isTypeMatch(t.type,this.inputType))return;const a={value:t.id,label:t.label};if(!i){const s=this.$store.state.factMap[t.subType];if(!s)return;a.children=e(s)}s.push(a)})),s},t=[],s=this.$store.state.factMap[this.field.subType];return t.push({value:s.uuid,label:s.name,children:e(s)}),t}},data:()=>({showPopover:!1,showCascader:!1,cascaderProps:{checkStrictly:!0,expandTrigger:"hover"}}),mounted(){this.immediate&&(this.showPopover=!0)},methods:{change(e){const t=e[0],s=e.slice(1).join(",");if(this.$utils.isNotBlank(this.inputType)){let i=!1;if(1==e.length)i=!0;else{const e=this.$store.getters.getFactField(t,s);this.$utils.isObject(e.type)&&(i=!0)}if(i&&!this.$utils.isTypeMatch("Object",this.inputType))return}this.showPopover=!1,this.$nextTick((()=>{this.$set(this.value,"id",t),this.$set(this.value,"fieldId",s),this.$emit("input",this.value)}))},popoverShow(){this.showCascader=!0,this.$nextTick((()=>{this.$refs.cascader.$el.click()}))},popoverHide(){this.$nextTick((()=>{this.showCascader=!1}))}}};var an=(0,A.Z)(sn,tn,[],!1,null,"3dd62d04",null);an.options.__file="src/view/decision/project/components/collection-child.vue";const on=an.exports;var nn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-popover",{ref:"popover",attrs:{placement:"right",width:"400",trigger:"click"}},[s("el-input",{attrs:{type:"textarea",rows:10},model:{value:e.list,callback:function(t){e.list=t},expression:"list"}}),e._v(" "),s("div",{staticStyle:{"margin-top":"10px","text-align":"right"}},[s("el-button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确认")])],1),e._v(" "),s("el-link",{attrs:{slot:"reference",icon:"el-icon-edit"},slot:"reference"})],1)};nn._withStripped=!0;const rn={name:"test-collection",props:{type:String,stringify:{type:Boolean,default:!0}},data(){const e=[];try{this.type&&(this.$utils.isObject(this.type)?e.push(this.$store.getters.getFactDefaultValueById(this.type)):e.push(this.$store.getters.getFieldDefaultValue({type:this.type})))}catch(e){}return{list:JSON.stringify(e,null,2)}},methods:{submit(){if(this.list){try{const e=JSON.parse(this.list);this.$emit("input",this.stringify?this.list:e)}catch(e){return void this.$message.warning("JSON格式不正确，请重新填写")}this.close()}else this.$message.warning("请填写")},focus(){this.$refs.popover.doShow()},close(){this.$refs.popover.doClose()}}};var ln=(0,A.Z)(rn,nn,[],!1,null,"1b6fb76a",null);ln.options.__file="src/view/decision/project/knowledgepackage/test-collection.vue";const cn=ln.exports;var dn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-link",{attrs:{icon:"el-icon-edit"}}),e._v(" "),s("el-dialog",{attrs:{title:"设置集合对象",visible:e.show,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.show=t}}},[s("el-table",{staticClass:"tb-edit",attrs:{data:e.fields,"row-style":{cursor:"pointer"},"highlight-current-row":"",border:""},on:{"cell-click":e.cellClick}},[s("el-table-column",{attrs:{label:"值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isNumber(t.row.type)?s("el-input-number",{ref:"input_value_"+t.row.id,staticStyle:{width:"100%"},attrs:{controls:!1},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isBoolean(t.row.type)?s("el-select",{ref:"input_value_"+t.row.id,attrs:{placeholder:"请选择"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}},[s("el-option",{attrs:{value:"true",label:"是"}}),e._v(" "),s("el-option",{attrs:{value:"false",label:"否"}})],1):e.$utils.isDate(t.row.type)?s("date-picker",{ref:"input_value_"+t.row.id,staticStyle:{width:"100%"},attrs:{"value-format":"yyyy-MM-dd"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isDateTime(t.row.type)?s("date-picker",{ref:"input_value_"+t.row.id,staticStyle:{width:"100%"},attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):e.$utils.isCollection(t.row.type)?s("test-collection",{ref:"input_value_"+t.row.id,attrs:{type:t.row.subType},model:{value:t.row.value,callback:function(s){e.$set(t.row,"value",s)},expression:"scope.row.value"}}):s("el-input",{ref:"input_value_"+t.row.id,model:{value:t.row.value,callback:function(s){e.$set(t.row,"value","string"==typeof s?s.trim():s)},expression:"scope.row.value"}}),e._v(" "),e.$utils.isBoolean(t.row.type)?s("span",[e._v("\n            "+e._s(t.row.value?"true"===t.row.value?"是":"否":"")+"\n          ")]):e.$utils.isCollection(t.row.type)?e._e():s("span",[e._v(e._s(t.row.value))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"label",label:"中文名称",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"数据类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$utils.isCollection(t.row.type)?s("span",[e._v(e._s(t.row.type+"<"+e.getSubTypeName(t.row.subType)+">"))]):s("span",[e._v(e._s(t.row.type))])]}}])})],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success"},on:{click:e.submit}},[e._v("确 定")])],1)],1)],1)};dn._withStripped=!0;const un={name:"test-collection-child",props:{value:Object,id:String},data(){return{show:!1,fields:this.$utils.copy(this.$store.getters.getFactFields(this.id))}},methods:{focus(){this.show=!0},cellClick(e,t,s,i){const a=this.$refs["input_value_"+e.id];"值"==t.label&&a&&this.$nextTick((function(){this.$utils.isBoolean(e.type)?a.toggleMenu():a.focus()}))},getSubTypeName(e){return this.$utils.isObject(e)?this.$store.getters.getFactText(e):e},changeNumberInput(e){0==e.value&&(e.value=void 0)},onChangeNum(e){const t=e.value;!isNaN(t)&&/^-?[0-9]*(\.[0-9]*)?$/.test(t)||""===t?e.value=t:e.value=null},submit(){const e={};this.fields.forEach((t=>{e[t.name]=t.value})),this.$emit("input",e),this.show=!1}}};var pn=(0,A.Z)(un,dn,[],!1,null,"5d8e3b79",null);pn.options.__file="src/view/decision/project/knowledgepackage/test-collection-child.vue";const hn=pn.exports;var mn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-popover",{ref:"popover",attrs:{placement:"right",width:"400",trigger:"click"}},[s("el-input",{attrs:{type:"textarea",rows:10},model:{value:e.data,callback:function(t){e.data=t},expression:"data"}}),e._v(" "),s("div",{staticStyle:{"margin-top":"10px","text-align":"right"}},[s("el-button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确认")])],1),e._v(" "),s("el-link",{attrs:{slot:"reference",icon:"el-icon-edit"},slot:"reference"})],1)};mn._withStripped=!0;const fn={name:"test-object",props:{id:String,stringify:{type:Boolean,default:!0}},data(){return{data:this.id?JSON.stringify(this.$store.getters.getFactDefaultValueById(this.id),null,2):"{}"}},methods:{submit(){if(this.data){try{const e=JSON.parse(this.data);this.$emit("input",this.stringify?this.data:e)}catch(e){return void this.$message.warning("JSON格式不正确，请重新填写")}this.close()}else this.$message.warning("请填写")},focus(){this.$refs.popover.doShow()},close(){this.$refs.popover.doClose()}}};var gn=(0,A.Z)(fn,mn,[],!1,null,"18ffa4ea",null);gn.options.__file="src/view/decision/project/knowledgepackage/test-object.vue";const vn=gn.exports;var bn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:e.title,visible:e.show,"element-loading-text":"数据加载中...",width:"80%",top:"10px","custom-class":e.customClass,"append-to-body":""},on:{"update:visible":e.close,open:e.init,closed:e.closed}},[null!=e.assets?["guidedrule"==e.assets.type?s("guidedrule-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):"rulescript"==e.assets.type?s("rulescript-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):"ruletable"==e.assets.type?s("ruletable-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):"ruletree"==e.assets.type?s("ruletree-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):"scorecard"==e.assets.type?s("scorecard-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):"ruleflow"==e.assets.type?s("ruleflow-assets",{attrs:{assets:e.assets,readonly:"","fire-rules":e.fireRules}}):e._e()]:e._e()],2)};bn._withStripped=!0;const wn={name:"assets-view",components:{"guidedrule-assets":kt,"rulescript-assets":vs,"ruletable-assets":Ct,"ruletree-assets":Qt,"scorecard-assets":is,"ruleflow-assets":hs},props:{assetsUuid:String,assetsVersion:[Number,String],show:Boolean,template:Boolean,fireRules:Array},computed:{title(){return null==this.assets?"":!this.template&&this.assetsVersion?`${this.assets.name} - V${this.assetsVersion}`:this.assets.name},customClass(){return null==this.assets||"rulescript"!=this.assets.type&&"ruleflow"!=this.assets.type?null:"fixed-height"}},data:()=>({loading:!1,assets:null}),methods:{init(){this.loadAssets()},loadAssets(){this.loading=!0;let e,t={};this.template?e="/template/":(e="/assets/",t.version=this.assetsVersion),this.$axios.get(e+this.assetsUuid,{params:t}).then((e=>{this.loading=!1,0==e.data.code?this.assets=e.data.data:(this.$message.error(e.data.msg?e.data.msg:"查询失败"),this.assets=null)})).catch((()=>{this.$message.error("查询失败"),this.loading=!1}))},close(){this.$emit("update:show",!1)},closed(){this.assets=null}}};var yn=(0,A.Z)(wn,bn,[],!1,null,"142f205b",null);yn.options.__file="src/view/decision/project/assets/assets-view.vue";const _n=yn.exports;var xn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$hasPerm("project.asset:edit")?s("div",[e.showDropdown?s("dropdown",{attrs:{"split-button":""},on:{click:function(t){e.show=!0}}},[s("i",{staticClass:"el-icon-edit"}),e._v("编辑\n    "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"el-icon-download"},nativeOn:{click:function(t){return e.exportAssets(t)}}},[e._v("导出文件")])],1)],1):s("el-button",{attrs:{icon:"el-icon-edit"},on:{click:function(t){e.show=!0}}},[e._v("编辑")]),e._v(" "),s("el-dialog",{attrs:{title:"文件编辑",width:"40%",visible:e.show,"close-on-click-modal":!1,"append-to-body":!0},on:{"update:visible":function(t){e.show=t},open:e.open,opened:function(t){return e.$refs.nameRef.focus()}}},[s("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.assetsLoading,expression:"assetsLoading"}],ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("el-form-item",{attrs:{label:"文件名称：",prop:"name"}},[s("el-input",{ref:"nameRef",attrs:{maxlength:20,"show-word-limit":"",placeholder:"请输入文件名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitEdit(t)}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"文件描述：",prop:"description"}},[s("el-input",{attrs:{type:"textarea",maxlength:100,autosize:{minRows:6},"show-word-limit":!0,placeholder:"请输入文件描述"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.submitEdit(t)}},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"创建时间："}},[s("span",[e._v(e._s(e._f("formatDateTime")(e.form.createTime)))])])],1),e._v(" "),s("el-col",{attrs:{span:12}},[s("el-form-item",{attrs:{label:"更新时间："}},[e.form.updateTime?s("span",[e._v(e._s(e._f("formatDateTime")(e.form.updateTime)))]):s("span",[e._v("无")])])],1)],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error",disabled:e.assetsLoading},on:{click:function(t){e.show=!1}}},[e._v("取 消")]),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{disabled:e.assetsLoading,loading:e.lockLoading,icon:e.form.locked?"el-icon-unlock":"el-icon-lock"},on:{click:e.lock}},[e._v("\n        "+e._s(e.form.locked?"解锁文件":"锁定文件")+"\n      ")]):e._e(),e._v(" "),e.$hasPerm("project.asset:edit")?s("el-button",{attrs:{type:"primary",icon:"el-icon-success",disabled:e.assetsLoading,loading:e.editLoading},on:{click:e.submitEdit}},[e._v("\n        "+e._s(e.editLoading?"提交中...":"确 认")+"\n      ")]):e._e()],1)],1)],1):e._e()};xn._withStripped=!0;const kn={name:"asset-editor-dialog",props:{assets:Object},computed:{showDropdown(){return-1===["testcase","fact","constant"].indexOf(this.assets.type)}},data(){const e=this;return{show:!1,form:{},rules:{name:[{required:!0,message:"请输入文件名称",trigger:"blur"},{max:20,message:"长度不超过20个字符",trigger:"blur"},{validator:function(t,s,i){!s||"fact"!=e.assets.type&&"constant"!=e.assets.type||-1==s.indexOf(".")?i():i(new Error("不能包含字符[.]"))}}],description:[{max:100,message:"长度不超过100个字符",trigger:"blur"}]},editLoading:!1,assetsLoading:!1,lockLoading:!1}},methods:{open(){this.initAssets()},initAssets(){this.assetsLoading=!0,this.$axios.get("/assets/"+this.assets.uuid).then((e=>{this.assetsLoading=!1,0==e.data.code?this.form=e.data.data:this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.assetsLoading=!1}))},submitEdit(){this.$refs.form.validate((e=>{e&&(this.editLoading=!0,this.$axios.post("/assets/edit",this.$qs.stringify({uuid:this.form.uuid,description:this.form.description,name:this.form.name,dirParentId:this.assets.dirParentId})).then((e=>{this.editLoading=!1,0==e.data.code?(this.show=!1,this.$message.success("编辑成功"),this.$emit("refresh",{uuid:this.assets.uuid,name:this.form.name,locked:this.assets.locked,type:this.assets.type})):this.$message.error(e.data.msg?e.data.msg:"编辑失败")})).catch((()=>{this.$message.error("编辑失败"),this.editLoading=!1})))}))},exportAssets(){const e=this;this.$axios({method:"get",url:"/assets/export?uuid="+this.assets.uuid,responseType:"blob"}).then((t=>{if("application/json"==t.data.type){var s=new FileReader;s.onload=function(){const t=JSON.parse(s.result);if(401==t.code){localStorage.removeItem("hasLogin");const t=e.$router.currentRoute.fullPath;e.$router.push("/login?from="+t)}else e.$message.error(t.msg?t.msg:"导出失败")},s.readAsText(t.data)}else{let e=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.style.display="none",s.href=e,s.target="_blank",s.setAttribute("download",this.assets.name+".rule"),document.body.appendChild(s),s.click()}})).catch((t=>{console.error(t),e.$message.error("导出失败")}))},lock(){this.lockLoading=!0;const e=this.form.locked?"/assets/unlock":"/assets/lock";this.$axios.post(e,this.$qs.stringify({uuid:this.form.uuid})).then((e=>{this.lockLoading=!1,0==e.data.code?(this.$message.success("操作成功"),this.form.locked=!this.form.locked,this.$emit("refresh",{uuid:this.assets.uuid,name:this.assets.name,locked:this.form.locked})):this.$message.error(e.data.msg?e.data.msg:"操作失败")})).catch((()=>{this.$message.error("操作失败"),this.lockLoading=!1}))}}};var $n=(0,A.Z)(kn,xn,[],!1,null,"10364462",null);$n.options.__file="src/view/decision/project/assets/assets-editor-dialog.vue";const Tn=$n.exports;var Dn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$hasPerm("project.asset:edit")?s("div",[e.newVersion?s("dropdown",{attrs:{"split-button":"",type:"primary"},on:{click:function(t){return e.save(!1)}}},[s("i",{staticClass:"iconfont iconbaocun"}),e._v(e._s(e.saveLoading?"提交中...":"保存")+"\n    "),s("dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[s("dropdown-item",{attrs:{icon:"iconfont iconVersionupdaterule-copy"},nativeOn:{click:function(t){return e.save(!0)}}},[e._v("\n        保存新版本\n      ")]),e._v(" "),"guidedrule"==e.assets.type||"ruletable"==e.assets.type||"ruletree"==e.assets.type||"scorecard"==e.assets.type?s("dropdown-item",{attrs:{icon:"el-icon-money"},nativeOn:{click:function(t){return e.saveTemplate(t)}}},[e._v("\n        保存为模板\n      ")]):e._e(),e._v(" "),s("dropdown-item",{attrs:{icon:"el-icon-view"},nativeOn:{click:function(t){e.showVersionDialog=!0}}},[e._v("\n        查看历史版本\n      ")])],1)],1):s("el-button",{attrs:{type:"primary",disabled:e.saveLoading,icon:"iconfont iconbaocun"},on:{click:function(t){return e.save(!1)}}},[e._v("\n    "+e._s(e.saveLoading?"提交中...":"保存")+"\n  ")]),e._v(" "),e.newVersion?s("el-dialog",{attrs:{title:"保存新版本",width:"30%","append-to-body":"",visible:e.showNewVersionDialog},on:{"update:visible":function(t){e.showNewVersionDialog=t},opened:function(){return e.$refs.inputDesc.focus()},close:function(t){e.versionDesc=null}}},[s("el-form",{attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"文件名称"}},[s("span",{staticStyle:{color:"#303133"}},[e._v(e._s(e.assets.name))])]),e._v(" "),s("el-form-item",{attrs:{label:"版本描述",prop:"desc"}},[s("el-input",{ref:"inputDesc",attrs:{type:"textarea",maxlength:100,"show-word-limit":"",placeholder:"请输入版本描述"},model:{value:e.versionDesc,callback:function(t){e.versionDesc=t},expression:"versionDesc"}})],1)],1),e._v(" "),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showNewVersionDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary",icon:"el-icon-success",loading:e.saveNewVersionLoading},on:{click:e.doSaveNewVersion}},[e._v("\n        "+e._s(e.saveNewVersionLoading?"提交中...":"确 认")+"\n      ")])],1)],1):e._e(),e._v(" "),e.newVersion?s("assets-version-dialog",{attrs:{assets:e.assets,active:e.showVersionDialog},on:{"update:active":function(t){e.showVersionDialog=t},change:e.changeVersion}}):e._e()],1):e._e()};Dn._withStripped=!0;const Sn={name:"save-btn",props:{assets:Object,newVersion:{type:Boolean,default:function(){return!0}}},data:()=>({saveLoading:!1,saveNewVersionLoading:!1,showNewVersionDialog:!1,content:null,versionDesc:null,callback:null,showVersionDialog:!1}),methods:{save(e){this.saveLoading||this.$emit("callback",((t,s)=>{this.content=t,this.callback=s,e?this.showNewVersionDialog=!0:this.doSave()}))},saveTemplate(){this.saveLoading||this.$emit("callback",((e,t)=>{this.content=e,this.callback=t,this.doSaveTemplate()}))},doSave(){this.saveLoading=!0,this.$axios.post("/assets/savecontent",this.$qs.stringify({uuid:this.assets.uuid,content:this.content})).then((e=>{0==e.data.code?(this.$message.success("保存成功"),"function"==typeof this.callback&&this.callback()):this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败")})).then((()=>{this.saveLoading=!1}))},doSaveTemplate(){this.saveLoading=!0,this.$axios.post("/template",this.$qs.stringify({assetsUuid:this.assets.uuid,name:this.assets.name})).then((e=>{if(0==e.data.code){this.$message.success("保存成功");const t={name:e.data.data.name,uuid:e.data.data.uuid,dirParentId:"tpl_"+e.data.data.type,type:"tpl_"+e.data.data.type,leaf:!0};this.$store.commit("setAddTreeNode",t),this.$emit("template"),"function"==typeof this.callback&&this.callback()}else this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败")})).then((()=>{this.saveLoading=!1}))},doSaveNewVersion(){this.saveNewVersionLoading=!0,this.$axios.post("/assets/version/new",this.$qs.stringify({uuid:this.assets.uuid,content:this.content,versionDesc:this.versionDesc})).then((e=>{0==e.data.code?(this.showNewVersionDialog=!1,this.$message.success("保存成功"),"function"==typeof this.callback&&this.callback()):this.$message.error(e.data.msg?e.data.msg:"保存失败")})).catch((()=>{this.$message.error("保存失败")})).then((()=>{this.saveNewVersionLoading=!1}))},changeVersion(e){this.$emit("refresh",{uuid:this.assets.uuid,changeVersion:!0,content:e})},saveContent(e,t,s=!1){this.content=e,this.callback=t,s?this.showNewVersionDialog=!0:this.doSave()}}};var Cn=(0,A.Z)(Sn,Dn,[],!1,null,"23f9e890",null);Cn.options.__file="src/view/decision/project/assets/save-btn.vue";const Nn=Cn.exports;var Ln=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"版本列表",top:e.$dialogTop,visible:e.show,width:"70%","append-to-body":""},on:{"update:visible":function(t){e.show=t},open:e.open,closed:function(t){return e.$emit("update:active",!1)}}},[s("div",{staticClass:"toolbar"},[s("el-button",{attrs:{type:"primary",icon:"el-icon-document-copy"},on:{click:e.openDiff}},[e._v("对比差异")])],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.list,"element-loading-text":"数据加载中..."},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{prop:"versionNo",label:"版本号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("V"+e._s(t.row.versionNo))]}}])}),e._v(" "),s("el-table-column",{attrs:{property:"versionDesc","show-overflow-tooltip":"",label:"版本描述"}}),e._v(" "),s("el-table-column",{attrs:{property:"creator.realname",label:"创建人"}}),e._v(" "),s("el-table-column",{attrs:{label:"创建时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n      ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return e.viewAssets(t.row)}}},[e._v("查看")]),e._v(" "),s("el-popconfirm",{attrs:{title:"确定切换到当前版本？"},on:{confirm:function(s){return e.change(t.row.versionNo)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("切换")])],1),e._v(" "),s("el-popconfirm",{attrs:{title:"确定删除当前版本？"},on:{confirm:function(s){return e.del(t.row.versionNo)}}},[s("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.initVersion}}),e._v(" "),s("assets-view",{attrs:{"assets-uuid":e.viewingAssets.uuid,"assets-version":e.viewingAssets.version,show:e.viewingAssets.show},on:{"update:show":function(t){return e.$set(e.viewingAssets,"show",t)}}}),e._v(" "),s("assets-diff",{attrs:{"assets-uuid":e.diffAssets.uuid,"assets-version":e.diffAssets.version,"assets-type":e.diffAssets.type,show:e.diffAssets.show},on:{"update:show":function(t){return e.$set(e.diffAssets,"show",t)}}})],1)};Ln._withStripped=!0;var An=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dialog",attrs:{visible:t.show,"element-loading-text":"数据加载中...",width:"80%",top:"10px","append-to-body":""},on:{"update:visible":t.close,opened:t.init,closed:t.closed}},[i("template",{slot:"title"},[t._v("\n    版本比较\n    "),"ruleflow"==t.assetsType?i("el-tooltip",{attrs:{placement:"right"}},[i("div",{attrs:{slot:"content"},slot:"content"},[t._v("\n        1、右侧新增的节点以绿色方框高亮展示\n        "),i("br"),t._v("\n        2、左侧删除的节点以灰色方框高亮展示\n        "),i("br"),t._v("\n        3、两侧更新的节点以红色方框高亮展示\n      ")]),t._v(" "),i("i",{staticClass:"el-icon-question"})]):t._e()],1),t._v(" "),null!=t.baseVersion&&null!=t.compareVersion?["ruleflow"==t.assetsType?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.diagramLoading,expression:"diagramLoading"}],staticClass:"diffContent",attrs:{"element-loading-text":"初始化编辑框..."}},[i("div",{staticClass:"diffComponent"},[i("span",[t._v(" 版本V"+t._s(t.assetsVersion[1].versionNo))]),t._v(" "),i("div",{staticStyle:{"flex-grow":"1",height:"500px",border:"solid 1px #ddd"},attrs:{id:"compareFlowDiagram"}})]),t._v(" "),i("div",{staticClass:"divider"}),t._v(" "),i("div",{staticClass:"diffComponent"},[i("span",[t._v(" 版本V"+t._s(t.assetsVersion[0].versionNo))]),t._v(" "),i("div",{staticStyle:{"flex-grow":"1",height:"500px",border:"solid 1px #ddd"},attrs:{id:"baseFlowDiagram"}})])]):i("div",{ref:"diffContainer",staticStyle:{width:"100%",height:"500px"}})]:t._e(),t._v(" "),"ruleflow"==t.assetsType?[i("ul",{ref:"contextMenu",staticClass:"el-dropdown-menu el-popper",staticStyle:{top:"-1000px","transform-origin":"center bottom 0px"}},[i("li",{ref:"contextMenu-setRule",staticClass:"el-dropdown-menu__item",on:{click:t.showRule}},[i("i",{staticClass:"iconfont iconguize"}),t._v("\n        查看规则\n      ")]),t._v(" "),i("li",{ref:"contextMenu-setDecision",staticClass:"el-dropdown-menu__item",on:{click:t.showDecision}},[i("i",{staticClass:"iconfont iconfenzhijiedian"}),t._v("\n        查看决策\n      ")]),t._v(" "),i("li",{ref:"contextMenu-setScript",staticClass:"el-dropdown-menu__item",on:{click:t.showScript}},[i("i",{staticClass:"iconfont iconjiaobenrenwu"}),t._v("\n        查看脚本\n      ")])]),t._v(" "),i("el-dialog",{attrs:{title:"规则文件列表",top:t.$dialogTop,width:"60%",visible:t.showRuleDialog,"append-to-body":""},on:{"update:visible":function(e){t.showRuleDialog=e}}},[i("el-table",{attrs:{data:t.rules}},[i("el-table-column",{attrs:{prop:"name",label:"文件名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"versionNo",label:"版本号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(e.row.versionNo||0==e.row.versionNo?"V"+e.row.versionNo:"")+"\n          ")]}}],null,!1,3901388335)}),t._v(" "),i("el-table-column",{attrs:{label:"版本描述",prop:"versionDes","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return e.row.createTime?[t._v("\n            "+t._s(t._f("formatDateTime")(e.row.createTime))+"\n          ")]:void 0}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:"文件类型",formatter:function(t){return e.$utils.getAssetsTypeText(t.type)}}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),t.viewAssets(e.row)}}},[t._v("查看")])]}}],null,!1,2138889203)})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showRuleDialog=!1}}},[t._v("取 消")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"查看脚本",visible:t.showScriptDialog,"append-to-body":""},on:{"update:visible":function(e){t.showScriptDialog=e}}},[i("rhs",{attrs:{"from-flow":"",readonly:""},model:{value:t.script.rhs,callback:function(e){t.$set(t.script,"rhs",e)},expression:"script.rhs"}}),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showScriptDialog=!1}}},[t._v("取 消")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"查看决策",visible:t.showDecisionDialog,"append-to-body":""},on:{"update:visible":function(e){t.showDecisionDialog=e}}},[i("el-form",{attrs:{model:t.decisionForm,"label-width":"80px",inline:""}},[i("el-form-item",{attrs:{label:"分支类型"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.decisionForm.type,callback:function(e){t.$set(t.decisionForm,"type",e)},expression:"decisionForm.type"}},[i("el-option",{attrs:{label:"条件",value:"CONDITION"}}),t._v(" "),i("el-option",{attrs:{label:"百分比",value:"PERCENTAGE"}})],1)],1),t._v(" "),"CONDITION"==t.decisionForm.type?i("el-form-item",{attrs:{label:"策略配置"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.decisionForm.strategy,callback:function(e){t.$set(t.decisionForm,"strategy",e)},expression:"decisionForm.strategy"}},[i("el-option",{attrs:{label:"XOR",value:"XOR"}}),t._v(" "),i("el-option",{attrs:{label:"OR",value:"OR"}})],1)],1):t._e()],1),t._v(" "),i("el-table",{attrs:{data:t.decisionForm.connections}},[i("el-table-column",{attrs:{label:"CONDITION"==t.decisionForm.type?"条件":"百分比(单位%)"},scopedSlots:t._u([{key:"default",fn:function(e){return["CONDITION"==t.decisionForm.type?[i("span",{staticStyle:{"white-space":"normal","line-height":"1.5"},domProps:{innerHTML:t._s(t.$lhs.getText(e.row.lhs,!0))}})]:[i("el-input-number",{attrs:{controls:!1,disabled:"",min:0,max:t.maxPercentage(e.$index)},model:{value:e.row.percentage,callback:function(s){t.$set(e.row,"percentage",s)},expression:"scope.row.percentage"}})]]}}],null,!1,3426329721)}),t._v(" "),i("el-table-column",{attrs:{label:"流向"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.row.key,callback:function(s){t.$set(e.row,"key",s)},expression:"scope.row.key"}},t._l(t.decisionForm.toNodes,(function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1)]}}],null,!1,592281884)})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:t.showDecisionDialog}},[t._v("取 消")])],1)],1),t._v(" "),i("assets-view",{attrs:{"assets-uuid":t.viewingAssets.uuid,"assets-version":t.viewingAssets.version,show:t.viewingAssets.show},on:{"update:show":function(e){return t.$set(t.viewingAssets,"show",e)}}})]:t._e()],2)};An._withStripped=!0;let En=null,Fn=null;const On={name:"assets-diff",props:{assetsUuid:String,assetsVersion:Array,assetsType:String,show:Boolean},components:{rhs:it},data:()=>({loading:!1,baseVersion:null,compareVersion:null,baseFlowDiagram:null,compareFlowDiagram:null,activeNode:null,showRuleDialog:!1,rules:[],showScriptDialog:!1,script:{},decisionForm:{},showDecisionDialog:!1,baseRuleContent:null,compareRuleContent:null,viewingAssets:{uuid:"",version:0,show:!1},diffEditor:null,originalModel:null,modifiedModel:null,changedAdornmentTpl:null,addedAdornmentTpl:null,removedAdornmentTpl:null,diagramLoading:!1}),methods:{init(){this.loading=!0,this.assetsVersion.sort(((e,t)=>t.versionNo-e.versionNo)),this.$axios.get("/assets/compare",{params:{assetUuid:this.assetsUuid,assetType:this.assetsType,baseVersion:this.assetsVersion[0].versionNo,compareVersion:this.assetsVersion[1].versionNo}}).then((e=>{0==e.data.code?(this.baseVersion=e.data.data.baseVersion,this.compareVersion=e.data.data.compareVersion,"ruleflow"==this.assetsType?(this.loading=!1,this.$nextTick((()=>{this.renderFlowDiagram()}))):this.renderRuleContent()):(this.$message.error(e.data.msg?e.data.msg:"查询失败"),this.loading=!1)})).catch((e=>{console.error(e),this.$message.error("查询失败"),this.loading=!1}))},async renderFlowDiagram(){null==En&&(this.diagramLoading=!0,En=await s.e(160).then(s.t.bind(s,7160,23)),Fn=En.GraphObject.make,this.diagramLoading=!1,this.changedAdornmentTpl=Fn(En.Adornment,"Auto",Fn(En.Shape,{fill:null,stroke:"red",strokeWidth:3}),Fn(En.Placeholder,{margin:0})),this.addedAdornmentTpl=Fn(En.Adornment,"Auto",Fn(En.Shape,{fill:null,stroke:"green",strokeWidth:3}),Fn(En.Placeholder,{margin:0})),this.removedAdornmentTpl=Fn(En.Adornment,"Auto",Fn(En.Shape,{fill:null,stroke:"grey",strokeWidth:3}),Fn(En.Placeholder,{margin:0}))),this.renderBaseFlowDiagram(),this.renderCompareFlowDiagram(),this.renderDiff()},renderBaseFlowDiagram(){const e=this,t=JSON.parse(this.baseVersion.content),s=Fn(En.Diagram,"baseFlowDiagram",{initialContentAlignment:En.Spot.Center,allowDrop:!0,scrollsPageOnFocus:!1,isReadOnly:!0,"grid.gridCellSize":new En.Size(30,20),"draggingTool.isGridSnapEnabled":!0,"resizingTool.isGridSnapEnabled":!0,"rotatingTool.snapAngleMultiple":90,"rotatingTool.snapAngleEpsilon":45});var i=this.$refs.contextMenu,a=Fn(En.HTMLInfo,{show:function(t,s,a){const o=t.part.data.category;if(e.readonly&&("Start"==o||"Diverge"==o||"Converge"==o))return;e.activeNode=t.part,e.$refs["contextMenu-setRule"].style.display="Rule"==o?"block":"none",e.$refs["contextMenu-setDecision"].style.display="Decision"==o?"block":"none",e.$refs["contextMenu-setScript"].style.display="Script"==o?"block":"none";const n=s.lastInput.viewPoint;let r=n.x,l=n.y;r+i.offsetWidth>s.div.offsetWidth&&(r-=i.offsetWidth),l+i.offsetHeight>s.div.offsetHeight&&(l-=i.offsetHeight);const c=e.$refs.dialog.$el.querySelector(".el-dialog__body");i.style.left=r+20+c.offsetWidth/2+"px",i.style.top=l+100+"px"},hide:this.hideContextMenu,mainElement:i});i.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1}),!1),s.nodeTemplateMap.add("Start",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Circle",{fill:"#79C900",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!1,toMaxLinks:0}),Fn(En.TextBlock,"开始",e.textStyle(),{},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Rule",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"RoundedRectangle",{fill:"#faaa00",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"规则",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Decision",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#56abe4",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"决策",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Diverge",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#eb4f38",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"分支",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Converge",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#ae58a7",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1/0},new En.Binding("figure","figure")),Fn(En.TextBlock,"聚合",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Script",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"RoundedRectangle",{fill:"#669999",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"脚本",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.linkTemplate=Fn(En.Link,{routing:En.Link.AvoidsNodes,curve:En.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,resegmentable:!0,mouseEnter:function(e,t){t.findObject("HIGHLIGHT").stroke="rgba(30,144,255,0.2)"},mouseLeave:function(e,t){t.findObject("HIGHLIGHT").stroke="transparent"},selectionAdorned:!1},new En.Binding("points").makeTwoWay(),Fn(En.Shape,{isPanelMain:!0,strokeWidth:8,stroke:"transparent",name:"HIGHLIGHT"}),Fn(En.Shape,{isPanelMain:!0,stroke:"gray",strokeWidth:2},new En.Binding("stroke","isSelected",(function(e){return e?"dodgerblue":"gray"})).ofObject()),Fn(En.Shape,{toArrow:"standard",strokeWidth:0,fill:"gray"}),Fn(En.Panel,"Auto",{name:"LABEL",segmentIndex:2,segmentFraction:.5},new En.Binding("visible","visible").makeTwoWay(),Fn(En.Shape,"RoundedRectangle",{visible:!1,fill:"#F8F8F8",strokeWidth:0}),Fn(En.TextBlock,{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#333333",editable:!0,textEdited:(e,t,s)=>{const i=e.panel.findMainElement();(s=s.trim())?(e.text=s.trim(),i.visible=!0):i.visible=!1}},new En.Binding("text").makeTwoWay()))),s.toolManager.linkingTool.temporaryLink.routing=En.Link.Orthogonal,s.toolManager.relinkingTool.temporaryLink.routing=En.Link.Orthogonal;const o=En.Model.fromJson(t);s.model=Fn(En.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:o.nodeDataArray,linkDataArray:o.linkDataArray}),this.baseFlowDiagram=s},renderCompareFlowDiagram(){const e=this,t=JSON.parse(this.compareVersion.content),s=Fn(En.Diagram,"compareFlowDiagram",{initialContentAlignment:En.Spot.Center,allowDrop:!0,scrollsPageOnFocus:!1,isReadOnly:!0,"grid.gridCellSize":new En.Size(30,20),"draggingTool.isGridSnapEnabled":!0,"resizingTool.isGridSnapEnabled":!0,"rotatingTool.snapAngleMultiple":90,"rotatingTool.snapAngleEpsilon":45});var i=this.$refs.contextMenu,a=Fn(En.HTMLInfo,{show:function(t,s,a){const o=t.part.data.category;if(e.readonly&&("Start"==o||"Diverge"==o||"Converge"==o))return;e.activeNode=t.part,e.$refs["contextMenu-setRule"].style.display="Rule"==o?"block":"none",e.$refs["contextMenu-setDecision"].style.display="Decision"==o?"block":"none",e.$refs["contextMenu-setScript"].style.display="Script"==o?"block":"none";const n=s.lastInput.viewPoint;let r=n.x,l=n.y;l+i.offsetHeight>s.div.offsetHeight&&(l-=i.offsetHeight),e.$refs.dialog.$el.querySelector(".el-dialog__body"),i.style.left=r+20+"px",i.style.top=l+100+"px"},hide:this.hideContextMenu,mainElement:i});i.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1}),!1),s.nodeTemplateMap.add("Start",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Circle",{fill:"#79C900",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!1,toMaxLinks:0}),Fn(En.TextBlock,"开始",e.textStyle(),{},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Rule",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"RoundedRectangle",{fill:"#faaa00",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"规则",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Decision",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#56abe4",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"决策",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Diverge",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#eb4f38",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"分支",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Converge",Fn(En.Node,"Table",e.nodeStyle(),{},Fn(En.Panel,"Auto",Fn(En.Shape,"Diamond",{fill:"#ae58a7",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1/0},new En.Binding("figure","figure")),Fn(En.TextBlock,"聚合",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.nodeTemplateMap.add("Script",Fn(En.Node,"Table",e.nodeStyle(),{contextMenu:a},Fn(En.Panel,"Auto",Fn(En.Shape,"RoundedRectangle",{fill:"#669999",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new En.Binding("figure","figure")),Fn(En.TextBlock,"脚本",e.textStyle(),{margin:8,maxSize:new En.Size(160,NaN),wrap:En.TextBlock.WrapFit},new En.Binding("text","name").makeTwoWay())))),s.linkTemplate=Fn(En.Link,{routing:En.Link.AvoidsNodes,curve:En.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,resegmentable:!0,mouseEnter:function(e,t){t.findObject("HIGHLIGHT").stroke="rgba(30,144,255,0.2)"},mouseLeave:function(e,t){t.findObject("HIGHLIGHT").stroke="transparent"},selectionAdorned:!1},new En.Binding("points").makeTwoWay(),Fn(En.Shape,{isPanelMain:!0,strokeWidth:8,stroke:"transparent",name:"HIGHLIGHT"}),Fn(En.Shape,{isPanelMain:!0,stroke:"gray",strokeWidth:2},new En.Binding("stroke","isSelected",(function(e){return e?"dodgerblue":"gray"})).ofObject()),Fn(En.Shape,{toArrow:"standard",strokeWidth:0,fill:"gray"}),Fn(En.Panel,"Auto",{name:"LABEL",segmentIndex:2,segmentFraction:.5},new En.Binding("visible","visible").makeTwoWay(),Fn(En.Shape,"RoundedRectangle",{visible:!1,fill:"#F8F8F8",strokeWidth:0}),Fn(En.TextBlock,{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#333333",editable:!0,textEdited:(e,t,s)=>{const i=e.panel.findMainElement();(s=s.trim())?(e.text=s.trim(),i.visible=!0):i.visible=!1}},new En.Binding("text").makeTwoWay()))),s.toolManager.linkingTool.temporaryLink.routing=En.Link.Orthogonal,s.toolManager.relinkingTool.temporaryLink.routing=En.Link.Orthogonal;const o=En.Model.fromJson(t);s.model=Fn(En.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:o.nodeDataArray,linkDataArray:o.linkDataArray}),this.compareFlowDiagram=s},hideContextMenu(){this.$refs.contextMenu.style.top="-1000px"},renderDiff(){const e=this.baseFlowDiagram,t=this.compareFlowDiagram;e.model.nodeDataArray.forEach((s=>{const i=e.findNodeForKey(s.key),a=t.findNodeForKey(s.key);null==a?this.addAdornment(i,this.addedAdornmentTpl):this.isDiff(i,a)&&this.addAdornment(i,this.changedAdornmentTpl)})),t.model.nodeDataArray.forEach((s=>{const i=e.findNodeForKey(s.key),a=t.findNodeForKey(s.key);null==i?this.addAdornment(a,this.removedAdornmentTpl):this.isDiff(i,a)&&this.addAdornment(a,this.changedAdornmentTpl)}))},isDiff(e,t){const s=e.data.category;if("Rule"==s){if(!this.$utils.equals(e.data.rules,t.data.rules))return!0}else if("Script"==s){if(!this.$utils.equals(e.data.script,t.data.script))return!0}else if("Decision"==s&&!this.$utils.equals(e.data.decision,t.data.decision))return!0;return!1},addAdornment(e,t){const s=t.copy();s.adornedObject=e,s.location=e.position,e.addAdornment("diff",s)},textStyle:()=>({font:"bold 11pt Helvetica, Arial, sans-serif",stroke:"whitesmoke"}),nodeStyle:()=>[new En.Binding("location","loc",En.Point.parse).makeTwoWay(En.Point.stringify),{locationSpot:En.Spot.Center}],close(){this.$emit("update:show",!1)},closed(){this.baseVersion=null,this.compareVersion=null,null!=this.diffEditor&&(this.diffEditor.dispose(),this.originalModel.dispose(),this.modifiedModel.dispose())},showRule(){this.activeNode.data.rules?this.rules=this.activeNode.data.rules:this.rules=[],this.showRuleDialog=!0,this.hideContextMenu()},showDecision(){this.activeNode.data.decision||(this.activeNode.data.decision={}),this.$set(this.decisionForm,"type",this.activeNode.data.decision.type||"CONDITION"),this.$set(this.decisionForm,"strategy",this.activeNode.data.decision.strategy||"XOR");let e=[],t=[];for(let s=this.activeNode.findLinksOutOf().iterator;s.next();){const i=s.value.toNode.data;let a,o;this.activeNode.data.decision.connections&&this.activeNode.data.decision.connections.some((e=>{if(e.key==i.key)return"CONDITION"==this.activeNode.data.decision.type?a=this.$utils.copy(e.lhs):o=e.percentage,!0})),e.push({key:i.key,lhs:a,percentage:o}),t.push({key:i.key,name:i.name})}this.decisionForm.connections=e,this.decisionForm.toNodes=t,this.showDecisionDialog=!0,this.hideContextMenu()},showScript(){this.activeNode.data.script?this.script=this.activeNode.data().script:this.script={},this.showScriptDialog=!0,this.hideContextMenu()},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.versionNo,this.viewingAssets.show=!0},renderRuleContent(){const e=this.baseVersion.content?JSON.parse(this.baseVersion.content):{},t=this.compareVersion.content?JSON.parse(this.compareVersion.content):{};"guidedrule"==this.assetsType?(this.baseRuleContent=this.getGuidedRuleText(e),this.compareRuleContent=this.getGuidedRuleText(t)):"rulescript"==this.assetsType?(this.baseRuleContent=this.getRuleScriptText(e),this.compareRuleContent=this.getRuleScriptText(t)):"ruletable"==this.assetsType?(this.baseRuleContent=this.getRuleTableText(e),this.compareRuleContent=this.getRuleTableText(t)):"ruletree"==this.assetsType?(this.baseRuleContent=this.getRuleTreeText(e),this.compareRuleContent=this.getRuleTreeText(t)):"scorecard"==this.assetsType&&(this.baseRuleContent=this.getScorecardText(e),this.compareRuleContent=this.getScorecardText(t)),this.baseRuleContent=`版本V${this.assetsVersion[0].versionNo}\n\n`+this.baseRuleContent,this.compareRuleContent=`版本V${this.assetsVersion[1].versionNo}\n\n`+this.compareRuleContent,this.initEditor()},async initEditor(){try{const e=await s.e(720).then(s.bind(s,59595)),t=e.editor.createModel(this.compareRuleContent,"text/plain"),i=e.editor.createModel(this.baseRuleContent,"text/plain");this.$nextTick((()=>{const s=e.editor.createDiffEditor(this.$refs.diffContainer,{readOnly:!0});s.setModel({original:t,modified:i}),this.diffEditor=s,this.originalModel=t,this.modifiedModel=i,this.loading=!1}))}catch(e){this.loading=!1,this.$message.error("初始化编辑框失败")}},getGuidedRuleText(e){const t=[];return e.rules.forEach((e=>{const s=[];s.push(`规则 "${e.name}"`);const i=this.getAttrsText(e.attrs);if(i&&s.push(i),e.loop){const t=this.$store.getters.getFactText(e.loopTarget.id,e.loopTarget.fieldId);t&&s.push("循环对象: "+t)}s.push("如果");const a=this.$lhs.getText(e.lhs,!0,!1,e.loopTarget);s.push(a),s.push("那么"),s.push(this.getRhsText(e.rhs)),e.other&&e.other.actions&&e.other.actions.length>0&&(s.push("否则"),s.push(this.getRhsText(e.other))),t.push(s.join("\n")+"\n")})),t.join("\n")},getRuleScriptText:e=>e.script,getRuleTableText(e){const t=[];return e.rows.forEach(((s,i)=>{const a=[],o=[],n=[],r={conjunction:"AND",constraints:[]};s.forEach(((t,s)=>{const i=e.headers[s];if("CONDITION"==i.type)t.constraint.constraints.forEach((e=>{e.left={type:"FACT",fact:i.fact}})),r.constraints.push(t.constraint);else if("ASSIGN"==i.type){const e=this.$store.getters.getFactText(i.fact.id,i.fact.fieldId)+" = "+this.$lhs.getExpressionText(t.right);n.push(e)}else"ATTR"==i.type&&o.push({name:i.name,value:t.value})}));const l=this.$lhs.getText({constraint:r},!0,!1);o.length>0&&a.push(this.getAttrsText(o)),a.push("如果"),a.push(l),a.push("那么"),a.push(n.join("\n")),t.push(a.join("\n")+"\n")})),t.join("\n")},getRuleTreeText(e){const t=[],s=[],i=[],a=e.tree;let o=0;const n=e=>{const t=e.parent;return t.nodeType&&"FACT"!=t.nodeType?n(t):(t.constraintMap||(t.constraintMap={}),t)},r=(e,t)=>{if(e.length!=t.length)return!1;for(let s=0;s<e.length;s++)if(!l(e[s],t[s]))return!1;return!0},l=(e,t)=>{try{return e.left.fact==t.left.fact&&e.op==t.op&&e.right==t.right}catch(e){return!1}},c=e=>{(e=>{if(0!=i.length){for(;i[i.length-1]!=e.parent;)i.pop();i.push(e)}else i.push(e)})(e),e.children&&0!=e.children.length?e.children.forEach((t=>{t.parent=e,c(t)})):(()=>{o++;const e={conjunction:"AND",constraints:[]};let t,a;i.forEach((s=>{const i=s.nodeType;if(i&&"FACT"!=i)if("CONDITION"==i&&s.condition){const t=s.condition;if(t.other){const t={conjunction:"NOT",constraints:[]};(e=>{const t=[];Object.keys(e).forEach((s=>{let i=!1;t.some((t=>{if(r(e[s],t))return i=!0,!0})),i||t.push(e[s])}))})(s.parent.constraintMap).forEach((e=>{const s={conjunction:"AND",constraints:[]};e.forEach((e=>{s.constraints.push(e)})),t.constraints.push(s)})),e.constraints.push(t),s.elseConstraint=t}else{const i={left:a,op:t.op,right:t.right};e.constraints.push(i);const l=n(s);let c=l.constraintMap[o];c||(c=[],l.constraintMap[o]=c);const d=(e=>{let t;return n(e).children.some((e=>{if(e.elseConstraint)return t=e.elseConstraint,!0})),t})(s);if(d){let e;0==c.length?(e={conjunction:"AND",constraints:[]},d.constraints.push(e)):e=d.constraints[d.constraints.length-1],e.constraints.push(i);const t=d.constraints;t.length>1&&r(t[t.length-2].constraints,t[t.length-1].constraints)&&t.pop()}c.push(i)}}else"ACTION"==i&&(t=s.rhs);else a={type:"FACT",fact:s.fact}})),s.push({lhs:{constraint:e},rhs:t})})()};return c(a),t.push(this.getAttrsText(e.attrs)),s.forEach((e=>{const s=[],i=this.$lhs.getText(e.lhs,!1,!1);s.push("如果"),s.push(i),s.push("那么"),s.push(this.getRhsText(e.rhs)+"\n"),t.push(s.join("\n"))})),t.join("\n")},getScorecardText(e){const t=[],s=this.getAttrsText(e.attrs);return s&&t.push(s),t.push(this.getScorecardHeaderText(e)),e.rows.forEach((e=>{const s=[];s.push("如果");let i="";e.fact&&e.fact.id?i+=this.$store.getters.getFactText(e.fact.id,e.fact.fieldId)+" ":i+="请选择 ",i+=this.$lhs.getText(e.condition,!1,!1),s.push(i),s.push("那么");let a="";e.scoreLabel?a+=e.scoreLabel+" = ":a+="分值 = ",e.weight&&(a+="("),e.score?a+=this.$lhs.getExpressionText(e.score):a+="请选择",e.weight&&(a+=") * "+e.weight),a+="\n",e.reasonCode&&(a+="原因码 = "+e.reasonCode,a+="\n"),e.reasonMsg&&(a+="原因信息 = "+e.reasonMsg,a+="\n"),s.push(a),t.push(s.join("\n"))})),t.join("\n")},getScorecardHeaderText(e){const t=[];if(t.push(`支持权重（${e.weight?"是":"否"}）`),t.push(`评分计算方式（${"SUM"==e.scoringType?"求和":"求积"}）`),e.assign&&e.assign.id){const s=this.$store.getters.getFactText(e.assign.id,e.assign.fieldId);t.push(`将评分赋给（${s}）`)}return t.push(`初始评分（${e.defaultScore?e.defaultScore:"0"}）`),t.join("，")+"\n"},getAttrsText(e){if(0==e.length)return"";const t=[];return e.forEach((e=>{e.label||("enabled"==e.name?(e.label="是否可用",e.text="true"==e.value?"是":"否"):"salience"==e.name?e.label="优先级":"date-effective"==e.name?e.label="生效日期":"date-expires"==e.name?e.label="失效日期":"activation-group"==e.name&&(e.label="互斥组"),e.text||(e.text=e.value)),t.push(`${e.label}（${e.text}）`)})),t.join("，")},getRhsText(e){const t=[];return e.actions.forEach((e=>{t.push(this.getActionText(e))})),t.join("\n")},getActionText(e){let t="";return"ASSIGN"==e.type?(t+=this.$lhs.getFactExpressionText(e.left)+" = ",t+=this.$lhs.getExpressionText(e.right)):"FUNC"==e.type?t=this.$lhs.getFuncExpressionText(e.func):"MODEL"==e.type&&(t=this.$lhs.getModelExpressionText(e.model)),t}}};var In=(0,A.Z)(On,An,[],!1,null,"71c17c8a",null);In.options.__file="src/view/decision/project/assets/assets-diff.vue";const Pn=In.exports,Mn={name:"assets-version-dialog",props:{active:Boolean,assets:Object},components:{"assets-diff":Pn},watch:{active(e){this.show=e}},data(){return{show:this.active,list:[],tableLoading:!1,total:0,page:1,pageNum:10,viewingAssets:{uuid:"",version:0,show:!1},diffAssets:{uuid:"",type:"",version:[],show:!1},tabSelect:[]}},methods:{open(){this.initVersion()},initVersion(){this.tableLoading=!0,this.$axios.get("/assets/version/list",{params:{uuid:this.assets.uuid,page:this.page,pageNum:this.pageNum}}).then((e=>{0==e.data.code&&(this.total=e.data.total,e.data.total>0?this.list=e.data.data:this.list=[],this.show=!0),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},change(e){this.tableLoading=!0,this.$axios.post("/assets/version/change",this.$qs.stringify({uuid:this.assets.uuid,versionNo:e})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.show=!1,this.$emit("change",e.data.data.content),this.$message.success("版本切换成功")):this.$message.error(e.data.msg?e.data.msg:"版本切换失败")})).catch((()=>{this.$message.error("版本切换失败"),this.tableLoading=!1}))},del(e){this.tableLoading=!0,this.$axios.post("/assets/version/delete",this.$qs.stringify({uuid:this.assets.uuid,versionNo:e})).then((e=>{this.tableLoading=!1,0==e.data.code?(this.$message.success("删除成功"),this.initVersion()):this.$message.error(e.data.msg?e.data.msg:"删除失败")})).catch((()=>{this.$message.error("删除失败"),this.tableLoading=!1}))},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.versionNo,this.viewingAssets.show=!0},openDiff(){2==this.tabSelect.length?(this.diffAssets.uuid=this.assets.uuid,this.diffAssets.type=this.assets.type,this.diffAssets.version=this.tabSelect,this.diffAssets.show=!0):this.$message.warning("请勾选两个版本对比")},handleSelectionChange(e){this.tabSelect=[],e.forEach((e=>{this.tabSelect.push(e)}))}}};var Rn=(0,A.Z)(Mn,Ln,[],!1,null,"bd2777da",null);Rn.options.__file="src/view/decision/project/assets/assets-version-dialog.vue";const jn=Rn.exports;var Bn=function(){var e=this,t=this,s=t.$createElement,i=t._self._c||s;return i("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"dialog",attrs:{title:"查询轨迹",visible:t.show,"element-loading-text":"数据加载中...",width:"80%",top:"10px","custom-class":"fixed-height","append-to-body":""},on:{"update:visible":t.close,opened:t.init,closed:t.closed}},[t.show?i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.diagramLoading,expression:"diagramLoading"}],staticClass:"diagram-main",style:{height:t.diagramHeight},attrs:{id:"diagramDiv","element-loading-text":"初始化编辑框..."}}):t._e(),t._v(" "),i("ul",{ref:"contextMenu",staticClass:"el-dropdown-menu el-popper",staticStyle:{top:"-1000px","transform-origin":"center bottom 0px"}},[i("li",{ref:"contextMenu-setRule",staticClass:"el-dropdown-menu__item",on:{click:t.showRule}},[i("i",{staticClass:"iconfont iconguize"}),t._v("\n      查看规则\n    ")]),t._v(" "),i("li",{ref:"contextMenu-setDecision",staticClass:"el-dropdown-menu__item",on:{click:t.showDecision}},[i("i",{staticClass:"iconfont iconfenzhijiedian"}),t._v("\n      查看决策\n    ")]),t._v(" "),i("li",{ref:"contextMenu-setScript",staticClass:"el-dropdown-menu__item",on:{click:t.showScript}},[i("i",{staticClass:"iconfont iconjiaobenrenwu"}),t._v("\n      查看脚本\n    ")])]),t._v(" "),i("el-dialog",{attrs:{title:"规则文件列表",top:t.$dialogTop,width:"60%",visible:t.showRuleDialog,"append-to-body":""},on:{"update:visible":function(e){t.showRuleDialog=e}}},[i("el-table",{attrs:{data:t.rules}},[i("el-table-column",{attrs:{prop:"name",label:"文件名称"}}),t._v(" "),i("el-table-column",{attrs:{prop:"versionNo",label:"版本号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.versionNo||0==e.row.versionNo?"V"+e.row.versionNo:"")+"\n        ")]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"版本描述",prop:"versionDes","show-overflow-tooltip":""}}),t._v(" "),i("el-table-column",{attrs:{label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return e.row.createTime?[t._v("\n          "+t._s(t._f("formatDateTime")(e.row.createTime))+"\n        ")]:void 0}}],null,!0)}),t._v(" "),i("el-table-column",{attrs:{prop:"type",label:"文件类型",formatter:function(t){return e.$utils.getAssetsTypeText(t.type)}}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),t.viewAssets(e.row)}}},[t._v("查看")])]}}])})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showRuleDialog=!1}}},[t._v("取 消")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"查看脚本",visible:t.showScriptDialog,"append-to-body":""},on:{"update:visible":function(e){t.showScriptDialog=e}}},[i("rhs",{attrs:{"from-flow":"",readonly:""},model:{value:t.script.rhs,callback:function(e){t.$set(t.script,"rhs",e)},expression:"script.rhs"}}),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(e){t.showScriptDialog=!1}}},[t._v("取 消")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"查看决策",visible:t.showDecisionDialog,"append-to-body":""},on:{"update:visible":function(e){t.showDecisionDialog=e}}},[i("el-form",{attrs:{model:t.decisionForm,"label-width":"80px",inline:""}},[i("el-form-item",{attrs:{label:"分支类型"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.decisionForm.type,callback:function(e){t.$set(t.decisionForm,"type",e)},expression:"decisionForm.type"}},[i("el-option",{attrs:{label:"条件",value:"CONDITION"}}),t._v(" "),i("el-option",{attrs:{label:"百分比",value:"PERCENTAGE"}})],1)],1),t._v(" "),"CONDITION"==t.decisionForm.type?i("el-form-item",{attrs:{label:"策略配置"}},[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:t.decisionForm.strategy,callback:function(e){t.$set(t.decisionForm,"strategy",e)},expression:"decisionForm.strategy"}},[i("el-option",{attrs:{label:"XOR",value:"XOR"}}),t._v(" "),i("el-option",{attrs:{label:"OR",value:"OR"}})],1)],1):t._e()],1),t._v(" "),i("el-table",{attrs:{data:t.decisionForm.connections}},[i("el-table-column",{attrs:{label:"CONDITION"==t.decisionForm.type?"条件":"百分比(单位%)"},scopedSlots:t._u([{key:"default",fn:function(e){return["CONDITION"==t.decisionForm.type?[i("span",{staticStyle:{"white-space":"normal","line-height":"1.5"},domProps:{innerHTML:t._s(t.$lhs.getText(e.row.lhs,!0))}})]:[i("el-input-number",{attrs:{controls:!1,disabled:"",min:0,max:t.maxPercentage(e.$index)},model:{value:e.row.percentage,callback:function(s){t.$set(e.row,"percentage",s)},expression:"scope.row.percentage"}})]]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"流向"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-select",{attrs:{placeholder:"请选择",disabled:""},model:{value:e.row.key,callback:function(s){t.$set(e.row,"key",s)},expression:"scope.row.key"}},t._l(t.decisionForm.toNodes,(function(e){return i("el-option",{key:e.key,attrs:{label:e.name,value:e.key}})})),1)]}}])})],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{icon:"el-icon-error"},on:{click:t.showDecisionDialog}},[t._v("取 消")])],1)],1),t._v(" "),i("assets-view",{attrs:{"assets-uuid":t.viewingAssets.uuid,"assets-version":t.viewingAssets.version,show:t.viewingAssets.show},on:{"update:show":function(e){return t.$set(t.viewingAssets,"show",e)}}})],1)};Bn._withStripped=!0;let Un=null,Vn=null;const Hn={name:"ruleflow-trace",props:{flowUuid:String,flowVersion:Number,nodes:Array,show:Boolean},components:{rhs:it},data:()=>({loading:!1,flow:null,diagram:null,linkDataArray:{},activeNode:null,showRuleDialog:!1,rules:[],showScriptDialog:!1,script:{},decisionForm:{},showDecisionDialog:!1,viewingAssets:{uuid:"",version:0,show:!1},diagramLoading:!1,diagramHeight:"100%"}),methods:{init(){window.addEventListener("resize",this.setDiagramHeight),this.setDiagramHeight(),this.loading=!0,this.$axios.get(`/assets/${this.flowUuid}?version=${this.flowVersion}`).then((e=>{this.loading=!1,0==e.data.code?(this.flow=e.data.data,this.initGoJS()):this.$message.error(e.data.msg?e.data.msg:"查询失败")})).catch((()=>{this.$message.error("查询失败"),this.loading=!1}))},async initGoJS(){null==Un&&(this.diagramLoading=!0,Un=await s.e(160).then(s.t.bind(s,7160,23)),Vn=Un.GraphObject.make,this.diagramLoading=!1),this.initDiagram()},textStyle:()=>({font:"bold 11pt Helvetica, Arial, sans-serif",stroke:"whitesmoke"}),nodeStyle:()=>[new Un.Binding("location","loc",Un.Point.parse).makeTwoWay(Un.Point.stringify),{locationSpot:Un.Spot.Center}],initDiagram(){const e=this,t=Vn(Un.Diagram,"diagramDiv",{initialContentAlignment:Un.Spot.Center,allowDrop:!0,scrollsPageOnFocus:!1,isReadOnly:!0,"grid.gridCellSize":new Un.Size(30,20),"draggingTool.isGridSnapEnabled":!0,"resizingTool.isGridSnapEnabled":!0,"rotatingTool.snapAngleMultiple":90,"rotatingTool.snapAngleEpsilon":45});var s=this.$refs.contextMenu,i=Vn(Un.HTMLInfo,{show:function(t,i,a){const o=t.part.data.category;if(e.readonly&&("Start"==o||"Diverge"==o||"Converge"==o))return;e.activeNode=t.part,e.$refs["contextMenu-setRule"].style.display="Rule"==o?"block":"none",e.$refs["contextMenu-setDecision"].style.display="Decision"==o?"block":"none",e.$refs["contextMenu-setScript"].style.display="Script"==o?"block":"none";const n=i.lastInput.viewPoint;let r=n.x,l=n.y;r+s.offsetWidth>i.div.offsetWidth&&(r-=s.offsetWidth),l+s.offsetHeight>i.div.offsetHeight&&(l-=s.offsetHeight),s.style.left=r+20+"px",s.style.top=l+80+"px"},hide:this.hideContextMenu,mainElement:s});s.addEventListener("contextmenu",(function(e){return e.preventDefault(),!1}),!1),t.nodeTemplateMap.add("Start",Vn(Un.Node,"Table",e.nodeStyle(),{},Vn(Un.Panel,"Auto",Vn(Un.Shape,"Circle",{fill:"#79C900",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!1,toMaxLinks:0}),Vn(Un.TextBlock,"开始",e.textStyle(),{},new Un.Binding("text","name").makeTwoWay())))),t.nodeTemplateMap.add("Rule",Vn(Un.Node,"Table",e.nodeStyle(),{contextMenu:i},Vn(Un.Panel,"Auto",Vn(Un.Shape,"RoundedRectangle",{fill:"#faaa00",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new Un.Binding("figure","figure")),Vn(Un.TextBlock,"规则",e.textStyle(),{margin:8,maxSize:new Un.Size(160,NaN),wrap:Un.TextBlock.WrapFit},new Un.Binding("text","name").makeTwoWay())))),t.nodeTemplateMap.add("Decision",Vn(Un.Node,"Table",e.nodeStyle(),{contextMenu:i},Vn(Un.Panel,"Auto",Vn(Un.Shape,"Diamond",{fill:"#56abe4",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new Un.Binding("figure","figure")),Vn(Un.TextBlock,"决策",e.textStyle(),{margin:8,maxSize:new Un.Size(160,NaN),wrap:Un.TextBlock.WrapFit},new Un.Binding("text","name").makeTwoWay())))),t.nodeTemplateMap.add("Diverge",Vn(Un.Node,"Table",e.nodeStyle(),{},Vn(Un.Panel,"Auto",Vn(Un.Shape,"Diamond",{fill:"#eb4f38",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1/0,toLinkable:!0,toMaxLinks:1},new Un.Binding("figure","figure")),Vn(Un.TextBlock,"分支",e.textStyle(),{margin:8,maxSize:new Un.Size(160,NaN),wrap:Un.TextBlock.WrapFit},new Un.Binding("text","name").makeTwoWay())))),t.nodeTemplateMap.add("Converge",Vn(Un.Node,"Table",e.nodeStyle(),{},Vn(Un.Panel,"Auto",Vn(Un.Shape,"Diamond",{fill:"#ae58a7",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1/0},new Un.Binding("figure","figure")),Vn(Un.TextBlock,"聚合",e.textStyle(),{margin:8,maxSize:new Un.Size(160,NaN),wrap:Un.TextBlock.WrapFit},new Un.Binding("text","name").makeTwoWay())))),t.nodeTemplateMap.add("Script",Vn(Un.Node,"Table",e.nodeStyle(),{contextMenu:i},Vn(Un.Panel,"Auto",Vn(Un.Shape,"RoundedRectangle",{fill:"#669999",stroke:null,portId:"",cursor:"pointer",fromLinkable:!0,fromMaxLinks:1,toLinkable:!0,toMaxLinks:1},new Un.Binding("figure","figure")),Vn(Un.TextBlock,"脚本",e.textStyle(),{margin:8,maxSize:new Un.Size(160,NaN),wrap:Un.TextBlock.WrapFit},new Un.Binding("text","name").makeTwoWay())))),t.linkTemplate=Vn(Un.Link,{routing:Un.Link.AvoidsNodes,curve:Un.Link.JumpOver,corner:5,toShortLength:4,relinkableFrom:!0,relinkableTo:!0,resegmentable:!0,mouseEnter:function(e,t){t.findObject("HIGHLIGHT").stroke="rgba(30,144,255,0.2)"},mouseLeave:function(e,t){t.findObject("HIGHLIGHT").stroke="transparent"},selectionAdorned:!1},new Un.Binding("points").makeTwoWay(),Vn(Un.Shape,{isPanelMain:!0,strokeWidth:8,stroke:"transparent",name:"HIGHLIGHT"}),Vn(Un.Shape,{isPanelMain:!0,stroke:"gray",strokeWidth:2},new Un.Binding("stroke","isHighlighted",(function(e){return e?"red":"#ff"})).ofObject(),new Un.Binding("strokeWidth","isHighlighted",(function(e){return e?4:2})).ofObject(),new Un.Binding("strokeWidth","isSelected",(function(e){return e?"dodgerblue":"gray"})).ofObject()),Vn(Un.Shape,{toArrow:"standard",strokeWidth:0,fill:"gray"},new Un.Binding("stroke","isHighlighted",(function(e){return e?"red":"#ff"})).ofObject(),new Un.Binding("strokeWidth","isHighlighted",(function(e){return e?4:2})).ofObject()),Vn(Un.Panel,"Auto",{name:"LABEL",segmentIndex:2,segmentFraction:.5},new Un.Binding("visible","visible").makeTwoWay(),Vn(Un.Shape,"RoundedRectangle",{visible:!1,fill:"#F8F8F8",strokeWidth:0}),Vn(Un.TextBlock,{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#333333",editable:!0,textEdited:(e,t,s)=>{const i=e.panel.findMainElement();(s=s.trim())?(e.text=s.trim(),i.visible=!0):i.visible=!1}},new Un.Binding("text").makeTwoWay()))),t.toolManager.linkingTool.temporaryLink.routing=Un.Link.Orthogonal,t.toolManager.relinkingTool.temporaryLink.routing=Un.Link.Orthogonal;const a=Un.Model.fromJson(this.flow.content);t.model=Vn(Un.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:a.nodeDataArray,linkDataArray:a.linkDataArray}),this.linkDataArray=a.linkDataArray,this.diagram=t,this.diagram.addDiagramListener("InitialLayoutCompleted",(function(){e.highLight()}))},highLight(){this.diagram.startTransaction("highlight"),this.diagram.clearHighlighteds(),this.linkDataArray.forEach((e=>{const t=e.from,s=e.to,i=this.nodes.indexOf(t),a=this.nodes.indexOf(s);if(-1!=i&&-1!=a){const e=this.diagram.findNodeForKey(t),i=this.diagram.findNodeForKey(s);e.findLinksTo(i).each((function(e){e.isHighlighted=!0}))}})),this.diagram.commitTransaction("highlight")},close(){this.$emit("update:show",!1)},showRule(){this.activeNode.data.rules?this.rules=this.activeNode.data.rules:this.rules=[],this.showRuleDialog=!0,this.hideContextMenu()},showDecision(){this.activeNode.data.decision||(this.activeNode.data.decision={}),this.$set(this.decisionForm,"type",this.activeNode.data.decision.type||"CONDITION"),this.$set(this.decisionForm,"strategy",this.activeNode.data.decision.strategy||"XOR");let e=[],t=[];for(let s=this.activeNode.findLinksOutOf().iterator;s.next();){const i=s.value.toNode.data;let a,o;this.activeNode.data.decision.connections&&this.activeNode.data.decision.connections.some((e=>{if(e.key==i.key)return"CONDITION"==this.activeNode.data.decision.type?a=this.$utils.copy(e.lhs):o=e.percentage,!0})),e.push({key:i.key,lhs:a,percentage:o}),t.push({key:i.key,name:i.name})}this.decisionForm.connections=e,this.decisionForm.toNodes=t,this.showDecisionDialog=!0,this.hideContextMenu()},showScript(){this.activeNode.data.script?this.script=this.activeNode.data().script:this.script={},this.showScriptDialog=!0,this.hideContextMenu()},viewAssets(e){this.viewingAssets.uuid=e.uuid,this.viewingAssets.version=e.versionNo,this.viewingAssets.show=!0},hideContextMenu(){this.$refs.contextMenu.style.top="-1000px"},setDiagramHeight(){try{const e=this.$refs.dialog.$el.querySelector(".el-dialog"),t=e.querySelector(".el-dialog__header"),s=e.querySelector(".el-dialog__body"),i=window.getComputedStyle(e,null),a=window.getComputedStyle(s,null),o=parseInt(i.getPropertyValue("margin-top")),n=parseInt(a.getPropertyValue("padding-top")),r=parseInt(a.getPropertyValue("padding-bottom"));this.diagramHeight=window.innerHeight-t.offsetHeight-n-r-2*o+"px"}catch(e){console.error(e),this.diagramHeight="500px"}this.updateDialogHeight()},updateDialogHeight(){null!=this.diagram&&(this.diagram.div.style.height=this.diagramHeight,this.diagram.requestUpdate())},closed(){window.removeEventListener("resize",this.setDiagramHeight)}}};var qn=(0,A.Z)(Hn,Bn,[],!1,null,"2a886ff3",null);qn.options.__file="src/view/decision/project/components/ruleflow-trace.vue";const zn=qn.exports;var Wn=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:function(){return e.toggleDropDownVisible(!1)},expression:"() => toggleDropDownVisible(false)"}],ref:"reference",class:["el-cascader",e.realSize&&"el-cascader--"+e.realSize,{"is-disabled":e.isDisabled}],on:{mouseenter:function(t){e.inputHover=!0},mouseleave:function(t){e.inputHover=!1},click:function(){return e.toggleDropDownVisible(!e.readonly||void 0)},keydown:e.handleKeyDown}},[s("el-input",{ref:"input",class:{"is-focus":e.dropDownVisible},attrs:{size:e.realSize,placeholder:e.placeholder,readonly:e.readonly,disabled:e.isDisabled,"validate-event":!1},on:{focus:e.handleFocus,blur:e.handleBlur,input:e.handleInput},model:{value:e.multiple?e.presentText:e.inputValue,callback:function(t){e.multiple?e.presentText:e.inputValue=t},expression:"multiple ? presentText : inputValue"}},[s("template",{slot:"suffix"},[e.clearBtnVisible?s("i",{key:"clear",staticClass:"el-input__icon el-icon-circle-close",on:{click:function(t){return t.stopPropagation(),e.handleClear(t)}}}):s("i",{key:"arrow-down",class:["el-input__icon","el-icon-arrow-down",e.dropDownVisible&&"is-reverse"],on:{click:function(t){return t.stopPropagation(),e.toggleDropDownVisible()}}})])],2),e._v(" "),e.multiple?s("div",{staticClass:"el-cascader__tags"},[e._l(e.presentTags,(function(t,i){return s("el-tag",{key:t.key,attrs:{type:"info",size:e.tagSize,hit:t.hitState,closable:t.closable,"disable-transitions":""},on:{close:function(t){return e.deleteTag(i)}}},[s("span",[e._v(e._s(t.text))])])})),e._v(" "),e.filterable&&!e.isDisabled?s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.inputValue,expression:"inputValue",modifiers:{trim:!0}}],staticClass:"el-cascader__search-input",attrs:{type:"text",placeholder:e.presentTags.length?"":e.placeholder},domProps:{value:e.inputValue},on:{input:[function(t){t.target.composing||(e.inputValue=t.target.value.trim())},function(t){return e.handleInput(e.inputValue,t)}],click:function(t){return t.stopPropagation(),e.toggleDropDownVisible(!0)},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"delete",[8,46],t.key,["Backspace","Delete","Del"])?null:e.handleDelete(t)},blur:function(t){return e.$forceUpdate()}}}):e._e()],2):e._e(),e._v(" "),s("transition",{attrs:{name:"el-zoom-in-top"},on:{"after-leave":e.handleDropdownLeave}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.dropDownVisible,expression:"dropDownVisible"}],ref:"popper",class:["el-popper","el-cascader__dropdown",e.popperClass]},[s("cascader-panel",{directives:[{name:"show",rawName:"v-show",value:!e.filtering,expression:"!filtering"}],ref:"panel",attrs:{options:e.options,props:e.config,border:!1,"render-label":e.$scopedSlots.default},on:{"expand-change":e.handleExpandChange,close:function(t){return e.toggleDropDownVisible(!1)}},model:{value:e.checkedValue,callback:function(t){e.checkedValue=t},expression:"checkedValue"}}),e._v(" "),e.filterable?s("el-scrollbar",{directives:[{name:"show",rawName:"v-show",value:e.filtering,expression:"filtering"}],ref:"suggestionPanel",staticClass:"el-cascader__suggestion-panel",attrs:{tag:"ul","view-class":"el-cascader__suggestion-list"},nativeOn:{keydown:function(t){return e.handleSuggestionKeyDown(t)}}},[e.suggestions.length?e._l(e.suggestions,(function(t,i){return s("li",{key:t.uid,class:["el-cascader__suggestion-item",t.checked&&"is-checked"],attrs:{tabindex:-1},on:{click:function(t){return e.handleSuggestionClick(i)}}},[s("span",[e._v(e._s(t.text))]),e._v(" "),t.checked?s("i",{staticClass:"el-icon-check"}):e._e()])})):e._t("empty",[s("li",{staticClass:"el-cascader__empty-text"},[e._v(e._s(e.t("el.cascader.noMatch")))])])],2):e._e()],1)])],1)};Wn._withStripped=!0;var Gn=s(43235),Jn=s(72677),Zn=s(94097),Yn=s(62214),Kn=s(24456),Xn=s(9427),Qn=s(36739),er=s(38202),tr=s(19046),sr=s(87435),ir=s(84552),ar=s(15189),or=s.n(ar),nr=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:["el-cascader-panel",e.border&&"is-bordered"],on:{keydown:e.handleKeyDown}},e._l(e.menus,(function(e,t){return s("cascader-menu",{key:t,ref:"menu",refInFor:!0,attrs:{index:t,nodes:e}})})),1)};nr._withStripped=!0;var rr=s(25369),lr=s.n(rr);const cr=e=>e.stopPropagation(),dr={inject:["panel"],props:{node:{required:!0},nodeId:String},computed:{config(){return this.panel.config},isLeaf(){return this.node.isLeaf},isDisabled(){return this.node.isDisabled},checkedValue(){return this.panel.checkedValue},isChecked(){return this.node.isSameNode(this.checkedValue)},inActivePath(){return this.isInPath(this.panel.activePath)},inCheckedPath(){return!!this.config.checkStrictly&&this.panel.checkedNodePaths.some((e=>this.isInPath(e)))},value(){return this.node.getValueByOption()}},methods:{handleExpand(){const{panel:e,node:t,isDisabled:s,config:i}=this,{multiple:a,checkStrictly:o}=i;!o&&s||t.loading||(i.lazy&&!t.loaded?e.lazyLoad(t,(()=>{const{isLeaf:e}=this;if(e||this.handleExpand(),a){const s=!!e&&t.checked;this.handleMultiCheckChange(s)}})):e.handleExpand(t))},handleCheckChange(){const{panel:e,value:t,node:s}=this;e.handleCheckChange(t),e.handleExpand(s)},handleMultiCheckChange(e){this.node.doCheck(e),this.panel.calculateMultiCheckedValue()},handleClickForCheckStrictly(){const{panel:e,value:t,node:s}=this;e.handleCheckChange(t),e.handleExpand(s)},isInPath(e){const{node:t}=this;return(e[t.level-1]||{}).uid===t.uid},renderPrefix(e){const{isLeaf:t,isChecked:s,config:i}=this,{checkStrictly:a,multiple:o}=i;if(o)return this.renderCheckbox(e);if(a);else if(t&&s)return this.renderCheckIcon(e);return null},renderPostfix(e){const{node:t,isLeaf:s}=this;return t.loading?this.renderLoadingIcon(e):s?null:this.renderExpandIcon(e)},renderCheckbox(e){const{node:t,config:s,isDisabled:i}=this,a={on:{change:this.handleMultiCheckChange},nativeOn:{}};return s.checkStrictly&&(a.nativeOn.click=cr),e("el-checkbox",lr()([{attrs:{value:t.checked,indeterminate:t.indeterminate,disabled:i}},a]))},renderCheckIcon:e=>e("i",{class:"el-icon-check el-cascader-node__prefix"}),renderLoadingIcon:e=>e("i",{class:"el-icon-loading el-cascader-node__postfix"}),renderExpandIcon:e=>e("i",{class:"el-icon-arrow-right el-cascader-node__postfix"}),renderContent(e){const{panel:t,node:s}=this,i=t.renderLabelFn;return e("span",{class:"el-cascader-node__label"},[(i?i({node:s,data:s.data}):null)||s.label])}},render(e){const{inActivePath:t,inCheckedPath:s,isChecked:i,isLeaf:a,isDisabled:o,config:n,nodeId:r}=this,{expandTrigger:l,checkStrictly:c,multiple:d}=n,u=!c&&o,p={on:{}};return"click"===l?p.on.click=this.handleExpand:(p.on.mouseenter=e=>{this.handleExpand(),this.$emit("expand",e)},p.on.focus=e=>{this.handleExpand(),this.$emit("expand",e)}),!a||o||c||d||(p.on.click=this.handleCheckChange),c&&(p.on.click=this.handleClickForCheckStrictly),e("li",lr()([{attrs:{role:"menuitem",id:r,"aria-expanded":t,tabindex:u?null:-1},class:{"el-cascader-node":!0,"is-selectable":c,"in-active-path":t,"in-checked-path":s,"is-active":i,"is-disabled":u}},p]),[this.renderPrefix(e),this.renderContent(e),this.renderPostfix(e)])}};var ur=(0,A.Z)(dr,void 0,void 0,!1,null,null,null);ur.options.__file="src/components/cascader-panel/cascader-node.vue";const pr=ur.exports,hr={name:"CascaderMenu",mixins:[Yn.Z],inject:["panel"],components:{CascaderNode:pr},props:{nodes:{type:Array,required:!0},index:Number},data:()=>({activeNode:null,hoverTimer:null,id:(0,er.Ox)()}),computed:{isEmpty(){return!this.nodes.length},menuId(){return`cascader-menu-${this.id}-${this.index}`}},methods:{handleExpand(e){this.activeNode=e.target},handleMouseMove(e){const{activeNode:t,hoverTimer:s}=this,{hoverZone:i}=this.$refs;if(t&&i)if(t.contains(e.target)){clearTimeout(s);const{left:a}=this.$el.getBoundingClientRect(),o=e.clientX-a,{offsetWidth:n,offsetHeight:r}=this.$el,l=t.offsetTop,c=l+t.offsetHeight;i.innerHTML=`\n          <path style="pointer-events: auto;" fill="transparent" d="M${o} ${l} L${n} 0 V${l} Z" />\n          <path style="pointer-events: auto;" fill="transparent" d="M${o} ${c} L${n} ${r} V${c} Z" />\n        `}else s||(this.hoverTimer=setTimeout(this.clearHoverZone,this.panel.config.hoverThreshold))},clearHoverZone(){const{hoverZone:e}=this.$refs;e&&(e.innerHTML="")},renderEmptyText(e){return e("div",{class:"el-cascader-menu__empty-text"},[this.t("el.cascader.noData")])},renderNodeList(e){const{menuId:t}=this,{isHoverMenu:s}=this.panel,i={on:{}};return s&&(i.on.expand=this.handleExpand),[...this.nodes.map(((s,a)=>{const{hasChildren:o}=s;return e("cascader-node",lr()([{key:s.uid,attrs:{node:s,"node-id":`${t}-${a}`,"aria-haspopup":o,"aria-owns":o?t:null}},i]))})),s?e("svg",{ref:"hoverZone",class:"el-cascader-menu__hover-zone"}):null]}},render(e){const{isEmpty:t,menuId:s}=this,i={nativeOn:{}};return this.panel.isHoverMenu&&(i.nativeOn.mousemove=this.handleMouseMove),e("el-scrollbar",lr()([{attrs:{tag:"ul",role:"menu",id:s,"wrap-class":"el-cascader-menu__wrap","view-class":{"el-cascader-menu__list":!0,"is-empty":t}},class:"el-cascader-menu"},i]),[t?this.renderEmptyText(e):this.renderNodeList(e)])}};var mr=(0,A.Z)(hr,void 0,void 0,!1,null,null,null);mr.options.__file="src/components/cascader-panel/cascader-menu.vue";const fr=mr.exports;let gr=0;class vr{constructor(e,t,s){this.data=e,this.config=t,this.parent=s||null,this.level=this.parent?this.parent.level+1:1,this.uid=gr++,this.initState(),this.initChildren()}initState(){const{value:e,label:t}=this.config;this.value=this.data[e],this.label=this.data[t],this.pathNodes=this.calculatePathNodes(),this.path=this.pathNodes.map((e=>e.value)),this.pathLabels=this.pathNodes.map((e=>e.label)),this.loading=!1,this.loaded=!1}initChildren(){const{config:e}=this,t=e.children,s=this.data[t];this.hasChildren=Array.isArray(s),this.children=(s||[]).map((t=>new vr(t,e,this)))}get isDisabled(){const{data:e,parent:t,config:s}=this,i=s.disabled,{checkStrictly:a}=s;return e[i]||!a&&t&&t.isDisabled}get isLeaf(){const{data:e,loaded:t,hasChildren:s,children:i}=this,{lazy:a,leaf:o}=this.config;if(a){const s=(0,sr.X)(e[o])?e[o]:!!t&&!i.length;return this.hasChildren=!s,s}return!s}calculatePathNodes(){const e=[this];let t=this.parent;for(;t;)e.unshift(t),t=t.parent;return e}getPath(){return this.path}getValue(){return this.value}getValueByOption(){return this.config.emitPath?this.getPath():this.getValue()}getText(e,t){return e?this.pathLabels.join(t):this.label}isSameNode(e){const t=this.getValueByOption();return this.config.multiple&&Array.isArray(e)?e.some((e=>(0,er.Xy)(e,t))):(0,er.Xy)(e,t)}broadcast(e,...t){const s=`onParent${(0,er.kC)(e)}`;this.children.forEach((i=>{i&&(i.broadcast(e,...t),i[s]&&i[s](...t))}))}emit(e,...t){const{parent:s}=this,i=`onChild${(0,er.kC)(e)}`;s&&(s[i]&&s[i](...t),s.emit(e,...t))}onParentCheck(e){this.isDisabled||this.setCheckState(e)}onChildCheck(){const{children:e}=this,t=e.filter((e=>!e.isDisabled)),s=!!t.length&&t.every((e=>e.checked));this.setCheckState(s)}setCheckState(e){const t=this.children.length,s=this.children.reduce(((e,t)=>e+(t.checked?1:t.indeterminate?.5:0)),0);this.checked=e,this.indeterminate=s!==t&&s>0}syncCheckState(e){const t=this.getValueByOption(),s=this.isSameNode(e,t);this.doCheck(s)}doCheck(e){this.checked!==e&&(this.config.checkStrictly?this.checked=e:(this.broadcast("check",e),this.setCheckState(e),this.emit("check")))}}const br=(e,t)=>e.reduce(((e,s)=>(s.isLeaf?e.push(s):(!t&&e.push(s),e=e.concat(br(s.children,t))),e)),[]);class wr{constructor(e,t){this.config=t,this.initNodes(e)}initNodes(e){e=(0,er.me)(e),this.nodes=e.map((e=>new vr(e,this.config))),this.flattedNodes=this.getFlattedNodes(!1,!1),this.leafNodes=this.getFlattedNodes(!0,!1)}appendNode(e,t){const s=new vr(e,this.config,t);(t?t.children:this.nodes).push(s)}appendNodes(e,t){(e=(0,er.me)(e)).forEach((e=>this.appendNode(e,t)))}getNodes(){return this.nodes}getFlattedNodes(e,t=!0){const s=e?this.leafNodes:this.flattedNodes;return t?s:br(this.nodes,e)}getNodeByValue(e){if(e){const t=this.getFlattedNodes(!1,!this.config.lazy).filter((t=>(0,er.V_)(t.path,e)||t.value===e));return t&&t.length?t[0]:null}return null}}var yr=s(65329),_r=s(15396);const{keys:xr}=Xn.Z,kr={expandTrigger:"click",multiple:!1,checkStrictly:!1,emitPath:!0,lazy:!1,lazyLoad:er.ZT,value:"value",label:"label",children:"children",leaf:"leaf",disabled:"disabled",hoverThreshold:500},$r=e=>!e.getAttribute("aria-owns"),Tr=(e,t)=>{const{parentNode:s}=e;if(s){const i=s.querySelectorAll('.el-cascader-node[tabindex="-1"]');return i[Array.prototype.indexOf.call(i,e)+t]||null}return null},Dr=(e,t)=>{if(!e)return;const s=e.id.split("-");return Number(s[s.length-2])},Sr=e=>{e&&(e.focus(),!$r(e)&&e.click())},Cr={name:"CascaderPanel",components:{CascaderMenu:fr},props:{value:{},options:Array,props:Object,border:{type:Boolean,default:!0},renderLabel:Function},provide(){return{panel:this}},data:()=>({checkedValue:null,checkedNodePaths:[],store:[],menus:[],activePath:[],loadCount:0}),computed:{config(){return(0,yr.Z)({...kr},this.props||{})},multiple(){return this.config.multiple},checkStrictly(){return this.config.checkStrictly},leafOnly(){return!this.checkStrictly},isHoverMenu(){return"hover"===this.config.expandTrigger},renderLabelFn(){return this.renderLabel||this.$scopedSlots.default}},watch:{options:{handler:function(){this.initStore()},immediate:!0,deep:!0},value(){this.syncCheckedValue(),this.checkStrictly&&this.calculateCheckedNodePaths()},checkedValue(e){(0,er.Xy)(e,this.value)||(this.checkStrictly&&this.calculateCheckedNodePaths(),this.$emit("input",e),this.$emit("change",e))}},mounted(){(0,er.xb)(this.value)||this.syncCheckedValue()},methods:{initStore(){const{config:e,options:t}=this;e.lazy&&(0,er.xb)(t)?this.lazyLoad():(this.store=new wr(t,e),this.menus=[this.store.getNodes()],this.syncMenuState())},syncCheckedValue(){const{value:e,checkedValue:t}=this;(0,er.Xy)(e,t)||(this.checkedValue=e,this.syncMenuState())},syncMenuState(){const{multiple:e,checkStrictly:t}=this;this.syncActivePath(),e&&this.syncMultiCheckState(),t&&this.calculateCheckedNodePaths(),this.$nextTick(this.scrollIntoView)},syncMultiCheckState(){this.getFlattedNodes(this.leafOnly).forEach((e=>{e.syncCheckState(this.checkedValue)}))},syncActivePath(){const{store:e,multiple:t,activePath:s,checkedValue:i}=this;if((0,er.xb)(s))if((0,er.xb)(i))this.activePath=[],this.menus=[e.getNodes()];else{const e=t?i[0]:i,s=((this.getNodeByValue(e)||{}).pathNodes||[]).slice(0,-1);this.expandNodes(s)}else{const e=s.map((e=>this.getNodeByValue(e.getValue())));this.expandNodes(e)}},expandNodes(e){e.forEach((e=>this.handleExpand(e,!0)))},calculateCheckedNodePaths(){const{checkedValue:e,multiple:t}=this,s=t?(0,er.me)(e):[e];this.checkedNodePaths=s.map((e=>{const t=this.getNodeByValue(e);return t?t.pathNodes:[]}))},handleKeyDown(e){const{target:t,keyCode:s}=e;switch(s){case xr.up:const e=Tr(t,-1);Sr(e);break;case xr.down:const s=Tr(t,1);Sr(s);break;case xr.left:const i=this.$refs.menu[Dr(t)-1];if(i){const e=i.$el.querySelector('.el-cascader-node[aria-expanded="true"]');Sr(e)}break;case xr.right:const a=this.$refs.menu[Dr(t)+1];if(a){const e=a.$el.querySelector('.el-cascader-node[tabindex="-1"]');Sr(e)}break;case xr.enter:(e=>{if(!e)return;const t=e.querySelector("input");t?t.click():$r(e)&&e.click()})(t);break;case xr.esc:case xr.tab:this.$emit("close");break;default:return}},handleExpand(e,t){const{activePath:s}=this,{level:i}=e,a=s.slice(0,i-1),o=this.menus.slice(0,i);if(e.isLeaf||(a.push(e),o.push(e.children)),this.activePath=a,this.menus=o,!t){const e=a.map((e=>e.getValue())),t=s.map((e=>e.getValue()));(0,er.V_)(e,t)||(this.$emit("active-item-change",e),this.$emit("expand-change",e))}},handleCheckChange(e){this.checkedValue=e},lazyLoad(e,t){const{config:s}=this;e||(e=e||{root:!0,level:0},this.store=new wr([],s),this.menus=[this.store.getNodes()]),e.loading=!0,s.lazyLoad(e,(s=>{const i=e.root?null:e;if(s&&s.length&&this.store.appendNodes(s,i),e.loading=!1,e.loaded=!0,Array.isArray(this.checkedValue)){const e=this.checkedValue[this.loadCount++],t=this.config.value,i=this.config.leaf;if(Array.isArray(s)&&s.filter((s=>s[t]===e)).length>0){const t=this.store.getNodeByValue(e);t.data[i]||this.lazyLoad(t,(()=>{this.handleExpand(t)})),this.loadCount===this.checkedValue.length&&this.$parent.computePresentText()}}t&&t(s)}))},calculateMultiCheckedValue(){this.checkedValue=this.getCheckedNodes(this.leafOnly).map((e=>e.getValueByOption()))},scrollIntoView(){this.$isServer||(this.$refs.menu||[]).forEach((e=>{const t=e.$el;if(t){const e=t.querySelector(".el-scrollbar__wrap"),s=t.querySelector(".el-cascader-node.is-active")||t.querySelector(".el-cascader-node.in-active-path");(0,_r.Z)(e,s)}}))},getNodeByValue(e){return this.store.getNodeByValue(e)},getFlattedNodes(e){const t=!this.config.lazy;return this.store.getFlattedNodes(e,t)},getCheckedNodes(e){const{checkedValue:t,multiple:s}=this;return s?this.getFlattedNodes(e).filter((e=>e.checked)):(0,er.xb)(t)?[]:[this.getNodeByValue(t)]},clearCheckedNodes(){const{config:e,leafOnly:t}=this,{multiple:s,emitPath:i}=e;s?(this.getCheckedNodes(t).filter((e=>!e.isDisabled)).forEach((e=>e.doCheck(!1))),this.calculateMultiCheckedValue()):this.checkedValue=i?[]:null}}};var Nr=(0,A.Z)(Cr,nr,[],!1,null,null,null);Nr.options.__file="src/components/cascader-panel/cascader-panel.vue";const Lr=Nr.exports,{keys:Ar}=Xn.Z,Er={expandTrigger:{newProp:"expandTrigger",type:String},changeOnSelect:{newProp:"checkStrictly",type:Boolean},hoverThreshold:{newProp:"hoverThreshold",type:Number}},Fr={props:{placement:{type:String,default:"bottom-start"},appendToBody:Gn.Z.props.appendToBody,visibleArrow:{type:Boolean,default:!0},arrowOffset:Gn.Z.props.arrowOffset,offset:Gn.Z.props.offset,boundariesPadding:Gn.Z.props.boundariesPadding,popperOptions:Gn.Z.props.popperOptions},methods:Gn.Z.methods,data:Gn.Z.data,beforeDestroy:Gn.Z.beforeDestroy},Or={medium:36,small:32,mini:28},Ir={name:"cascader",directives:{Clickoutside:Jn.Z},mixins:[Fr,Zn.Z,Yn.Z,Kn.Z],inject:{elForm:{default:""},elFormItem:{default:""}},components:{CascaderPanel:Lr},props:{value:{},options:Array,props:Object,size:String,placeholder:{type:String,default:()=>(0,Qn.t)("el.cascader.placeholder")},disabled:Boolean,clearable:Boolean,filterable:Boolean,filterMethod:Function,separator:{type:String,default:" / "},showAllLevels:{type:Boolean,default:!0},collapseTags:Boolean,debounce:{type:Number,default:300},beforeFilter:{type:Function,default:()=>()=>{}},popperClass:String},data(){return{dropDownVisible:!1,checkedValue:this.value||null,inputHover:!1,inputValue:null,presentText:null,presentTags:[],checkedNodes:[],filtering:!1,suggestions:[],inputInitialHeight:0,pressDeleteCount:0}},computed:{realSize(){const e=(this.elFormItem||{}).elFormItemSize;return this.size||e||(this.$ELEMENT||{}).size},tagSize(){return["small","mini"].indexOf(this.realSize)>-1?"mini":"small"},isDisabled(){return this.disabled||(this.elForm||{}).disabled},config(){const e=this.props||{},{$attrs:t}=this;return Object.keys(Er).forEach((s=>{const{newProp:i,type:a}=Er[s];let o=t[s]||t[(0,er.GL)(s)];(0,sr.X)(s)&&!(0,sr.X)(e[i])&&(a===Boolean&&""===o&&(o=!0),e[i]=o)})),e},multiple(){return this.config.multiple},leafOnly(){return!this.config.checkStrictly},readonly(){return!this.filterable||this.multiple},clearBtnVisible(){return!(!this.clearable||this.isDisabled||this.filtering||!this.inputHover||(this.multiple?!this.checkedNodes.filter((e=>!e.isDisabled)).length:!this.presentText))},panel(){return this.$refs.panel}},watch:{disabled(){this.computePresentContent()},value(e){(0,er.Xy)(e,this.checkedValue)||(this.checkedValue=e,this.computePresentContent())},checkedValue(e){const{value:t,dropDownVisible:s}=this,{checkStrictly:i,multiple:a}=this.config;(0,er.Xy)(e,t)&&!(0,tr.o8)(t)||(this.computePresentContent(),a||i||!s||this.toggleDropDownVisible(!1),this.$emit("input",e),this.$emit("change",e),this.dispatch("ElFormItem","el.form.change",[e]))},options:{handler:function(){this.$nextTick(this.computePresentContent)},deep:!0},presentText(e){this.inputValue=e},presentTags(e,t){this.multiple&&(e.length||t.length)&&this.$nextTick(this.updateStyle)},filtering(e){this.$nextTick(this.updatePopper)}},mounted(){const{input:e}=this.$refs;e&&e.$el&&(this.inputInitialHeight=e.$el.offsetHeight||Or[this.realSize]||40),(0,er.xb)(this.value)||this.computePresentContent(),this.filterHandler=or()(this.debounce,(()=>{const{inputValue:e}=this;if(!e)return void(this.filtering=!1);const t=this.beforeFilter(e);t&&t.then?t.then(this.getSuggestions):!1!==t?this.getSuggestions():this.filtering=!1})),(0,ir.k)(this.$el,this.updateStyle)},beforeDestroy(){(0,ir.S)(this.$el,this.updateStyle)},methods:{getMigratingConfig:()=>({props:{"expand-trigger":"expand-trigger is removed, use `props.expandTrigger` instead.","change-on-select":"change-on-select is removed, use `props.checkStrictly` instead.","hover-threshold":"hover-threshold is removed, use `props.hoverThreshold` instead"},events:{"active-item-change":"active-item-change is renamed to expand-change"}}),toggleDropDownVisible(e){if(this.isDisabled)return;const{dropDownVisible:t}=this,{input:s}=this.$refs;(e=(0,sr.X)(e)?e:!t)!==t&&(this.dropDownVisible=e,e&&this.$nextTick((()=>{this.updatePopper(),this.panel.scrollIntoView()})),s.$refs.input.setAttribute("aria-expanded",e),this.$emit("visible-change",e))},handleDropdownLeave(){this.filtering=!1,this.inputValue=this.presentText},handleKeyDown(e){switch(e.keyCode){case Ar.enter:this.toggleDropDownVisible();break;case Ar.down:this.toggleDropDownVisible(!0),this.focusFirstNode(),e.preventDefault();break;case Ar.esc:case Ar.tab:this.toggleDropDownVisible(!1)}},handleFocus(e){this.$emit("focus",e)},handleBlur(e){this.$emit("blur",e)},handleInput(e,t){!this.dropDownVisible&&this.toggleDropDownVisible(!0),t&&t.isComposing||(e?this.filterHandler():this.filtering=!1)},handleClear(){this.presentText="",this.panel.clearCheckedNodes()},handleExpandChange(e){this.$nextTick(this.updatePopper.bind(this)),this.$emit("expand-change",e),this.$emit("active-item-change",e)},focusFirstNode(){this.$nextTick((()=>{const{filtering:e}=this,{popper:t,suggestionPanel:s}=this.$refs;let i=null;i=e&&s?s.$el.querySelector(".el-cascader__suggestion-item"):t.querySelector(".el-cascader-menu").querySelector('.el-cascader-node[tabindex="-1"]'),i&&(i.focus(),!e&&i.click())}))},computePresentContent(){this.$nextTick((()=>{this.config.multiple?(this.computePresentTags(),this.presentText=this.presentTags.length?" ":null):this.computePresentText()}))},computePresentText(){const{checkedValue:e,config:t}=this;if(!(0,er.xb)(e)){const s=this.panel.getNodeByValue(e);if(s&&(t.checkStrictly||s.isLeaf))return void(this.presentText=s.getText(this.showAllLevels,this.separator))}this.presentText=null},computePresentTags(){const{isDisabled:e,leafOnly:t,showAllLevels:s,separator:i,collapseTags:a}=this,o=this.getCheckedNodes(t),n=[],r=t=>({node:t,key:t.uid,text:t.getText(s,i),hitState:!1,closable:!e&&!t.isDisabled});if(o.length){const[e,...t]=o,s=t.length;n.push(r(e)),s&&(a?n.push({key:-1,text:`+ ${s}`,closable:!1}):t.forEach((e=>n.push(r(e)))))}this.checkedNodes=o,this.presentTags=n},getSuggestions(){let{filterMethod:e}=this;(0,tr.mf)(e)||(e=(e,t)=>e.text.includes(t));const t=this.panel.getFlattedNodes(this.leafOnly).filter((t=>!t.isDisabled&&(t.text=t.getText(this.showAllLevels,this.separator)||"",e(t,this.inputValue))));this.multiple?this.presentTags.forEach((e=>{e.hitState=!1})):t.forEach((e=>{e.checked=(0,er.Xy)(this.checkedValue,e.getValueByOption())})),this.filtering=!0,this.suggestions=t,this.$nextTick(this.updatePopper)},handleSuggestionKeyDown(e){const{keyCode:t,target:s}=e;switch(t){case Ar.enter:s.click();break;case Ar.up:const e=s.previousElementSibling;e&&e.focus();break;case Ar.down:const t=s.nextElementSibling;t&&t.focus();break;case Ar.esc:case Ar.tab:this.toggleDropDownVisible(!1)}},handleDelete(){const{inputValue:e,pressDeleteCount:t,presentTags:s}=this,i=s.length-1,a=s[i];this.pressDeleteCount=e?0:t+1,a&&this.pressDeleteCount&&(a.hitState?this.deleteTag(i):a.hitState=!0)},handleSuggestionClick(e){const{multiple:t}=this,s=this.suggestions[e];if(t){const{checked:e}=s;s.doCheck(!e),this.panel.calculateMultiCheckedValue()}else this.checkedValue=s.getValueByOption(),this.toggleDropDownVisible(!1)},deleteTag(e){const{checkedValue:t}=this,s=t[e];this.checkedValue=t.filter(((t,s)=>s!==e)),this.$emit("remove-tag",s)},updateStyle(){const{$el:e,inputInitialHeight:t}=this;if(this.$isServer||!e)return;const{suggestionPanel:s}=this.$refs,i=e.querySelector(".el-input__inner");if(!i)return;const a=e.querySelector(".el-cascader__tags");let o=null;if(s&&(o=s.$el)&&(o.querySelector(".el-cascader__suggestion-list").style.minWidth=i.offsetWidth+"px"),a){const{offsetHeight:e}=a,s=Math.max(e+6,t)+"px";i.style.height=s,this.updatePopper()}},getCheckedNodes(e){return this.panel.getCheckedNodes(e)}}};var Pr=(0,A.Z)(Ir,Wn,[],!1,null,null,null);Pr.options.__file="src/components/cascader/cascader.vue";const Mr=Pr.exports;var Rr=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-dropdown",{ref:"dropdown",attrs:{type:e.type,size:e.size,"split-button":e.splitButton,placement:e.placement,trigger:e.trigger,"hide-on-click":e.hideOnClick,"show-timeout":e.showTimeout,"hide-timeout":e.hideTimeout,tabindex:e.tabindex},on:{click:e.click,command:e.command,"visible-change":e.visibleChange}},[e._t("default"),e._v(" "),e._t("dropdown")],2)};Rr._withStripped=!0;const jr={name:"dropdown",props:{type:String,size:{type:String,default:""},splitButton:Boolean,placement:{type:String,default:"bottom"},trigger:{type:String,default:"click"},hideOnClick:{type:Boolean,default:!0},showTimeout:{type:Number,default:250},hideTimeout:{type:Number,default:150},tabindex:{type:Number,default:0}},methods:{click(e){this.$emit("click",e)},command(e){this.$emit("command",e)},visibleChange(e){this.$emit("visible-change",e)},show(){this.$refs.dropdown.show()}}};var Br=(0,A.Z)(jr,Rr,[],!1,null,"bac33622",null);Br.options.__file="src/components/dropdown/dropdown.vue";const Ur=Br.exports;var Vr=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e._t("default")],2)};Vr._withStripped=!0;var Hr=(0,A.Z)({name:"dropdown-menu"},Vr,[],!1,null,"18e6afad",null);Hr.options.__file="src/components/dropdown/dropdown-menu.vue";const qr=Hr.exports;var zr=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-dropdown-item",{attrs:{command:e.command,disabled:e.disabled,divided:e.divided,icon:e.icon}},[e._t("default")],2)};zr._withStripped=!0;const Wr={name:"dropdown-item",props:{command:{},disabled:Boolean,divided:Boolean,icon:String}};var Gr=(0,A.Z)(Wr,zr,[],!1,null,"f9d9c93e",null);Gr.options.__file="src/components/dropdown/dropdown-item.vue";const Jr=Gr.exports;var Zr=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-pagination",{attrs:{"page-size":e.pageNum,small:e.small,total:e.totalSize,"page-count":e.pageCount,"pager-count":e.pagerCount,"current-page":e.page,layout:e.layout,"page-sizes":e.pageSizes,"popper-class":e.popperClass,"prev-text":e.prevText,"next-text":e.nextText,background:e.background,disabled:e.disabled,"hide-on-single-page":e.hideOnSinglePage},on:{"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.sizeChange,"current-change":e.currentChange}})};Zr._withStripped=!0;const Yr={name:"pagination",props:{pageSize:{type:Number,default:10},small:Boolean,total:Number,pageCount:Number,pagerCount:Number,currentPage:Number,layout:{default:"total, sizes, prev, pager, next, jumper"},pageSizes:{type:Array,default:()=>[10,20,30,40,50]},popperClass:String,prevText:String,nextText:String,background:{type:Boolean,default:!0},disabled:Boolean,hideOnSinglePage:{type:Boolean,default:!0},load:Function},computed:{isLoadMode(){return"function"==typeof this.load}},data(){return{page:this.currentPage,pageNum:this.pageSize,totalSize:this.total}},mounted(){this.isLoadMode?this.loadData():this.$watch("total",(function(e){this.totalSize=e}))},methods:{sizeChange(){(this.page-1)*this.pageNum<this.totalSize&&this.doChange()},currentChange(){this.doChange()},doChange(){this.isLoadMode?this.loadData():(this.$emit("update:pageSize",this.pageNum),this.$emit("update:currentPage",this.page),this.$emit("change",this.page,this.pageNum))},loadData(){this.load(this.page,this.pageNum,this.resolveTotal)},resolveTotal(e){this.totalSize=e},refresh(e,t){e&&(this.page=e),t&&(this.pageNum=t),this.loadData()}}};var Kr=(0,A.Z)(Yr,Zr,[],!1,null,"440179cf",null);Kr.options.__file="src/components/pagination/pagination.vue";const Xr=Kr.exports;var Qr=function(){var e=this,t=e.$createElement;return(e._self._c||t)("el-date-picker",{ref:"datePicker",attrs:{readonly:e.readonly,disabled:e.disabled,editable:e.editable,clearable:e.clearable,placeholder:e.placeholder,type:e.type,"picker-options":e.pickerOptions,"default-value":e.defaultValue,"value-format":e.valueFormat},on:{change:e.handleChange},model:{value:e.valueData,callback:function(t){e.valueData=t},expression:"valueData"}})};Qr._withStripped=!0;const el={name:"date-picker",props:{value:[String,Date,Array],readonly:Boolean,disabled:Boolean,editable:{type:Boolean,default:!0},clearable:{type:Boolean,default:!0},placeholder:{type:String,default:"请选择"},type:{type:String,default:"date"},defaultValue:{type:Date,default:function(){return new Date}},valueFormat:String,disabledDate:Function,firstDayOfWeek:{type:Number,default:1}},watch:{value:function(e){this.valueData=e},valueData:function(e){this.$emit("input",e)}},data(){return{valueData:this.value,pickerOptions:{disabledDate:this.disabledDate,firstDayOfWeek:this.firstDayOfWeek}}},methods:{focus(){this.$refs.datePicker.focus()},handleChange(e){this.$emit("change",e)}}};var tl=(0,A.Z)(el,Qr,[],!1,null,"91d396aa",null);tl.options.__file="src/components/date-picker/date-picker.vue";const sl=tl.exports;var il=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.readonly?s("span",{staticStyle:{"white-space":"normal","line-height":"1.5"},domProps:{innerHTML:e._s(e.text)}}):s("div",{staticStyle:{display:"inline-block"}},[s("el-button",{staticStyle:{"white-space":"normal","line-height":"1.5"},attrs:{type:"text"},on:{click:function(t){e.showLhsDialog=!0}}},[s("span",{domProps:{innerHTML:e._s(e.text)}})]),e._v(" "),s("el-dialog",{attrs:{title:"编辑条件",visible:e.showLhsDialog,top:e.$dialogTop,"custom-class":"lhs-editor","append-to-body":""},on:{"update:visible":function(t){e.showLhsDialog=t}}},[s("lhs",{attrs:{"left-type":e.leftType,"loop-target":e.loopTarget,readonly:e.readonly},model:{value:e.valueData,callback:function(t){e.valueData=t},expression:"valueData"}}),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{icon:"el-icon-error"},on:{click:function(t){e.showLhsDialog=!1}}},[e._v("关 闭")])],1)],1)],1)};il._withStripped=!0;const al={name:"lhs-editor",props:{value:Object,leftType:[String,Object],loopTarget:Object,readonly:Boolean},components:{lhs:Qe},computed:{text(){return this.leftType?this.$lhs.getText(this.valueData):this.$lhs.getText(this.valueData,!0)}},watch:{valueData(e){this.$emit("input",e)}},data(){return{showLhsDialog:!1,valueData:this.value}}};var ol=(0,A.Z)(al,il,[],!1,null,"c5052cd8",null);ol.options.__file="src/view/decision/project/components/lhs-editor.vue";const nl=ol.exports;var rl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{title:"用户详情",width:"70%",visible:e.show,"append-to-body":""},on:{"update:visible":e.close,open:e.open,closed:e.closed}},[s("div",{staticClass:"user-container"},[s("el-row",[s("el-col",{attrs:{span:8}},[s("label",{staticClass:"text-name"},[e._v("用户名:")]),e._v(" "+e._s(e.user.username?e.user.username:"1")+"\n        ")]),e._v(" "),s("el-col",{attrs:{span:16}},[s("label",{staticClass:"text-name"},[e._v("真实姓名:")]),e._v(" "+e._s(e.user.realname?e.user.realname:"1"))])],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("label",{staticClass:"text-name"},[e._v("所属机构:")]),e._v(" "+e._s(e.user.orgname?e.user.orgname:""))]),e._v(" "),s("el-col",{attrs:{span:16}},[s("label",{staticClass:"text-name"},[e._v("所属角色:")]),e._v(e._s(e.user.rulenames?e.user.rulenames:"")+" ")])],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:8}},[s("label",{staticClass:"text-name"},[e._v("最后登录时间:")]),e._v("\n          "+e._s(e._f("formatDateTime")(e.user.lastLoginTime))+"\n        ")]),e._v(" "),s("el-col",{attrs:{span:16}},[s("label",{staticClass:"text-name"},[e._v("过期时间:")]),e._v("\n          "+e._s(e._f("formatDateTime")(e.user.expiredTime))+"\n        ")])],1)],1),e._v(" "),s("el-tabs",{on:{"tab-click":e.clickTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{attrs:{label:"项目",name:"first"}},[s("user-project",{attrs:{"user-uuid":e.userUuid}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"操作日志",name:"second"}},[s("user-logs",{attrs:{"user-uuid":e.userUuid}})],1),e._v(" "),s("el-tab-pane",{attrs:{label:"登录记录",name:"thi"}},[s("user-login-logs",{attrs:{"user-uuid":e.userUuid}})],1)],1)],1)};rl._withStripped=!0;var ll=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-form",{ref:"form",attrs:{inline:"",model:e.form}},[s("el-form-item",{staticClass:"timePickIn",attrs:{label:"登录地址",prop:"clientIp"}},[s("el-input",{attrs:{placeholder:"操作地址"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.form.clientIp,callback:function(t){e.$set(e.form,"clientIp",t)},expression:"form.clientIp"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"是否成功",prop:"success"}},[s("el-select",{attrs:{placeholder:"是否成功"},model:{value:e.form.success,callback:function(t){e.$set(e.form,"success",t)},expression:"form.success"}},[s("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),s("el-option",{attrs:{label:"成功",value:"1"}}),e._v(" "),s("el-option",{attrs:{label:"失败",value:"0"}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:"开始日期",prop:"beginTime"}},[s("date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"开始日期","disabled-date":e.beginTimeDisabledDate},model:{value:e.form.beginTime,callback:function(t){e.$set(e.form,"beginTime",t)},expression:"form.beginTime"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"结束日期",prop:"endTime"}},[s("date-picker",{attrs:{"value-format":"yyyy-MM-dd",placeholder:"结束日期","disabled-date":e.endTimeDisabledDate},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1),e._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.search}},[e._v("查 询")]),e._v(" "),s("el-button",{attrs:{icon:"el-icon-refresh"},on:{click:e.reset}},[e._v("重 置")])],1)],1),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.logs,align:"center"}},[s("el-table-column",{attrs:{prop:"clientIp",label:"登录地址"}}),e._v(" "),s("el-table-column",{attrs:{label:"登录时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.beginTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"success",label:"是否成功",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.success?s("i",{staticClass:"el-icon-success",staticStyle:{color:"green","font-size":"18px"}}):s("i",{staticClass:"el-icon-error",staticStyle:{color:"red","font-size":"18px"}})]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.loadUserLos}})],1)};ll._withStripped=!0;const cl={name:"user-logs",props:{userUuid:String},data(){return{tableLoading:!1,logs:[],page:1,pageNum:10,total:0,form:{userUuid:"",beginTime:"",endTime:"",clientIp:"",success:""},beginTimeDisabledDate:e=>!!(this.form.endTime&&e.getTime()>new Date(this.form.endTime+" 00:00:00").getTime())||e.getTime()>(new Date).getTime(),endTimeDisabledDate:e=>!!(this.form.beginTime&&e.getTime()<new Date(this.form.beginTime+" 00:00:00").getTime())||e.getTime()>(new Date).getTime()}},mounted(){this.loadUserLos()},watch:{userUuid(){this.page=1,this.$refs.form.resetFields(),this.loadUserLos()}},methods:{search(){this.page=1,this.loadUserLos()},loadUserLos(){this.form.userUuid=this.userUuid,this.tableLoading=!0;let e=this.$utils.copy(this.form);e.page=this.page,e.pageNum=this.pageNum,this.$axios.get("/user/login/logs",{params:e}).then((e=>{this.tableLoading=!1,0==e.data.code?(this.logs=e.data.data,this.total=e.data.total):this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常"),this.tableLoading=!1}))},reset(){this.$refs.form.resetFields(),this.search()}}};var dl=(0,A.Z)(cl,ll,[],!1,null,null,null);dl.options.__file="src/view/settings/user/user-login-logs.vue";const ul=dl.exports;var pl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"projectContent"},[s("div",{staticClass:"toolbar"},[s("div",{staticClass:"pull-right"},[s("el-input",{staticClass:"search",attrs:{placeholder:"搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.projectSearchName,callback:function(t){e.projectSearchName="string"==typeof t?t.trim():t},expression:"projectSearchName"}},[s("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})])],1)]),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{"element-loading-text":"数据加载中...",data:e.projects},on:{"sort-change":e.sortChange,"row-dblclick":function(t){return e.$router.push("/decision/project/"+t.uuid)}}},[s("el-table-column",{attrs:{label:"名称",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.openProject(t.row.uuid)}}},[e._v(e._s(t.row.name))]),e._v(" "),t.row.auditCount>0&&e.$hasPerm("project.pkg.baseline:audit")?s("el-tooltip",{attrs:{content:"有"+t.row.auditCount+"个基线待审核",placement:"top"}},[s("el-tag",{attrs:{type:"danger",size:"mini",effect:"dark"}},[e._v("\n              "+e._s(t.row.auditCount)+"\n            ")])],1):e._e()]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"description",label:"描述","show-overflow-tooltip":!0}}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"更新时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.updateTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{sortable:"custom",label:"创建时间",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("formatDateTime")(t.row.createTime))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"创建人",width:"80","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e._f("getRealname")(t.row.creator))+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"text"},on:{click:function(s){return s.stopPropagation(),e.openPkg(t.row.uuid)}}},[e._v("\n            知识包\n          ")])]}}])})],1),e._v(" "),s("pagination",{attrs:{total:e.total,"current-page":e.page,"page-size":e.pageNum},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"update:pageSize":function(t){e.pageNum=t},"update:page-size":function(t){e.pageNum=t},change:e.loadData}})],1)};pl._withStripped=!0;const hl={name:"user-project",props:{userUuid:String},data:()=>({projects:[],total:0,page:1,pageNum:10,form:{uuid:"",userUuid:"",name:"",description:""},sortOption:{sortField:"",sortDirection:""},projectSearchName:"",tableLoading:!1}),mounted(){this.loadData()},watch:{userUuid(){this.loadData()}},methods:{sortChange(e){this.sortOption.sortField=e.prop,this.sortOption.sortDirection="ascending"==e.order?"asc":"desc",this.loadData()},search(){this.page=1,this.loadData()},loadData(){this.tableLoading=!0,this.$axios.get("/user/project",{params:{page:this.page,pageNum:this.pageNum,projectName:this.projectSearchName,sortField:this.sortOption.sortField,sortDirection:this.sortOption.sortDirection,userUuid:this.userUuid}}).then((e=>{0==e.data.code&&(this.projects=e.data.data,this.total=e.data.total),this.tableLoading=!1})).catch((()=>{this.tableLoading=!1}))},openProject(e){let t=this.$router.resolve({path:"/decision/project/"+e});window.open(t.href)},openPkg(e){let t=this.$router.resolve({path:"/decision/project/"+e+"/knowledgepackage"});window.open(t.href,"_blank")}}};var ml=(0,A.Z)(hl,pl,[],!1,null,"6d9e4760",null);ml.options.__file="src/view/settings/user/user-project.vue";const fl={name:"user-profile",components:{UserLogs:Oi,UserLoginLogs:ul,UserProject:ml.exports},props:{show:Boolean,userUuid:String},data:()=>({activeName:"first",user:{lastLoginTime:"",expiredTime:"",realname:"",username:"",orgname:"",rulenames:"",disabled:!1}}),mounted(){},watch:{userUuid(e,t){this.$nextTick((()=>{this.userUuid=e}))}},methods:{open(){this.activeName="first",this.initUser()},initUser(){this.$axios.get("/user/"+this.userUuid).then((e=>{0==e.data.code?this.user=e.data.data:this.$message.error(e.data.msg?e.data.msg:"系统异常")})).catch((()=>{this.$message.error("系统异常")}))},close(){this.$emit("update:show",!1)},closed(){},clickTab(e){}}};var gl=(0,A.Z)(fl,rl,[],!1,null,"0bcd52e0",null);gl.options.__file="src/view/settings/user/user-profile.vue";const vl=gl.exports;var bl=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.loading||e.showPie?s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"main",style:{width:e.width,height:e.height},attrs:{"element-loading-text":"数据加载中..."}}):s("div",{staticClass:"font-secondary",staticStyle:{"text-align":"center"}},[e._v("暂无数据")])};bl._withStripped=!0;const wl={name:"echarts-pie",props:{width:{type:String,default:"100%"},height:{type:String,default:"300px"},data:[Array,Function]},data:()=>({loading:!1,showPie:!1}),mounted(){this.load()},methods:{load(){if(Array.isArray(this.data))this.initChart(this.data);else if("function"==typeof this.data){const e=this.data();Array.isArray(e)?this.initChart(e):e instanceof Promise&&(this.loading=!0,e.then((e=>{this.initChart(e),this.loading=!1})).catch((e=>{console.error(e),this.loading=!1})))}},async initChart(e){if(0==e.length)return;this.showPie=!0;const t={title:{text:"总数："+e.reduce(((e,t)=>({value:(e.value||0)+(t.value||0)}))).value,left:"right"},tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{name:"资源数量",type:"pie",data:e,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{formatter:"{b}: {c}"}}]},i=await Promise.all([s.e(216),s.e(759),s.e(395)]).then(s.bind(s,32567)),{PieChart:a}=await Promise.all([s.e(216),s.e(759),s.e(395)]).then(s.bind(s,63594)),{TitleComponent:o,TooltipComponent:n,LegendComponent:r}=await Promise.all([s.e(216),s.e(759),s.e(395)]).then(s.bind(s,58592)),{CanvasRenderer:l}=await Promise.all([s.e(216),s.e(759),s.e(395)]).then(s.bind(s,88378));i.use([o,n,r,a,l]),this.$nextTick((()=>{i.init(this.$refs.main).setOption(t)}))}}};var yl=(0,A.Z)(wl,bl,[],!1,null,"1e4364c4",null);yl.options.__file="src/components/echarts/echarts-pie.vue";const _l=yl.exports,xl={install:function(e,t={}){e.component("value-input",xo),e.component("func",Do),e.component("model",Lo),e.component("fact",Oo),e.component("constant",Ro),e.component("attr",Vo),e.component("arith",Wo),e.component("op",ls),e.component("expression",Fe),e.component("action",Yo),e.component("collection-child",on),e.component("test-collection",cn),e.component("test-collection-child",hn),e.component("test-object",vn),e.component("thirdapi",en),e.component("assets-view",_n),e.component("assets-editor-dialog",Tn),e.component("save-btn",Nn),e.component("assets-version-dialog",jn),e.component("ruleflow-trace",zn),e.component("cascader",Mr),e.component("dropdown",Ur),e.component("dropdown-menu",qr),e.component("dropdown-item",Jr),e.component("pagination",Xr),e.component("date-picker",sl),e.component("lhs-editor",nl),e.component("echarts-pie",_l),e.component("user-profile",vl)}};class kl{constructor(e){this.date=e,this.currentYear=p()().year()}format(e,t=!0){const s=p()(this.date);return t&&e.startsWith("YYYY")&&this.currentYear==s.year()&&(e=e.substring(e.indexOf("M"))),s.format(e)}}function $l(e){return new kl(e)}const Tl={};let Dl,Sl=0,Cl=-1;function Nl(e){e.target!=Dl&&(Dl.style.display="none")}function Ll(e){e.stopPropagation();const t=e.target;if("li"==t.tagName.toLocaleLowerCase()){const e=Dl.children;for(let s=0,i=e.length;s<i;s++)if(e[s]==t){const e=Tl[Cl].cache[s];"function"==typeof e.click&&e.click(e.command)}Dl.style.display="none"}}function Al(e){return Dl||(Dl=document.createElement("ul"),document.body.appendChild(Dl),Dl.className="el-dropdown-menu el-popper",Dl.style.transformOrigin="center bottom 0px",Dl.addEventListener("click",Ll,!1),document.body.addEventListener("click",Nl,!1)),function(e,t){const s=Tl[t],i="function"==typeof s.items?s.items():s.items,a=[];let o="";i.forEach((e=>{if(!1===e.filter||"function"==typeof e.filter&&!e.filter(e))return!0;o+='<li class="el-dropdown-menu__item',(!0===e.disabled||"function"==typeof e.disabled&&e.disabled(e))&&(o+=" is-disabled"),e.divided&&(o+=" el-dropdown-menu__item--divided"),o+='">',e.icon?o+=`<i class="${e.icon}"></i> ${e.text}`:o+=e.text,o+="</li>",a.push(e)})),Dl.innerHTML=o,function(e){let t=document.documentElement.scrollLeft||document.body.scrollLeft,s=document.documentElement.scrollTop||document.body.scrollTop,i=e.pageX||e.clientX+t,a=e.pageY||e.clientY+s;Dl.style.display="block",i+Dl.offsetWidth>document.body.scrollWidth&&(i-=Dl.offsetWidth),a+Dl.offsetHeight+10>document.body.scrollHeight&&(a-=Dl.offsetHeight),Dl.style.left=i+Dl.style.width+"px",Dl.style.top=a+"px"}(e),Cl=t,s.cache=a}(e,this.seed),e.preventDefault(),!1}function El(e){const t=e.value;return t&&t.items?"function"!=typeof t.items&&0==t.items.length?null:t:null}const Fl={bind:function(e,t,s){const i=El(t);null!=i&&(e.seed=Sl++,Tl[e.seed]=i,e.addEventListener("contextmenu",Al,!0))},update:function(e,t,s){const i=El(t);null!=i&&(Tl[e.seed]=i)},unbind:function(e,t,s){delete Tl[e.seed],e.removeEventListener("contextmenu",Al,!0)}};i.default.filter("formatDate",(function(e){return e?$l(e).format("YYYY-MM-DD"):""})),i.default.filter("formatTime",(function(e){return e?$l(e).format("HH:mm"):""})),i.default.filter("formatDateTime",(function(e){return e?$l(e).format("YYYY-MM-DD HH:mm"):""})),i.default.filter("getRealname",(function(e){return e?e.realname?e.realname:e.username:""})),i.default.filter("replaceBr",(function(e){return e?e.replace(/\n/g,"<br>"):""})),i.default.directive("contextmenu",Fl),i.default.use(y),i.default.use(xl),i.default.use(c),i.default.use({install:function(e,t={}){e.prototype.$conjunction={AND:"并且",OR:"或者"}}}),i.default.use({install:function(e,t={}){e.prototype.$op={items:[{value:"EQ",text:"等于",enabled:["Integer","Long","Double","BigDecimal","String","Boolean","Number","Date","DateTime","Object","Derive"]},{value:"NEQ",text:"不等于",enabled:["Integer","Long","Double","BigDecimal","String","Boolean","Number","Date","DateTime","Object","Derive"]},{value:"GT",text:"大于",enabled:["Integer","Long","Double","BigDecimal","Number","Date","DateTime","String","Derive"]},{value:"GTE",text:"大于或等于",enabled:["Integer","Long","Double","BigDecimal","Number","Date","DateTime","String","Derive"]},{value:"LT",text:"小于",enabled:["Integer","Long","Double","BigDecimal","Number","Date","DateTime","String","Derive"]},{value:"LTE",text:"小于或等于",enabled:["Integer","Long","Double","BigDecimal","Number","Date","DateTime","String","Derive"]},{value:"MATCHES",text:"匹配正则表达式",enabled:["String"]},{value:"NOT_MATCHES",text:"不匹配正则表达式",enabled:["String"]},{value:"CONTAINS",text:"包含",enabled:["String","List","Set"]},{value:"NOT_CONTAINS",text:"不包含",enabled:["String","List","Set"]},{value:"STR_STARTSWITH",text:"开始于",enabled:["String"]},{value:"STR_NOT_STARTSWITH",text:"不开始于",enabled:["String"]},{value:"STR_ENDSWITH",text:"结束于",enabled:["String"]},{value:"STR_NOT_ENDSWITH",text:"不结束于",enabled:["String"]},{value:"STR_LENGTH",text:"长度为",enabled:["String"]},{value:"STR_NOT_LENGTH",text:"长度不为",enabled:["String"]}],getText(e){let t;return this.items.some((s=>{if(s.value==e)return t=s.text,!0})),t},filterItems(e){if(!e)return this.items;const t=e.indexOf(".");-1!=t&&(e=e.substring(0,t));let s=[];return this.items.forEach((t=>{if(-1!=t.enabled.indexOf(e))return s.push(t),!0})),s}}}}),i.default.use(bo),i.default.use({install:function(e,t={}){e.prototype.$attr={items:[{name:"salience",label:"优先级"},{name:"date-effective",label:"生效时间"},{name:"date-expires",label:"失效时间"},{name:"activation-group",label:"互斥组"},{name:"agenda-group",label:"生效组"},{name:"enabled",label:"是否可用"}],getLabel(e){let t;return this.items.some((s=>{if(s.name==e)return t=s.label,!0})),t},getName(e){let t;return this.items.some((s=>{if(s.label==e)return t=s.name,!0})),t}}}}),i.default.config.productionTip=!1,i.default.prototype.$moment=$l,i.default.prototype.$hasPerm=S,i.default.prototype.$hasAnyPerm=function(...e){let t=!1;return e.some((e=>{if(S(e))return t=!0,!0})),t},new i.default({el:"#app",router:ho,store:k,render:e=>e(go)})},49674:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=49674,e.exports=t},42650:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/d4bf5b020378040efb9c.jpg"},63848:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/963410fdef34540055f3.jpg"},26365:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/ac82bb1f1da88456c7c2.jpg"},47875:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/e07579cd6852c19304b2.jpg"},47210:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/15d60c4199134a90414e.jpg"},89597:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/b88cbd450a381f7367ea.png"},62124:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/b9960d77688aee71ea07.png"},35959:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/473e2c15e01c5b9e4b23.png"},81194:(e,t,s)=>{"use strict";e.exports=s.p+"static/img/95e1c14898a791f5acef.png"}},0,[[40647,666,216]]]);